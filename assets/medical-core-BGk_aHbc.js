class y{constructor(){this.state={currentScreen:"login",results:null,sessionId:null,startTime:null,formData:{},validationErrors:{},screenHistory:[]},this.listeners=new Set,this.initialize()}initialize(){this.state.sessionId=this.generateSessionId(),this.state.startTime=Date.now()}generateSessionId(){const e=Date.now();try{if(typeof crypto!="undefined"&&crypto.getRandomValues){const r=new Uint8Array(8);crypto.getRandomValues(r);const s=Array.from(r).map(i=>i.toString(16).padStart(2,"0")).join("");return`session_${e}_${s}`}}catch(r){}const t=Math.random().toString(36).slice(2,10);return`session_${e}_${t}`}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){console.log(`[Store] Notifying ${this.listeners.size} listeners of state change`),this.listeners.forEach(e=>e(this.state))}getState(){return{...this.state}}setState(e){this.state={...this.state,...e},this.notify()}navigate(e){console.log(`[Store] navigate called: ${this.state.currentScreen} -> ${e}`);const t=[...this.state.screenHistory];this.state.currentScreen!==e&&!t.includes(this.state.currentScreen)&&t.push(this.state.currentScreen);const r={currentScreen:e,screenHistory:t};console.log("[Store] Setting new navigation state:",r),this.setState(r),console.log("[Store] State after navigation:",this.state.currentScreen)}goBack(){const e=[...this.state.screenHistory];if(e.length>0){const t=e.pop();return this.setState({currentScreen:t,screenHistory:e}),!0}return!1}goHome(){this.setState({currentScreen:"triage1",screenHistory:[]})}setFormData(e,t){const r={...this.state.formData};r[e]={...t},this.setState({formData:r})}getFormData(e){return this.state.formData[e]||{}}setValidationErrors(e){this.setState({validationErrors:e})}clearValidationErrors(){this.setState({validationErrors:{}})}setResults(e){this.setState({results:e})}hasUnsavedData(){return Object.keys(this.state.formData).length>0&&!this.state.results}reset(){const e={currentScreen:"triage1",results:null,sessionId:this.generateSessionId(),startTime:Date.now(),formData:{},validationErrors:{},screenHistory:[]};this.setState(e)}logEvent(e,t={}){this.state.sessionId}getSessionDuration(){return Date.now()-this.state.startTime}}const D=new y,v=!1,I={success:!0,message:"Development mode - authentication bypassed",session_token:`dev-token-${Date.now()}`,expires_at:new Date(Date.now()+30*60*1e3).toISOString(),session_duration:1800},T={coma_ich:{probability:25.3,ich_probability:25.3,drivers:{gfap_value:.4721,baseline_risk:.1456},confidence:.75},limited_ich:{probability:31.7,ich_probability:31.7,drivers:{age_years:.2845,systolic_bp:.1923,gfap_value:.4231,vigilanzminderung:.3456},confidence:.65},full_stroke:{ich_prediction:{probability:28.4,drivers:{age_years:.1834,gfap_value:.3921,systolic_bp:.2341,vigilanzminderung:.2876},confidence:.88},lvo_prediction:{probability:45.2,drivers:{fast_ed_score:.7834,age_years:.2341,eye_deviation:.1923},confidence:.82}},authenticate:{success:!0,message:"Development mode - authentication bypassed",session_token:`dev-token-${Date.now()}`,expires_at:new Date(Date.now()+30*60*1e3).toISOString(),session_duration:1800}},R={COMA_ICH:"https://europe-west3-igfap-452720.cloudfunctions.net/predict_coma_ich",LDM_ICH:"https://europe-west3-igfap-452720.cloudfunctions.net/predict_limited_data_ich",FULL_STROKE:"https://europe-west3-igfap-452720.cloudfunctions.net/predict_full_stroke",LVO_PREDICTION:"https://europe-west3-igfap-452720.cloudfunctions.net/predict_lvo",AUTHENTICATE:"https://europe-west3-igfap-452720.cloudfunctions.net/authenticate-research-access"},M={isDevelopment:v,mockAuthResponse:I,mockApiResponses:T},N={ich:{medium:25,high:50},lvo:{medium:25,high:50}},g={min:29,max:10001,normal:100,elevated:500,critical:1e3},C={autoSaveInterval:18e4,sessionTimeout:30*60*1e3},w={caseSharingUrl:"https://case-sharing-564499947017.europe-west3.run.app",googleMapsApiKey:"AIzaSyACBndIj8HD1wwZ4Vw8PDDI0bIe6DoBExI",gpsUpdateInterval:3e4,gpsHighAccuracy:!0,gpsTimeout:1e4,gpsMaxAge:0,autoArchiveHours:2,staleGpsMinutes:5},f={age_years:{required:!0,min:0,max:120,type:"integer",medicalCheck:c=>c<18?"Emergency stroke assessment typically for adults (≥18 years)":null},systolic_bp:{required:!0,min:60,max:300,type:"number",medicalCheck:(c,e)=>{const t=e==null?void 0:e.diastolic_bp;return t&&c<=t?"Systolic BP must be higher than diastolic BP":null}},diastolic_bp:{required:!0,min:30,max:200,type:"number",medicalCheck:(c,e)=>{const t=e==null?void 0:e.systolic_bp;return t&&c>=t?"Diastolic BP must be lower than systolic BP":null}},gfap_value:{required:!0,min:g.min,max:g.max,type:"number",medicalCheck:c=>c>8e3?"Warning: Extremely high GFAP value - please verify lab result (still valid)":null},fast_ed_score:{required:!0,min:0,max:9,type:"integer",medicalCheck:c=>c>=4?"High FAST-ED score suggests LVO - consider urgent intervention":null},gcs:{required:!0,min:3,max:15,type:"integer",medicalCheck:c=>c<8?"GCS < 8 indicates severe consciousness impairment - consider coma module":null}};function b(c,e,t,r=null){const s={errors:[],warnings:[]};if(t.required&&!e&&e!==0&&s.errors.push("This field is required"),t.min!==void 0&&e!==""&&!isNaN(e)&&parseFloat(e)<t.min&&s.errors.push(`Value must be at least ${t.min}`),t.max!==void 0&&e!==""&&!isNaN(e)&&parseFloat(e)>t.max&&s.errors.push(`Value must be at most ${t.max}`),t.pattern&&!t.pattern.test(e)&&s.errors.push("Invalid format"),t.medicalCheck&&e!==""&&!isNaN(e)){const i=t.medicalCheck(parseFloat(e),r);i&&s.warnings.push(i)}return s.warnings.length===0?s.errors:s}function P(c){let e=!0;const t={},r={};Object.keys(f).forEach(i=>{const o=c.elements[i];o&&(r[i]=o.value)});const s={};return Object.entries(f).forEach(([i,o])=>{const n=c.elements[i];if(n){const a=b(i,n.value,o,r);Array.isArray(a)?a.length>0&&(t[i]=a,e=!1):(a.errors.length>0&&(t[i]=a.errors,e=!1),a.warnings.length>0&&(s[i]=a.warnings))}}),{isValid:e,validationErrors:t,validationWarnings:s}}function H(c,e){Object.entries(e).forEach(([t,r])=>{const s=c.querySelector(`[name="${t}"]`);if(s){const i=s.closest(".input-group");if(i){i.classList.add("error"),i.querySelectorAll(".error-message").forEach(a=>a.remove());const o=document.createElement("div");o.className="error-message";const n=document.createElement("span");n.className="error-icon",n.textContent="⚠️",o.appendChild(n),o.appendChild(document.createTextNode(` ${r[0]}`)),i.appendChild(o)}}})}class A{constructor(){this.observers=new Map,this.eventHistory=[],this.maxHistorySize=1e3}subscribe(e,t,r={}){if(typeof t!="function")throw new Error("Observer callback must be a function");this.observers.has(e)||this.observers.set(e,new Set);const s={callback:t,id:`obs_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,priority:r.priority||0,once:r.once||!1,medicalContext:r.medicalContext||null};return this.observers.get(e).add(s),()=>{const i=this.observers.get(e);i&&(i.delete(s),i.size===0&&this.observers.delete(e))}}publish(e,t={},r={}){const s=this.observers.get(e);if(!s||s.size===0)return;const i={type:e,data:this.sanitizeEventData(t),metadata:{timestamp:new Date().toISOString(),source:"MedicalEventObserver",...r},id:`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};this.logEvent(i),Array.from(s).sort((n,a)=>a.priority-n.priority).forEach(n=>{try{n.callback(i),n.once&&s.delete(n)}catch(a){}})}sanitizeEventData(e){const t=["password","ssn","medical_record_number","patient_id"],r={...e};return t.forEach(s=>{r[s]&&(r[s]="[REDACTED]")}),r}logEvent(e){this.eventHistory.push({...e,loggedAt:new Date().toISOString()}),this.eventHistory.length>this.maxHistorySize&&this.eventHistory.shift()}getEventHistory(e=null){return e?this.eventHistory.filter(t=>t.type===e):[...this.eventHistory]}clearAll(){this.observers.clear(),this.eventHistory=[]}getStats(){const e={totalEventTypes:this.observers.size,totalObservers:0,eventHistory:this.eventHistory.length,eventTypes:{}};return this.observers.forEach((t,r)=>{e.totalObservers+=t.size,e.eventTypes[r]=t.size}),e}}const h={PATIENT_DATA_UPDATED:"patient_data_updated",VALIDATION_ERROR:"validation_error",VALIDATION_SUCCESS:"validation_success",TRIAGE_COMPLETED:"triage_completed",ASSESSMENT_STARTED:"assessment_started",RESULTS_GENERATED:"results_generated",PERFORMANCE_WARNING:"performance_warning",SECURITY_EVENT:"security_event",AUDIT_EVENT:"audit_event",FORM_SUBMITTED:"form_submitted",NAVIGATION_CHANGED:"navigation_changed",SESSION_TIMEOUT:"session_timeout"},d=new A,l={API_CALL:"api_call",VALIDATION:"validation",PREDICTION:"prediction",RENDER:"render",USER_INTERACTION:"user_interaction",NETWORK:"network",CACHE:"cache"},p={CRITICAL_API_RESPONSE:3e3,VALIDATION_RESPONSE:100,PREDICTION_RESPONSE:5e3,UI_RENDER:16,USER_INTERACTION:100,MEMORY_LEAK_THRESHOLD:50*1024*1024};class E{constructor(e,t,r=performance.now()){this.type=e,this.name=t,this.startTime=r,this.endTime=null,this.duration=null,this.metadata={},this.id=`perf_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.timestamp=new Date().toISOString()}end(){return this.endTime=performance.now(),this.duration=this.endTime-this.startTime,this}addMetadata(e,t){return this.metadata[e]=t,this}exceedsThreshold(){const e=p[this.getThresholdKey()];return e&&this.duration>e}getThresholdKey(){switch(this.type){case l.API_CALL:return this.metadata.critical?"CRITICAL_API_RESPONSE":"PREDICTION_RESPONSE";case l.VALIDATION:return"VALIDATION_RESPONSE";case l.PREDICTION:return"PREDICTION_RESPONSE";case l.RENDER:return"UI_RENDER";case l.USER_INTERACTION:return"USER_INTERACTION";default:return null}}getPerformanceGrade(){const e=p[this.getThresholdKey()];if(!e)return"N/A";const t=this.duration/e;return t<=.5?"EXCELLENT":t<=.75?"GOOD":t<=1?"ACCEPTABLE":t<=1.5?"WARNING":"CRITICAL"}}class O{constructor(){this.metrics=new Map,this.activeMetrics=new Map,this.memoryBaseline=null,this.performanceObserver=null,this.isMonitoring=!1,this.reportingInterval=null,this.config={reportingIntervalMs:3e4,maxMetricsRetention:1e3,enableMemoryMonitoring:!0,enableNetworkMonitoring:!0,enableUserTimingAPI:!0}}start(){this.isMonitoring||(this.isMonitoring=!0,this.memoryBaseline=this.getMemoryUsage(),window.PerformanceObserver&&this.initializePerformanceObserver(),this.reportingInterval=setInterval(()=>{this.generatePerformanceReport()},this.config.reportingIntervalMs),d.publish(h.AUDIT_EVENT,{action:"performance_monitoring_started",memoryBaseline:this.memoryBaseline}))}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null),this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=null),d.publish(h.AUDIT_EVENT,{action:"performance_monitoring_stopped",totalMetrics:this.metrics.size}))}initializePerformanceObserver(){try{this.performanceObserver=new PerformanceObserver(e=>{e.getEntries().forEach(t=>{this.recordPerformanceEntry(t)})}),this.performanceObserver.observe({entryTypes:["measure","navigation","resource"]})}catch(e){}}recordPerformanceEntry(e){let t=l.NETWORK,{name:r}=e;switch(e.entryType){case"navigation":t=l.RENDER,r="page_load";break;case"resource":t=e.name.includes("/api/")?l.API_CALL:l.NETWORK;break;case"measure":t=this.categorizeUserMeasure(e.name);break}const s=new E(t,r,e.startTime);s.end(),s.duration=e.duration,s.addMetadata("entryType",e.entryType),this.storeMetric(s)}categorizeUserMeasure(e){return e.includes("validation")?l.VALIDATION:e.includes("prediction")?l.PREDICTION:e.includes("render")?l.RENDER:e.includes("api")?l.API_CALL:l.USER_INTERACTION}startMeasurement(e,t,r={}){const s=new E(e,t);return Object.entries(r).forEach(([i,o])=>{s.addMetadata(i,o)}),this.activeMetrics.set(s.id,s),this.config.enableUserTimingAPI&&performance.mark&&performance.mark(`${t}_start`),s.id}endMeasurement(e,t={}){const r=this.activeMetrics.get(e);if(!r)return null;if(r.end(),Object.entries(t).forEach(([s,i])=>{r.addMetadata(s,i)}),this.config.enableUserTimingAPI&&performance.mark&&performance.measure)try{performance.mark(`${r.name}_end`),performance.measure(r.name,`${r.name}_start`,`${r.name}_end`)}catch(s){}return this.activeMetrics.delete(e),this.storeMetric(r),r.exceedsThreshold()&&this.handlePerformanceViolation(r),r}storeMetric(e){if(this.metrics.set(e.id,e),this.metrics.size>this.config.maxMetricsRetention){const t=this.metrics.keys().next().value;this.metrics.delete(t)}d.publish(h.PERFORMANCE_METRIC,{metric:{id:e.id,type:e.type,name:e.name,duration:e.duration,grade:e.getPerformanceGrade(),exceedsThreshold:e.exceedsThreshold()}})}handlePerformanceViolation(e){const t={metricId:e.id,type:e.type,name:e.name,duration:e.duration,threshold:p[e.getThresholdKey()],grade:e.getPerformanceGrade(),metadata:e.metadata};d.publish(h.PERFORMANCE_VIOLATION,t),e.getPerformanceGrade()}getMemoryUsage(){return performance.memory?{usedJSHeapSize:performance.memory.usedJSHeapSize,totalJSHeapSize:performance.memory.totalJSHeapSize,jsHeapSizeLimit:performance.memory.jsHeapSizeLimit,timestamp:Date.now()}:null}checkMemoryLeaks(){if(!this.config.enableMemoryMonitoring||!this.memoryBaseline)return null;const e=this.getMemoryUsage();if(!e)return null;const t=e.usedJSHeapSize-this.memoryBaseline.usedJSHeapSize,r=t>p.MEMORY_LEAK_THRESHOLD;return r&&d.publish(h.AUDIT_EVENT,{action:"memory_leak_detected",memoryIncrease:t,baseline:this.memoryBaseline.usedJSHeapSize,current:e.usedJSHeapSize}),{memoryIncrease:t,isLeak:r,baseline:this.memoryBaseline,current:e}}generatePerformanceReport(){const e=Array.from(this.metrics.values()),r=Date.now()-60*60*1e3,s=e.filter(n=>new Date(n.timestamp).getTime()>r),i=s.reduce((n,a)=>(n[a.type]||(n[a.type]=[]),n[a.type].push(a),n),{}),o={timestamp:new Date().toISOString(),timeframe:"last_hour",totalMetrics:s.length,memoryStatus:this.checkMemoryLeaks(),metricsByType:{},violations:s.filter(n=>n.exceedsThreshold()).length,topSlowOperations:this.getTopSlowOperations(s)};return Object.entries(i).forEach(([n,a])=>{const m=a.map(u=>u.duration),_=a.map(u=>u.getPerformanceGrade());o.metricsByType[n]={count:a.length,averageDuration:m.reduce((u,S)=>u+S,0)/m.length,medianDuration:this.calculateMedian(m),minDuration:Math.min(...m),maxDuration:Math.max(...m),violations:a.filter(u=>u.exceedsThreshold()).length,gradeDistribution:this.calculateGradeDistribution(_)}}),d.publish(h.PERFORMANCE_REPORT,o),o}calculateMedian(e){const t=[...e].sort((s,i)=>s-i),r=Math.floor(t.length/2);return t.length%2===0?(t[r-1]+t[r])/2:t[r]}calculateGradeDistribution(e){return e.reduce((t,r)=>(t[r]=(t[r]||0)+1,t),{})}getTopSlowOperations(e,t=10){return e.sort((r,s)=>s.duration-r.duration).slice(0,t).map(r=>({name:r.name,type:r.type,duration:r.duration,grade:r.getPerformanceGrade(),timestamp:r.timestamp}))}getTypeStatistics(e,t=60*60*1e3){const s=Date.now()-t,i=Array.from(this.metrics.values()).filter(n=>n.type===e&&new Date(n.timestamp).getTime()>s);if(i.length===0)return null;const o=i.map(n=>n.duration);return{type:e,count:i.length,averageDuration:o.reduce((n,a)=>n+a,0)/o.length,medianDuration:this.calculateMedian(o),minDuration:Math.min(...o),maxDuration:Math.max(...o),violations:i.filter(n=>n.exceedsThreshold()).length}}clearMetrics(){this.metrics.clear(),this.activeMetrics.clear(),d.publish(h.AUDIT_EVENT,{action:"performance_metrics_cleared"})}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e},e.reportingIntervalMs&&this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=setInterval(()=>{this.generatePerformanceReport()},this.config.reportingIntervalMs))}}const L=new O;export{R as A,N as C,M as D,g as G,w as K,h as M,l as P,L as a,H as b,C as c,d as m,D as s,P as v};
//# sourceMappingURL=medical-core-BGk_aHbc.js.map
