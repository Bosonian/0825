{"version":3,"mappings":"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","names":["Store","timestamp","randomBytes","randomHex","b","listener","updates","screen","history","previousScreen","module","data","formData","errors","results","newState","eventName","store","API_URLS","CRITICAL_THRESHOLDS","GFAP_RANGES","APP_CONFIG","VALIDATION_RULES","value","diastolic","systolic","_0x4f2a","_0xc3d1","_0x8a9f","MODEL_PARAMS","k1","k2","k3","_0xTransform","x","λ","v","m","s","z","_0xe","predictLVO","gfapValue","fastEdScore","_0xg","_0xf","_0xKeys","_0x1Transform","_0xNoise1","_0x2Scaled","_0x3Scaled","_0xLogit","a","c","probability","gfapScaled","fastEdScaled","logit","riskFactors","_0xContrib","_0xThreshold","interpretLVOProbability","error","probPercent","canUseLocalModel","patientData","MedicalEventObserver","eventType","callback","options","observer","eventObservers","metadata","event","sensitiveFields","sanitized","field","stats","observers","MEDICAL_EVENTS","medicalEventObserver","PerformanceMetricType","MedicalPerformanceThresholds","PerformanceMetric","type","name","startTime","key","threshold","ratio","MedicalPerformanceMonitor","list","entry","metricType","metric","metricId","additionalMetadata","oldestKey","violation","currentMemory","memoryIncrease","isLeak","metrics","lastHour","recentMetrics","metricsByType","acc","report","typeMetrics","durations","grades","values","sorted","mid","grade","limit","timeframeMs","cutoff","newConfig","medicalPerformanceMonitor","CacheStorageType","CachePriority","MedicalCacheTTL","CacheEntry","ttl","priority","obj","priorityWeight","accessWeight","ageWeight","MedicalCache","storageType","cacheData","parsed","entryData","size","oldEntry","entriesCleared","lowestScore","keyToEvict","score","cleanedCount","duration","hitRate","MedicalCacheFactory","cache","__publicField","apiCache","extractDriversFromResponse","response","predictionType","rawDrivers","_a","_b","formattedDrivers","formatDriversFromDictionary","fastEdFeature","f","drivers","positive","negative","label","weight","extractProbabilityFromResponse","extractConfidenceFromResponse","confidence","warmUpFunctions","warmUpPromises","url","controller","timeoutId","APIError","message","status","normalizeBooleans","payload","normalized","safeParseFloat","defaultValue","createCacheKey","urlKey","payloadHash","fetchJSON","cacheable","cacheTTL","cachePriority","critical","cacheKey","cachedData","errorMessage","errorData","apiError","predictComaIch","normalizedPayload","result","predictLimitedIch","fullPayload","predictFullStroke","lvoResult","localLVO","factor","ichProbability","ichDrivers","ichConfidence","ichResult","lvoProbability","lvoDrivers","lvoConfidence","messages","I18n","savedLanguage","language","newLanguage","lang","date","locale","i18n","t","getPrerequisites","renderPrerequisitesModal","prerequisites","item","initPrerequisitesModal","modal","closeBtn","cancelBtn","confirmBtn","closeModal","navigate","e","checkboxes","allChecked","cb","warning","checkbox","showPrerequisitesModal","existingModal","modalElement","validateInput","rules","medicalWarning","validateForm","form","isValid","validationErrors","input","validationWarnings","validation","showValidationErrors","container","group","el","errorDiv","iconSpan","handleTriage1","isComatose","handleTriage2","isExaminable","reset","goBack","goHome","handleSubmit","firstErrorName","sr","errorCount","inputs","element","n","button","originalContent","showError","alert","h4","p","containerDiv","LegacyICHModel","age","scaledAge","scaledGfap","rawProbability","riskCategory","mainResults","legacyResults","mainProb","legacyProb","absoluteDifference","relativeDifference","higherRiskModel","agreement","absDiff","difference","testCase","passedTests","r","totalTests","calculateLegacyICH","gfap","ResearchDataLogger","comparisonData","stored","headers","rows","_c","_d","_e","_f","_h","_g","_j","_i","_l","_k","_n","_m","format","filename","blob","link","entries","differences","d","avgDifference","sum","sessionId","safeLogResearchData","isResearchModeEnabled","setResearchMode","enabled","renderResearchToggle","renderModelComparison","comparison","renderProbabilityBars","renderDifferenceAnalysis","renderCalculationDetails","renderModelMetrics","initializeResearchMode","closeResearch","panel","exportButton","detailsToggle","details","clearButton","summary","AuthenticationManager","hashedInput","validHash","hashBuffer","session","lastActivity","events","updateActivity","resolve","timeRemaining","hoursRemaining","minutesRemaining","authManager","renderProgressIndicator","currentStep","steps","html","step","index","isActive","isCompleted","renderTriage1","renderTriage2","renderComa","renderLimited","renderFull","renderCriticalAlert","FIELD_LABEL_MAP","PATTERN_REPLACEMENTS","formatDriverName","fieldName","mappedKey","translated","formatted","pattern","replacement","l","formatSummaryLabel","formatDisplayValue","renderDriversSection","ich","lvo","renderEnhancedDriversPanel","title","driversViewModel","positiveDrivers","negativeDrivers","maxWeight","totalPositiveWeight","driver","relativeImportance","barWidth","cleanLabel","totalNegativeWeight","COMPREHENSIVE_HOSPITAL_DATABASE","ROUTING_ALGORITHM","location","state","timeFromOnset","clinicalFactors","detectedState","database","destination","comprehensiveOptions","allThrombolysisCapable","strokeUnitsAndHigher","stateCenters","nearestState","minDistance","center","distance","userLocation","hospitals","hospital","point1","point2","dLat","dLng","deg","calculateDistance","lat1","lng1","lat2","lng2","toRadians","degrees","calculateTravelTime","fromLat","fromLng","toLat","toLng","profile","route","calculateEmergencyTravelTime","renderStrokeCenterMap","initializeStrokeCenterMap","useGpsButton","manualLocationButton","locationManual","locationInput","searchLocationButton","resultsContainer","requestUserLocation","geocodeLocation","showLocationError","position","latitude","longitude","showNearestCenters","locationString","coordPattern","coordMatch","lat","lng","searchLocation","supportedStates","locationName","routing","routingExplanation","getEnhancedRoutingExplanation","getStateName","allHospitals","travelInfo","alternatives","alt","renderEnhancedStrokeCenterCard","stateCode","ichPercent","urgencyIcon","isRecommended","capabilities","networkBadge","getRiskLevel","probabilityPercent","thresholds","VOLUME_THRESHOLDS","calculateICHVolume","cappedGfap","calculatedVolume","volumeRange","riskLevel","getVolumeRiskLevel","mortalityRate","getMortalityRate","displayVolume","volume","formatVolumeDisplay","renderCircularBrainDisplay","formattedVolume","canvasId","initializeVolumeAnimations","canvas","cssWidth","cssHeight","drawVolumeFluid","ctx","centerX","centerY","radius","animationFrame","isAnimating","isDarkMode","draw","drawFluidLayer","fillHeight","baseLevel","startX","waveOffset1","waveOffset2","y","borderColor","volumePercent","progressColor","renderInputSummary","summaryHtml","moduleTitle","itemsHtml","displayValue","renderRiskCard","percent","isCritical","isHigh","icons","titles","level","renderICHVolumeDisplay","getCurrentGfapValue","volumeResult","renderResults","currentModule","getCurrentModuleName","calculateLegacyFromResults","getPatientInputs","isLimitedOrComa","resultsHtml","renderICHFocusedResults","renderFullModuleResults","mountIslands","__vitePreload","err","criticalAlert","ichPercentLocal","strokeCenterHtml","inputSummaryHtml","researchToggleHtml","researchComparisonHtml","alternativeDiagnosesHtml","renderComaAlternativeDiagnoses","strokeDifferentialHtml","renderStrokeDifferentialDiagnoses","renderVolumeCard","renderICHDriversOnly","renderBibliography","lvoPercent","isFullModule","hasValidLVO","showLVORiskCard","showVolumeCard","inRatioBand","showDominanceBanner","debugShowTachometer","cardCount","layoutClass","renderTachometerGauge","renderDominanceBanner","dominant","icon","dominantText","subtitle","driversData","renderCompactDriver","percentage","width","ichData","patientInputs","isDE","volumeData","diff","maxP","renderLoginScreen","initializeLoginScreen","loginForm","passwordInput","loginError","loginButton","password","showLoginError","setLoginLoading","hideLoginError","isLoading","buttonText","loadingSpinner","announceScreenChange","announcement","screenNames","setPageTitle","appName","section","focusMainHeading","heading","FastEdCalculator","total","component","applyBtn","totalElement","riskElement","currentScore","onApplyCallback","firstRadio","armWeaknessBoolean","eyeDeviationBoolean","remaining","components","assignToThis","fastEdCalculator","render","currentScreen","navigationHistory","tempContainer","backButton","restoreFormData","attachEvents","action","boolVal","printButton","fastEdInput","currentValue","armPareseField","eyeDeviationField","toggle","targetId","targetContent","arrow","App","homeButton","languageToggle","newLang","darkModeToggle","researchToggle","lastTouchEnd","now","resizeTimer","handleResize","vh","helpButton","helpModal","modalClose","privacyLink","disclaimerLink","versionLink","savedTheme","newTheme","isEnabled","modalTitle","resetTimeout","yearElement","app"],"ignoreList":[],"sources":["../../src/state/store.js","../../src/config.js","../../src/logic/lvo-local-model.js","../../src/patterns/observer.js","../../src/performance/medical-performance-monitor.js","../../src/performance/medical-cache.js","../../src/api/drivers.js","../../src/api/client.js","../../src/localization/messages.js","../../src/localization/i18n.js","../../src/ui/components/prerequisites-modal.js","../../src/logic/validate.js","../../src/logic/handlers.js","../../src/research/legacy-ich-model.js","../../src/research/data-logger.js","../../src/research/comparison-ui.js","../../src/auth/authentication.js","../../src/ui/components/progress.js","../../src/ui/screens/triage1.js","../../src/ui/screens/triage2.js","../../src/ui/screens/coma.js","../../src/ui/screens/limited.js","../../src/ui/screens/full.js","../../src/ui/components/alerts.js","../../src/utils/label-formatter.js","../../src/ui/components/drivers.js","../../src/data/comprehensive-stroke-centers.js","../../src/data/stroke-centers.js","../../src/ui/components/stroke-center-map.js","../../src/logic/formatters.js","../../src/logic/ich-volume-calculator.js","../../src/ui/components/brain-visualization.js","../../src/ui/screens/results.js","../../src/ui/screens/login.js","../../src/ui/a11y.js","../../src/ui/components/fastEdModal.js","../../src/ui/render.js","../../src/main-simple.js"],"sourcesContent":["// State management for the Stroke Triage Assistant\n\nclass Store {\n  constructor() {\n    this.state = {\n      currentScreen: 'triage1',\n      results: null,\n      sessionId: null,\n      startTime: null,\n      formData: {},\n      validationErrors: {},\n      screenHistory: [],\n    };\n\n    this.listeners = new Set();\n    this.initialize();\n  }\n\n  initialize() {\n    this.state.sessionId = this.generateSessionId();\n    this.state.startTime = Date.now();\n  }\n\n  generateSessionId() {\n    // Use cryptographically secure random values\n    const timestamp = Date.now();\n    const randomBytes = new Uint8Array(8);\n    crypto.getRandomValues(randomBytes);\n    const randomHex = Array.from(randomBytes)\n      .map((b) => b.toString(16).padStart(2, '0'))\n      .join('');\n    return `session_${timestamp}_${randomHex}`;\n  }\n\n  // Subscribe to state changes\n  subscribe(listener) {\n    this.listeners.add(listener);\n    return () => this.listeners.delete(listener);\n  }\n\n  // Notify all listeners of state changes\n  notify() {\n    this.listeners.forEach((listener) => listener(this.state));\n  }\n\n  // Get current state (read-only)\n  getState() {\n    return { ...this.state };\n  }\n\n  // Update state and notify listeners\n  setState(updates) {\n    this.state = { ...this.state, ...updates };\n    this.notify();\n  }\n\n  // Navigate to a new screen\n  navigate(screen) {\n    const history = [...this.state.screenHistory];\n\n    // Add current screen to history if not already there\n    if (this.state.currentScreen !== screen && !history.includes(this.state.currentScreen)) {\n      history.push(this.state.currentScreen);\n    }\n\n    this.setState({\n      currentScreen: screen,\n      screenHistory: history,\n    });\n  }\n\n  // Navigate back to previous screen\n  goBack() {\n    const history = [...this.state.screenHistory];\n\n    if (history.length > 0) {\n      const previousScreen = history.pop();\n\n      this.setState({\n        currentScreen: previousScreen,\n        screenHistory: history,\n      });\n      return true;\n    }\n\n    return false;\n  }\n\n  // Navigate to home screen\n  goHome() {\n    this.setState({\n      currentScreen: 'triage1',\n      screenHistory: [],\n    });\n  }\n\n  // Store form data for a specific module\n  setFormData(module, data) {\n    const formData = { ...this.state.formData };\n    formData[module] = { ...data };\n    this.setState({ formData });\n  }\n\n  // Get form data for a specific module\n  getFormData(module) {\n    return this.state.formData[module] || {};\n  }\n\n  // Store validation errors\n  setValidationErrors(errors) {\n    this.setState({ validationErrors: errors });\n  }\n\n  // Clear validation errors\n  clearValidationErrors() {\n    this.setState({ validationErrors: {} });\n  }\n\n  // Store prediction results\n  setResults(results) {\n    this.setState({ results });\n  }\n\n  // Check if there's unsaved data\n  hasUnsavedData() {\n    return Object.keys(this.state.formData).length > 0 && !this.state.results;\n  }\n\n  // Reset to initial state\n  reset() {\n    const newState = {\n      currentScreen: 'triage1',\n      results: null,\n      sessionId: this.generateSessionId(),\n      startTime: Date.now(),\n      formData: {},\n      validationErrors: {},\n      screenHistory: [],\n    };\n    this.setState(newState);\n  }\n\n  // Log events for audit trail\n  logEvent(eventName, data = {}) {\n    const event = {\n      timestamp: Date.now(),\n      session: this.state.sessionId,\n      event: eventName,\n      data,\n    };\n\n    // In production, send to analytics service\n    // this.sendToAnalytics(event);\n  }\n\n  // Calculate session duration\n  getSessionDuration() {\n    return Date.now() - this.state.startTime;\n  }\n}\n\n// Create and export a singleton instance\nexport const store = new Store();\n\n// Export the Store class for testing purposes\nexport { Store };\n","// Configuration for the Stroke Triage Assistant\n\nexport const API_URLS = {\n  COMA_ICH: 'https://europe-west3-igfap-452720.cloudfunctions.net/predict_coma_ich',\n  LDM_ICH: 'https://europe-west3-igfap-452720.cloudfunctions.net/predict_limited_data_ich',\n  FULL_STROKE: 'https://europe-west3-igfap-452720.cloudfunctions.net/predict_full_stroke',\n};\n\nexport const CRITICAL_THRESHOLDS = {\n  ich: {\n    medium: 25,\n    high: 50,\n  },\n  lvo: {\n    medium: 25,\n    high: 50,\n  },\n};\n\nexport const GFAP_RANGES = {\n  min: 29,\n  max: 10001,\n  normal: 100,\n  elevated: 500,\n  critical: 1000,\n};\n\nexport const APP_CONFIG = {\n  autoSaveInterval: 180000, // 3 minutes to reduce irritating screen blinks\n  sessionTimeout: 30 * 60 * 1000, // 30 minutes\n  requestTimeout: 10000, // 10 seconds\n};\n\nexport const VALIDATION_RULES = {\n  age_years: {\n    required: true,\n    min: 0,\n    max: 120,\n    type: 'integer',\n    medicalCheck: (value) => (value < 18 ? 'Emergency stroke assessment typically for adults (≥18 years)' : null),\n  },\n  systolic_bp: {\n    required: true,\n    min: 60,\n    max: 300,\n    type: 'number',\n    medicalCheck: (value, formData) => {\n      const diastolic = formData?.diastolic_bp;\n      if (diastolic && value <= diastolic) {\n        return 'Systolic BP must be higher than diastolic BP';\n      }\n      return null;\n    },\n  },\n  diastolic_bp: {\n    required: true,\n    min: 30,\n    max: 200,\n    type: 'number',\n    medicalCheck: (value, formData) => {\n      const systolic = formData?.systolic_bp;\n      if (systolic && value >= systolic) {\n        return 'Diastolic BP must be lower than systolic BP';\n      }\n      return null;\n    },\n  },\n  gfap_value: {\n    required: true,\n    min: GFAP_RANGES.min,\n    max: GFAP_RANGES.max,\n    type: 'number',\n    medicalCheck: (value) => {\n      if (value > 8000) {\n        return 'Warning: Extremely high GFAP value - please verify lab result (still valid)';\n      }\n      return null;\n    },\n  },\n  fast_ed_score: {\n    required: true,\n    min: 0,\n    max: 9,\n    type: 'integer',\n    medicalCheck: (value) => (value >= 4 ? 'High FAST-ED score suggests LVO - consider urgent intervention' : null),\n  },\n  gcs: {\n    required: true,\n    min: 3,\n    max: 15,\n    type: 'integer',\n    medicalCheck: (value) => (value < 8 ? 'GCS < 8 indicates severe consciousness impairment - consider coma module' : null),\n  },\n};\n","/**\n * Local LVO Prediction Model\n * Proprietary algorithm for stroke assessment\n */\n\n// Obfuscated model parameters\nconst _0x4f2a = [0.4731, 0.8623, 1.8253, 3.6667, 2.3495, 1.0, 0.0];\nconst _0xc3d1 = btoa('proprietary-lvo-model-v2');\nconst _0x8a9f = (i) => _0x4f2a[i];\n\n// Encoded coefficients\nconst MODEL_PARAMS = (() => {\n  const k1 = String.fromCharCode(105, 110, 116, 101, 114, 99, 101, 112, 116);\n  const k2 = String.fromCharCode(99, 111, 101, 102, 102, 105, 99, 105, 101, 110, 116, 115);\n  const k3 = String.fromCharCode(115, 99, 97, 108, 105, 110, 103);\n\n  return {\n    [k1]: -_0x8a9f(0),\n    [k2]: {\n      [String.fromCharCode(103, 102, 97, 112)]: -_0x8a9f(1),\n      [String.fromCharCode(102, 97, 115, 116, 69, 100)]: _0x8a9f(2),\n    },\n    [k3]: {\n      [String.fromCharCode(103, 102, 97, 112)]: {\n        [String.fromCharCode(109, 101, 97, 110)]: _0x8a9f(6),\n        [String.fromCharCode(115, 116, 100)]: _0x8a9f(5),\n      },\n      [String.fromCharCode(102, 97, 115, 116, 69, 100)]: {\n        [String.fromCharCode(109, 101, 97, 110)]: _0x8a9f(3),\n        [String.fromCharCode(115, 116, 100)]: _0x8a9f(4),\n      },\n    },\n  };\n})();\n\n// Obfuscated transformation functions\nconst _0xTransform = {\n  // YJ transform\n  _0x7b2c: (x, λ = 0) => {\n    const _0x1a = x >= 0;\n    if (_0x1a) {\n      return λ === 0 ? Math[String.fromCharCode(108, 111, 103)](x + 1)\n        : (Math[String.fromCharCode(112, 111, 119)](x + 1, λ) - 1) / λ;\n    }\n    return λ === 2 ? -Math[String.fromCharCode(108, 111, 103)](-x + 1)\n      : -(Math[String.fromCharCode(112, 111, 119)](-x + 1, 2 - λ) - 1) / (2 - λ);\n  },\n\n  // Standard scaler\n  _0x9d4e: (v, m, s) => {\n    const _0x2b = v - m;\n    return _0x2b / s;\n  },\n\n  // Sigmoid\n  _0x3f8a: (z) => {\n    const _0xe = Math[String.fromCharCode(101, 120, 112)];\n    return 1 / (1 + _0xe(-z));\n  },\n\n  // Noise function (doesn't affect result)\n  _0x5c1d: (x) => Math.sin(x * 1000) * 0 + x,\n};\n\n/**\n * Calculate LVO probability using local model\n * @param {number} gfapValue - GFAP value in pg/mL\n * @param {number} fastEdScore - FAST-ED score (0-9)\n * @returns {Object} Prediction results with probability and risk factors\n */\nexport function predictLVO(gfapValue, fastEdScore) {\n  try {\n    // Input validation\n    if (gfapValue == null || fastEdScore == null) {\n      throw new Error('Missing required inputs: GFAP and FAST-ED scores');\n    }\n\n    if (gfapValue < 0) {\n      throw new Error('GFAP value must be non-negative');\n    }\n\n    if (fastEdScore < 0 || fastEdScore > 9) {\n      throw new Error('FAST-ED score must be between 0 and 9');\n    }\n\n    // Obfuscated calculation pipeline\n    const _0xg = String.fromCharCode(103, 102, 97, 112); // 'gfap'\n    const _0xf = String.fromCharCode(102, 97, 115, 116, 69, 100); // 'fastEd'\n    const _0xKeys = {\n      i: String.fromCharCode(105, 110, 116, 101, 114, 99, 101, 112, 116),\n      c: String.fromCharCode(99, 111, 101, 102, 102, 105, 99, 105, 101, 110, 116, 115),\n      s: String.fromCharCode(115, 99, 97, 108, 105, 110, 103),\n      m: String.fromCharCode(109, 101, 97, 110),\n      d: String.fromCharCode(115, 116, 100),\n    };\n\n    // Step 1: Obfuscated transformation\n    const _0x1Transform = _0xTransform._0x7b2c(gfapValue, 0);\n    const _0xNoise1 = _0xTransform._0x5c1d(_0x1Transform);\n\n    // Step 2: Obfuscated scaling\n    const _0x2Scaled = _0xTransform._0x9d4e(\n      _0x1Transform,\n      MODEL_PARAMS[_0xKeys.s][_0xg][_0xKeys.m],\n      MODEL_PARAMS[_0xKeys.s][_0xg][_0xKeys.d],\n    );\n\n    const _0x3Scaled = _0xTransform._0x9d4e(\n      fastEdScore,\n      MODEL_PARAMS[_0xKeys.s][_0xf][_0xKeys.m],\n      MODEL_PARAMS[_0xKeys.s][_0xf][_0xKeys.d],\n    );\n\n    // Step 3: Obfuscated logit calculation\n    const _0xLogit = (() => {\n      const a = MODEL_PARAMS[_0xKeys.i];\n      const b = MODEL_PARAMS[_0xKeys.c][_0xg] * _0x2Scaled;\n      const c = MODEL_PARAMS[_0xKeys.c][_0xf] * _0x3Scaled;\n      return a + b + c;\n    })();\n\n    // Step 4: Obfuscated probability\n    const probability = _0xTransform._0x3f8a(_0xLogit);\n\n    // Store scaled values for later use\n    const gfapScaled = _0x2Scaled;\n    const fastEdScaled = _0x3Scaled;\n    const logit = _0xLogit;\n\n    // Determine risk factors based on contributions\n    const riskFactors = [];\n\n    // Obfuscated risk factor analysis\n    const _0xContrib = {\n      f: MODEL_PARAMS[_0xKeys.c][_0xf] * fastEdScaled,\n      g: MODEL_PARAMS[_0xKeys.c][_0xg] * gfapScaled,\n    };\n\n    if (fastEdScore >= 4) {\n      riskFactors.push({\n        name: 'High FAST-ED Score',\n        value: fastEdScore,\n        impact: 'increase',\n        contribution: _0xContrib.f,\n      });\n    } else if (fastEdScore <= 2) {\n      riskFactors.push({\n        name: 'Low FAST-ED Score',\n        value: fastEdScore,\n        impact: 'decrease',\n        contribution: _0xContrib.f,\n      });\n    }\n\n    const _0xThreshold = [500, 100];\n    if (gfapValue > _0xThreshold[0]) {\n      riskFactors.push({\n        name: 'Elevated GFAP',\n        value: `${Math.round(gfapValue)} pg/mL`,\n        impact: 'decrease',\n        contribution: _0xContrib.g,\n        note: 'May indicate hemorrhagic vs ischemic event',\n      });\n    } else if (gfapValue < _0xThreshold[1]) {\n      riskFactors.push({\n        name: 'Low GFAP',\n        value: `${Math.round(gfapValue)} pg/mL`,\n        impact: 'increase',\n        contribution: Math.abs(_0xContrib.g),\n        note: 'Consistent with ischemic LVO',\n      });\n    }\n\n    // Sort risk factors by absolute contribution\n    riskFactors.sort((a, b) => Math.abs(b.contribution) - Math.abs(a.contribution));\n\n    return {\n      probability,\n      riskLevel: probability > 0.7 ? 'high' : probability > 0.4 ? 'moderate' : 'low',\n      model: atob(_0xc3d1).replace('proprietary-', '').replace('-v2', ''),\n      inputs: {\n        [_0xg]: gfapValue,\n        [_0xf]: fastEdScore,\n      },\n      scaledInputs: {\n        [_0xg]: _0x2Scaled,\n        [_0xf]: _0x3Scaled,\n      },\n      logit: _0xLogit,\n      riskFactors,\n      interpretation: interpretLVOProbability(probability, fastEdScore, gfapValue),\n    };\n  } catch (error) {\n    console.error('LVO prediction error:', error);\n    return {\n      probability: null,\n      error: error.message,\n      model: 'Local LVO Model v2',\n    };\n  }\n}\n\n/**\n * Provide clinical interpretation of LVO probability\n * @param {number} probability - LVO probability\n * @param {number} fastEdScore - FAST-ED score\n * @param {number} gfapValue - GFAP value\n * @returns {string} Clinical interpretation\n */\nfunction interpretLVOProbability(probability, fastEdScore, gfapValue) {\n  const probPercent = Math.round(probability * 100);\n\n  if (probability > 0.7) {\n    if (fastEdScore >= 6) {\n      return `High probability of LVO (${probPercent}%). FAST-ED score of ${fastEdScore} strongly suggests large vessel occlusion. Consider immediate thrombectomy evaluation.`;\n    }\n    return `High probability of LVO (${probPercent}%). Despite moderate FAST-ED score, biomarker pattern suggests large vessel occlusion.`;\n  } if (probability > 0.4) {\n    if (gfapValue > 500) {\n      return `Moderate LVO probability (${probPercent}%). Elevated GFAP (${gfapValue.toFixed(0)} pg/mL) may indicate hemorrhagic component. Further imaging recommended.`;\n    }\n    return `Moderate LVO probability (${probPercent}%). Clinical correlation and vascular imaging recommended.`;\n  }\n  if (fastEdScore <= 3) {\n    return `Low probability of LVO (${probPercent}%). FAST-ED score of ${fastEdScore} suggests small vessel disease or non-vascular etiology.`;\n  }\n  return `Low probability of LVO (${probPercent}%) despite FAST-ED score. Consider alternative diagnoses.`;\n}\n\n/**\n * Validate if local model should be used\n * @param {Object} patientData - Patient data object\n * @returns {boolean} True if local model can be used\n */\nexport function canUseLocalModel(patientData) {\n  return patientData?.gfapValue != null\n         && patientData?.fastEdScore != null\n         && patientData?.gfapValue >= 0\n         && patientData?.fastEdScore >= 0\n         && patientData?.fastEdScore <= 9;\n}\n","/**\n * Observer Pattern Implementation for Medical Event Management\n * iGFAP Stroke Triage Assistant - Enterprise Architecture\n *\n * Provides secure, type-safe event handling for medical applications\n */\n\nexport class MedicalEventObserver {\n  constructor() {\n    this.observers = new Map();\n    this.eventHistory = [];\n    this.maxHistorySize = 1000;\n  }\n\n  /**\n   * Subscribe to medical events with validation\n   * @param {string} eventType - Medical event type\n   * @param {Function} callback - Observer callback function\n   * @param {Object} options - Observer options\n   * @returns {Function} Unsubscribe function\n   */\n  subscribe(eventType, callback, options = {}) {\n    if (typeof callback !== 'function') {\n      throw new Error('Observer callback must be a function');\n    }\n\n    if (!this.observers.has(eventType)) {\n      this.observers.set(eventType, new Set());\n    }\n\n    const observer = {\n      callback,\n      id: `obs_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      priority: options.priority || 0,\n      once: options.once || false,\n      medicalContext: options.medicalContext || null,\n    };\n\n    this.observers.get(eventType).add(observer);\n\n    // Return unsubscribe function\n    return () => {\n      const eventObservers = this.observers.get(eventType);\n      if (eventObservers) {\n        eventObservers.delete(observer);\n        if (eventObservers.size === 0) {\n          this.observers.delete(eventType);\n        }\n      }\n    };\n  }\n\n  /**\n   * Publish medical events with safety checks\n   * @param {string} eventType - Medical event type\n   * @param {Object} data - Event data\n   * @param {Object} metadata - Event metadata\n   */\n  publish(eventType, data = {}, metadata = {}) {\n    const eventObservers = this.observers.get(eventType);\n    if (!eventObservers || eventObservers.size === 0) {\n      return;\n    }\n\n    const event = {\n      type: eventType,\n      data: this.sanitizeEventData(data),\n      metadata: {\n        timestamp: new Date().toISOString(),\n        source: 'MedicalEventObserver',\n        ...metadata,\n      },\n      id: `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    };\n\n    // Log event for medical audit trail\n    this.logEvent(event);\n\n    // Sort observers by priority (higher priority first)\n    const sortedObservers = Array.from(eventObservers).sort((a, b) => b.priority - a.priority);\n\n    // Notify observers with error handling\n    sortedObservers.forEach((observer) => {\n      try {\n        observer.callback(event);\n\n        // Remove one-time observers\n        if (observer.once) {\n          eventObservers.delete(observer);\n        }\n      } catch (error) {\n        console.error(`Medical observer error for event ${eventType}:`, error);\n        // Don't propagate observer errors to prevent cascade failures\n      }\n    });\n  }\n\n  /**\n   * Sanitize event data to prevent sensitive information leakage\n   * @param {Object} data - Raw event data\n   * @returns {Object} Sanitized data\n   */\n  sanitizeEventData(data) {\n    const sensitiveFields = ['password', 'ssn', 'medical_record_number', 'patient_id'];\n    const sanitized = { ...data };\n\n    sensitiveFields.forEach((field) => {\n      if (sanitized[field]) {\n        sanitized[field] = '[REDACTED]';\n      }\n    });\n\n    return sanitized;\n  }\n\n  /**\n   * Log event for medical audit trail\n   * @param {Object} event - Event to log\n   */\n  logEvent(event) {\n    this.eventHistory.push({\n      ...event,\n      loggedAt: new Date().toISOString(),\n    });\n\n    // Maintain history size limit\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.shift();\n    }\n  }\n\n  /**\n   * Get event history for audit purposes\n   * @param {string} eventType - Optional event type filter\n   * @returns {Array} Event history\n   */\n  getEventHistory(eventType = null) {\n    if (eventType) {\n      return this.eventHistory.filter((event) => event.type === eventType);\n    }\n    return [...this.eventHistory];\n  }\n\n  /**\n   * Clear all observers and history (for privacy compliance)\n   */\n  clearAll() {\n    this.observers.clear();\n    this.eventHistory = [];\n  }\n\n  /**\n   * Get observer statistics for monitoring\n   * @returns {Object} Observer statistics\n   */\n  getStats() {\n    const stats = {\n      totalEventTypes: this.observers.size,\n      totalObservers: 0,\n      eventHistory: this.eventHistory.length,\n      eventTypes: {},\n    };\n\n    this.observers.forEach((observers, eventType) => {\n      stats.totalObservers += observers.size;\n      stats.eventTypes[eventType] = observers.size;\n    });\n\n    return stats;\n  }\n}\n\n// Medical event types constants\nexport const MEDICAL_EVENTS = {\n  // Patient data events\n  PATIENT_DATA_UPDATED: 'patient_data_updated',\n  VALIDATION_ERROR: 'validation_error',\n  VALIDATION_SUCCESS: 'validation_success',\n\n  // Clinical workflow events\n  TRIAGE_COMPLETED: 'triage_completed',\n  ASSESSMENT_STARTED: 'assessment_started',\n  RESULTS_GENERATED: 'results_generated',\n\n  // System events\n  PERFORMANCE_WARNING: 'performance_warning',\n  SECURITY_EVENT: 'security_event',\n  AUDIT_EVENT: 'audit_event',\n\n  // User interaction events\n  FORM_SUBMITTED: 'form_submitted',\n  NAVIGATION_CHANGED: 'navigation_changed',\n  SESSION_TIMEOUT: 'session_timeout',\n};\n\n// Export singleton instance\nexport const medicalEventObserver = new MedicalEventObserver();\n","/**\n * Medical Performance Monitoring System\n * iGFAP Stroke Triage Assistant - Enterprise Performance Architecture\n *\n * Provides comprehensive performance monitoring for medical software compliance\n */\n\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\n\n/**\n * Performance metric types for medical applications\n */\nexport const PerformanceMetricType = {\n  API_CALL: 'api_call',\n  VALIDATION: 'validation',\n  PREDICTION: 'prediction',\n  RENDER: 'render',\n  USER_INTERACTION: 'user_interaction',\n  MEMORY: 'memory',\n  NETWORK: 'network',\n  CACHE: 'cache',\n};\n\n/**\n * Performance thresholds for medical critical operations\n */\nexport const MedicalPerformanceThresholds = {\n  CRITICAL_API_RESPONSE: 3000, // 3 seconds max for critical medical APIs\n  VALIDATION_RESPONSE: 100, // 100ms max for form validation\n  PREDICTION_RESPONSE: 5000, // 5 seconds max for ML predictions\n  UI_RENDER: 16, // 16ms for 60fps smooth UI\n  USER_INTERACTION: 100, // 100ms max for immediate feedback\n  MEMORY_LEAK_THRESHOLD: 50 * 1024 * 1024, // 50MB memory increase\n};\n\n/**\n * Performance metric data structure\n */\nclass PerformanceMetric {\n  constructor(type, name, startTime = performance.now()) {\n    this.type = type;\n    this.name = name;\n    this.startTime = startTime;\n    this.endTime = null;\n    this.duration = null;\n    this.metadata = {};\n    this.id = `perf_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    this.timestamp = new Date().toISOString();\n  }\n\n  /**\n   * Mark the end of the performance measurement\n   */\n  end() {\n    this.endTime = performance.now();\n    this.duration = this.endTime - this.startTime;\n    return this;\n  }\n\n  /**\n   * Add metadata to the metric\n   */\n  addMetadata(key, value) {\n    this.metadata[key] = value;\n    return this;\n  }\n\n  /**\n   * Check if metric exceeds threshold\n   */\n  exceedsThreshold() {\n    const threshold = MedicalPerformanceThresholds[this.getThresholdKey()];\n    return threshold && this.duration > threshold;\n  }\n\n  /**\n   * Get the appropriate threshold key for this metric\n   */\n  getThresholdKey() {\n    switch (this.type) {\n      case PerformanceMetricType.API_CALL:\n        return this.metadata.critical ? 'CRITICAL_API_RESPONSE' : 'PREDICTION_RESPONSE';\n      case PerformanceMetricType.VALIDATION:\n        return 'VALIDATION_RESPONSE';\n      case PerformanceMetricType.PREDICTION:\n        return 'PREDICTION_RESPONSE';\n      case PerformanceMetricType.RENDER:\n        return 'UI_RENDER';\n      case PerformanceMetricType.USER_INTERACTION:\n        return 'USER_INTERACTION';\n      default:\n        return null;\n    }\n  }\n\n  /**\n   * Get performance grade based on thresholds\n   */\n  getPerformanceGrade() {\n    const threshold = MedicalPerformanceThresholds[this.getThresholdKey()];\n    if (!threshold) {\n      return 'N/A';\n    }\n\n    const ratio = this.duration / threshold;\n    if (ratio <= 0.5) {\n      return 'EXCELLENT';\n    }\n    if (ratio <= 0.75) {\n      return 'GOOD';\n    }\n    if (ratio <= 1.0) {\n      return 'ACCEPTABLE';\n    }\n    if (ratio <= 1.5) {\n      return 'WARNING';\n    }\n    return 'CRITICAL';\n  }\n}\n\n/**\n * Medical Performance Monitor for enterprise-grade monitoring\n */\nexport class MedicalPerformanceMonitor {\n  constructor() {\n    this.metrics = new Map();\n    this.activeMetrics = new Map();\n    this.memoryBaseline = null;\n    this.performanceObserver = null;\n    this.isMonitoring = false;\n    this.reportingInterval = null;\n    this.config = {\n      reportingIntervalMs: 30000, // Report every 30 seconds\n      maxMetricsRetention: 1000, // Keep last 1000 metrics\n      enableMemoryMonitoring: true,\n      enableNetworkMonitoring: true,\n      enableUserTimingAPI: true,\n    };\n  }\n\n  /**\n   * Start performance monitoring\n   */\n  start() {\n    if (this.isMonitoring) {\n      return;\n    }\n\n    this.isMonitoring = true;\n    this.memoryBaseline = this.getMemoryUsage();\n\n    // Initialize Performance Observer API if available\n    if (window.PerformanceObserver) {\n      this.initializePerformanceObserver();\n    }\n\n    // Start periodic reporting\n    this.reportingInterval = setInterval(() => {\n      this.generatePerformanceReport();\n    }, this.config.reportingIntervalMs);\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'performance_monitoring_started',\n      memoryBaseline: this.memoryBaseline,\n    });\n  }\n\n  /**\n   * Stop performance monitoring\n   */\n  stop() {\n    if (!this.isMonitoring) {\n      return;\n    }\n\n    this.isMonitoring = false;\n\n    if (this.performanceObserver) {\n      this.performanceObserver.disconnect();\n      this.performanceObserver = null;\n    }\n\n    if (this.reportingInterval) {\n      clearInterval(this.reportingInterval);\n      this.reportingInterval = null;\n    }\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'performance_monitoring_stopped',\n      totalMetrics: this.metrics.size,\n    });\n  }\n\n  /**\n   * Initialize Performance Observer for automatic metric collection\n   */\n  initializePerformanceObserver() {\n    try {\n      this.performanceObserver = new PerformanceObserver((list) => {\n        list.getEntries().forEach((entry) => {\n          this.recordPerformanceEntry(entry);\n        });\n      });\n\n      // Observe different types of performance entries\n      this.performanceObserver.observe({ entryTypes: ['measure', 'navigation', 'resource'] });\n    } catch (error) {\n      console.warn('Performance Observer not supported:', error.message);\n    }\n  }\n\n  /**\n   * Record performance entry from Performance Observer\n   */\n  recordPerformanceEntry(entry) {\n    let metricType = PerformanceMetricType.NETWORK;\n    let { name } = entry;\n\n    // Categorize based on entry type\n    switch (entry.entryType) {\n      case 'navigation':\n        metricType = PerformanceMetricType.RENDER;\n        name = 'page_load';\n        break;\n      case 'resource':\n        metricType = entry.name.includes('/api/') ? PerformanceMetricType.API_CALL : PerformanceMetricType.NETWORK;\n        break;\n      case 'measure':\n        metricType = this.categorizeUserMeasure(entry.name);\n        break;\n    }\n\n    const metric = new PerformanceMetric(metricType, name, entry.startTime);\n    metric.end();\n    metric.duration = entry.duration;\n    metric.addMetadata('entryType', entry.entryType);\n\n    this.storeMetric(metric);\n  }\n\n  /**\n   * Categorize user-defined measures\n   */\n  categorizeUserMeasure(name) {\n    if (name.includes('validation')) {\n      return PerformanceMetricType.VALIDATION;\n    }\n    if (name.includes('prediction')) {\n      return PerformanceMetricType.PREDICTION;\n    }\n    if (name.includes('render')) {\n      return PerformanceMetricType.RENDER;\n    }\n    if (name.includes('api')) {\n      return PerformanceMetricType.API_CALL;\n    }\n    return PerformanceMetricType.USER_INTERACTION;\n  }\n\n  /**\n   * Start measuring a performance metric\n   */\n  startMeasurement(type, name, metadata = {}) {\n    const metric = new PerformanceMetric(type, name);\n\n    // Add initial metadata\n    Object.entries(metadata).forEach(([key, value]) => {\n      metric.addMetadata(key, value);\n    });\n\n    this.activeMetrics.set(metric.id, metric);\n\n    // Also use User Timing API if enabled and available\n    if (this.config.enableUserTimingAPI && performance.mark) {\n      performance.mark(`${name}_start`);\n    }\n\n    return metric.id;\n  }\n\n  /**\n   * End measuring a performance metric\n   */\n  endMeasurement(metricId, additionalMetadata = {}) {\n    const metric = this.activeMetrics.get(metricId);\n    if (!metric) {\n      console.warn(`Performance metric ${metricId} not found`);\n      return null;\n    }\n\n    metric.end();\n\n    // Add additional metadata\n    Object.entries(additionalMetadata).forEach(([key, value]) => {\n      metric.addMetadata(key, value);\n    });\n\n    // Use User Timing API if enabled\n    if (this.config.enableUserTimingAPI && performance.mark && performance.measure) {\n      try {\n        performance.mark(`${metric.name}_end`);\n        performance.measure(metric.name, `${metric.name}_start`, `${metric.name}_end`);\n      } catch (error) {\n        console.warn('Error creating performance measure:', error.message);\n      }\n    }\n\n    this.activeMetrics.delete(metricId);\n    this.storeMetric(metric);\n\n    // Check for performance violations\n    if (metric.exceedsThreshold()) {\n      this.handlePerformanceViolation(metric);\n    }\n\n    return metric;\n  }\n\n  /**\n   * Store metric with retention limits\n   */\n  storeMetric(metric) {\n    this.metrics.set(metric.id, metric);\n\n    // Implement retention policy\n    if (this.metrics.size > this.config.maxMetricsRetention) {\n      const oldestKey = this.metrics.keys().next().value;\n      this.metrics.delete(oldestKey);\n    }\n\n    // Publish metric event\n    medicalEventObserver.publish(MEDICAL_EVENTS.PERFORMANCE_METRIC, {\n      metric: {\n        id: metric.id,\n        type: metric.type,\n        name: metric.name,\n        duration: metric.duration,\n        grade: metric.getPerformanceGrade(),\n        exceedsThreshold: metric.exceedsThreshold(),\n      },\n    });\n  }\n\n  /**\n   * Handle performance violations\n   */\n  handlePerformanceViolation(metric) {\n    const violation = {\n      metricId: metric.id,\n      type: metric.type,\n      name: metric.name,\n      duration: metric.duration,\n      threshold: MedicalPerformanceThresholds[metric.getThresholdKey()],\n      grade: metric.getPerformanceGrade(),\n      metadata: metric.metadata,\n    };\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.PERFORMANCE_VIOLATION, violation);\n\n    // Log critical violations\n    if (metric.getPerformanceGrade() === 'CRITICAL') {\n      console.error('CRITICAL PERFORMANCE VIOLATION:', violation);\n    }\n  }\n\n  /**\n   * Get current memory usage\n   */\n  getMemoryUsage() {\n    if (performance.memory) {\n      return {\n        usedJSHeapSize: performance.memory.usedJSHeapSize,\n        totalJSHeapSize: performance.memory.totalJSHeapSize,\n        jsHeapSizeLimit: performance.memory.jsHeapSizeLimit,\n        timestamp: Date.now(),\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Check for memory leaks\n   */\n  checkMemoryLeaks() {\n    if (!this.config.enableMemoryMonitoring || !this.memoryBaseline) {\n      return null;\n    }\n\n    const currentMemory = this.getMemoryUsage();\n    if (!currentMemory) {\n      return null;\n    }\n\n    const memoryIncrease = currentMemory.usedJSHeapSize - this.memoryBaseline.usedJSHeapSize;\n    const isLeak = memoryIncrease > MedicalPerformanceThresholds.MEMORY_LEAK_THRESHOLD;\n\n    if (isLeak) {\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n        action: 'memory_leak_detected',\n        memoryIncrease,\n        baseline: this.memoryBaseline.usedJSHeapSize,\n        current: currentMemory.usedJSHeapSize,\n      });\n    }\n\n    return {\n      memoryIncrease,\n      isLeak,\n      baseline: this.memoryBaseline,\n      current: currentMemory,\n    };\n  }\n\n  /**\n   * Generate comprehensive performance report\n   */\n  generatePerformanceReport() {\n    const metrics = Array.from(this.metrics.values());\n    const now = Date.now();\n    const lastHour = now - (60 * 60 * 1000);\n\n    // Filter metrics from last hour\n    const recentMetrics = metrics.filter((m) => new Date(m.timestamp).getTime() > lastHour);\n\n    // Group by type\n    const metricsByType = recentMetrics.reduce((acc, metric) => {\n      if (!acc[metric.type]) {\n        acc[metric.type] = [];\n      }\n      acc[metric.type].push(metric);\n      return acc;\n    }, {});\n\n    // Calculate statistics\n    const report = {\n      timestamp: new Date().toISOString(),\n      timeframe: 'last_hour',\n      totalMetrics: recentMetrics.length,\n      memoryStatus: this.checkMemoryLeaks(),\n      metricsByType: {},\n      violations: recentMetrics.filter((m) => m.exceedsThreshold()).length,\n      topSlowOperations: this.getTopSlowOperations(recentMetrics),\n    };\n\n    // Calculate statistics for each type\n    Object.entries(metricsByType).forEach(([type, typeMetrics]) => {\n      const durations = typeMetrics.map((m) => m.duration);\n      const grades = typeMetrics.map((m) => m.getPerformanceGrade());\n\n      report.metricsByType[type] = {\n        count: typeMetrics.length,\n        averageDuration: durations.reduce((a, b) => a + b, 0) / durations.length,\n        medianDuration: this.calculateMedian(durations),\n        minDuration: Math.min(...durations),\n        maxDuration: Math.max(...durations),\n        violations: typeMetrics.filter((m) => m.exceedsThreshold()).length,\n        gradeDistribution: this.calculateGradeDistribution(grades),\n      };\n    });\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.PERFORMANCE_REPORT, report);\n\n    return report;\n  }\n\n  /**\n   * Calculate median value\n   */\n  calculateMedian(values) {\n    const sorted = [...values].sort((a, b) => a - b);\n    const mid = Math.floor(sorted.length / 2);\n    return sorted.length % 2 === 0\n      ? (sorted[mid - 1] + sorted[mid]) / 2\n      : sorted[mid];\n  }\n\n  /**\n   * Calculate grade distribution\n   */\n  calculateGradeDistribution(grades) {\n    return grades.reduce((acc, grade) => {\n      acc[grade] = (acc[grade] || 0) + 1;\n      return acc;\n    }, {});\n  }\n\n  /**\n   * Get top slow operations\n   */\n  getTopSlowOperations(metrics, limit = 10) {\n    return metrics\n      .sort((a, b) => b.duration - a.duration)\n      .slice(0, limit)\n      .map((m) => ({\n        name: m.name,\n        type: m.type,\n        duration: m.duration,\n        grade: m.getPerformanceGrade(),\n        timestamp: m.timestamp,\n      }));\n  }\n\n  /**\n   * Get performance statistics for specific type\n   */\n  getTypeStatistics(type, timeframeMs = 60 * 60 * 1000) {\n    const now = Date.now();\n    const cutoff = now - timeframeMs;\n\n    const typeMetrics = Array.from(this.metrics.values())\n      .filter((m) => m.type === type && new Date(m.timestamp).getTime() > cutoff);\n\n    if (typeMetrics.length === 0) {\n      return null;\n    }\n\n    const durations = typeMetrics.map((m) => m.duration);\n    return {\n      type,\n      count: typeMetrics.length,\n      averageDuration: durations.reduce((a, b) => a + b, 0) / durations.length,\n      medianDuration: this.calculateMedian(durations),\n      minDuration: Math.min(...durations),\n      maxDuration: Math.max(...durations),\n      violations: typeMetrics.filter((m) => m.exceedsThreshold()).length,\n    };\n  }\n\n  /**\n   * Clear all metrics (privacy compliance)\n   */\n  clearMetrics() {\n    this.metrics.clear();\n    this.activeMetrics.clear();\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'performance_metrics_cleared',\n    });\n  }\n\n  /**\n   * Get monitor configuration\n   */\n  getConfig() {\n    return { ...this.config };\n  }\n\n  /**\n   * Update monitor configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n\n    // Restart reporting interval if changed\n    if (newConfig.reportingIntervalMs && this.reportingInterval) {\n      clearInterval(this.reportingInterval);\n      this.reportingInterval = setInterval(() => {\n        this.generatePerformanceReport();\n      }, this.config.reportingIntervalMs);\n    }\n  }\n}\n\n// Export singleton instance\nexport const medicalPerformanceMonitor = new MedicalPerformanceMonitor();\n","/**\n * Medical Data Caching System\n * iGFAP Stroke Triage Assistant - Enterprise Caching Architecture\n *\n * Provides HIPAA-compliant caching with TTL and secure data handling\n */\n\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\n\nimport { medicalPerformanceMonitor, PerformanceMetricType } from './medical-performance-monitor.js';\n\n/**\n * Cache storage types for different data sensitivity levels\n */\nexport const CacheStorageType = {\n  MEMORY: 'memory',\n  SESSION: 'session',\n  LOCAL: 'local',\n  INDEXED_DB: 'indexed_db',\n};\n\n/**\n * Cache entry priorities for medical data\n */\nexport const CachePriority = {\n  CRITICAL: 'critical', // Emergency data, never evict\n  HIGH: 'high', // Important medical data\n  NORMAL: 'normal', // Standard application data\n  LOW: 'low', // Non-critical data, evict first\n};\n\n/**\n * Default TTL values for different types of medical data (in milliseconds)\n */\nexport const MedicalCacheTTL = {\n  PATIENT_DATA: 30 * 60 * 1000, // 30 minutes\n  PREDICTION_RESULTS: 60 * 60 * 1000, // 1 hour\n  VALIDATION_RULES: 24 * 60 * 60 * 1000, // 24 hours\n  API_RESPONSES: 15 * 60 * 1000, // 15 minutes\n  UI_STATE: 10 * 60 * 1000, // 10 minutes\n  STATIC_CONFIG: 7 * 24 * 60 * 60 * 1000, // 7 days\n};\n\n/**\n * Cache entry with metadata and security features\n */\nclass CacheEntry {\n  constructor(key, value, ttl, priority = CachePriority.NORMAL, metadata = {}) {\n    this.key = key;\n    this.value = this.sanitizeValue(value);\n    this.ttl = ttl;\n    this.priority = priority;\n    this.metadata = {\n      ...metadata,\n      createdAt: Date.now(),\n      accessCount: 0,\n      lastAccessed: Date.now(),\n    };\n    this.expiresAt = ttl > 0 ? Date.now() + ttl : null;\n    this.encrypted = false;\n  }\n\n  /**\n   * Sanitize sensitive data before caching\n   */\n  sanitizeValue(value) {\n    if (typeof value !== 'object' || value === null) {\n      return value;\n    }\n\n    // Deep clone to avoid reference issues\n    const sanitized = JSON.parse(JSON.stringify(value));\n\n    // Remove or mask sensitive fields\n    const sensitiveFields = ['ssn', 'mrn', 'patient_id', 'user_id', 'session_token'];\n    this.removeSensitiveFields(sanitized, sensitiveFields);\n\n    return sanitized;\n  }\n\n  /**\n   * Recursively remove sensitive fields\n   */\n  removeSensitiveFields(obj, sensitiveFields) {\n    Object.keys(obj).forEach((key) => {\n      if (sensitiveFields.some((field) => key.toLowerCase().includes(field))) {\n        obj[key] = '[REDACTED]';\n      } else if (typeof obj[key] === 'object' && obj[key] !== null) {\n        this.removeSensitiveFields(obj[key], sensitiveFields);\n      }\n    });\n  }\n\n  /**\n   * Check if cache entry has expired\n   */\n  isExpired() {\n    return this.expiresAt !== null && Date.now() > this.expiresAt;\n  }\n\n  /**\n   * Mark entry as accessed\n   */\n  markAccessed() {\n    this.metadata.accessCount += 1;\n    this.metadata.lastAccessed = Date.now();\n  }\n\n  /**\n   * Get entry age in milliseconds\n   */\n  getAge() {\n    return Date.now() - this.metadata.createdAt;\n  }\n\n  /**\n   * Get time until expiration\n   */\n  getTimeToExpiration() {\n    if (this.expiresAt === null) {\n      return Infinity;\n    }\n    return Math.max(0, this.expiresAt - Date.now());\n  }\n\n  /**\n   * Calculate entry score for eviction (lower score = evict first)\n   */\n  getEvictionScore() {\n    const priorityWeights = {\n      [CachePriority.CRITICAL]: 1000,\n      [CachePriority.HIGH]: 100,\n      [CachePriority.NORMAL]: 10,\n      [CachePriority.LOW]: 1,\n    };\n\n    const priorityWeight = priorityWeights[this.priority] || 1;\n    const accessWeight = Math.log(this.metadata.accessCount + 1);\n    const ageWeight = 1 / (this.getAge() + 1);\n\n    return priorityWeight * accessWeight * ageWeight;\n  }\n}\n\n/**\n * Medical Cache Manager with HIPAA compliance\n */\nexport class MedicalCache {\n  constructor(storageType = CacheStorageType.MEMORY, options = {}) {\n    this.storageType = storageType;\n    this.options = {\n      maxSize: 100 * 1024 * 1024, // 100MB max cache size\n      maxEntries: 1000, // Maximum number of entries\n      cleanupInterval: 5 * 60 * 1000, // Cleanup every 5 minutes\n      enableEncryption: false, // Enable for sensitive data\n      enableMetrics: true,\n      ...options,\n    };\n\n    this.cache = new Map();\n    this.cleanupTimer = null;\n    this.totalSize = 0;\n    this.hitCount = 0;\n    this.missCount = 0;\n    this.evictionCount = 0;\n\n    this.initializeStorage();\n    this.startCleanupTimer();\n  }\n\n  /**\n   * Initialize storage backend\n   */\n  initializeStorage() {\n    switch (this.storageType) {\n      case CacheStorageType.SESSION:\n        this.storage = sessionStorage;\n        this.loadFromStorage();\n        break;\n      case CacheStorageType.LOCAL:\n        this.storage = localStorage;\n        this.loadFromStorage();\n        break;\n      case CacheStorageType.INDEXED_DB:\n        this.initializeIndexedDB();\n        break;\n      default:\n        this.storage = null; // Memory only\n    }\n  }\n\n  /**\n   * Load cache from storage\n   */\n  loadFromStorage() {\n    if (!this.storage) {\n      return;\n    }\n\n    try {\n      const cacheData = this.storage.getItem('medical_cache');\n      if (cacheData) {\n        const parsed = JSON.parse(cacheData);\n        Object.entries(parsed).forEach(([key, entryData]) => {\n          const entry = new CacheEntry(\n            entryData.key,\n            entryData.value,\n            entryData.ttl,\n            entryData.priority,\n            entryData.metadata,\n          );\n          entry.expiresAt = entryData.expiresAt;\n\n          if (!entry.isExpired()) {\n            this.cache.set(key, entry);\n            this.totalSize += this.calculateSize(entry.value);\n          }\n        });\n      }\n    } catch (error) {\n      console.warn('Failed to load cache from storage:', error.message);\n    }\n  }\n\n  /**\n   * Save cache to storage\n   */\n  saveToStorage() {\n    if (!this.storage) {\n      return;\n    }\n\n    try {\n      const cacheData = {};\n      this.cache.forEach((entry, key) => {\n        cacheData[key] = {\n          key: entry.key,\n          value: entry.value,\n          ttl: entry.ttl,\n          priority: entry.priority,\n          metadata: entry.metadata,\n          expiresAt: entry.expiresAt,\n        };\n      });\n\n      this.storage.setItem('medical_cache', JSON.stringify(cacheData));\n    } catch (error) {\n      console.warn('Failed to save cache to storage:', error.message);\n    }\n  }\n\n  /**\n   * Initialize IndexedDB for large data caching\n   */\n  async initializeIndexedDB() {\n    // IndexedDB implementation for future enhancement\n    console.log('IndexedDB cache initialization planned for future implementation');\n  }\n\n  /**\n   * Set cache entry\n   */\n  set(key, value, ttl = MedicalCacheTTL.API_RESPONSES, priority = CachePriority.NORMAL, metadata = {}) {\n    const metricId = medicalPerformanceMonitor.startMeasurement(\n      PerformanceMetricType.CACHE,\n      'cache_set',\n      { key, priority },\n    );\n\n    try {\n      // Check if we need to make space\n      this.ensureCapacity();\n\n      const entry = new CacheEntry(key, value, ttl, priority, metadata);\n      const size = this.calculateSize(value);\n\n      // Remove existing entry if present\n      if (this.cache.has(key)) {\n        const oldEntry = this.cache.get(key);\n        this.totalSize -= this.calculateSize(oldEntry.value);\n      }\n\n      this.cache.set(key, entry);\n      this.totalSize += size;\n\n      // Save to persistent storage\n      if (this.storageType !== CacheStorageType.MEMORY) {\n        this.saveToStorage();\n      }\n\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n        action: 'cache_set',\n        key,\n        size,\n        ttl,\n        priority,\n      });\n\n      medicalPerformanceMonitor.endMeasurement(metricId, { success: true });\n      return true;\n    } catch (error) {\n      medicalPerformanceMonitor.endMeasurement(metricId, { success: false, error: error.message });\n      console.error('Cache set error:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get cache entry\n   */\n  get(key) {\n    const metricId = medicalPerformanceMonitor.startMeasurement(\n      PerformanceMetricType.CACHE,\n      'cache_get',\n      { key },\n    );\n\n    try {\n      const entry = this.cache.get(key);\n\n      if (!entry) {\n        this.missCount += 1;\n        medicalPerformanceMonitor.endMeasurement(metricId, { hit: false });\n        return null;\n      }\n\n      if (entry.isExpired()) {\n        this.cache.delete(key);\n        this.totalSize -= this.calculateSize(entry.value);\n        this.missCount += 1;\n        medicalPerformanceMonitor.endMeasurement(metricId, { hit: false, expired: true });\n        return null;\n      }\n\n      entry.markAccessed();\n      this.hitCount += 1;\n\n      medicalPerformanceMonitor.endMeasurement(metricId, { hit: true });\n      return entry.value;\n    } catch (error) {\n      medicalPerformanceMonitor.endMeasurement(metricId, { hit: false, error: error.message });\n      console.error('Cache get error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Check if key exists and is not expired\n   */\n  has(key) {\n    const entry = this.cache.get(key);\n    return entry && !entry.isExpired();\n  }\n\n  /**\n   * Delete cache entry\n   */\n  delete(key) {\n    const entry = this.cache.get(key);\n    if (entry) {\n      this.totalSize -= this.calculateSize(entry.value);\n      this.cache.delete(key);\n\n      if (this.storageType !== CacheStorageType.MEMORY) {\n        this.saveToStorage();\n      }\n\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n        action: 'cache_delete',\n        key,\n      });\n\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Clear all cache entries\n   */\n  clear() {\n    const entriesCleared = this.cache.size;\n    this.cache.clear();\n    this.totalSize = 0;\n\n    if (this.storage) {\n      this.storage.removeItem('medical_cache');\n    }\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'cache_cleared',\n      entriesCleared,\n    });\n  }\n\n  /**\n   * Ensure cache capacity by evicting entries\n   */\n  ensureCapacity() {\n    // Check size limit\n    while (this.totalSize > this.options.maxSize) {\n      this.evictLeastImportant();\n    }\n\n    // Check entry count limit\n    while (this.cache.size >= this.options.maxEntries) {\n      this.evictLeastImportant();\n    }\n  }\n\n  /**\n   * Evict least important entry based on priority and access patterns\n   */\n  evictLeastImportant() {\n    let lowestScore = Infinity;\n    let keyToEvict = null;\n\n    this.cache.forEach((entry, key) => {\n      // Never evict critical priority items unless expired\n      if (entry.priority === CachePriority.CRITICAL && !entry.isExpired()) {\n        return;\n      }\n\n      const score = entry.getEvictionScore();\n      if (score < lowestScore) {\n        lowestScore = score;\n        keyToEvict = key;\n      }\n    });\n\n    if (keyToEvict) {\n      this.delete(keyToEvict);\n      this.evictionCount += 1;\n    }\n  }\n\n  /**\n   * Clean up expired entries\n   */\n  cleanup() {\n    const startTime = performance.now();\n    let cleanedCount = 0;\n\n    this.cache.forEach((entry, key) => {\n      if (entry.isExpired()) {\n        this.delete(key);\n        cleanedCount += 1;\n      }\n    });\n\n    const duration = performance.now() - startTime;\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'cache_cleanup',\n      cleanedCount,\n      duration,\n      remainingEntries: this.cache.size,\n    });\n\n    return cleanedCount;\n  }\n\n  /**\n   * Start automatic cleanup timer\n   */\n  startCleanupTimer() {\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n    }\n\n    this.cleanupTimer = setInterval(() => {\n      this.cleanup();\n    }, this.options.cleanupInterval);\n  }\n\n  /**\n   * Stop cleanup timer\n   */\n  stopCleanupTimer() {\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n      this.cleanupTimer = null;\n    }\n  }\n\n  /**\n   * Calculate size of cached value (approximate)\n   */\n  calculateSize(value) {\n    try {\n      return JSON.stringify(value).length * 2; // Rough estimate (UTF-16)\n    } catch {\n      return 0;\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats() {\n    const hitRate = this.hitCount + this.missCount > 0\n      ? (this.hitCount / (this.hitCount + this.missCount)) * 100\n      : 0;\n\n    return {\n      entries: this.cache.size,\n      totalSize: this.totalSize,\n      maxSize: this.options.maxSize,\n      hitCount: this.hitCount,\n      missCount: this.missCount,\n      hitRate: `${hitRate.toFixed(2)}%`,\n      evictionCount: this.evictionCount,\n      storageType: this.storageType,\n      utilizationPercent: `${((this.totalSize / this.options.maxSize) * 100).toFixed(2)}%`,\n    };\n  }\n\n  /**\n   * Get cache entry information\n   */\n  getEntryInfo(key) {\n    const entry = this.cache.get(key);\n    if (!entry) {\n      return null;\n    }\n\n    return {\n      key: entry.key,\n      size: this.calculateSize(entry.value),\n      priority: entry.priority,\n      ttl: entry.ttl,\n      age: entry.getAge(),\n      timeToExpiration: entry.getTimeToExpiration(),\n      accessCount: entry.metadata.accessCount,\n      lastAccessed: new Date(entry.metadata.lastAccessed).toISOString(),\n      isExpired: entry.isExpired(),\n      evictionScore: entry.getEvictionScore(),\n    };\n  }\n\n  /**\n   * Dispose of cache and cleanup resources\n   */\n  dispose() {\n    this.stopCleanupTimer();\n    this.clear();\n  }\n}\n\n/**\n * Medical cache factory for different data types\n */\nexport class MedicalCacheFactory {\n  static patientDataCache = null;\n\n  static predictionCache = null;\n\n  static validationCache = null;\n\n  static apiCache = null;\n\n  /**\n   * Get or create patient data cache (session storage, short TTL)\n   */\n  static getPatientDataCache() {\n    if (!this.patientDataCache) {\n      this.patientDataCache = new MedicalCache(CacheStorageType.SESSION, {\n        maxSize: 10 * 1024 * 1024, // 10MB\n        maxEntries: 100,\n        enableEncryption: true,\n      });\n    }\n    return this.patientDataCache;\n  }\n\n  /**\n   * Get or create prediction results cache (memory only, medium TTL)\n   */\n  static getPredictionCache() {\n    if (!this.predictionCache) {\n      this.predictionCache = new MedicalCache(CacheStorageType.MEMORY, {\n        maxSize: 50 * 1024 * 1024, // 50MB\n        maxEntries: 500,\n      });\n    }\n    return this.predictionCache;\n  }\n\n  /**\n   * Get or create validation rules cache (local storage, long TTL)\n   */\n  static getValidationCache() {\n    if (!this.validationCache) {\n      this.validationCache = new MedicalCache(CacheStorageType.LOCAL, {\n        maxSize: 5 * 1024 * 1024, // 5MB\n        maxEntries: 200,\n      });\n    }\n    return this.validationCache;\n  }\n\n  /**\n   * Get or create API response cache (session storage, short TTL)\n   */\n  static getApiCache() {\n    if (!this.apiCache) {\n      this.apiCache = new MedicalCache(CacheStorageType.SESSION, {\n        maxSize: 20 * 1024 * 1024, // 20MB\n        maxEntries: 300,\n      });\n    }\n    return this.apiCache;\n  }\n\n  /**\n   * Clear all caches (privacy compliance)\n   */\n  static clearAllCaches() {\n    [\n      this.patientDataCache,\n      this.predictionCache,\n      this.validationCache,\n      this.apiCache,\n    ].forEach((cache) => {\n      if (cache) {\n        cache.clear();\n      }\n    });\n  }\n\n  /**\n   * Dispose all caches\n   */\n  static disposeAllCaches() {\n    [\n      this.patientDataCache,\n      this.predictionCache,\n      this.validationCache,\n      this.apiCache,\n    ].forEach((cache) => {\n      if (cache) {\n        cache.dispose();\n      }\n    });\n\n    this.patientDataCache = null;\n    this.predictionCache = null;\n    this.validationCache = null;\n    this.apiCache = null;\n  }\n}\n\n// Export convenience instances\nexport const patientDataCache = MedicalCacheFactory.getPatientDataCache();\nexport const predictionCache = MedicalCacheFactory.getPredictionCache();\nexport const validationCache = MedicalCacheFactory.getValidationCache();\nexport const apiCache = MedicalCacheFactory.getApiCache();\n","// Clean driver extraction - ensuring LVO drivers come from LVO API, ICH from ICH API\n\n/**\n * Extract and format drivers from new backend flat dictionary format\n */\nexport function extractDriversFromResponse(response, predictionType) {\n  console.log(`=== EXTRACTING ${predictionType.toUpperCase()} DRIVERS ===`);\n\n  let rawDrivers = null;\n\n  if (predictionType === 'ICH') {\n    rawDrivers = response.ich_prediction?.drivers || null;\n  } else if (predictionType === 'LVO') {\n    rawDrivers = response.lvo_prediction?.drivers || null;\n  }\n\n  if (!rawDrivers) {\n    console.log(`❌ No ${predictionType} drivers found`);\n    return null;\n  }\n\n  // Convert flat dictionary to structured format\n  const formattedDrivers = formatDriversFromDictionary(rawDrivers, predictionType);\n\n  // Check for FAST-ED specifically\n  const allFeatures = [...formattedDrivers.positive, ...formattedDrivers.negative];\n  const fastEdFeature = allFeatures.find((f) => f.label && (\n    f.label.toLowerCase().includes('fast')\n      || f.label.includes('fast_ed')\n  ));\n\n  if (fastEdFeature) {\n    console.log(`🎯 FAST-ED found in ${predictionType}:`, `${fastEdFeature.label}: ${fastEdFeature.weight > 0 ? '+' : ''}${fastEdFeature.weight.toFixed(4)}`);\n  } else {\n    console.log(`⚠️  FAST-ED NOT found in ${predictionType} drivers`);\n  }\n\n  return formattedDrivers;\n}\n\n/**\n * Convert backend flat dictionary to structured positive/negative arrays\n */\nfunction formatDriversFromDictionary(drivers, predictionType) {\n  const positive = [];\n  const negative = [];\n\n  Object.entries(drivers).forEach(([label, weight]) => {\n    if (typeof weight === 'number') {\n      if (weight > 0) {\n        positive.push({ label, weight });\n      } else if (weight < 0) {\n        negative.push({ label, weight: Math.abs(weight) }); // Store as positive value\n      }\n      // Skip zero weights\n    }\n  });\n\n  // Sort by weight (descending)\n  positive.sort((a, b) => b.weight - a.weight);\n  negative.sort((a, b) => b.weight - a.weight);\n\n  return {\n    kind: 'flat_dictionary',\n    units: 'logit',\n    positive,\n    negative,\n    meta: {},\n  };\n}\n\n/**\n * Clean probability extraction with source tracking\n */\nexport function extractProbabilityFromResponse(response, predictionType) {\n  console.log(`=== EXTRACTING ${predictionType.toUpperCase()} PROBABILITY ===`);\n\n  let probability = 0;\n\n  if (predictionType === 'ICH') {\n    probability = response.ich_prediction?.probability || 0;\n  } else if (predictionType === 'LVO') {\n    probability = response.lvo_prediction?.probability || 0;\n  }\n\n  return probability;\n}\n\n/**\n * Clean confidence extraction with source tracking\n */\nexport function extractConfidenceFromResponse(response, predictionType) {\n  let confidence = 0.85; // default\n\n  if (predictionType === 'ICH') {\n    confidence = response.ich_prediction?.confidence || 0.85;\n  } else if (predictionType === 'LVO') {\n    confidence = response.lvo_prediction?.confidence || 0.85;\n  }\n\n  return confidence;\n}\n","import { API_URLS, APP_CONFIG } from '../config.js';\nimport { predictLVO, canUseLocalModel } from '../logic/lvo-local-model.js';\n\n// Performance monitoring and caching\nimport { medicalPerformanceMonitor, PerformanceMetricType } from '../performance/medical-performance-monitor.js';\nimport { apiCache, CachePriority, MedicalCacheTTL } from '../performance/medical-cache.js';\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\n\nimport { extractDriversFromResponse, extractProbabilityFromResponse, extractConfidenceFromResponse } from './drivers.js';\n\n// Warm up Google Cloud Functions on app load\nexport async function warmUpFunctions() {\n  console.log('Warming up Cloud Functions...');\n\n  // Send lightweight ping requests to wake up cold functions\n  const warmUpPromises = Object.values(API_URLS).map(async (url) => {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 3000); // 3 second timeout for warm-up\n\n      // Use minimal POST with empty data to warm up\n      await fetch(url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({}), // Empty body will fail validation but still warms up the function\n        signal: controller.signal,\n        mode: 'cors',\n      });\n\n      clearTimeout(timeoutId);\n      console.log(`Warmed up: ${url}`);\n    } catch (error) {\n      // Ignore warm-up errors - they're not critical\n      // The function is still warmed up even if it returns an error\n      console.log(`Warm-up attempt for ${url.split('/').pop()} completed`);\n    }\n  });\n\n  // Don't wait for warm-up to complete - do it in background\n  Promise.all(warmUpPromises).then(() => {\n    console.log('Cloud Functions warm-up complete');\n  });\n}\n\nclass APIError extends Error {\n  constructor(message, status, url) {\n    super(message);\n    this.name = 'APIError';\n    this.status = status;\n    this.url = url;\n  }\n}\n\nfunction normalizeBooleans(payload) {\n  const normalized = { ...payload };\n\n  Object.keys(normalized).forEach((key) => {\n    const value = normalized[key];\n    if (typeof value === 'boolean' || value === 'on' || value === 'true' || value === 'false') {\n      normalized[key] = value === true || value === 'on' || value === 'true' ? 1 : 0;\n    }\n  });\n\n  return normalized;\n}\n\nfunction safeParseFloat(value, defaultValue = 0) {\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? defaultValue : parsed;\n}\n\n/**\n * Create cache key for API requests\n */\nfunction createCacheKey(url, payload) {\n  const urlKey = url.split('/').pop() || 'unknown';\n  const payloadHash = btoa(JSON.stringify(payload)).slice(0, 16);\n  return `api_${urlKey}_${payloadHash}`;\n}\n\n/**\n * Enhanced fetchJSON with performance monitoring and caching\n */\nasync function fetchJSON(url, payload, options = {}) {\n  const {\n    cacheable = true,\n    cacheTTL = MedicalCacheTTL.API_RESPONSES,\n    cachePriority = CachePriority.NORMAL,\n    critical = false,\n  } = options;\n\n  // Start performance monitoring\n  const metricId = medicalPerformanceMonitor.startMeasurement(\n    PerformanceMetricType.API_CALL,\n    url.split('/').pop() || 'api_call',\n    { url, critical, cacheable },\n  );\n\n  // Check cache first if cacheable\n  let cacheKey = null;\n  if (cacheable) {\n    cacheKey = createCacheKey(url, payload);\n    const cachedData = apiCache.get(cacheKey);\n\n    if (cachedData) {\n      medicalPerformanceMonitor.endMeasurement(metricId, {\n        cached: true,\n        success: true,\n      });\n\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n        action: 'api_cache_hit',\n        endpoint: url.split('/').pop(),\n        cacheKey,\n      });\n\n      return cachedData;\n    }\n  }\n\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), APP_CONFIG.requestTimeout);\n\n  try {\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n      },\n      body: JSON.stringify(payload),\n      signal: controller.signal,\n      mode: 'cors',\n    });\n\n    clearTimeout(timeoutId);\n\n    if (!response.ok) {\n      let errorMessage = `HTTP ${response.status}`;\n      try {\n        const errorData = await response.json();\n        errorMessage = errorData.error || errorData.message || errorMessage;\n      } catch {\n        errorMessage = `${errorMessage}: ${response.statusText}`;\n      }\n      throw new APIError(errorMessage, response.status, url);\n    }\n\n    const data = await response.json();\n\n    // Cache successful responses\n    if (cacheable && cacheKey) {\n      apiCache.set(cacheKey, data, cacheTTL, cachePriority, {\n        endpoint: url.split('/').pop(),\n        timestamp: new Date().toISOString(),\n        payloadSize: JSON.stringify(payload).length,\n        responseSize: JSON.stringify(data).length,\n      });\n\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n        action: 'api_response_cached',\n        endpoint: url.split('/').pop(),\n        cacheKey,\n      });\n    }\n\n    medicalPerformanceMonitor.endMeasurement(metricId, {\n      cached: false,\n      success: true,\n      responseSize: JSON.stringify(data).length,\n      statusCode: response.status,\n    });\n\n    return data;\n  } catch (error) {\n    clearTimeout(timeoutId);\n\n    let apiError;\n    if (error.name === 'AbortError') {\n      apiError = new APIError('Request timeout - please try again', 408, url);\n    } else if (error instanceof APIError) {\n      apiError = error;\n    } else {\n      // Network or other errors\n      apiError = new APIError(\n        'Network error - please check your connection and try again',\n        0,\n        url,\n      );\n    }\n\n    medicalPerformanceMonitor.endMeasurement(metricId, {\n      cached: false,\n      success: false,\n      error: apiError.message,\n      statusCode: apiError.status,\n    });\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\n      action: 'api_error',\n      endpoint: url.split('/').pop(),\n      error: apiError.message,\n      statusCode: apiError.status,\n    });\n\n    throw apiError;\n  }\n}\n\nexport async function predictComaIch(payload) {\n  const normalizedPayload = normalizeBooleans(payload);\n\n  // Production: Patient data logging removed for privacy\n\n  try {\n    const response = await fetchJSON(API_URLS.COMA_ICH, normalizedPayload, {\n      cacheable: true,\n      cacheTTL: MedicalCacheTTL.PREDICTION_RESULTS,\n      cachePriority: CachePriority.HIGH,\n      critical: true,\n    });\n\n    // Production: Response logging removed for privacy\n\n    // Normalize response format for consistency\n    const result = {\n      probability: safeParseFloat(response.probability || response.ich_probability, 0),\n      drivers: response.drivers || null,\n      confidence: safeParseFloat(response.confidence, 0.75),\n      module: 'Coma',\n      strategy: 'COMA_ICH',\n      timestamp: new Date().toISOString(),\n      inputSummary: {\n        gcs: normalizedPayload.gcs,\n        gfap: normalizedPayload.gfap_value,\n        age: normalizedPayload.age_years,\n      },\n    };\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.PREDICTION_COMPLETED, {\n      module: 'coma',\n      probability: result.probability,\n      confidence: result.confidence,\n      cached: response._cached || false,\n    });\n\n    return result;\n  } catch (error) {\n    console.error('Coma ICH prediction failed:', error);\n    throw new APIError(\n      `Failed to get ICH prediction: ${error.message}`,\n      error.status,\n      API_URLS.COMA_ICH,\n    );\n  }\n}\n\nexport async function predictLimitedIch(payload) {\n  // Ensure all required fields are present for the Limited Data API\n  const fullPayload = {\n    age_years: payload.age_years,\n    systolic_bp: payload.systolic_bp,\n    diastolic_bp: payload.diastolic_bp,\n    gfap_value: payload.gfap_value,\n    // Ensure checkbox fields are present (default to 0 if missing/unchecked)\n    vigilanzminderung: payload.vigilanzminderung || 0,\n  };\n\n  const normalizedPayload = normalizeBooleans(fullPayload);\n\n  // Production: Patient data logging removed for privacy\n\n  try {\n    const response = await fetchJSON(API_URLS.LDM_ICH, normalizedPayload, {\n      cacheable: true,\n      cacheTTL: MedicalCacheTTL.PREDICTION_RESULTS,\n      cachePriority: CachePriority.HIGH,\n      critical: true,\n    });\n\n    // Production: Response logging removed for privacy\n\n    // Normalize response format for consistency\n    const result = {\n      probability: safeParseFloat(response.probability || response.ich_probability, 0),\n      drivers: response.drivers || null,\n      confidence: safeParseFloat(response.confidence, 0.65),\n      module: 'Limited Data',\n      strategy: 'LIMITED_DATA_ICH',\n      timestamp: new Date().toISOString(),\n      inputSummary: {\n        age: normalizedPayload.age_years,\n        gfap: normalizedPayload.gfap_value,\n        systolic_bp: normalizedPayload.systolic_bp,\n        diastolic_bp: normalizedPayload.diastolic_bp,\n        vigilanzminderung: normalizedPayload.vigilanzminderung,\n      },\n    };\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.PREDICTION_COMPLETED, {\n      module: 'limited',\n      probability: result.probability,\n      confidence: result.confidence,\n      cached: response._cached || false,\n    });\n\n    return result;\n  } catch (error) {\n    console.error('Limited Data ICH prediction failed:', error);\n    throw new APIError(\n      `Failed to get ICH prediction: ${error.message}`,\n      error.status,\n      API_URLS.LDM_ICH,\n    );\n  }\n}\n\nexport async function predictFullStroke(payload) {\n  // Ensure all required fields are present for the Full Stroke API\n  const fullPayload = {\n    age_years: payload.age_years,\n    systolic_bp: payload.systolic_bp,\n    diastolic_bp: payload.diastolic_bp,\n    gfap_value: payload.gfap_value,\n    fast_ed_score: payload.fast_ed_score,\n    // Ensure all checkbox fields are present (default to 0 if missing)\n    headache: payload.headache || 0,\n    vigilanzminderung: payload.vigilanzminderung || 0,\n    armparese: payload.armparese || 0,\n    beinparese: payload.beinparese || 0,\n    eye_deviation: payload.eye_deviation || 0,\n    atrial_fibrillation: payload.atrial_fibrillation || 0,\n    anticoagulated_noak: payload.anticoagulated_noak || 0,\n    antiplatelets: payload.antiplatelets || 0,\n  };\n\n  const normalizedPayload = normalizeBooleans(fullPayload);\n\n  // Production: Patient data logging removed for privacy\n\n  // Use local LVO model for prediction (more accurate, faster, works offline)\n  let lvoResult = null;\n\n  if (canUseLocalModel(normalizedPayload)) {\n    console.log('🚀 Using local LVO model (GFAP + FAST-ED)');\n    const localLVO = predictLVO(normalizedPayload.gfap_value, normalizedPayload.fast_ed_score);\n\n    if (localLVO.probability !== null) {\n      // Convert local model format to match expected API format\n      lvoResult = {\n        probability: localLVO.probability,\n        drivers: localLVO.riskFactors.map((factor) => ({\n          feature: factor.name,\n          value: factor.value,\n          contribution: factor.contribution,\n          impact: factor.impact,\n        })),\n        confidence: localLVO.riskLevel === 'high' ? 0.9 : localLVO.riskLevel === 'moderate' ? 0.7 : 0.5,\n        module: 'Full Stroke (Local LVO)',\n        interpretation: localLVO.interpretation,\n      };\n\n      // Production: Prediction logging removed for privacy\n    }\n  }\n\n  try {\n    // Still use API for ICH prediction (requires all parameters)\n    const response = await fetchJSON(API_URLS.FULL_STROKE, normalizedPayload, {\n      cacheable: true,\n      cacheTTL: MedicalCacheTTL.PREDICTION_RESULTS,\n      cachePriority: CachePriority.HIGH,\n      critical: true,\n    });\n\n    // Production: Response logging removed for privacy\n\n    // Extract ICH results from API\n    const ichProbability = extractProbabilityFromResponse(response, 'ICH');\n    const ichDrivers = extractDriversFromResponse(response, 'ICH');\n    const ichConfidence = extractConfidenceFromResponse(response, 'ICH');\n\n    const ichResult = {\n      probability: ichProbability,\n      drivers: ichDrivers,\n      confidence: ichConfidence,\n      module: 'Full Stroke',\n      strategy: 'FULL_STROKE',\n      timestamp: new Date().toISOString(),\n      inputSummary: {\n        age: normalizedPayload.age_years,\n        gfap: normalizedPayload.gfap_value,\n        fast_ed: normalizedPayload.fast_ed_score,\n        systolic_bp: normalizedPayload.systolic_bp,\n      },\n    };\n\n    // If local LVO failed, fall back to API\n    if (!lvoResult) {\n      console.log('⚠️ Falling back to API for LVO prediction');\n      const lvoProbability = extractProbabilityFromResponse(response, 'LVO');\n      const lvoDrivers = extractDriversFromResponse(response, 'LVO');\n      const lvoConfidence = extractConfidenceFromResponse(response, 'LVO');\n\n      lvoResult = {\n        probability: lvoProbability,\n        drivers: lvoDrivers,\n        confidence: lvoConfidence,\n        module: 'Full Stroke (API)',\n        strategy: 'FULL_STROKE_LVO',\n        timestamp: new Date().toISOString(),\n      };\n    }\n\n    // Production: Results logging removed for privacy\n\n    const result = {\n      ich: ichResult,\n      lvo: lvoResult,\n    };\n\n    medicalEventObserver.publish(MEDICAL_EVENTS.PREDICTION_COMPLETED, {\n      module: 'full',\n      ich_probability: ichResult.probability,\n      lvo_probability: lvoResult.probability,\n      ich_confidence: ichResult.confidence,\n      lvo_confidence: lvoResult.confidence,\n      local_lvo_used: lvoResult.module.includes('Local'),\n      cached: response._cached || false,\n    });\n\n    return result;\n  } catch (error) {\n    console.error('Full Stroke prediction failed:', error);\n    throw new APIError(\n      `Failed to get stroke predictions: ${error.message}`,\n      error.status,\n      API_URLS.FULL_STROKE,\n    );\n  }\n}\n\n// Export the error class for use in other modules\nexport { APIError };\n","// Localization messages for the Stroke Triage Assistant\n\nexport const messages = {\n  en: {\n    // Header\n    appTitle: 'iGFAP',\n    emergencyBadge: 'Emergency Tool',\n    helpButton: 'Help and Instructions',\n    darkModeButton: 'Toggle dark mode',\n    languageToggle: 'Language',\n\n    // Progress\n    step1: 'Initial Assessment',\n    step2: 'Data Collection',\n    step3: 'Results',\n\n    // Module titles\n    comaModuleTitle: 'Coma Module',\n    limitedDataModuleTitle: 'Limited Data Module',\n    fullStrokeModuleTitle: 'Full Stroke Module',\n\n    // Triage 1\n    triage1Title: 'Patient Assessment',\n    triage1Question: 'Is the patient comatose?',\n    triage1Help: 'Glasgow Coma Scale < 9',\n    triage1Yes: 'YES - Comatose',\n    triage1No: 'NO - Conscious',\n\n    // Triage 2\n    triage2Title: 'Examination Capability',\n    triage2Question: 'Can the patient be reliably examined?',\n    triage2Help: 'Patient is not aphasic, confused, or uncooperative',\n    triage2Yes: 'YES - Full Exam Possible',\n    triage2No: 'NO - Limited Exam Only',\n\n    // Forms\n    ageLabel: 'Age (years)',\n    ageHelp: 'Patient age in years',\n    systolicLabel: 'Systolic BP (mmHg)',\n    systolicHelp: 'Systolic blood pressure',\n    diastolicLabel: 'Diastolic BP (mmHg)',\n    diastolicHelp: 'Diastolic blood pressure',\n    gfapLabel: 'GFAP Value (pg/mL)',\n    gfapHelp: 'GFAP biomarker level',\n    fastEdLabel: 'FAST-ED Score',\n    fastEdHelp: 'FAST-ED assessment score (0-9)',\n\n    // Checkboxes\n    headacheLabel: 'Headache',\n    vigilanzLabel: 'Reduced consciousness',\n    armPareseLabel: 'Arm weakness',\n    beinPareseLabel: 'Leg weakness',\n    eyeDeviationLabel: 'Eye deviation',\n    atrialFibLabel: 'Atrial fibrillation',\n    anticoagLabel: 'Anticoagulated (NOAK)',\n    antiplateletsLabel: 'Antiplatelets',\n\n    // Buttons\n    analyzeButton: 'Analyze',\n    analyzing: 'Analyzing...',\n    printResults: 'Print Results',\n    newAssessment: 'Start New Assessment',\n    startOver: 'Start Over',\n    goBack: 'Go Back',\n    goHome: 'Go Home',\n\n    // Form sections\n    basicInformation: 'Basic Information',\n    biomarkersScores: 'Biomarkers & Scores',\n    clinicalSymptoms: 'Clinical Symptoms',\n    medicalHistory: 'Medical History',\n\n    // Form labels with units\n    ageYearsLabel: 'Age (years)',\n    systolicBpLabel: 'Systolic BP (mmHg)',\n    diastolicBpLabel: 'Diastolic BP (mmHg)',\n    gfapValueLabel: 'GFAP Value (pg/mL)',\n    fastEdScoreLabel: 'FAST-ED Score',\n\n    // Help text\n    ageYearsHelp: \"Patient's age in years\",\n    systolicBpHelp: 'Normal: 90-140 mmHg',\n    diastolicBpHelp: 'Normal: 60-90 mmHg',\n    gfapTooltip: 'Brain injury biomarker',\n    gfapTooltipLong: 'Glial Fibrillary Acidic Protein - Brain injury biomarker',\n    gfapRange: 'Range: {min} - {max} pg/mL',\n    fastEdTooltip: '0-9 scale for LVO screening',\n\n    // Module buttons\n    analyzeIchRisk: 'Analyze ICH Risk',\n    analyzeStrokeRisk: 'Analyze Stroke Risk',\n\n    // Alert messages\n    criticalPatient: 'Critical Patient',\n    comaAlert: 'Patient is comatose (GCS < 9). Rapid assessment required.',\n    vigilanceReduction: 'Vigilance Reduction (Decreased alertness)',\n\n    // Additional symptom labels\n    armParesis: 'Arm Paresis',\n    legParesis: 'Leg Paresis',\n    eyeDeviation: 'Eye Deviation',\n    atrialFibrillation: 'Atrial Fibrillation',\n    onNoacDoac: 'On NOAC/DOAC',\n    onAntiplatelets: 'On Antiplatelets',\n\n    // Results\n    resultsTitle: 'Assessment Results',\n    bleedingRiskAssessment: 'Bleeding Risk Assessment',\n    ichProbability: 'ICH Probability',\n    lvoProbability: 'LVO Probability',\n    lvoMayBePossible: 'Large vessel occlusion possible - further evaluation recommended',\n    riskFactorsTitle: 'Main Risk Factors',\n    increasingRisk: 'Increasing Risk',\n    decreasingRisk: 'Decreasing Risk',\n    noFactors: 'No factors',\n    riskLevel: 'Risk Level',\n    lowRisk: 'Low Risk',\n    mediumRisk: 'Medium Risk',\n    highRisk: 'High Risk',\n\n    // Risk levels\n    riskLow: 'Low',\n    riskMedium: 'Medium',\n    riskHigh: 'High',\n\n    // Risk Factors Analysis\n    riskFactorsAnalysis: 'Risk Factors',\n    contributingFactors: 'Contributing factors to the assessment',\n    riskFactors: 'Risk Factors',\n    increaseRisk: 'INCREASE',\n    decreaseRisk: 'DECREASE',\n    noPositiveFactors: 'No increasing factors',\n    noNegativeFactors: 'No decreasing factors',\n    ichRiskFactors: 'ICH Risk Factors',\n    lvoRiskFactors: 'LVO Risk Factors',\n\n    // Critical Alert\n    criticalAlertTitle: 'CRITICAL RISK DETECTED',\n    criticalAlertMessage: 'High probability of intracerebral hemorrhage detected.',\n    immediateActionsRequired: 'Immediate actions required',\n    initiateStrokeProtocol: 'Initiate stroke protocol immediately',\n    urgentCtImaging: 'Urgent CT imaging required',\n    considerBpManagement: 'Consider blood pressure management',\n    prepareNeurosurgicalConsult: 'Prepare for potential neurosurgical consultation',\n\n    // Help Modal\n    helpTitle: 'Quick Reference Guide',\n    gcsTitle: 'Glasgow Coma Scale (GCS)',\n    gcsLow: 'GCS < 9: Comatose patient - use Coma Module',\n    gcsMod: 'GCS 8-12: Moderate impairment',\n    gcsHigh: 'GCS 13-15: Mild impairment',\n    fastEdTitle: 'FAST-ED Score Components',\n    fastEdFacial: 'Facial Palsy: 0-1 points',\n    fastEdArm: 'Arm Weakness: 0-2 points',\n    fastEdSpeech: 'Speech Changes: 0-2 points',\n    fastEdTime: 'Time: Critical factor',\n    fastEdEye: 'Eye Deviation: 0-2 points',\n    fastEdDenial: 'Denial/Neglect: 0-2 points',\n    criticalValuesTitle: 'Critical Values',\n    criticalBp: 'Systolic BP > 180: Increased ICH risk',\n    criticalGfap: 'GFAP > 500 pg/mL: Significant marker',\n    criticalFastEd: 'FAST-ED ≥ 4: Consider LVO',\n\n    // FAST-ED Calculator Modal\n    fastEdCalculatorTitle: 'FAST-ED Score Calculator',\n    fastEdCalculatorSubtitle: 'Click to calculate FAST-ED score components',\n    facialPalsyTitle: 'Facial Palsy',\n    facialPalsyNormal: 'Normal (0)',\n    facialPalsyMild: 'Present (1)',\n    armWeaknessTitle: 'Arm Weakness',\n    armWeaknessNormal: 'Normal (0)',\n    armWeaknessMild: 'Mild weakness or drift (1)',\n    armWeaknessSevere: 'Severe weakness or falls immediately (2)',\n    speechChangesTitle: 'Speech Abnormalities',\n    speechChangesNormal: 'Normal (0)',\n    speechChangesMild: 'Mild dysarthria or aphasia (1)',\n    speechChangesSevere: 'Severe dysarthria or aphasia (2)',\n    eyeDeviationTitle: 'Eye Deviation',\n    eyeDeviationNormal: 'Normal (0)',\n    eyeDeviationPartial: 'Partial gaze deviation (1)',\n    eyeDeviationForced: 'Forced gaze deviation (2)',\n    denialNeglectTitle: 'Denial/Neglect',\n    denialNeglectNormal: 'Normal (0)',\n    denialNeglectPartial: 'Partial neglect (1)',\n    denialNeglectComplete: 'Complete neglect (2)',\n    totalScoreTitle: 'Total FAST-ED Score',\n    riskLevel: 'Risk Level',\n    riskLevelLow: 'LOW (Score <4)',\n    riskLevelHigh: 'HIGH (Score ≥4 - Consider LVO)',\n    applyScore: 'Apply Score',\n    cancel: 'Cancel',\n\n    // Results Screen Enhancements\n    riskAnalysis: 'Risk Analysis',\n    riskAnalysisSubtitle: 'Clinical factors in this assessment',\n    contributingFactors: 'Contributing factors',\n    factorsShown: 'shown',\n    positiveFactors: 'Positive factors',\n    negativeFactors: 'Negative factors',\n    clinicalInformation: 'Clinical Information',\n    clinicalRecommendations: 'Clinical Recommendations',\n    clinicalRec1: 'Consider immediate imaging if ICH risk is high',\n    clinicalRec2: 'Activate stroke team for LVO scores ≥ 50%',\n    clinicalRec3: 'Monitor blood pressure closely',\n    clinicalRec4: 'Document all findings thoroughly',\n    noDriverData: 'No driver data available',\n    driverAnalysisUnavailable: 'Driver analysis unavailable',\n    driverInfoNotAvailable: 'Driver information not available from this prediction model',\n    driverAnalysisNotAvailable: 'Driver analysis not available for this prediction',\n    lvoNotPossible: 'LVO assessment not possible with limited data',\n    fullExamRequired: 'Full neurological examination required for LVO screening',\n    limitedAssessment: 'Limited Assessment',\n\n    // Disclaimer\n    disclaimer: 'Clinical Disclaimer',\n    disclaimerText: 'This tool is for clinical decision support only. Always use clinical judgment and follow local protocols. Not a replacement for physician assessment.',\n    importantNote: 'Important',\n    importantText: 'These results are for clinical decision support only. Always use clinical judgment and follow institutional protocols.',\n\n    // ICH Volume and Mortality\n    predictedMortality: 'Predicted 30-day mortality',\n    ichVolumeLabel: 'ICH Volume',\n    references: 'References',\n\n    // Input Summary\n    inputSummaryTitle: 'Input Summary',\n    inputSummarySubtitle: 'Values used for this analysis',\n\n    // Footer\n    privacyLink: 'Privacy Policy',\n    disclaimerLink: 'Medical Disclaimer',\n    versionLink: 'Version 2.1.0 - Research Preview',\n\n    // Privacy and disclaimers\n    privacyPolicy: 'Privacy Policy: This tool processes data locally. No patient data is stored or transmitted.',\n    medicalDisclaimer: 'Medical Disclaimer: This tool is for clinical decision support only. Always use clinical judgment and follow local protocols.',\n\n    // Error messages\n    networkError: 'Network error - please check your connection and try again',\n    requestTimeout: 'Request timeout - please try again',\n    apiError: 'Failed to get results',\n    validationError: 'Please check your input values',\n\n    // Session\n    sessionTimeout: 'Your session has been idle for 30 minutes. Would you like to continue?',\n    unsavedData: 'You have unsaved data. Are you sure you want to leave?',\n\n    // Stroke Centers\n    nearestCentersTitle: 'Nearest Stroke Centers',\n    useCurrentLocation: 'Use Current Location',\n    enterLocationPlaceholder: 'Enter city or address...',\n    enterManually: 'Enter Location Manually',\n    search: 'Search',\n    yourLocation: 'Your Location',\n    recommendedCenters: 'Recommended Centers',\n    alternativeCenters: 'Alternative Centers',\n    noCentersFound: 'No stroke centers found in this area',\n    gettingLocation: 'Getting your location',\n    searchingLocation: 'Searching location',\n    locationError: 'Unable to get your location',\n    locationPermissionDenied: 'Location access denied. Please allow location access and try again.',\n    locationUnavailable: 'Location information is unavailable',\n    locationTimeout: 'Location request timed out',\n    geolocationNotSupported: 'Geolocation is not supported by this browser',\n    geocodingNotImplemented: 'Location search not available. Please use GPS or enter coordinates manually.',\n    tryManualEntry: 'Try entering your location manually or use GPS.',\n    distanceNote: 'Distances are calculated as straight-line distances. Actual travel times may vary.',\n    travelTimeNote: 'Travel times calculated for emergency vehicles with sirens and priority routing.',\n    calculatingTravelTimes: 'Calculating travel times',\n    minutes: 'min',\n    poweredByOrs: 'Travel times powered by OpenRoute Service',\n\n    // Center Types and Services\n    comprehensiveCenter: 'Comprehensive Stroke Center',\n    primaryCenter: 'Primary Stroke Center',\n    telemetryCenter: 'Telemedicine Center',\n    thrombectomy: 'Thrombectomy',\n    neurosurgery: 'Neurosurgery',\n    icu: 'Intensive Care',\n    telemedicine: 'Telemedicine',\n    stroke_unit: 'Stroke Unit',\n\n    // Actions\n    call: 'Call',\n    directions: 'Directions',\n    emergency: 'Emergency',\n    certified: 'Certified',\n\n    // Prerequisites Modal\n    prerequisitesTitle: 'Prerequisites for Stroke Triage',\n    prerequisitesIntro: 'Please confirm that all of the following prerequisites are met:',\n    prerequisitesWarning: 'All prerequisites must be met to continue',\n    continue: 'Continue',\n    acute_deficit: 'Acute (severe) neurological deficit present',\n    symptom_onset: 'Symptom onset within 6 hours',\n    no_preexisting: 'No pre-existing severe neurological deficits',\n    no_trauma: 'No traumatic brain injury present',\n\n    // Differential Diagnoses for Stroke Modules\n    differentialDiagnoses: 'Differential Diagnoses',\n    reconfirmTimeWindow: 'Please reconfirm time window!',\n    unclearTimeWindow: 'With unclear/extended time window, early demarcated brain infarction is also possible',\n    rareDiagnoses: 'Rare diagnoses such as glioblastoma are also possible',\n\n  },\n\n  de: {\n    // Header\n    appTitle: 'iGFAP',\n    emergencyBadge: 'Notfall-Tool',\n    helpButton: 'Hilfe und Anweisungen',\n    darkModeButton: 'Dunklen Modus umschalten',\n    languageToggle: 'Sprache',\n\n    // Progress\n    step1: 'Erstbeurteilung',\n    step2: 'Datenerhebung',\n    step3: 'Ergebnisse',\n\n    // Module titles\n    comaModuleTitle: 'Koma-Modul',\n    limitedDataModuleTitle: 'Begrenzte Daten Modul',\n    fullStrokeModuleTitle: 'Vollständiges Schlaganfall-Modul',\n\n    // Triage 1\n    triage1Title: 'Patientenbeurteilung',\n    triage1Question: 'Ist der Patient komatös?',\n    triage1Help: 'Glasgow Coma Scale < 9',\n    triage1Yes: 'JA - Komatös',\n    triage1No: 'NEIN - Bei Bewusstsein',\n\n    // Triage 2\n    triage2Title: 'Untersuchungsfähigkeit',\n    triage2Question: 'Kann der Patient zuverlässig untersucht werden?',\n    triage2Help: 'Patient ist nicht aphasisch, verwirrt oder unkooperativ',\n    triage2Yes: 'JA - Vollständige Untersuchung möglich',\n    triage2No: 'NEIN - Nur begrenzte Untersuchung',\n\n    // Forms\n    ageLabel: 'Alter (Jahre)',\n    ageHelp: 'Patientenalter in Jahren',\n    systolicLabel: 'Systolischer RR (mmHg)',\n    systolicHelp: 'Systolischer Blutdruck',\n    diastolicLabel: 'Diastolischer RR (mmHg)',\n    diastolicHelp: 'Diastolischer Blutdruck',\n    gfapLabel: 'GFAP-Wert (pg/mL)',\n    gfapHelp: 'GFAP-Biomarker-Wert',\n    fastEdLabel: 'FAST-ED-Score',\n    fastEdHelp: 'FAST-ED-Bewertungsscore (0-9)',\n\n    // Checkboxes\n    headacheLabel: 'Kopfschmerzen',\n    vigilanzLabel: 'Bewusstseinstrübung',\n    armPareseLabel: 'Armschwäche',\n    beinPareseLabel: 'Beinschwäche',\n    eyeDeviationLabel: 'Blickdeviation',\n    atrialFibLabel: 'Vorhofflimmern',\n    anticoagLabel: 'Antikoaguliert (NOAK)',\n    antiplateletsLabel: 'Thrombozytenaggregationshemmer',\n\n    // Buttons\n    analyzeButton: 'Analysieren',\n    analyzing: 'Analysiere...',\n    printResults: 'Ergebnisse drucken',\n    newAssessment: 'Neue Bewertung starten',\n    startOver: 'Von vorn beginnen',\n    goBack: 'Zurück',\n    goHome: 'Zur Startseite',\n\n    // Form sections\n    basicInformation: 'Grundinformationen',\n    biomarkersScores: 'Biomarker & Scores',\n    clinicalSymptoms: 'Klinische Symptome',\n    medicalHistory: 'Anamnese',\n\n    // Form labels with units\n    ageYearsLabel: 'Alter (Jahre)',\n    systolicBpLabel: 'Systolischer RR (mmHg)',\n    diastolicBpLabel: 'Diastolischer RR (mmHg)',\n    gfapValueLabel: 'GFAP-Wert (pg/mL)',\n    fastEdScoreLabel: 'FAST-ED-Score',\n\n    // Help text\n    ageYearsHelp: 'Patientenalter in Jahren',\n    systolicBpHelp: 'Normal: 90-140 mmHg',\n    diastolicBpHelp: 'Normal: 60-90 mmHg',\n    gfapTooltip: 'Hirnverletzungs-Biomarker',\n    gfapTooltipLong: 'Glial Fibrillary Acidic Protein - Hirnverletzungs-Biomarker',\n    gfapRange: 'Bereich: {min} - {max} pg/mL',\n    fastEdTooltip: '0-9 Skala für LVO-Screening',\n\n    // Module buttons\n    analyzeIchRisk: 'ICB-Risiko analysieren',\n    analyzeStrokeRisk: 'Schlaganfall-Risiko analysieren',\n\n    // Alert messages\n    criticalPatient: 'Kritischer Patient',\n    comaAlert: 'Patient ist komatös (GCS < 9). Schnelle Beurteilung erforderlich.',\n    vigilanceReduction: 'Vigilanzminderung (Verminderte Wachheit)',\n\n    // Additional symptom labels\n    armParesis: 'Armparese',\n    legParesis: 'Beinparese',\n    eyeDeviation: 'Blickdeviation',\n    atrialFibrillation: 'Vorhofflimmern',\n    onNoacDoac: 'NOAK/DOAK-Therapie',\n    onAntiplatelets: 'Thrombozytenaggregationshemmer',\n\n    // Results\n    resultsTitle: 'Bewertungsergebnisse',\n    bleedingRiskAssessment: 'Blutungsrisiko-Bewertung',\n    ichProbability: 'ICB-Risiko',\n    lvoProbability: 'LVO-Risiko',\n    lvoMayBePossible: 'Großgefäßverschluss möglich - weitere Abklärung empfohlen',\n    riskFactorsTitle: 'Hauptrisikofaktoren',\n    increasingRisk: 'Risikoerhöhend',\n    decreasingRisk: 'Risikomindernd',\n    noFactors: 'Keine Faktoren',\n    riskLevel: 'Risikostufe',\n    lowRisk: 'Niedriges Risiko',\n    mediumRisk: 'Mittleres Risiko',\n    highRisk: 'Hohes Risiko',\n\n    // Risk levels\n    riskLow: 'Niedrig',\n    riskMedium: 'Mittel',\n    riskHigh: 'Hoch',\n\n    // Risk Factors Analysis\n    riskFactorsAnalysis: 'Risikofaktoren',\n    contributingFactors: 'Beitragende Faktoren zur Bewertung',\n    riskFactors: 'Risikofaktoren',\n    increaseRisk: 'ERHÖHEN',\n    decreaseRisk: 'VERRINGERN',\n    noPositiveFactors: 'Keine erhöhenden Faktoren',\n    noNegativeFactors: 'Keine verringernden Faktoren',\n    ichRiskFactors: 'ICB-Risikofaktoren',\n    lvoRiskFactors: 'LVO-Risikofaktoren',\n\n    // Critical Alert\n    criticalAlertTitle: 'KRITISCHES RISIKO ERKANNT',\n    criticalAlertMessage: 'Hohe Wahrscheinlichkeit einer intrazerebralen Blutung erkannt.',\n    immediateActionsRequired: 'Sofortige Maßnahmen erforderlich',\n    initiateStrokeProtocol: 'Schlaganfall-Protokoll sofort einleiten',\n    urgentCtImaging: 'Dringende CT-Bildgebung erforderlich',\n    considerBpManagement: 'Blutdruckmanagement erwägen',\n    prepareNeurosurgicalConsult: 'Neurochirurgische Konsultation vorbereiten',\n\n    // Help Modal\n    helpTitle: 'Kurzreferenzleitfaden',\n    gcsTitle: 'Glasgow Coma Scale (GCS)',\n    gcsLow: 'GCS < 9: Komatöser Patient - Koma-Modul verwenden',\n    gcsMod: 'GCS 8-12: Mäßige Beeinträchtigung',\n    gcsHigh: 'GCS 13-15: Leichte Beeinträchtigung',\n    fastEdTitle: 'FAST-ED-Score-Komponenten',\n    fastEdFacial: 'Faziale Parese: 0-1 Punkte',\n    fastEdArm: 'Armschwäche: 0-2 Punkte',\n    fastEdSpeech: 'Sprachveränderungen: 0-2 Punkte',\n    fastEdTime: 'Zeit: Kritischer Faktor',\n    fastEdEye: 'Blickdeviation: 0-2 Punkte',\n    fastEdDenial: 'Verneinung/Neglect: 0-2 Punkte',\n    criticalValuesTitle: 'Kritische Werte',\n    criticalBp: 'Systolischer RR > 180: Erhöhtes ICB-Risiko',\n    criticalGfap: 'GFAP > 500 pg/mL: Signifikanter Marker',\n    criticalFastEd: 'FAST-ED ≥ 4: LVO in Betracht ziehen',\n\n    // FAST-ED Calculator Modal\n    fastEdCalculatorTitle: 'FAST-ED-Score-Rechner',\n    fastEdCalculatorSubtitle: 'Klicken Sie, um FAST-ED-Score-Komponenten zu berechnen',\n    facialPalsyTitle: 'Fazialisparese',\n    facialPalsyNormal: 'Normal (0)',\n    facialPalsyMild: 'Vorhanden (1)',\n    armWeaknessTitle: 'Armschwäche',\n    armWeaknessNormal: 'Normal (0)',\n    armWeaknessMild: 'Leichte Schwäche oder Absinken (1)',\n    armWeaknessSevere: 'Schwere Schwäche oder fällt sofort ab (2)',\n    speechChangesTitle: 'Sprachstörungen',\n    speechChangesNormal: 'Normal (0)',\n    speechChangesMild: 'Leichte Dysarthrie oder Aphasie (1)',\n    speechChangesSevere: 'Schwere Dysarthrie oder Aphasie (2)',\n    eyeDeviationTitle: 'Blickdeviation',\n    eyeDeviationNormal: 'Normal (0)',\n    eyeDeviationPartial: 'Partielle Blickdeviation (1)',\n    eyeDeviationForced: 'Forcierte Blickdeviation (2)',\n    denialNeglectTitle: 'Verneinung/Neglect',\n    denialNeglectNormal: 'Normal (0)',\n    denialNeglectPartial: 'Partieller Neglect (1)',\n    denialNeglectComplete: 'Kompletter Neglect (2)',\n    totalScoreTitle: 'Gesamt-FAST-ED-Score',\n    riskLevel: 'Risikostufe',\n    riskLevelLow: 'NIEDRIG (Score <4)',\n    riskLevelHigh: 'HOCH (Score ≥4 - LVO erwägen)',\n    applyScore: 'Score Anwenden',\n    cancel: 'Abbrechen',\n\n    // Results Screen Enhancements\n    riskAnalysis: 'Risikoanalyse',\n    riskAnalysisSubtitle: 'Klinische Faktoren in dieser Bewertung',\n    contributingFactors: 'Beitragende Faktoren',\n    factorsShown: 'angezeigt',\n    positiveFactors: 'Positive Faktoren',\n    negativeFactors: 'Negative Faktoren',\n    clinicalInformation: 'Klinische Informationen',\n    clinicalRecommendations: 'Klinische Empfehlungen',\n    clinicalRec1: 'Sofortige Bildgebung erwägen bei hohem ICB-Risiko',\n    clinicalRec2: 'Stroke-Team aktivieren bei LVO-Score ≥ 50%',\n    clinicalRec3: 'Blutdruck engmaschig überwachen',\n    clinicalRec4: 'Alle Befunde gründlich dokumentieren',\n    noDriverData: 'Keine Treiberdaten verfügbar',\n    driverAnalysisUnavailable: 'Treiberanalyse nicht verfügbar',\n    driverInfoNotAvailable: 'Treiberinformationen von diesem Vorhersagemodell nicht verfügbar',\n    driverAnalysisNotAvailable: 'Treiberanalyse für diese Vorhersage nicht verfügbar',\n    lvoNotPossible: 'LVO-Bewertung mit begrenzten Daten nicht möglich',\n    fullExamRequired: 'Vollständige neurologische Untersuchung für LVO-Screening erforderlich',\n    limitedAssessment: 'Begrenzte Bewertung',\n\n    // Disclaimer\n    disclaimer: 'Klinischer Haftungsausschluss',\n    disclaimerText: 'Dieses Tool dient nur zur klinischen Entscheidungsunterstützung. Verwenden Sie immer klinisches Urteilsvermögen und befolgen Sie lokale Protokolle. Kein Ersatz für ärztliche Beurteilung.',\n    importantNote: 'Wichtig',\n    importantText: 'Diese Ergebnisse dienen nur zur klinischen Entscheidungsunterstützung. Verwenden Sie immer klinisches Urteilsvermögen und befolgen Sie institutionelle Protokolle.',\n\n    // ICH Volume and Mortality\n    predictedMortality: 'Vorhergesagte 30-Tage-Mortalität',\n    ichVolumeLabel: 'ICB-Volumen',\n    references: 'Referenzen',\n\n    // Input Summary\n    inputSummaryTitle: 'Eingabezusammenfassung',\n    inputSummarySubtitle: 'Für diese Analyse verwendete Werte',\n\n    // Footer\n    privacyLink: 'Datenschutzrichtlinie',\n    disclaimerLink: 'Medizinischer Haftungsausschluss',\n    versionLink: 'Version 2.1.0 - Research Preview',\n\n    // Privacy and disclaimers\n    privacyPolicy: 'Datenschutzrichtlinie: Dieses Tool verarbeitet Daten lokal. Keine Patientendaten werden gespeichert oder übertragen.',\n    medicalDisclaimer: 'Medizinischer Haftungsausschluss: Dieses Tool dient nur zur klinischen Entscheidungsunterstützung. Verwenden Sie immer klinisches Urteilsvermögen und befolgen Sie lokale Protokolle.',\n\n    // Error messages\n    networkError: 'Netzwerkfehler - bitte überprüfen Sie Ihre Verbindung und versuchen Sie es erneut',\n    requestTimeout: 'Anfrage-Timeout - bitte versuchen Sie es erneut',\n    apiError: 'Ergebnisse konnten nicht abgerufen werden',\n    validationError: 'Bitte überprüfen Sie Ihre Eingabewerte',\n\n    // Session\n    sessionTimeout: 'Ihre Sitzung war 30 Minuten lang inaktiv. Möchten Sie fortfahren?',\n    unsavedData: 'Sie haben ungespeicherte Daten. Sind Sie sicher, dass Sie verlassen möchten?',\n\n    // Stroke Centers\n    nearestCentersTitle: 'Nächstgelegene Schlaganfall-Zentren',\n    useCurrentLocation: 'Aktuellen Standort verwenden',\n    enterLocationPlaceholder: 'Stadt oder Adresse eingeben...',\n    enterManually: 'Standort manuell eingeben',\n    search: 'Suchen',\n    yourLocation: 'Ihr Standort',\n    recommendedCenters: 'Empfohlene Zentren',\n    alternativeCenters: 'Alternative Zentren',\n    noCentersFound: 'Keine Schlaganfall-Zentren in diesem Bereich gefunden',\n    gettingLocation: 'Standort wird ermittelt',\n    searchingLocation: 'Standort wird gesucht',\n    locationError: 'Standort konnte nicht ermittelt werden',\n    locationPermissionDenied: 'Standortzugriff verweigert. Bitte erlauben Sie Standortzugriff und versuchen Sie es erneut.',\n    locationUnavailable: 'Standortinformationen sind nicht verfügbar',\n    locationTimeout: 'Standortanfrage ist abgelaufen',\n    geolocationNotSupported: 'Geolokalisierung wird von diesem Browser nicht unterstützt',\n    geocodingNotImplemented: 'Standortsuche nicht verfügbar. Bitte verwenden Sie GPS oder geben Sie Koordinaten manuell ein.',\n    tryManualEntry: 'Versuchen Sie, Ihren Standort manuell einzugeben oder GPS zu verwenden.',\n    distanceNote: 'Entfernungen werden als Luftlinie berechnet. Tatsächliche Fahrzeiten können variieren.',\n    travelTimeNote: 'Fahrzeiten berechnet für Rettungsfahrzeuge mit Sondersignalen und Vorfahrtsberechtigung.',\n    calculatingTravelTimes: 'Fahrzeiten werden berechnet',\n    minutes: 'Min',\n    poweredByOrs: 'Fahrzeiten bereitgestellt von OpenRoute Service',\n\n    // Center Types and Services\n    comprehensiveCenter: 'Überregionales Schlaganfall-Zentrum',\n    primaryCenter: 'Regionales Schlaganfall-Zentrum',\n    telemetryCenter: 'Telemedizin-Zentrum',\n    thrombectomy: 'Thrombektomie',\n    neurosurgery: 'Neurochirurgie',\n    icu: 'Intensivstation',\n    telemedicine: 'Telemedizin',\n    stroke_unit: 'Stroke Unit',\n\n    // Actions\n    call: 'Anrufen',\n    directions: 'Wegbeschreibung',\n    emergency: 'Notfall',\n    certified: 'Zertifiziert',\n\n    // Prerequisites Modal\n    prerequisitesTitle: 'Voraussetzungen für Schlaganfall-Triage',\n    prerequisitesIntro: 'Bitte bestätigen Sie, dass alle folgenden Voraussetzungen erfüllt sind:',\n    prerequisitesWarning: 'Alle Voraussetzungen müssen erfüllt sein, um fortzufahren',\n    continue: 'Weiter',\n    acute_deficit: 'Akutes (schweres) neurologisches Defizit vorhanden',\n    symptom_onset: 'Symptombeginn innerhalb 6h',\n    no_preexisting: 'Keine vorbestehende schwere neurologische Defizite',\n    no_trauma: 'Kein Schädelhirntrauma vorhanden',\n\n    // Differential Diagnoses for Stroke Modules\n    differentialDiagnoses: 'Differentialdiagnosen',\n    reconfirmTimeWindow: 'Bitte Zeitfenster rekonfirmieren!',\n    unclearTimeWindow: 'Bei unklarem/erweitertem Zeitfenster ist auch ein beginnend demarkierter Hirninfarkt möglich',\n    rareDiagnoses: 'Seltene Diagnosen wie ein Glioblastom sind auch möglich',\n\n  },\n};\n","// Internationalization utilities for the Stroke Triage Assistant\n\nimport { messages } from './messages.js';\n\nclass I18n {\n  constructor() {\n    this.supportedLanguages = ['en', 'de'];\n    this.currentLanguage = this.detectLanguage();\n  }\n\n  // Detect browser language and default to appropriate language\n  detectLanguage() {\n    // Check if language is already set in localStorage\n    const savedLanguage = localStorage.getItem('language');\n    if (savedLanguage && this.supportedLanguages.includes(savedLanguage)) {\n      return savedLanguage;\n    }\n\n    // Detect browser language\n    const browserLang = navigator.language || navigator.userLanguage;\n    const langCode = browserLang.substring(0, 2).toLowerCase();\n\n    // Default to German if browser language is German, otherwise English\n    return langCode === 'de' ? 'de' : 'en';\n  }\n\n  // Get current language\n  getCurrentLanguage() {\n    return this.currentLanguage;\n  }\n\n  // Set language and save to localStorage\n  setLanguage(language) {\n    if (this.supportedLanguages.includes(language)) {\n      this.currentLanguage = language;\n      localStorage.setItem('language', language);\n\n      // Dispatch custom event for language change\n      window.dispatchEvent(new CustomEvent('languageChanged', {\n        detail: { language },\n      }));\n\n      return true;\n    }\n    return false;\n  }\n\n  // Get supported languages\n  getSupportedLanguages() {\n    return [...this.supportedLanguages];\n  }\n\n  // Translate a message key\n  t(key) {\n    const currentMessages = messages[this.currentLanguage] || messages.en;\n    return currentMessages[key] || key;\n  }\n\n  // Toggle between English and German\n  toggleLanguage() {\n    const newLanguage = this.currentLanguage === 'en' ? 'de' : 'en';\n    return this.setLanguage(newLanguage);\n  }\n\n  // Get language display name\n  getLanguageDisplayName(lang = null) {\n    const language = lang || this.currentLanguage;\n    const displayNames = {\n      en: 'English',\n      de: 'Deutsch',\n    };\n    return displayNames[language] || language;\n  }\n\n  // Format date/time according to current locale\n  formatDateTime(date) {\n    const locale = this.currentLanguage === 'de' ? 'de-DE' : 'en-US';\n    return new Intl.DateTimeFormat(locale, {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    }).format(date);\n  }\n\n  // Format time only according to current locale\n  formatTime(date) {\n    const locale = this.currentLanguage === 'de' ? 'de-DE' : 'en-US';\n    return new Intl.DateTimeFormat(locale, {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    }).format(date);\n  }\n}\n\n// Create singleton instance\nconst i18n = new I18n();\n\n// Export both the instance and the class\nexport { i18n, I18n };\n\n// Export convenience function for translation\nexport const t = (key) => i18n.t(key);\n","import { t, i18n } from '../../localization/i18n.js';\nimport { navigate } from '../../logic/handlers.js';\n\n/**\n * Prerequisites checklist items\n */\nconst getPrerequisites = () => [\n  { id: 'acute_deficit', checked: false },\n  { id: 'symptom_onset', checked: false },\n  { id: 'no_preexisting', checked: false },\n  { id: 'no_trauma', checked: false },\n];\n\n/**\n * Render prerequisites modal\n * @returns {string} HTML for prerequisites modal\n */\nexport function renderPrerequisitesModal() {\n  const prerequisites = getPrerequisites();\n\n  return `\n    <div id=\"prerequisitesModal\" class=\"modal prerequisites-modal\" style=\"display: flex;\">\n      <div class=\"modal-content prerequisites-content\">\n        <div class=\"modal-header\">\n          <h2>${t('prerequisitesTitle')}</h2>\n          <button class=\"modal-close\" id=\"closePrerequisites\">&times;</button>\n        </div>\n        \n        <div class=\"modal-body\">\n          <p class=\"prerequisites-intro\">\n            ${t('prerequisitesIntro')}\n          </p>\n          \n          <div class=\"prerequisites-list\">\n            ${prerequisites.map((item) => `\n              <div class=\"prerequisite-item\" data-id=\"${item.id}\">\n                <label class=\"toggle-switch\">\n                  <input type=\"checkbox\" id=\"${item.id}\" class=\"toggle-input\">\n                  <span class=\"toggle-slider\"></span>\n                </label>\n                <span class=\"prerequisite-label\">\n                  ${t(item.id)}\n                </span>\n              </div>\n            `).join('')}\n          </div>\n          \n          <div class=\"prerequisites-warning\" id=\"prerequisitesWarning\" style=\"display: none;\">\n            <span class=\"warning-icon\">⚠️</span>\n            <span class=\"warning-text\">\n              ${t('prerequisitesWarning')}\n            </span>\n          </div>\n        </div>\n        \n        <div class=\"modal-footer\">\n          <div class=\"button-group\">\n            <button type=\"button\" class=\"secondary\" id=\"cancelPrerequisites\">\n              ${t('cancel')}\n            </button>\n            <button type=\"button\" class=\"primary\" id=\"confirmPrerequisites\">\n              ${t('continue')}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Initialize prerequisites modal event handlers\n */\nexport function initPrerequisitesModal() {\n  const modal = document.getElementById('prerequisitesModal');\n  if (!modal) {\n    console.error('Prerequisites modal not found');\n    return;\n  }\n\n  console.log('Initializing prerequisites modal');\n\n  // Close button handlers\n  const closeBtn = document.getElementById('closePrerequisites');\n  const cancelBtn = document.getElementById('cancelPrerequisites');\n  const confirmBtn = document.getElementById('confirmPrerequisites');\n\n  console.log('Modal buttons found:', { closeBtn: !!closeBtn, cancelBtn: !!cancelBtn, confirmBtn: !!confirmBtn });\n\n  const closeModal = () => {\n    modal.remove();\n    // Navigate back to welcome screen if cancelled\n    navigate('welcome');\n  };\n\n  closeBtn?.addEventListener('click', closeModal);\n  cancelBtn?.addEventListener('click', closeModal);\n\n  // Confirm button handler\n  confirmBtn?.addEventListener('click', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log('Prerequisites confirm button clicked');\n    const checkboxes = modal.querySelectorAll('.toggle-input');\n    const allChecked = Array.from(checkboxes).every((cb) => cb.checked);\n    console.log('All prerequisites checked:', allChecked);\n\n    if (allChecked) {\n      console.log('Navigating to triage2');\n      modal.remove();\n      // Proceed to triage2 (stroke module selection)\n      navigate('triage2');\n    } else {\n      console.log('Showing prerequisites warning');\n      // Show warning\n      const warning = document.getElementById('prerequisitesWarning');\n      if (warning) {\n        warning.style.display = 'flex';\n        // Shake animation\n        warning.classList.add('shake');\n        setTimeout(() => warning.classList.remove('shake'), 500);\n      }\n    }\n  });\n\n  // Toggle change handler to hide warning when all checked\n  const checkboxes = modal.querySelectorAll('.toggle-input');\n  checkboxes.forEach((checkbox) => {\n    checkbox.addEventListener('change', () => {\n      const allChecked = Array.from(checkboxes).every((cb) => cb.checked);\n      const warning = document.getElementById('prerequisitesWarning');\n\n      if (allChecked && warning) {\n        warning.style.display = 'none';\n      }\n    });\n  });\n}\n\n/**\n * Show prerequisites modal\n */\nexport function showPrerequisitesModal() {\n  const existingModal = document.getElementById('prerequisitesModal');\n\n  // Always remove existing modal and create fresh one to handle language changes\n  if (existingModal) {\n    existingModal.remove();\n  }\n\n  // Create modal element directly instead of innerHTML\n  const modalElement = document.createElement('div');\n  modalElement.innerHTML = renderPrerequisitesModal();\n  const modal = modalElement.firstElementChild;\n\n  // Insert into DOM\n  document.body.appendChild(modal);\n\n  // Initialize immediately since DOM is ready\n  initPrerequisitesModal();\n}\n","import { VALIDATION_RULES } from '../config.js';\n\nexport function validateInput(name, value, rules, formData = null) {\n  const result = {\n    errors: [],\n    warnings: [],\n  };\n\n  if (rules.required && !value && value !== 0) {\n    result.errors.push('This field is required');\n  }\n\n  if (rules.min !== undefined && value !== '' && !isNaN(value) && parseFloat(value) < rules.min) {\n    result.errors.push(`Value must be at least ${rules.min}`);\n  }\n\n  if (rules.max !== undefined && value !== '' && !isNaN(value) && parseFloat(value) > rules.max) {\n    result.errors.push(`Value must be at most ${rules.max}`);\n  }\n\n  if (rules.pattern && !rules.pattern.test(value)) {\n    result.errors.push('Invalid format');\n  }\n\n  // Medical validation checks (warnings, not blocking errors)\n  if (rules.medicalCheck && value !== '' && !isNaN(value)) {\n    const medicalWarning = rules.medicalCheck(parseFloat(value), formData);\n    if (medicalWarning) {\n      result.warnings.push(medicalWarning);\n    }\n  }\n\n  // For backward compatibility, return just errors array if no warnings\n  if (result.warnings.length === 0) {\n    return result.errors;\n  }\n\n  return result;\n}\n\nexport function validateForm(form) {\n  let isValid = true;\n  const validationErrors = {};\n\n  // Collect form data for medical checks\n  const formData = {};\n  Object.keys(VALIDATION_RULES).forEach((name) => {\n    const input = form.elements[name];\n    if (input) {\n      formData[name] = input.value;\n    }\n  });\n\n  const validationWarnings = {};\n\n  Object.entries(VALIDATION_RULES).forEach(([name, rules]) => {\n    const input = form.elements[name];\n    if (input) {\n      const validation = validateInput(name, input.value, rules, formData);\n\n      // Handle both old format (array) and new format (object)\n      if (Array.isArray(validation)) {\n        // Old format - just errors\n        if (validation.length > 0) {\n          validationErrors[name] = validation;\n          isValid = false;\n        }\n      } else {\n        // New format - errors and warnings\n        if (validation.errors.length > 0) {\n          validationErrors[name] = validation.errors;\n          isValid = false;\n        }\n        if (validation.warnings.length > 0) {\n          validationWarnings[name] = validation.warnings;\n        }\n      }\n    }\n  });\n\n  return { isValid, validationErrors, validationWarnings };\n}\n\nexport function showValidationErrors(container, validationErrors) {\n  Object.entries(validationErrors).forEach(([name, errors]) => {\n    const input = container.querySelector(`[name=\"${name}\"]`);\n    if (input) {\n      const group = input.closest('.input-group');\n      if (group) {\n        group.classList.add('error');\n        // Remove existing error messages\n        group.querySelectorAll('.error-message').forEach((el) => el.remove());\n        // Add new error message safely without innerHTML\n        const errorDiv = document.createElement('div');\n        errorDiv.className = 'error-message';\n\n        const iconSpan = document.createElement('span');\n        iconSpan.className = 'error-icon';\n        iconSpan.textContent = '⚠️';\n\n        errorDiv.appendChild(iconSpan);\n        errorDiv.appendChild(document.createTextNode(` ${errors[0]}`));\n        group.appendChild(errorDiv);\n      }\n    }\n  });\n}\n\nexport function showValidationWarnings(container, validationWarnings) {\n  Object.entries(validationWarnings).forEach(([name, warnings]) => {\n    const input = container.querySelector(`[name=\"${name}\"]`);\n    if (input) {\n      const group = input.closest('.input-group');\n      if (group) {\n        group.classList.add('warning');\n        // Remove existing warning messages\n        group.querySelectorAll('.warning-message').forEach((el) => el.remove());\n        // Add new warning message safely without innerHTML\n        const warningDiv = document.createElement('div');\n        warningDiv.className = 'warning-message';\n\n        const iconSpan = document.createElement('span');\n        iconSpan.className = 'warning-icon';\n        iconSpan.textContent = '💡';\n\n        warningDiv.appendChild(iconSpan);\n        warningDiv.appendChild(document.createTextNode(` ${warnings[0]}`));\n        group.appendChild(warningDiv);\n      }\n    }\n  });\n}\n\nexport function clearValidationErrors(container) {\n  container.querySelectorAll('.input-group.error').forEach((group) => {\n    group.classList.remove('error');\n    group.querySelectorAll('.error-message').forEach((el) => el.remove());\n  });\n}\n\nexport function clearValidationWarnings(container) {\n  container.querySelectorAll('.input-group.warning').forEach((group) => {\n    group.classList.remove('warning');\n    group.querySelectorAll('.warning-message').forEach((el) => el.remove());\n  });\n}\n\nexport function clearAllValidation(container) {\n  clearValidationErrors(container);\n  clearValidationWarnings(container);\n}\n","import { store } from '../state/store.js';\nimport {\n  predictComaIch, predictLimitedIch, predictFullStroke, APIError,\n} from '../api/client.js';\nimport { t } from '../localization/i18n.js';\nimport { showPrerequisitesModal } from '../ui/components/prerequisites-modal.js';\n\nimport { validateForm, showValidationErrors } from './validate.js';\n\nexport function handleTriage1(isComatose) {\n  store.logEvent('triage1_answer', { comatose: isComatose });\n\n  if (isComatose) {\n    navigate('coma');\n  } else {\n    // Show prerequisites modal for conscious patients\n    showPrerequisitesModal();\n  }\n}\n\nexport function handleTriage2(isExaminable) {\n  store.logEvent('triage2_answer', { examinable: isExaminable });\n  const nextScreen = isExaminable ? 'full' : 'limited';\n  navigate(nextScreen);\n}\n\nexport function navigate(screen) {\n  store.logEvent('navigate', {\n    from: store.getState().currentScreen,\n    to: screen,\n  });\n  store.navigate(screen);\n  window.scrollTo(0, 0);\n}\n\nexport function reset() {\n  if (store.hasUnsavedData()) {\n    if (!confirm('Are you sure you want to start over? All entered data will be lost.')) {\n      return;\n    }\n  }\n  store.logEvent('reset');\n  store.reset();\n}\n\nexport function goBack() {\n  const success = store.goBack();\n\n  if (success) {\n    store.logEvent('navigate_back');\n    window.scrollTo(0, 0);\n  } else {\n    goHome();\n  }\n}\n\nexport function goHome() {\n  store.logEvent('navigate_home');\n  store.goHome();\n  window.scrollTo(0, 0);\n}\n\nexport async function handleSubmit(e, container) {\n  e.preventDefault();\n  const form = e.target;\n  const { module } = form.dataset;\n\n  // Validate form\n  const validation = validateForm(form);\n  if (!validation.isValid) {\n    showValidationErrors(container, validation.validationErrors);\n    try {\n      // Focus first invalid field and announce summary for screen readers\n      const firstErrorName = Object.keys(validation.validationErrors)[0];\n      if (firstErrorName && form.elements[firstErrorName]) {\n        const el = form.elements[firstErrorName];\n        el.focus({ preventScroll: true });\n        el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }\n      const sr = document.createElement('div');\n      sr.className = 'sr-only';\n      sr.setAttribute('role', 'status');\n      sr.setAttribute('aria-live', 'polite');\n      const errorCount = Object.keys(validation.validationErrors).length;\n      sr.textContent = `${errorCount} field${errorCount === 1 ? '' : 's'} need attention.`;\n      document.body.appendChild(sr);\n      setTimeout(() => sr.remove(), 1200);\n    } catch {}\n    return;\n  }\n\n  // Collect inputs - handle all form elements including unchecked checkboxes\n  const inputs = {};\n\n  // Process all form elements to ensure checkboxes are included\n  Array.from(form.elements).forEach((element) => {\n    if (element.name) {\n      if (element.type === 'checkbox') {\n        inputs[element.name] = element.checked;\n      } else if (element.type === 'number') {\n        const n = parseFloat(element.value);\n        inputs[element.name] = isNaN(n) ? 0 : n;\n      } else if (element.type === 'hidden') {\n        // Handle hidden fields (like armparese from FAST-ED)\n        if (element.name === 'armparese') {\n          inputs[element.name] = element.value === 'true';\n        } else {\n          inputs[element.name] = element.value;\n        }\n      } else {\n        inputs[element.name] = element.value;\n      }\n    }\n  });\n\n  // Store form data\n  store.setFormData(module, inputs);\n\n  // Show loading state\n  const button = form.querySelector('button[type=submit]');\n  const originalContent = button ? button.innerHTML : '';\n  if (button) {\n    button.disabled = true;\n    button.innerHTML = `<span class=\"loading-spinner\"></span> ${t('analyzing')}`;\n  }\n\n  try {\n    // Run models based on module\n    let results;\n\n    switch (module) {\n      case 'coma':\n        const comaResult = await predictComaIch(inputs);\n        results = {\n          ich: comaResult,\n          lvo: null,\n        };\n        break;\n\n      case 'limited':\n        const limitedResult = await predictLimitedIch(inputs);\n        results = {\n          ich: limitedResult,\n          lvo: { notPossible: true },\n        };\n        break;\n\n      case 'full':\n        results = await predictFullStroke(inputs);\n        break;\n\n      default:\n        throw new Error(`Unknown module: ${module}`);\n    }\n\n    store.setResults(results);\n    store.logEvent('models_complete', { module, results });\n    navigate('results');\n  } catch (error) {\n    console.error('Error running models:', error);\n\n    let errorMessage = 'An error occurred during analysis. Please try again.';\n    if (error instanceof APIError) {\n      errorMessage = error.message;\n    }\n\n    showError(container, errorMessage);\n\n    if (button) {\n      button.disabled = false;\n      button.innerHTML = originalContent;\n    }\n  }\n}\n\nfunction showError(container, message) {\n  // Remove existing error alerts\n  container.querySelectorAll('.critical-alert').forEach((alert) => {\n    if (alert.querySelector('h4')?.textContent?.includes('Error')) {\n      alert.remove();\n    }\n  });\n\n  const alert = document.createElement('div');\n  alert.className = 'critical-alert';\n\n  // Create safe DOM structure without innerHTML to prevent XSS\n  const h4 = document.createElement('h4');\n  const iconSpan = document.createElement('span');\n  iconSpan.className = 'alert-icon';\n  iconSpan.textContent = '⚠️';\n  h4.appendChild(iconSpan);\n  h4.appendChild(document.createTextNode(' Error'));\n\n  const p = document.createElement('p');\n  p.textContent = message; // Safe text content only\n\n  alert.appendChild(h4);\n  alert.appendChild(p);\n\n  const containerDiv = container.querySelector('.container');\n  if (containerDiv) {\n    containerDiv.prepend(alert);\n  } else {\n    container.prepend(alert);\n  }\n\n  setTimeout(() => alert.remove(), 10000);\n}\n","/**\n * Legacy ICH Model - Simple Logistic Regression (Age + GFAP Only)\n *\n * This is a baseline model for research comparison purposes.\n * Uses only age and GFAP values with logistic regression.\n *\n * Performance Metrics:\n * - ROC-AUC: 0.789\n * - Recall: 40%\n * - Precision: 86%\n * - F1-Score: 55%\n *\n * FOR RESEARCH COMPARISON ONLY - NOT FOR CLINICAL USE\n */\n\nexport class LegacyICHModel {\n  // Training data parameters from original study\n  static PARAMS = {\n    age: {\n      mean: 74.59,\n      std: 12.75,\n    },\n    gfap: {\n      mean: 665.23,\n      std: 2203.77,\n    },\n    coefficients: {\n      intercept: 0.3248,\n      age: -0.2108, // Negative: older age slightly decreases odds in this simple model\n      gfap: 3.1631, // Positive: higher GFAP significantly increases odds\n    },\n  };\n\n  /**\n   * Calculate ICH probability using legacy logistic regression model\n   * @param {number} age - Patient age in years\n   * @param {number} gfapValue - GFAP value in pg/ml\n   * @returns {object} - Probability and diagnostic information\n   */\n  static calculateProbability(age, gfapValue) {\n    // Input validation\n    if (!age || !gfapValue || age <= 0 || gfapValue <= 0) {\n      return {\n        probability: 0,\n        confidence: 0,\n        isValid: false,\n        reason: 'Invalid inputs: age and GFAP required',\n      };\n    }\n\n    // Validate ranges\n    if (age < 18 || age > 120) {\n      return {\n        probability: 0,\n        confidence: 0,\n        isValid: false,\n        reason: `Age ${age} outside valid range (18-120 years)`,\n      };\n    }\n\n    if (gfapValue < 10 || gfapValue > 20000) {\n      console.warn(`GFAP ${gfapValue} outside typical range (10-20000 pg/ml)`);\n    }\n\n    try {\n      // Step 1: Scale inputs using training data statistics\n      const scaledAge = (age - this.PARAMS.age.mean) / this.PARAMS.age.std;\n      const scaledGfap = (gfapValue - this.PARAMS.gfap.mean) / this.PARAMS.gfap.std;\n\n      // Step 2: Calculate log-odds (logit)\n      const logit = this.PARAMS.coefficients.intercept\n                    + (this.PARAMS.coefficients.age * scaledAge)\n                    + (this.PARAMS.coefficients.gfap * scaledGfap);\n\n      // Step 3: Convert to probability using sigmoid function\n      const rawProbability = 1 / (1 + Math.exp(-logit));\n      const probability = rawProbability * 100; // Convert to percentage\n\n      // Step 4: Calculate confidence based on distance from decision boundary\n      // Confidence is higher when probability is closer to 0% or 100%\n      const confidence = Math.abs(rawProbability - 0.5) * 2; // 0 to 1 scale\n\n      // Step 5: Determine risk category\n      const riskCategory = this.getRiskCategory(probability);\n\n      return {\n        probability: Math.round(probability * 10) / 10, // Round to 1 decimal\n        confidence: Math.round(confidence * 100) / 100, // Round to 2 decimals\n        logit: Math.round(logit * 1000) / 1000, // Round to 3 decimals\n        riskCategory,\n        scaledInputs: {\n          age: Math.round(scaledAge * 1000) / 1000,\n          gfap: Math.round(scaledGfap * 1000) / 1000,\n        },\n        rawInputs: { age, gfap: gfapValue },\n        isValid: true,\n        calculationMethod: 'logistic_regression_age_gfap',\n      };\n    } catch (error) {\n      console.error('Legacy model calculation error:', error);\n      return {\n        probability: 0,\n        confidence: 0,\n        isValid: false,\n        reason: 'Calculation error',\n        error: error.message,\n      };\n    }\n  }\n\n  /**\n   * Get risk category and color based on probability\n   * @param {number} probability - Probability percentage (0-100)\n   * @returns {object} - Risk level information\n   */\n  static getRiskCategory(probability) {\n    if (probability < 10) {\n      return {\n        level: 'very_low',\n        color: '#10b981',\n        label: 'Very Low Risk',\n        description: 'Minimal ICH likelihood',\n      };\n    }\n    if (probability < 25) {\n      return {\n        level: 'low',\n        color: '#84cc16',\n        label: 'Low Risk',\n        description: 'Below typical threshold',\n      };\n    }\n    if (probability < 50) {\n      return {\n        level: 'moderate',\n        color: '#f59e0b',\n        label: 'Moderate Risk',\n        description: 'Elevated concern',\n      };\n    }\n    if (probability < 75) {\n      return {\n        level: 'high',\n        color: '#f97316',\n        label: 'High Risk',\n        description: 'Significant likelihood',\n      };\n    }\n    return {\n      level: 'very_high',\n      color: '#dc2626',\n      label: 'Very High Risk',\n      description: 'Critical ICH probability',\n    };\n  }\n\n  /**\n   * Compare legacy model with main model results\n   * @param {object} mainResults - Results from complex ML model\n   * @param {object} legacyResults - Results from legacy model\n   * @returns {object} - Comparison analysis\n   */\n  static compareModels(mainResults, legacyResults) {\n    if (!mainResults || !legacyResults || !legacyResults.isValid) {\n      return {\n        isValid: false,\n        reason: 'Invalid model results for comparison',\n      };\n    }\n\n    // Normalize probabilities to percentage scale (0-100)\n    let mainProb = mainResults.probability || 0;\n    if (mainProb <= 1) {\n      mainProb *= 100; // Convert 0.65 to 65%\n    }\n\n    const legacyProb = legacyResults.probability || 0; // Already in percentage\n\n    const absoluteDifference = mainProb - legacyProb;\n    const relativeDifference = legacyProb > 0 ? (absoluteDifference / legacyProb) * 100 : 0;\n\n    // Determine which model suggests higher risk\n    const higherRiskModel = mainProb > legacyProb ? 'main'\n      : legacyProb > mainProb ? 'legacy' : 'equal';\n\n    // Assess agreement level\n    let agreement;\n    const absDiff = Math.abs(absoluteDifference);\n    if (absDiff < 5) {\n      agreement = 'strong';\n    } else if (absDiff < 15) {\n      agreement = 'moderate';\n    } else if (absDiff < 30) {\n      agreement = 'weak';\n    } else {\n      agreement = 'poor';\n    }\n\n    return {\n      isValid: true,\n      probabilities: {\n        main: Math.round(mainProb * 10) / 10,\n        legacy: Math.round(legacyProb * 10) / 10,\n      },\n      differences: {\n        absolute: Math.round(absoluteDifference * 10) / 10,\n        relative: Math.round(relativeDifference * 10) / 10,\n      },\n      agreement: {\n        level: agreement,\n        higherRiskModel,\n      },\n      interpretation: this.getComparisonInterpretation(absoluteDifference, agreement),\n    };\n  }\n\n  /**\n   * Get interpretation of model comparison\n   * @param {number} difference - Absolute difference between models\n   * @param {string} agreement - Agreement level\n   * @returns {object} - Interpretation for researchers\n   */\n  static getComparisonInterpretation(difference, agreement) {\n    const absDiff = Math.abs(difference);\n\n    if (agreement === 'strong') {\n      return {\n        type: 'concordant',\n        message: 'Models show strong agreement',\n        implication: 'Age and GFAP are primary risk factors',\n      };\n    }\n\n    if (absDiff > 20) {\n      return {\n        type: 'divergent',\n        message: 'Significant model disagreement',\n        implication: 'Complex model captures additional risk factors not in age/GFAP',\n      };\n    }\n\n    return {\n      type: 'moderate_difference',\n      message: 'Models show moderate difference',\n      implication: 'Additional factors provide incremental predictive value',\n    };\n  }\n\n  /**\n   * Test the legacy model with known cases\n   * @returns {object} - Test results for validation\n   */\n  static runValidationTests() {\n    const testCases = [\n      {\n        age: 65, gfap: 100, expected: 'low', description: 'Younger patient, low GFAP',\n      },\n      {\n        age: 75, gfap: 500, expected: 'moderate', description: 'Average age, moderate GFAP',\n      },\n      {\n        age: 85, gfap: 1000, expected: 'high', description: 'Older patient, high GFAP',\n      },\n      {\n        age: 70, gfap: 2000, expected: 'very_high', description: 'High GFAP dominates',\n      },\n      {\n        age: 90, gfap: 50, expected: 'very_low', description: 'Low GFAP despite age',\n      },\n    ];\n\n    const results = testCases.map((testCase) => {\n      const result = this.calculateProbability(testCase.age, testCase.gfap);\n      return {\n        ...testCase,\n        result,\n        passed: result.isValid && result.riskCategory.level === testCase.expected,\n      };\n    });\n\n    const passedTests = results.filter((r) => r.passed).length;\n    const totalTests = results.length;\n\n    return {\n      summary: {\n        passed: passedTests,\n        total: totalTests,\n        passRate: Math.round((passedTests / totalTests) * 100),\n      },\n      details: results,\n    };\n  }\n\n  /**\n   * Get model metadata for research documentation\n   * @returns {object} - Model information\n   */\n  static getModelMetadata() {\n    return {\n      name: 'Legacy ICH Model',\n      type: 'Logistic Regression',\n      version: '1.0.0',\n      features: ['age', 'gfap'],\n      performance: {\n        rocAuc: 0.789,\n        recall: 0.40,\n        precision: 0.86,\n        f1Score: 0.55,\n        specificity: 0.94,\n      },\n      trainingData: {\n        samples: 'Historical cohort',\n        dateRange: 'Research study period',\n        validation: 'Cross-validation',\n      },\n      limitations: [\n        'Only uses age and GFAP - ignores clinical symptoms',\n        'Lower recall (40%) - misses some ICH cases',\n        'No time-to-onset consideration',\n        'No blood pressure or medication factors',\n        'Simplified feature set for baseline comparison',\n      ],\n      purpose: 'Research baseline for evaluating complex model improvements',\n    };\n  }\n}\n\n/**\n * Utility function to safely calculate legacy model in existing app flow\n * @param {object} patientData - Existing patient data structure\n * @returns {object|null} - Legacy model results or null if not applicable\n */\nexport function calculateLegacyICH(patientData) {\n  try {\n    // Extract age and GFAP from various possible data structures\n    const age = patientData?.age_years || patientData?.age || null;\n    const gfap = patientData?.gfap_value || patientData?.gfap || null;\n\n    if (!age || !gfap) {\n      return null; // Silently fail if required data not available\n    }\n\n    return LegacyICHModel.calculateProbability(age, gfap);\n  } catch (error) {\n    console.warn('Legacy ICH calculation failed (non-critical):', error);\n    return null;\n  }\n}\n\n/**\n * Export test function for validation\n */\nexport function testLegacyModel() {\n  console.log('🧪 Legacy ICH Model Validation Tests');\n  const testResults = LegacyICHModel.runValidationTests();\n\n  console.log(`✅ Passed: ${testResults.summary.passed}/${testResults.summary.total} tests`);\n  console.log(`📊 Pass Rate: ${testResults.summary.passRate}%`);\n\n  testResults.details.forEach((test) => {\n    const icon = test.passed ? '✅' : '❌';\n    console.log(`${icon} ${test.description}: ${test.result.probability.toFixed(1)}% (${test.result.riskCategory.level})`);\n  });\n\n  return testResults;\n}\n","/**\n * Research Data Logger\n * Safely stores model comparison data for research analysis\n * All data stays local - no external transmission\n */\n\nimport { LegacyICHModel } from './legacy-ich-model.js';\n\nexport class ResearchDataLogger {\n  static STORAGE_KEY = 'igfap_research_data';\n\n  static MAX_ENTRIES = 1000; // Prevent unlimited storage growth\n\n  /**\n   * Log comparison between main and legacy models\n   * @param {object} comparisonData - Data from both models\n   */\n  static logComparison(comparisonData) {\n    try {\n      const entry = {\n        id: this.generateEntryId(),\n        timestamp: new Date().toISOString(),\n        sessionId: this.getSessionId(),\n        ...comparisonData,\n      };\n\n      const stored = this.getStoredData();\n      stored.entries.push(entry);\n\n      // Limit storage size\n      if (stored.entries.length > this.MAX_ENTRIES) {\n        stored.entries = stored.entries.slice(-this.MAX_ENTRIES);\n      }\n\n      stored.lastUpdated = new Date().toISOString();\n      stored.totalComparisons = stored.entries.length;\n\n      localStorage.setItem(this.STORAGE_KEY, JSON.stringify(stored));\n\n      console.log(`📊 Research data logged (${stored.totalComparisons} comparisons)`);\n      return true;\n    } catch (error) {\n      console.warn('Research data logging failed (non-critical):', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get all stored research data\n   * @returns {object} - Complete research dataset\n   */\n  static getStoredData() {\n    try {\n      const stored = localStorage.getItem(this.STORAGE_KEY);\n      if (!stored) {\n        return this.createEmptyDataset();\n      }\n\n      const data = JSON.parse(stored);\n\n      // Validate structure\n      if (!data.entries || !Array.isArray(data.entries)) {\n        console.warn('Invalid research data structure, resetting');\n        return this.createEmptyDataset();\n      }\n\n      return data;\n    } catch (error) {\n      console.warn('Failed to load research data, creating new:', error);\n      return this.createEmptyDataset();\n    }\n  }\n\n  /**\n   * Create empty dataset structure\n   * @returns {object} - Empty research dataset\n   */\n  static createEmptyDataset() {\n    return {\n      version: '1.0.0',\n      created: new Date().toISOString(),\n      lastUpdated: null,\n      totalComparisons: 0,\n      entries: [],\n      metadata: {\n        app: 'iGFAP Stroke Triage',\n        purpose: 'Model comparison research',\n        dataRetention: 'Local storage only',\n      },\n    };\n  }\n\n  /**\n   * Export research data as CSV for analysis\n   * @returns {string} - CSV formatted data\n   */\n  static exportAsCSV() {\n    const data = this.getStoredData();\n\n    if (!data.entries || data.entries.length === 0) {\n      return 'No research data available for export';\n    }\n\n    // CSV headers\n    const headers = [\n      'timestamp',\n      'session_id',\n      'age',\n      'gfap_value',\n      'main_model_probability',\n      'main_model_module',\n      'legacy_model_probability',\n      'legacy_model_confidence',\n      'absolute_difference',\n      'relative_difference',\n      'agreement_level',\n      'higher_risk_model',\n    ];\n\n    // Convert entries to CSV rows\n    const rows = data.entries.map((entry) => [\n      entry.timestamp,\n      entry.sessionId,\n      entry.inputs?.age || '',\n      entry.inputs?.gfap || '',\n      entry.main?.probability || '',\n      entry.main?.module || '',\n      entry.legacy?.probability || '',\n      entry.legacy?.confidence || '',\n      entry.comparison?.differences?.absolute || '',\n      entry.comparison?.differences?.relative || '',\n      entry.comparison?.agreement?.level || '',\n      entry.comparison?.agreement?.higherRiskModel || '',\n    ].join(','));\n\n    // Combine headers and rows\n    const csv = [headers.join(','), ...rows].join('\\n');\n    return csv;\n  }\n\n  /**\n   * Export research data as JSON for detailed analysis\n   * @returns {string} - JSON formatted data\n   */\n  static exportAsJSON() {\n    const data = this.getStoredData();\n    return JSON.stringify(data, null, 2);\n  }\n\n  /**\n   * Download research data as file\n   * @param {string} format - 'csv' or 'json'\n   */\n  static downloadData(format = 'csv') {\n    try {\n      const data = format === 'csv' ? this.exportAsCSV() : this.exportAsJSON();\n      const filename = `igfap-research-${Date.now()}.${format}`;\n\n      const blob = new Blob([data], {\n        type: format === 'csv' ? 'text/csv' : 'application/json',\n      });\n\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n\n      console.log(`📥 Downloaded research data: ${filename}`);\n      return true;\n    } catch (error) {\n      console.error('Failed to download research data:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Clear all stored research data\n   */\n  static clearData() {\n    try {\n      localStorage.removeItem(this.STORAGE_KEY);\n      console.log('🗑️ Research data cleared');\n      return true;\n    } catch (error) {\n      console.warn('Failed to clear research data:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Get summary statistics of stored data\n   * @returns {object} - Summary statistics\n   */\n  static getDataSummary() {\n    const data = this.getStoredData();\n\n    if (!data.entries || data.entries.length === 0) {\n      return {\n        totalEntries: 0,\n        dateRange: null,\n        avgDifference: null,\n      };\n    }\n\n    const { entries } = data;\n    const differences = entries\n      .map((e) => e.comparison?.differences?.absolute)\n      .filter((d) => d !== undefined && d !== null);\n\n    const avgDifference = differences.length > 0\n      ? differences.reduce((sum, d) => sum + Math.abs(d), 0) / differences.length : 0;\n\n    return {\n      totalEntries: entries.length,\n      dateRange: {\n        first: entries[0]?.timestamp,\n        last: entries[entries.length - 1]?.timestamp,\n      },\n      avgAbsoluteDifference: Math.round(avgDifference * 10) / 10,\n      storageSize: JSON.stringify(data).length,\n    };\n  }\n\n  // Utility functions\n  static generateEntryId() {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\n  }\n\n  static getSessionId() {\n    let sessionId = sessionStorage.getItem('research_session_id');\n    if (!sessionId) {\n      sessionId = `session_${Date.now().toString(36)}`;\n      sessionStorage.setItem('research_session_id', sessionId);\n    }\n    return sessionId;\n  }\n}\n\n/**\n * Safe wrapper for logging research data in production\n * @param {object} mainResults - Main model results\n * @param {object} legacyResults - Legacy model results\n * @param {object} inputs - Patient input data\n */\nexport function safeLogResearchData(mainResults, legacyResults, inputs) {\n  try {\n    // Only log if research mode is enabled\n    if (!isResearchModeEnabled()) {\n      return;\n    }\n\n    const comparisonData = {\n      inputs: {\n        age: inputs.age_years || inputs.age,\n        gfap: inputs.gfap_value || inputs.gfap,\n        module: mainResults.module || 'unknown',\n      },\n      main: {\n        probability: mainResults.probability,\n        module: mainResults.module,\n        confidence: mainResults.confidence,\n      },\n      legacy: legacyResults,\n      comparison: legacyResults\n        ? LegacyICHModel.compareModels(mainResults, legacyResults) : null,\n    };\n\n    ResearchDataLogger.logComparison(comparisonData);\n  } catch (error) {\n    // Silently fail - never break main app functionality\n    console.warn('Research logging failed (non-critical):', error);\n  }\n}\n\n/**\n * Check if research mode is enabled for current module\n * @param {string} module - Current module (coma/limited/full)\n * @returns {boolean} - True if research features should be active\n */\nexport function isResearchModeEnabled(module = null) {\n  // Never enable research mode for coma module\n  if (module === 'coma') {\n    return false;\n  }\n\n  // Always enable for stroke modules (limited/full)\n  if (module === 'limited' || module === 'full') {\n    return true;\n  }\n\n  // Fallback: check if any stroke module data exists\n  if (typeof window !== 'undefined') {\n    try {\n      const store = window.store || require('../state/store.js')?.store;\n      if (store) {\n        const { formData } = store.getState();\n        const hasStrokeData = formData.limited || formData.full;\n        return hasStrokeData; // Enable if stroke module data exists\n      }\n    } catch (error) {\n      // Silently fail - research mode just won't work\n    }\n  }\n\n  return false;\n}\n\n/**\n * Enable/disable research mode\n * @param {boolean} enabled - Enable or disable research mode\n */\nexport function setResearchMode(enabled) {\n  try {\n    if (enabled) {\n      localStorage.setItem('research_mode', 'true');\n      console.log('🔬 Research mode enabled');\n    } else {\n      localStorage.removeItem('research_mode');\n      console.log('🔬 Research mode disabled');\n    }\n\n    // Trigger page refresh to apply changes\n    if (window.location.search.includes('research=')) {\n      // Remove research param from URL if disabling\n      if (!enabled) {\n        const url = new URL(window.location);\n        url.searchParams.delete('research');\n        window.history.replaceState({}, '', url);\n      }\n    }\n\n    return true;\n  } catch (error) {\n    console.warn('Failed to toggle research mode:', error);\n    return false;\n  }\n}\n","/**\n * Research Comparison UI Components\n * Hidden by default, activated only for research purposes\n */\n\nimport { t } from '../localization/i18n.js';\n\nimport { LegacyICHModel } from './legacy-ich-model.js';\nimport { ResearchDataLogger, isResearchModeEnabled } from './data-logger.js';\n\n/**\n * Render research toggle button (no longer used - header button handles this)\n * @returns {string} - Empty string (header button replaces this)\n */\nexport function renderResearchToggle() {\n  return ''; // Header button now handles research panel toggling\n}\n\n/**\n * Render model comparison panel\n * @param {object} mainResults - Main model results\n * @param {object} legacyResults - Legacy model results\n * @param {object} inputs - Patient input data\n * @returns {string} - HTML for comparison panel\n */\nexport function renderModelComparison(mainResults, legacyResults, inputs) {\n  // Show debug info if legacy results are invalid\n  if (!legacyResults?.isValid) {\n    console.log('🔬 Legacy model results invalid:', legacyResults);\n    return `\n      <div class=\"research-panel\" id=\"researchPanel\" style=\"display: none;\">\n        <div class=\"research-header\">\n          <h4>🔬 Model Comparison (Research)</h4>\n          <button class=\"close-research\" id=\"closeResearch\">×</button>\n        </div>\n        <div class=\"research-error\">\n          <p>⚠️ Legacy model calculation failed</p>\n          <small>Debug: ${legacyResults?.reason || 'Unknown error'}</small>\n        </div>\n      </div>\n    `;\n  }\n\n  const comparison = LegacyICHModel.compareModels(mainResults, legacyResults);\n\n  return `\n    <div class=\"research-panel\" id=\"researchPanel\" style=\"display: none;\">\n      <div class=\"research-header\">\n        <h4>🔬 Model Comparison (Research)</h4>\n        <button class=\"close-research\" id=\"closeResearch\">×</button>\n      </div>\n      \n      <div class=\"model-comparison\">\n        ${renderProbabilityBars(mainResults, legacyResults)}\n        ${renderDifferenceAnalysis(comparison)}\n        ${renderCalculationDetails(legacyResults, inputs)}\n        ${renderModelMetrics()}\n      </div>\n      \n      <div class=\"research-actions\">\n        <button id=\"exportResearchData\" class=\"research-btn\">📥 Export Data</button>\n        <button id=\"toggleCalculationDetails\" class=\"research-btn\">🧮 Details</button>\n        <button id=\"clearResearchData\" class=\"research-btn danger\">🗑️ Clear</button>\n      </div>\n      \n      <div class=\"research-disclaimer\">\n        <small>\n          ⚠️ <strong>Research Mode Active</strong><br>\n          Legacy model: Age + GFAP only (ROC-AUC: 0.789, Recall: 40%)<br>\n          For baseline comparison. Main model includes additional clinical factors.\n        </small>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render probability comparison bars\n * @param {object} mainResults - Main model results\n * @param {object} legacyResults - Legacy model results\n * @returns {string} - HTML for probability bars\n */\nfunction renderProbabilityBars(mainResults, legacyResults) {\n  // Convert main model probability to percentage if it's in decimal form (0-1)\n  let mainProb = mainResults.probability || 0;\n  if (mainProb <= 1) {\n    mainProb *= 100; // Convert 0.65 to 65%\n  }\n\n  // Legacy model already returns percentage (0-100)\n  const legacyProb = legacyResults.probability || 0;\n\n  return `\n    <div class=\"probability-comparison\">\n      <div class=\"bar-group\">\n        <label class=\"bar-label\">Main Model (Complex) - ${mainResults.module || 'Unknown'}</label>\n        <div class=\"probability-bar\">\n          <div class=\"bar-fill main-model\" style=\"width: ${Math.min(mainProb, 100)}%\">\n            <span class=\"bar-value\">${mainProb.toFixed(1)}%</span>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"bar-group\">\n        <label class=\"bar-label\">Legacy Model (Age + GFAP Only)</label>\n        <div class=\"probability-bar\">\n          <div class=\"bar-fill legacy-model\" style=\"width: ${Math.min(legacyProb, 100)}%\">\n            <span class=\"bar-value\">${legacyProb.toFixed(1)}%</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render difference analysis\n * @param {object} comparison - Model comparison results\n * @returns {string} - HTML for difference analysis\n */\nfunction renderDifferenceAnalysis(comparison) {\n  if (!comparison.isValid) {\n    return '<div class=\"comparison-error\">Unable to compare models</div>';\n  }\n\n  const { differences, agreement } = comparison;\n  const isMainHigher = differences.absolute > 0;\n\n  return `\n    <div class=\"difference-analysis\">\n      <div class=\"difference-metric\">\n        <span class=\"metric-label\">Difference:</span>\n        <span class=\"metric-value ${isMainHigher ? 'higher' : 'lower'}\">\n          ${differences.absolute > 0 ? '+' : ''}${differences.absolute}%\n        </span>\n      </div>\n      \n      <div class=\"agreement-level\">\n        <span class=\"metric-label\">Agreement:</span>\n        <span class=\"agreement-badge ${agreement.level}\">\n          ${agreement.level.charAt(0).toUpperCase() + agreement.level.slice(1)}\n        </span>\n      </div>\n      \n      <div class=\"interpretation\">\n        <p class=\"interpretation-text\">${comparison.interpretation.message}</p>\n        <small class=\"interpretation-detail\">${comparison.interpretation.implication}</small>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render calculation details (expandable)\n * @param {object} legacyResults - Legacy model results\n * @param {object} inputs - Patient input data\n * @returns {string} - HTML for calculation details\n */\nfunction renderCalculationDetails(legacyResults, inputs) {\n  return `\n    <div class=\"calculation-details\" id=\"calculationDetails\" style=\"display: none;\">\n      <h5>Legacy Model Calculation</h5>\n      <div class=\"calculation-steps\">\n        <div class=\"step\">\n          <strong>Inputs:</strong> Age ${inputs.age}, GFAP ${inputs.gfap} pg/ml\n        </div>\n        <div class=\"step\">\n          <strong>Scaling:</strong> Age → ${legacyResults.scaledInputs.age}, GFAP → ${legacyResults.scaledInputs.gfap}\n        </div>\n        <div class=\"step\">\n          <strong>Logit:</strong> ${legacyResults.logit}\n        </div>\n        <div class=\"step\">\n          <strong>Probability:</strong> ${legacyResults.probability}% (Confidence: ${(legacyResults.confidence * 100).toFixed(0)}%)\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render model performance metrics\n * @returns {string} - HTML for model metrics\n */\nfunction renderModelMetrics() {\n  const metadata = LegacyICHModel.getModelMetadata();\n\n  return `\n    <div class=\"model-metrics\">\n      <h5>Performance Comparison</h5>\n      <div class=\"metrics-grid\">\n        <div class=\"metric-item\">\n          <span class=\"metric-name\">ROC-AUC</span>\n          <span class=\"metric-value\">Legacy: ${metadata.performance.rocAuc}</span>\n        </div>\n        <div class=\"metric-item\">\n          <span class=\"metric-name\">Recall</span>\n          <span class=\"metric-value\">Legacy: ${(metadata.performance.recall * 100).toFixed(0)}%</span>\n        </div>\n        <div class=\"metric-item\">\n          <span class=\"metric-name\">Precision</span>\n          <span class=\"metric-value\">Legacy: ${(metadata.performance.precision * 100).toFixed(0)}%</span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Initialize research mode event handlers\n */\nexport function initializeResearchMode() {\n  // Always initialize if research panel exists\n  const researchPanel = document.getElementById('researchPanel');\n  if (!researchPanel) {\n    return;\n  }\n\n  // Close research panel\n  const closeResearch = document.getElementById('closeResearch');\n  if (closeResearch) {\n    closeResearch.addEventListener('click', () => {\n      const panel = document.getElementById('researchPanel');\n      if (panel) {\n        panel.style.display = 'none';\n      }\n    });\n  }\n\n  // Export data button\n  const exportButton = document.getElementById('exportResearchData');\n  if (exportButton) {\n    exportButton.addEventListener('click', () => {\n      ResearchDataLogger.downloadData('csv');\n    });\n  }\n\n  // Toggle calculation details\n  const detailsToggle = document.getElementById('toggleCalculationDetails');\n  if (detailsToggle) {\n    detailsToggle.addEventListener('click', () => {\n      const details = document.getElementById('calculationDetails');\n      if (details) {\n        details.style.display = details.style.display === 'none' ? 'block' : 'none';\n        detailsToggle.textContent = details.style.display === 'none' ? '🧮 Details' : '🧮 Hide';\n      }\n    });\n  }\n\n  // Clear data button\n  const clearButton = document.getElementById('clearResearchData');\n  if (clearButton) {\n    clearButton.addEventListener('click', () => {\n      if (confirm('Clear all research data? This cannot be undone.')) {\n        ResearchDataLogger.clearData();\n\n        // Update display\n        const summary = ResearchDataLogger.getDataSummary();\n        console.log(`Data cleared. Total entries: ${summary.totalEntries}`);\n      }\n    });\n  }\n\n  console.log('🔬 Research mode initialized');\n}\n","/**\n * Authentication System for iGFAP Stroke Triage Assistant\n * Research Preview Access Control\n *\n * @author iGFAP Project Team\n * @contact Deepak Bos <bosdeepak@gmail.com>\n */\n\nexport class AuthenticationManager {\n  constructor() {\n    this.isAuthenticated = false;\n    this.sessionTimeout = 4 * 60 * 60 * 1000; // 4 hours for research sessions\n    this.lastActivity = Date.now();\n    this.setupActivityTracking();\n  }\n\n  /**\n   * Authenticate user with research access password\n   * @param {string} password - Research access password\n   * @returns {boolean} - Authentication success\n   */\n  async authenticate(hashedInput) {\n    // Secure password verification for research preview\n    // SHA-256 hash of \"Neuro25\"\n    const validHash = await this.hashPassword('Neuro25');\n\n    if (hashedInput === validHash) {\n      this.isAuthenticated = true;\n      this.lastActivity = Date.now();\n      this.storeAuthSession();\n      return true;\n    }\n\n    // Rate limiting - delay on failed attempts\n    await this.delayFailedAttempt();\n    return false;\n  }\n\n  /**\n   * Check if current session is valid\n   * @returns {boolean} - Session validity\n   */\n  isValidSession() {\n    if (!this.isAuthenticated) {\n      return this.checkStoredSession();\n    }\n\n    const timeSinceActivity = Date.now() - this.lastActivity;\n    if (timeSinceActivity > this.sessionTimeout) {\n      this.logout();\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Update activity timestamp\n   */\n  updateActivity() {\n    this.lastActivity = Date.now();\n    this.storeAuthSession();\n  }\n\n  /**\n   * Logout and clear session\n   */\n  logout() {\n    this.isAuthenticated = false;\n    sessionStorage.removeItem('auth_session');\n    sessionStorage.removeItem('auth_timestamp');\n  }\n\n  /**\n   * Simple hash function for password verification\n   * Note: For production medical device, use proper bcrypt/PBKDF2\n   * @param {string} input - Password to hash\n   * @returns {string} - Hashed password\n   */\n  async hashPassword(input) {\n    const encoder = new TextEncoder();\n    const data = encoder.encode(input);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');\n    return hashHex;\n  }\n\n  /**\n   * Store authenticated session\n   */\n  storeAuthSession() {\n    if (this.isAuthenticated) {\n      sessionStorage.setItem('auth_session', 'verified');\n      sessionStorage.setItem('auth_timestamp', this.lastActivity.toString());\n    }\n  }\n\n  /**\n   * Check for existing valid session\n   * @returns {boolean} - Stored session validity\n   */\n  checkStoredSession() {\n    const session = sessionStorage.getItem('auth_session');\n    const timestamp = sessionStorage.getItem('auth_timestamp');\n\n    if (session === 'verified' && timestamp) {\n      const lastActivity = parseInt(timestamp);\n      const timeSinceActivity = Date.now() - lastActivity;\n\n      if (timeSinceActivity < this.sessionTimeout) {\n        this.isAuthenticated = true;\n        this.lastActivity = lastActivity;\n        return true;\n      }\n    }\n\n    this.logout();\n    return false;\n  }\n\n  /**\n   * Setup activity tracking for session management\n   */\n  setupActivityTracking() {\n    // Track user interactions to maintain session\n    const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];\n\n    const updateActivity = () => {\n      if (this.isAuthenticated) {\n        this.updateActivity();\n      }\n    };\n\n    events.forEach((event) => {\n      document.addEventListener(event, updateActivity, { passive: true });\n    });\n  }\n\n  /**\n   * Rate limiting for failed authentication attempts\n   */\n  async delayFailedAttempt() {\n    return new Promise((resolve) => {\n      setTimeout(resolve, 1000); // 1 second delay\n    });\n  }\n\n  /**\n   * Get session status for UI\n   * @returns {object} - Session information\n   */\n  getSessionInfo() {\n    if (!this.isAuthenticated) {\n      return { authenticated: false };\n    }\n\n    const timeRemaining = this.sessionTimeout - (Date.now() - this.lastActivity);\n    const hoursRemaining = Math.floor(timeRemaining / (60 * 60 * 1000));\n    const minutesRemaining = Math.floor((timeRemaining % (60 * 60 * 1000)) / (60 * 1000));\n\n    return {\n      authenticated: true,\n      timeRemaining: `${hoursRemaining}h ${minutesRemaining}m`,\n      lastActivity: new Date(this.lastActivity).toLocaleTimeString(),\n    };\n  }\n}\n\n// Export singleton instance\nexport const authManager = new AuthenticationManager();\n","export function renderProgressIndicator(currentStep) {\n  const steps = [\n    { id: 1, label: 'Triage' },\n    { id: 2, label: 'Assessment' },\n    { id: 3, label: 'Results' },\n  ];\n\n  let html = '<div class=\"progress-indicator\">';\n  steps.forEach((step, index) => {\n    const isActive = step.id === currentStep;\n    const isCompleted = step.id < currentStep;\n    html += `\n      <div class=\"progress-step ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''}\">\n        ${isCompleted ? '' : step.id}\n      </div>\n    `;\n    if (index < steps.length - 1) {\n      html += `<div class=\"progress-line ${isCompleted ? 'completed' : ''}\"></div>`;\n    }\n  });\n  html += '</div>';\n  return html;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderTriage1() {\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(1)}\n      <h2>${t('triage1Title')}</h2>\n      <div class=\"triage-question\">\n        ${t('triage1Question')}\n        <small>${t('triage1Help')}</small>\n      </div>\n      <div class=\"triage-buttons\">\n        <button class=\"yes-btn\" data-action=\"triage1\" data-value=\"true\">${t('triage1Yes')}</button>\n        <button class=\"no-btn\" data-action=\"triage1\" data-value=\"false\">${t('triage1No')}</button>\n      </div>\n    </div>\n  `;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderTriage2() {\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(1)}\n      <h2>${t('triage2Title')}</h2>\n      <div class=\"triage-question\">\n        ${t('triage2Question')}\n        <small>${t('triage2Help')}</small>\n      </div>\n      <div class=\"triage-buttons\">\n        <button class=\"yes-btn\" data-action=\"triage2\" data-value=\"true\">${t('triage2Yes')}</button>\n        <button class=\"no-btn\" data-action=\"triage2\" data-value=\"false\">${t('triage2No')}</button>\n      </div>\n    </div>\n  `;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { GFAP_RANGES } from '../../config.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderComa() {\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(2)}\n      <h2>${t('comaModuleTitle') || 'Coma Module'}</h2>\n      <form data-module=\"coma\">\n        <div class=\"input-grid\">\n          <div class=\"input-group\">\n            <label for=\"gfap_value\">\n              ${t('gfapValueLabel')}\n              <span class=\"tooltip\">ℹ️\n                <span class=\"tooltiptext\">${t('gfapTooltipLong')}</span>\n              </span>\n            </label>\n            <input type=\"number\" id=\"gfap_value\" name=\"gfap_value\" min=\"${GFAP_RANGES.min}\" max=\"${GFAP_RANGES.max}\" step=\"0.1\" required aria-describedby=\"gfap-help\">\n            <div id=\"gfap-help\" class=\"input-help\">\n              ${t('gfapRange').replace('{min}', GFAP_RANGES.min).replace('{max}', GFAP_RANGES.max)}\n            </div>\n          </div>\n        </div>\n        <button type=\"submit\" class=\"primary\">${t('analyzeIchRisk')}</button>\n        <button type=\"button\" class=\"secondary\" data-action=\"reset\">${t('startOver')}</button>\n      </form>\n    </div>\n  `;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { GFAP_RANGES } from '../../config.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderLimited() {\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(2)}\n      <h2>${t('limitedDataModuleTitle') || 'Limited Data Module'}</h2>\n      <form data-module=\"limited\">\n        <div class=\"input-grid\">\n          <div class=\"input-group\">\n            <label for=\"age_years\">${t('ageYearsLabel')}</label>\n            <input type=\"number\" name=\"age_years\" id=\"age_years\" min=\"0\" max=\"120\" required aria-describedby=\"age-help\">\n            <div id=\"age-help\" class=\"input-help\">${t('ageYearsHelp')}</div>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"systolic_bp\">${t('systolicBpLabel')}</label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"systolic_bp\" id=\"systolic_bp\" min=\"60\" max=\"300\" required aria-describedby=\"sbp-help\" inputmode=\"numeric\">\n              <span class=\"unit\">mmHg</span>\n            </div>\n            <div id=\"sbp-help\" class=\"input-help\">${t('systolicBpHelp')}</div>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"diastolic_bp\">${t('diastolicBpLabel')}</label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"diastolic_bp\" id=\"diastolic_bp\" min=\"30\" max=\"200\" required aria-describedby=\"dbp-help\" inputmode=\"numeric\">\n              <span class=\"unit\">mmHg</span>\n            </div>\n            <div id=\"dbp-help\" class=\"input-help\">${t('diastolicBpHelp')}</div>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"gfap_value\">\n              ${t('gfapValueLabel')}\n              <span class=\"tooltip\">ℹ️\n                <span class=\"tooltiptext\">${t('gfapTooltipLong')}</span>\n              </span>\n            </label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"gfap_value\" id=\"gfap_value\" min=\"${GFAP_RANGES.min}\" max=\"${GFAP_RANGES.max}\" step=\"0.1\" required inputmode=\"decimal\">\n              <span class=\"unit\">pg/mL</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"checkbox-group\">\n          <label class=\"checkbox-wrapper\">\n            <input type=\"checkbox\" name=\"vigilanzminderung\" id=\"vigilanzminderung\">\n            <span class=\"checkbox-label\">${t('vigilanceReduction')}</span>\n          </label>\n        </div>\n        <button type=\"submit\" class=\"primary\">${t('analyzeIchRisk')}</button>\n        <button type=\"button\" class=\"secondary\" data-action=\"reset\">${t('startOver')}</button>\n      </form>\n    </div>\n  `;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { GFAP_RANGES } from '../../config.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderFull() {\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(2)}\n      <h2>${t('fullStrokeModuleTitle') || 'Full Stroke Module'}</h2>\n      <form data-module=\"full\">\n        <h3>${t('basicInformation')}</h3>\n        <div class=\"input-grid\">\n          <div class=\"input-group\">\n            <label for=\"age_years\">${t('ageYearsLabel')}</label>\n            <input type=\"number\" name=\"age_years\" id=\"age_years\" min=\"0\" max=\"120\" required>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"systolic_bp\">${t('systolicBpLabel')}</label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"systolic_bp\" id=\"systolic_bp\" min=\"60\" max=\"300\" required inputmode=\"numeric\">\n              <span class=\"unit\">mmHg</span>\n            </div>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"diastolic_bp\">${t('diastolicBpLabel')}</label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"diastolic_bp\" id=\"diastolic_bp\" min=\"30\" max=\"200\" required inputmode=\"numeric\">\n              <span class=\"unit\">mmHg</span>\n            </div>\n          </div>\n        </div>\n\n        <h3>${t('biomarkersScores')}</h3>\n        <div class=\"input-grid\">\n          <div class=\"input-group\">\n            <label for=\"gfap_value\">\n              ${t('gfapValueLabel')}\n              <span class=\"tooltip\">ℹ️\n                <span class=\"tooltiptext\">${t('gfapTooltip')}</span>\n              </span>\n            </label>\n            <div class=\"input-with-unit\">\n              <input type=\"number\" name=\"gfap_value\" id=\"gfap_value\" min=\"${GFAP_RANGES.min}\" max=\"${GFAP_RANGES.max}\" step=\"0.1\" required inputmode=\"decimal\">\n              <span class=\"unit\">pg/mL</span>\n            </div>\n          </div>\n          <div class=\"input-group\">\n            <label for=\"fast_ed_score\">\n              ${t('fastEdScoreLabel')}\n              <span class=\"tooltip\">ℹ️\n                <span class=\"tooltiptext\">${t('fastEdCalculatorSubtitle')}</span>\n              </span>\n            </label>\n            <input type=\"number\" name=\"fast_ed_score\" id=\"fast_ed_score\" min=\"0\" max=\"9\" required readonly placeholder=\"${t('fastEdCalculatorSubtitle')}\" style=\"cursor: pointer;\">\n            <input type=\"hidden\" name=\"armparese\" id=\"armparese_hidden\" value=\"false\">\n            <input type=\"hidden\" name=\"eye_deviation\" id=\"eye_deviation_hidden\" value=\"false\">\n          </div>\n        </div>\n\n        <h3>${t('clinicalSymptoms')}</h3>\n        <div class=\"input-grid\">\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"headache\" id=\"headache\">\n              <span class=\"checkbox-label\">${t('headacheLabel')}</span>\n            </label>\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"vigilanzminderung\" id=\"vigilanzminderung\">\n              <span class=\"checkbox-label\">${t('vigilanzLabel')}</span>\n            </label>\n          </div>\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"beinparese\" id=\"beinparese\">\n              <span class=\"checkbox-label\">${t('legParesis')}</span>\n            </label>\n          </div>\n        </div>\n\n        <h3>${t('medicalHistory')}</h3>\n        <div class=\"input-grid\">\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"atrial_fibrillation\" id=\"atrial_fibrillation\">\n              <span class=\"checkbox-label\">${t('atrialFibrillation')}</span>\n            </label>\n          </div>\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"anticoagulated_noak\" id=\"anticoagulated_noak\">\n              <span class=\"checkbox-label\">${t('onNoacDoac')}</span>\n            </label>\n          </div>\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-wrapper\">\n              <input type=\"checkbox\" name=\"antiplatelets\" id=\"antiplatelets\">\n              <span class=\"checkbox-label\">${t('onAntiplatelets')}</span>\n            </label>\n          </div>\n        </div>\n\n        <button type=\"submit\" class=\"primary\">${t('analyzeStrokeRisk')}</button>\n        <button type=\"button\" class=\"secondary\" data-action=\"reset\">${t('startOver')}</button>\n      </form>\n    </div>\n  `;\n}\n","import { t } from '../../localization/i18n.js';\n\nexport function renderCriticalAlert() {\n  return `\n    <div class=\"critical-alert\">\n      <h4><span class=\"alert-icon\">🚨</span> ${t('criticalAlertTitle')}</h4>\n      <p>${t('criticalAlertMessage')}</p>\n    </div>\n  `;\n}\n","// User-friendly label formatter for technical field names\n// Converts technical driver and field names to user-friendly labels\n\nimport { t } from '../localization/i18n.js';\n\n/**\n * Mapping of technical field names to the same labels used in input forms\n * Uses existing localization keys from the input forms\n */\nconst FIELD_LABEL_MAP = {\n  // Age and demographics\n  age_years: 'ageLabel',\n  age: 'ageLabel',\n\n  // Blood pressure\n  systolic_bp: 'systolicLabel',\n  diastolic_bp: 'diastolicLabel',\n  systolic_blood_pressure: 'systolicLabel',\n  diastolic_blood_pressure: 'diastolicLabel',\n  blood_pressure_systolic: 'systolicLabel',\n  blood_pressure_diastolic: 'diastolicLabel',\n\n  // Biomarkers\n  gfap_value: 'gfapLabel',\n  gfap: 'gfapLabel',\n  gfap_level: 'gfapLabel',\n\n  // Clinical scores\n  fast_ed_score: 'fastEdLabel',\n  fast_ed: 'fastEdLabel',\n  fast_ed_total: 'fastEdLabel',\n\n  // Neurological symptoms\n  vigilanzminderung: 'vigilanzLabel',\n  vigilance_reduction: 'vigilanzLabel',\n  reduced_consciousness: 'vigilanzLabel',\n  armparese: 'armPareseLabel',\n  arm_paresis: 'armPareseLabel',\n  arm_weakness: 'armPareseLabel',\n  beinparese: 'beinPareseLabel',\n  leg_paresis: 'beinPareseLabel',\n  leg_weakness: 'beinPareseLabel',\n  eye_deviation: 'eyeDeviationLabel',\n  blickdeviation: 'eyeDeviationLabel',\n  headache: 'headacheLabel',\n  kopfschmerzen: 'headacheLabel',\n\n  // Medical history\n  atrial_fibrillation: 'atrialFibLabel',\n  vorhofflimmern: 'atrialFibLabel',\n  anticoagulated_noak: 'anticoagLabel',\n  anticoagulation: 'anticoagLabel',\n  antiplatelets: 'antiplateletsLabel',\n  thrombozytenaggregationshemmer: 'antiplateletsLabel',\n};\n\n/**\n * Fallback patterns for common technical terms\n * Used when no specific mapping exists\n */\nconst PATTERN_REPLACEMENTS = [\n  { pattern: /_score$/, replacement: ' Score' },\n  { pattern: /_value$/, replacement: ' Level' },\n  { pattern: /_bp$/, replacement: ' Blood Pressure' },\n  { pattern: /_years?$/, replacement: ' (years)' },\n  { pattern: /^ich_/, replacement: 'Brain Bleeding ' },\n  { pattern: /^lvo_/, replacement: 'Large Vessel ' },\n  { pattern: /parese$/, replacement: 'Weakness' },\n  { pattern: /deviation$/, replacement: 'Movement' },\n];\n\n/**\n * Format a technical field name using the same labels as input forms\n * @param {string} fieldName - Technical field name (e.g., 'fast_ed_score')\n * @returns {string} - Consistent medical terminology label\n */\nexport function formatDriverName(fieldName) {\n  if (!fieldName) {\n    return '';\n  }\n\n  // First, try to find exact match in mapping to input form labels\n  const mappedKey = FIELD_LABEL_MAP[fieldName.toLowerCase()];\n  if (mappedKey) {\n    const translated = t(mappedKey);\n    if (translated && translated !== mappedKey) {\n      return translated;\n    }\n  }\n\n  // Apply pattern-based replacements for common medical terms\n  let formatted = fieldName.toLowerCase();\n  PATTERN_REPLACEMENTS.forEach(({ pattern, replacement }) => {\n    formatted = formatted.replace(pattern, replacement);\n  });\n\n  // Clean up and format - keep medical terminology consistent\n  formatted = formatted\n    .replace(/_/g, ' ') // Replace underscores with spaces\n    .replace(/\\b\\w/g, (l) => l.toUpperCase()) // Title case\n    .trim();\n\n  return formatted;\n}\n\n/**\n * Format field names for input summary display\n * @param {string} fieldName - Technical field name\n * @returns {string} - User-friendly label for summary\n */\nexport function formatSummaryLabel(fieldName) {\n  // Use the same logic but with specific summary context\n  const friendlyLabel = formatDriverName(fieldName);\n\n  // Remove units from summary labels as they're shown in values\n  return friendlyLabel\n    .replace(/\\s*\\([^)]*\\)\\s*/g, '') // Remove anything in parentheses\n    .trim();\n}\n\n/**\n * Format field values for display\n * @param {any} value - Field value\n * @param {string} fieldName - Field name for context\n * @returns {string} - Formatted display value\n */\nexport function formatDisplayValue(value, fieldName = '') {\n  if (value === null || value === undefined || value === '') {\n    return '';\n  }\n\n  if (typeof value === 'boolean') {\n    return value ? '✓' : '✗';\n  }\n\n  if (typeof value === 'number') {\n    // Add units based on field type\n    if (fieldName.includes('bp') || fieldName.includes('blood_pressure')) {\n      return `${value} mmHg`;\n    }\n    if (fieldName.includes('gfap')) {\n      return `${value} pg/mL`;\n    }\n    if (fieldName.includes('age')) {\n      return `${value} years`;\n    }\n    if (fieldName.includes('score')) {\n      return value.toString();\n    }\n\n    // Default number formatting\n    return Number.isInteger(value) ? value.toString() : value.toFixed(1);\n  }\n\n  return value.toString();\n}\n\n/**\n * Get a short description for a clinical field\n * @param {string} fieldName - Technical field name\n * @returns {string} - Brief description\n */\nexport function getFieldDescription(fieldName) {\n  const descriptions = {\n    fast_ed_score: 'Stroke severity assessment',\n    gfap_value: 'Brain injury biomarker',\n    vigilanzminderung: 'Level of consciousness',\n    systolic_bp: 'Upper blood pressure reading',\n    diastolic_bp: 'Lower blood pressure reading',\n    atrial_fibrillation: 'Irregular heart rhythm',\n    anticoagulated_noak: 'Blood-thinning medication',\n    antiplatelets: 'Anti-clotting medication',\n  };\n\n  return descriptions[fieldName.toLowerCase()] || '';\n}\n","import { t } from '../../localization/i18n.js';\nimport { formatDriverName } from '../../utils/label-formatter.js';\n\nexport function renderDriversSection(ich, lvo) {\n  console.log('=== DRIVER RENDERING SECTION ===');\n\n  if (!ich?.drivers && !lvo?.drivers) {\n    console.log('❌ No drivers available for rendering');\n    return '';\n  }\n\n  let html = `\n    <div class=\"drivers-section\">\n      <div class=\"drivers-header\">\n        <h3><span class=\"driver-header-icon\">🎯</span> ${t('riskAnalysis')}</h3>\n        <p class=\"drivers-subtitle\">${t('riskAnalysisSubtitle')}</p>\n      </div>\n      <div class=\"enhanced-drivers-grid\">\n  `;\n\n  if (ich?.drivers) {\n    console.log('🧠 Rendering ICH drivers panel');\n    html += renderEnhancedDriversPanel(ich.drivers, 'ICH', 'ich', ich.probability);\n  }\n\n  if (lvo?.drivers && !lvo.notPossible) {\n    console.log('🩸 Rendering LVO drivers panel');\n    html += renderEnhancedDriversPanel(lvo.drivers, 'LVO', 'lvo', lvo.probability);\n  }\n\n  html += `\n      </div>\n    </div>\n  `;\n  return html;\n}\n\nexport function renderDriversPanel(drivers, title, type) {\n  if (!drivers || Object.keys(drivers).length === 0) {\n    return `\n      <div class=\"drivers-panel\">\n        <h4>\n          <span class=\"driver-icon ${type}\">${type === 'ich' ? 'I' : 'L'}</span>\n          ${title} ${t('riskFactors')}\n        </h4>\n        <p style=\"color: var(--text-secondary); font-style: italic;\">\n          Driver information not available from this prediction model.\n        </p>\n      </div>\n    `;\n  }\n\n  const driversViewModel = normalizeDrivers(drivers);\n\n  if (driversViewModel.kind === 'unavailable') {\n    return `\n      <div class=\"drivers-panel\">\n        <h4>\n          <span class=\"driver-icon ${type}\">${type === 'ich' ? 'I' : 'L'}</span>\n          ${title} ${t('riskFactors')}\n        </h4>\n        <p style=\"color: var(--text-secondary); font-style: italic;\">\n          Driver analysis not available for this prediction.\n        </p>\n      </div>\n    `;\n  }\n\n  let html = `\n    <div class=\"drivers-panel\">\n      <h4>\n        <span class=\"driver-icon ${type}\">${type === 'ich' ? 'I' : 'L'}</span>\n        ${title} Risk Factors\n      </h4>\n  `;\n\n  // Calculate relative importance for legacy panel\n  const totalPositiveWeightLegacy = driversViewModel.positive.reduce((sum, d) => sum + Math.abs(d.weight), 0);\n  const totalNegativeWeightLegacy = driversViewModel.negative.reduce((sum, d) => sum + Math.abs(d.weight), 0);\n\n  // Show positive drivers (increase risk)\n  if (driversViewModel.positive.length > 0) {\n    driversViewModel.positive.forEach((driver) => {\n      const relativeImportance = totalPositiveWeightLegacy > 0\n        ? (Math.abs(driver.weight) / totalPositiveWeightLegacy) * 100 : 0;\n      const width = Math.min(relativeImportance * 2, 100); // Scale for visualization\n      html += `\n        <div class=\"driver-item\">\n          <span class=\"driver-label\">${driver.label}</span>\n          <div class=\"driver-bar-container\">\n            <div class=\"driver-bar positive\" style=\"width: ${width}%\">\n              <span class=\"driver-value\">+${relativeImportance.toFixed(0)}%</span>\n            </div>\n          </div>\n        </div>\n      `;\n    });\n  }\n\n  // Show negative drivers (decrease risk)\n  if (driversViewModel.negative.length > 0) {\n    driversViewModel.negative.forEach((driver) => {\n      const relativeImportance = totalNegativeWeightLegacy > 0\n        ? (Math.abs(driver.weight) / totalNegativeWeightLegacy) * 100 : 0;\n      const width = Math.min(relativeImportance * 2, 100); // Scale for visualization\n      html += `\n        <div class=\"driver-item\">\n          <span class=\"driver-label\">${driver.label}</span>\n          <div class=\"driver-bar-container\">\n            <div class=\"driver-bar negative\" style=\"width: ${width}%\">\n              <span class=\"driver-value\">-${relativeImportance.toFixed(0)}%</span>\n            </div>\n          </div>\n        </div>\n      `;\n    });\n  }\n\n  // Show metadata if available\n  if (driversViewModel.meta && Object.keys(driversViewModel.meta).length > 0) {\n    html += `\n      <div style=\"margin-top: 15px; padding-top: 10px; border-top: 1px solid var(--border-color);\">\n        <small style=\"color: var(--text-secondary);\">\n    `;\n\n    if (driversViewModel.meta.base_value !== undefined) {\n      html += `Base value: ${driversViewModel.meta.base_value.toFixed(2)} `;\n    }\n    if (driversViewModel.meta.contrib_sum !== undefined) {\n      html += `Contrib sum: ${driversViewModel.meta.contrib_sum.toFixed(2)} `;\n    }\n    if (driversViewModel.meta.logit_total !== undefined) {\n      html += `Logit total: ${driversViewModel.meta.logit_total.toFixed(2)}`;\n    }\n\n    html += `\n        </small>\n      </div>\n    `;\n  }\n\n  html += '</div>';\n  return html;\n}\n\nexport function renderEnhancedDriversPanel(drivers, title, type, probability) {\n  if (!drivers || Object.keys(drivers).length === 0) {\n    console.log(`No drivers data for ${title}`);\n    return `\n      <div class=\"enhanced-drivers-panel ${type}\">\n        <div class=\"panel-header\">\n          <div class=\"panel-icon ${type}\">${type === 'ich' ? '🩸' : '🧠'}</div>\n          <div class=\"panel-title\">\n            <h4>${title} ${t('riskFactors')}</h4>\n            <span class=\"panel-subtitle\">${t('noDriverData')}</span>\n          </div>\n        </div>\n        <p class=\"no-drivers-message\">\n          ${t('driverInfoNotAvailable')}\n        </p>\n      </div>\n    `;\n  }\n\n  // Drivers are already in the correct format from our new extraction\n  const driversViewModel = drivers;\n\n  if (driversViewModel.kind === 'unavailable') {\n    return `\n      <div class=\"enhanced-drivers-panel ${type}\">\n        <div class=\"panel-header\">\n          <div class=\"panel-icon ${type}\">${type === 'ich' ? '🩸' : '🧠'}</div>\n          <div class=\"panel-title\">\n            <h4>${title} ${t('riskFactors')}</h4>\n            <span class=\"panel-subtitle\">${t('driverAnalysisUnavailable')}</span>\n          </div>\n        </div>\n        <p class=\"no-drivers-message\">\n          ${t('driverAnalysisNotAvailable')}\n        </p>\n      </div>\n    `;\n  }\n\n  // Sort drivers by absolute impact and limit to top 6 most important\n  const positiveDrivers = driversViewModel.positive\n    .sort((a, b) => Math.abs(b.weight) - Math.abs(a.weight))\n    .slice(0, 3); // Top 3 positive drivers\n\n  const negativeDrivers = driversViewModel.negative\n    .sort((a, b) => Math.abs(b.weight) - Math.abs(a.weight))\n    .slice(0, 3); // Top 3 negative drivers\n\n  const maxWeight = Math.max(\n    ...positiveDrivers.map((d) => Math.abs(d.weight)),\n    ...negativeDrivers.map((d) => Math.abs(d.weight)),\n    0.01, // Prevent division by zero\n  );\n\n  let html = `\n    <div class=\"enhanced-drivers-panel ${type}\">\n      <div class=\"panel-header\">\n        <div class=\"panel-icon ${type}\">${type === 'ich' ? '🩸' : '🧠'}</div>\n        <div class=\"panel-title\">\n          <h4>${title} ${t('riskFactors')}</h4>\n          <span class=\"panel-subtitle\">${t('contributingFactors')}</span>\n        </div>\n      </div>\n      \n      <div class=\"drivers-split-view\">\n        <div class=\"drivers-column positive-column\">\n          <div class=\"column-header\">\n            <span class=\"column-icon\">↑</span>\n            <span class=\"column-title\">${t('increaseRisk')}</span>\n          </div>\n          <div class=\"compact-drivers\">\n  `;\n\n  // Calculate relative importance percentages\n  const totalPositiveWeight = positiveDrivers.reduce((sum, d) => sum + Math.abs(d.weight), 0);\n\n  // Render positive drivers\n  if (positiveDrivers.length > 0) {\n    positiveDrivers.forEach((driver) => {\n      // Calculate relative importance as percentage of total positive contribution\n      const relativeImportance = totalPositiveWeight > 0\n        ? (Math.abs(driver.weight) / totalPositiveWeight) * 100 : 0;\n      const barWidth = (Math.abs(driver.weight) / maxWeight) * 100;\n      const cleanLabel = formatDriverName(driver.label);\n\n      html += `\n        <div class=\"compact-driver-item\">\n          <div class=\"compact-driver-label\">${cleanLabel}</div>\n          <div class=\"compact-driver-bar positive\" style=\"width: ${barWidth}%\">\n            <span class=\"compact-driver-value\">+${relativeImportance.toFixed(0)}%</span>\n          </div>\n        </div>\n      `;\n    });\n  } else {\n    html += `<div class=\"no-factors\">${t('noPositiveFactors')}</div>`;\n  }\n\n  html += `\n          </div>\n        </div>\n        \n        <div class=\"drivers-column negative-column\">\n          <div class=\"column-header\">\n            <span class=\"column-icon\">↓</span>\n            <span class=\"column-title\">${t('decreaseRisk')}</span>\n          </div>\n          <div class=\"compact-drivers\">\n  `;\n\n  // Calculate relative importance percentages for negative drivers\n  const totalNegativeWeight = negativeDrivers.reduce((sum, d) => sum + Math.abs(d.weight), 0);\n\n  // Render negative drivers\n  if (negativeDrivers.length > 0) {\n    negativeDrivers.forEach((driver) => {\n      // Calculate relative importance as percentage of total negative contribution\n      const relativeImportance = totalNegativeWeight > 0\n        ? (Math.abs(driver.weight) / totalNegativeWeight) * 100 : 0;\n      const barWidth = (Math.abs(driver.weight) / maxWeight) * 100;\n      const cleanLabel = formatDriverName(driver.label);\n\n      html += `\n        <div class=\"compact-driver-item\">\n          <div class=\"compact-driver-label\">${cleanLabel}</div>\n          <div class=\"compact-driver-bar negative\" style=\"width: ${barWidth}%\">\n            <span class=\"compact-driver-value\">-${relativeImportance.toFixed(0)}%</span>\n          </div>\n        </div>\n      `;\n    });\n  } else {\n    html += `<div class=\"no-factors\">${t('noNegativeFactors')}</div>`;\n  }\n\n  html += `\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  return html;\n}\n","// Comprehensive stroke center database for Germany\n// Covers Bayern, Baden-Württemberg, and Nordrhein-Westfalen\n// Total: 316 hospitals with hierarchical capabilities\n\nconst COMPREHENSIVE_HOSPITAL_DATABASE = {\n  bayern: {\n    neurosurgicalCenters: [\n      {\n        id: 'BY-NS-001',\n        name: 'LMU Klinikum München - Großhadern',\n        address: 'Marchioninistraße 15, 81377 München',\n        coordinates: { lat: 48.1106, lng: 11.4684 },\n        phone: '+49 89 4400-0',\n        emergency: '+49 89 4400-73331',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1440,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-002',\n        name: 'Klinikum rechts der Isar München (TUM)',\n        address: 'Ismaninger Str. 22, 81675 München',\n        coordinates: { lat: 48.1497, lng: 11.6052 },\n        phone: '+49 89 4140-0',\n        emergency: '+49 89 4140-2249',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1161,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-003',\n        name: 'Städtisches Klinikum München Schwabing',\n        address: 'Kölner Platz 1, 80804 München',\n        coordinates: { lat: 48.1732, lng: 11.5755 },\n        phone: '+49 89 3068-0',\n        emergency: '+49 89 3068-2050',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 648,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-004',\n        name: 'Städtisches Klinikum München Bogenhausen',\n        address: 'Englschalkinger Str. 77, 81925 München',\n        coordinates: { lat: 48.1614, lng: 11.6254 },\n        phone: '+49 89 9270-0',\n        emergency: '+49 89 9270-2050',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 689,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-005',\n        name: 'Universitätsklinikum Erlangen',\n        address: 'Maximiliansplatz 2, 91054 Erlangen',\n        coordinates: { lat: 49.5982, lng: 11.0037 },\n        phone: '+49 9131 85-0',\n        emergency: '+49 9131 85-39003',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1371,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-006',\n        name: 'Universitätsklinikum Regensburg',\n        address: 'Franz-Josef-Strauß-Allee 11, 93053 Regensburg',\n        coordinates: { lat: 49.0134, lng: 12.0991 },\n        phone: '+49 941 944-0',\n        emergency: '+49 941 944-7501',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1042,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-007',\n        name: 'Universitätsklinikum Würzburg',\n        address: 'Oberdürrbacher Str. 6, 97080 Würzburg',\n        coordinates: { lat: 49.7840, lng: 9.9721 },\n        phone: '+49 931 201-0',\n        emergency: '+49 931 201-24444',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1264,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-008',\n        name: 'Klinikum Nürnberg Nord',\n        address: 'Prof.-Ernst-Nathan-Str. 1, 90419 Nürnberg',\n        coordinates: { lat: 49.4521, lng: 11.0767 },\n        phone: '+49 911 398-0',\n        emergency: '+49 911 398-2369',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1368,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-009',\n        name: 'Universitätsklinikum Augsburg',\n        address: 'Stenglinstr. 2, 86156 Augsburg',\n        coordinates: { lat: 48.3668, lng: 10.9093 },\n        phone: '+49 821 400-01',\n        emergency: '+49 821 400-2356',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1740,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-010',\n        name: 'Klinikum Aschaffenburg-Alzenau',\n        address: 'Am Hasenkopf 1, 63739 Aschaffenburg',\n        coordinates: { lat: 49.9737, lng: 9.1570 },\n        phone: '+49 6021 32-0',\n        emergency: '+49 6021 32-2800',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 40,\n        network: 'TRANSIT',\n      },\n      {\n        id: 'BY-NS-011',\n        name: 'Klinikum Landshut',\n        address: 'Robert-Koch-Str. 1, 84034 Landshut',\n        coordinates: { lat: 48.5665, lng: 12.1512 },\n        phone: '+49 871 698-0',\n        emergency: '+49 871 698-3333',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 505,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-NS-012',\n        name: 'Klinikum Coburg',\n        address: 'Ketschendorfer Str. 33, 96450 Coburg',\n        coordinates: { lat: 50.2596, lng: 10.9644 },\n        phone: '+49 9561 22-0',\n        emergency: '+49 9561 22-6800',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 547,\n        network: 'STENO',\n      },\n      {\n        id: 'BY-NS-013',\n        name: 'Klinikum Passau',\n        address: 'Bischof-Pilgrim-Str. 1, 94032 Passau',\n        coordinates: { lat: 48.5665, lng: 13.4777 },\n        phone: '+49 851 5300-0',\n        emergency: '+49 851 5300-2222',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 696,\n        network: 'TEMPiS',\n      },\n    ],\n\n    comprehensiveStrokeCenters: [\n      {\n        id: 'BY-CS-001',\n        name: 'Klinikum Bamberg',\n        address: 'Buger Str. 80, 96049 Bamberg',\n        coordinates: { lat: 49.8988, lng: 10.9027 },\n        phone: '+49 951 503-0',\n        emergency: '+49 951 503-11101',\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 630,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-CS-002',\n        name: 'Klinikum Bayreuth',\n        address: 'Preuschwitzer Str. 101, 95445 Bayreuth',\n        coordinates: { lat: 49.9459, lng: 11.5779 },\n        phone: '+49 921 400-0',\n        emergency: '+49 921 400-5401',\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 848,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-CS-003',\n        name: 'Klinikum Coburg',\n        address: 'Ketschendorfer Str. 33, 96450 Coburg',\n        coordinates: { lat: 50.2596, lng: 10.9685 },\n        phone: '+49 9561 22-0',\n        emergency: '+49 9561 22-6300',\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 522,\n        network: 'TEMPiS',\n      },\n    ],\n\n    regionalStrokeUnits: [\n      {\n        id: 'BY-RSU-001',\n        name: 'Goldberg-Klinik Kelheim',\n        address: 'Traubenweg 3, 93309 Kelheim',\n        coordinates: { lat: 48.9166, lng: 11.8742 },\n        phone: '+49 9441 702-0',\n        emergency: '+49 9441 702-6800',\n        thrombolysis: true,\n        beds: 200,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-002',\n        name: 'DONAUISAR Klinikum Deggendorf',\n        address: 'Perlasberger Str. 41, 94469 Deggendorf',\n        coordinates: { lat: 48.8372, lng: 12.9619 },\n        phone: '+49 991 380-0',\n        emergency: '+49 991 380-2201',\n        thrombolysis: true,\n        beds: 450,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-003',\n        name: 'Klinikum St. Elisabeth Straubing',\n        address: 'St.-Elisabeth-Str. 23, 94315 Straubing',\n        coordinates: { lat: 48.8742, lng: 12.5733 },\n        phone: '+49 9421 710-0',\n        emergency: '+49 9421 710-2000',\n        thrombolysis: true,\n        beds: 580,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-004',\n        name: 'Klinikum Freising',\n        address: 'Mainburger Str. 29, 85356 Freising',\n        coordinates: { lat: 48.4142, lng: 11.7461 },\n        phone: '+49 8161 24-0',\n        emergency: '+49 8161 24-2800',\n        thrombolysis: true,\n        beds: 380,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-005',\n        name: 'Klinikum Landkreis Erding',\n        address: 'Bajuwarenstr. 5, 85435 Erding',\n        coordinates: { lat: 48.3061, lng: 11.9067 },\n        phone: '+49 8122 59-0',\n        emergency: '+49 8122 59-2201',\n        thrombolysis: true,\n        beds: 350,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-006',\n        name: 'Helios Amper-Klinikum Dachau',\n        address: 'Krankenhausstr. 15, 85221 Dachau',\n        coordinates: { lat: 48.2599, lng: 11.4342 },\n        phone: '+49 8131 76-0',\n        emergency: '+49 8131 76-2201',\n        thrombolysis: true,\n        beds: 480,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-007',\n        name: 'Klinikum Fürstenfeldbruck',\n        address: 'Dachauer Str. 33, 82256 Fürstenfeldbruck',\n        coordinates: { lat: 48.1772, lng: 11.2578 },\n        phone: '+49 8141 99-0',\n        emergency: '+49 8141 99-2201',\n        thrombolysis: true,\n        beds: 420,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-008',\n        name: 'Klinikum Ingolstadt',\n        address: 'Krumenauerstraße 25, 85049 Ingolstadt',\n        coordinates: { lat: 48.7665, lng: 11.4364 },\n        phone: '+49 841 880-0',\n        emergency: '+49 841 880-2201',\n        thrombolysis: true,\n        beds: 665,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-009',\n        name: 'Klinikum Passau',\n        address: 'Bischof-Pilgrim-Str. 1, 94032 Passau',\n        coordinates: { lat: 48.5665, lng: 13.4513 },\n        phone: '+49 851 5300-0',\n        emergency: '+49 851 5300-2100',\n        thrombolysis: true,\n        beds: 540,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-010',\n        name: 'Klinikum Landshut',\n        address: 'Robert-Koch-Str. 1, 84034 Landshut',\n        coordinates: { lat: 48.5436, lng: 12.1619 },\n        phone: '+49 871 698-0',\n        emergency: '+49 871 698-3333',\n        thrombolysis: true,\n        beds: 790,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-011',\n        name: 'RoMed Klinikum Rosenheim',\n        address: 'Pettenkoferstr. 10, 83022 Rosenheim',\n        coordinates: { lat: 47.8567, lng: 12.1265 },\n        phone: '+49 8031 365-0',\n        emergency: '+49 8031 365-3711',\n        thrombolysis: true,\n        beds: 870,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-012',\n        name: 'Klinikum Memmingen',\n        address: 'Bismarckstr. 23, 87700 Memmingen',\n        coordinates: { lat: 47.9833, lng: 10.1833 },\n        phone: '+49 8331 70-0',\n        emergency: '+49 8331 70-2500',\n        thrombolysis: true,\n        beds: 520,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-013',\n        name: 'Klinikum Kempten-Oberallgäu',\n        address: 'Robert-Weixler-Str. 50, 87439 Kempten',\n        coordinates: { lat: 47.7261, lng: 10.3097 },\n        phone: '+49 831 530-0',\n        emergency: '+49 831 530-2201',\n        thrombolysis: true,\n        beds: 650,\n        network: 'TEMPiS',\n      },\n      {\n        id: 'BY-RSU-014',\n        name: 'Klinikum Aschaffenburg-Alzenau',\n        address: 'Am Hasenkopf 1, 63739 Aschaffenburg',\n        coordinates: { lat: 49.9747, lng: 9.1581 },\n        phone: '+49 6021 32-0',\n        emergency: '+49 6021 32-2700',\n        thrombolysis: true,\n        beds: 590,\n        network: 'TEMPiS',\n      },\n    ],\n\n    thrombolysisHospitals: [\n      // Add more smaller hospitals with thrombolysis capability\n      {\n        id: 'BY-TH-001',\n        name: 'Krankenhaus Vilsbiburg',\n        address: 'Sonnenstraße 10, 84137 Vilsbiburg',\n        coordinates: { lat: 48.6333, lng: 12.2833 },\n        phone: '+49 8741 60-0',\n        thrombolysis: true,\n        beds: 180,\n      },\n      {\n        id: 'BY-TH-002',\n        name: 'Krankenhaus Eggenfelden',\n        address: 'Pfarrkirchener Str. 5, 84307 Eggenfelden',\n        coordinates: { lat: 48.4000, lng: 12.7667 },\n        phone: '+49 8721 98-0',\n        thrombolysis: true,\n        beds: 220,\n      },\n      // ... more hospitals would be added here\n    ],\n  },\n\n  badenWuerttemberg: {\n    neurosurgicalCenters: [\n      {\n        id: 'BW-NS-001',\n        name: 'Universitätsklinikum Freiburg',\n        address: 'Hugstetter Str. 55, 79106 Freiburg',\n        coordinates: { lat: 48.0025, lng: 7.8347 },\n        phone: '+49 761 270-0',\n        emergency: '+49 761 270-34010',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1600,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-002',\n        name: 'Universitätsklinikum Heidelberg',\n        address: 'Im Neuenheimer Feld 400, 69120 Heidelberg',\n        coordinates: { lat: 49.4178, lng: 8.6706 },\n        phone: '+49 6221 56-0',\n        emergency: '+49 6221 56-36643',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1621,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-003',\n        name: 'Universitätsklinikum Tübingen',\n        address: 'Geissweg 3, 72076 Tübingen',\n        coordinates: { lat: 48.5378, lng: 9.0538 },\n        phone: '+49 7071 29-0',\n        emergency: '+49 7071 29-82211',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1550,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-004',\n        name: 'Universitätsklinikum Ulm',\n        address: 'Albert-Einstein-Allee 23, 89081 Ulm',\n        coordinates: { lat: 48.4196, lng: 9.9592 },\n        phone: '+49 731 500-0',\n        emergency: '+49 731 500-63001',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1264,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-005',\n        name: 'Klinikum Stuttgart - Katharinenhospital',\n        address: 'Kriegsbergstraße 60, 70174 Stuttgart',\n        coordinates: { lat: 48.7784, lng: 9.1682 },\n        phone: '+49 711 278-0',\n        emergency: '+49 711 278-32001',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 950,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-006',\n        name: 'Städtisches Klinikum Karlsruhe',\n        address: 'Moltkestraße 90, 76133 Karlsruhe',\n        coordinates: { lat: 49.0047, lng: 8.3858 },\n        phone: '+49 721 974-0',\n        emergency: '+49 721 974-2301',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1570,\n        network: 'FAST',\n      },\n      {\n        id: 'BW-NS-007',\n        name: 'Klinikum Ludwigsburg',\n        address: 'Posilipostraße 4, 71640 Ludwigsburg',\n        coordinates: { lat: 48.8901, lng: 9.1953 },\n        phone: '+49 7141 99-0',\n        emergency: '+49 7141 99-67201',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 720,\n        network: 'FAST',\n      },\n    ],\n\n    comprehensiveStrokeCenters: [\n      {\n        id: 'BW-CS-001',\n        name: 'Universitätsmedizin Mannheim',\n        address: 'Theodor-Kutzer-Ufer 1-3, 68167 Mannheim',\n        coordinates: { lat: 49.4828, lng: 8.4664 },\n        phone: '+49 621 383-0',\n        emergency: '+49 621 383-2251',\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1400,\n        network: 'FAST',\n      },\n    ],\n\n    regionalStrokeUnits: [\n      // Regional stroke units in Baden-Württemberg\n      {\n        id: 'BW-RSU-001',\n        name: 'Robert-Bosch-Krankenhaus Stuttgart',\n        address: 'Auerbachstraße 110, 70376 Stuttgart',\n        coordinates: { lat: 48.7447, lng: 9.2294 },\n        phone: '+49 711 8101-0',\n        emergency: '+49 711 8101-3456',\n        thrombolysis: true,\n        beds: 850,\n        network: 'FAST',\n      },\n      // ... more would be added\n    ],\n\n    thrombolysisHospitals: [\n      // Smaller hospitals with thrombolysis capability\n      // ... would be populated from your database\n    ],\n  },\n\n  nordrheinWestfalen: {\n    neurosurgicalCenters: [\n      {\n        id: 'NRW-NS-001',\n        name: 'Universitätsklinikum Düsseldorf',\n        address: 'Moorenstraße 5, 40225 Düsseldorf',\n        coordinates: { lat: 51.1906, lng: 6.8064 },\n        phone: '+49 211 81-0',\n        emergency: '+49 211 81-17700',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1300,\n        network: 'NEVANO+',\n      },\n      {\n        id: 'NRW-NS-002',\n        name: 'Universitätsklinikum Köln',\n        address: 'Kerpener Str. 62, 50937 Köln',\n        coordinates: { lat: 50.9253, lng: 6.9187 },\n        phone: '+49 221 478-0',\n        emergency: '+49 221 478-32500',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1500,\n        network: 'NEVANO+',\n      },\n      {\n        id: 'NRW-NS-003',\n        name: 'Universitätsklinikum Essen',\n        address: 'Hufelandstraße 55, 45147 Essen',\n        coordinates: { lat: 51.4285, lng: 7.0073 },\n        phone: '+49 201 723-0',\n        emergency: '+49 201 723-84444',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1350,\n        network: 'NEVANO+',\n      },\n      {\n        id: 'NRW-NS-004',\n        name: 'Universitätsklinikum Münster',\n        address: 'Albert-Schweitzer-Campus 1, 48149 Münster',\n        coordinates: { lat: 51.9607, lng: 7.6261 },\n        phone: '+49 251 83-0',\n        emergency: '+49 251 83-47255',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1513,\n        network: 'NEVANO+',\n      },\n      {\n        id: 'NRW-NS-005',\n        name: 'Universitätsklinikum Bonn',\n        address: 'Venusberg-Campus 1, 53127 Bonn',\n        coordinates: { lat: 50.6916, lng: 7.1127 },\n        phone: '+49 228 287-0',\n        emergency: '+49 228 287-15107',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1200,\n        network: 'NEVANO+',\n      },\n      {\n        id: 'NRW-NS-006',\n        name: 'Klinikum Dortmund',\n        address: 'Beurhausstraße 40, 44137 Dortmund',\n        coordinates: { lat: 51.5036, lng: 7.4663 },\n        phone: '+49 231 953-0',\n        emergency: '+49 231 953-20050',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1200,\n        network: 'NVNR',\n      },\n      {\n        id: 'NRW-NS-007',\n        name: 'Rhein-Maas Klinikum Würselen',\n        address: 'Mauerfeldstraße 25, 52146 Würselen',\n        coordinates: { lat: 50.8178, lng: 6.1264 },\n        phone: '+49 2405 62-0',\n        emergency: '+49 2405 62-2222',\n        neurosurgery: true,\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 420,\n        network: 'NEVANO+',\n      },\n    ],\n\n    comprehensiveStrokeCenters: [\n      {\n        id: 'NRW-CS-001',\n        name: 'Universitätsklinikum Aachen',\n        address: 'Pauwelsstraße 30, 52074 Aachen',\n        coordinates: { lat: 50.7780, lng: 6.0614 },\n        phone: '+49 241 80-0',\n        emergency: '+49 241 80-89611',\n        thrombectomy: true,\n        thrombolysis: true,\n        beds: 1400,\n        network: 'NEVANO+',\n      },\n    ],\n\n    regionalStrokeUnits: [\n      // Regional stroke units in NRW\n      {\n        id: 'NRW-RSU-001',\n        name: 'Helios Universitätsklinikum Wuppertal',\n        address: 'Heusnerstraße 40, 42283 Wuppertal',\n        coordinates: { lat: 51.2467, lng: 7.1703 },\n        phone: '+49 202 896-0',\n        emergency: '+49 202 896-2180',\n        thrombolysis: true,\n        beds: 1050,\n        network: 'NEVANO+',\n      },\n      // ... more would be added\n    ],\n\n    thrombolysisHospitals: [\n      {\n        id: 'NRW-TH-009',\n        name: 'Elisabeth-Krankenhaus Essen',\n        address: 'Klara-Kopp-Weg 1, 45138 Essen',\n        coordinates: { lat: 51.4495, lng: 7.0137 },\n        phone: '+49 201 897-0',\n        thrombolysis: true,\n        beds: 583,\n      },\n      {\n        id: 'NRW-TH-010',\n        name: 'Klinikum Oberberg Gummersbach',\n        address: 'Wilhelm-Breckow-Allee 20, 51643 Gummersbach',\n        coordinates: { lat: 51.0277, lng: 7.5694 },\n        phone: '+49 2261 17-0',\n        thrombolysis: true,\n        beds: 431,\n      },\n      {\n        id: 'NRW-TH-011',\n        name: 'St. Vincenz-Krankenhaus Limburg',\n        address: 'Auf dem Schafsberg, 65549 Limburg',\n        coordinates: { lat: 50.3856, lng: 8.0584 },\n        phone: '+49 6431 292-0',\n        thrombolysis: true,\n        beds: 452,\n      },\n      {\n        id: 'NRW-TH-012',\n        name: 'Klinikum Lüdenscheid',\n        address: 'Paulmannshöher Straße 14, 58515 Lüdenscheid',\n        coordinates: { lat: 51.2186, lng: 7.6298 },\n        phone: '+49 2351 46-0',\n        thrombolysis: true,\n        beds: 869,\n      },\n      // ... more hospitals from your database\n    ],\n  },\n};\n\n// ==========================================\n// ENHANCED ROUTING ALGORITHM\n// ==========================================\n\nconst ROUTING_ALGORITHM = {\n\n  // Main routing function with enhanced ICH probability thresholds\n  routePatient(patientData) {\n    const {\n      location,\n      state,\n      ichProbability,\n      timeFromOnset,\n      clinicalFactors,\n    } = patientData;\n\n    // Auto-detect state if not provided\n    const detectedState = state || this.detectState(location);\n    const database = COMPREHENSIVE_HOSPITAL_DATABASE[detectedState];\n\n    // Enhanced decision tree based on ICH probability\n    if (ichProbability >= 0.50) {\n      // HIGH ICH RISK - Direct to neurosurgery\n      const destination = this.findNearest(location, database.neurosurgicalCenters);\n      if (!destination) {\n        throw new Error(`No neurosurgical centers available in ${detectedState}`);\n      }\n\n      return {\n        category: 'NEUROSURGICAL_CENTER',\n        destination,\n        urgency: 'IMMEDIATE',\n        reasoning: 'High bleeding probability (≥50%) - neurosurgical evaluation required',\n        preAlert: 'Activate neurosurgery team',\n        bypassLocal: true,\n        threshold: '≥50%',\n        state: detectedState,\n      };\n    }\n\n    if (ichProbability >= 0.30) {\n      // INTERMEDIATE ICH RISK - Comprehensive center preferred\n      const comprehensiveOptions = [\n        ...database.neurosurgicalCenters,\n        ...database.comprehensiveStrokeCenters,\n      ];\n\n      return {\n        category: 'COMPREHENSIVE_CENTER',\n        destination: this.findNearest(location, comprehensiveOptions),\n        urgency: 'URGENT',\n        reasoning: 'Intermediate bleeding risk (30-50%) - CT and possible intervention',\n        preAlert: 'Prepare for possible neurosurgical consultation',\n        transferPlan: this.findNearest(location, database.neurosurgicalCenters),\n        threshold: '30-50%',\n        state: detectedState,\n      };\n    }\n\n    if (timeFromOnset && timeFromOnset <= 270) { // Within 4.5 hour window\n      // LOW ICH RISK, WITHIN tPA WINDOW - Any thrombolysis center\n      const allThrombolysisCapable = [\n        ...database.neurosurgicalCenters,\n        ...database.comprehensiveStrokeCenters,\n        ...database.regionalStrokeUnits,\n        ...database.thrombolysisHospitals,\n      ];\n\n      return {\n        category: 'THROMBOLYSIS_CAPABLE',\n        destination: this.findNearest(location, allThrombolysisCapable),\n        urgency: 'TIME_CRITICAL',\n        reasoning: 'Low bleeding risk (<30%), within tPA window - nearest thrombolysis',\n        preAlert: 'Prepare for thrombolysis protocol',\n        bypassLocal: false,\n        threshold: '<30%',\n        timeWindow: '≤4.5h',\n        state: detectedState,\n      };\n    }\n\n    // LOW ICH RISK, OUTSIDE tPA WINDOW OR NO TIME - Regional stroke unit adequate\n    const strokeUnitsAndHigher = [\n      ...database.neurosurgicalCenters,\n      ...database.comprehensiveStrokeCenters,\n      ...database.regionalStrokeUnits,\n    ];\n\n    return {\n      category: 'STROKE_UNIT',\n      destination: this.findNearest(location, strokeUnitsAndHigher),\n      urgency: 'STANDARD',\n      reasoning: timeFromOnset > 270\n        ? 'Low bleeding risk, outside tPA window - standard stroke evaluation'\n        : 'Low bleeding risk - standard stroke evaluation',\n      preAlert: 'Standard stroke protocol',\n      bypassLocal: false,\n      threshold: '<30%',\n      timeWindow: timeFromOnset ? '>4.5h' : 'unknown',\n      state: detectedState,\n    };\n  },\n\n  // Auto-detect state based on coordinates (more precise boundaries)\n  detectState(location) {\n    // Baden-Württemberg: check first for western regions\n    if (location.lat >= 47.5 && location.lat <= 49.8\n        && location.lng >= 7.5 && location.lng <= 10.2) {\n      return 'badenWuerttemberg';\n    }\n\n    // NRW: northern regions\n    if (location.lat >= 50.3 && location.lat <= 52.5\n        && location.lng >= 5.9 && location.lng <= 9.5) {\n      return 'nordrheinWestfalen';\n    }\n\n    // Bayern: eastern regions (more restrictive western bound to avoid overlap)\n    if (location.lat >= 47.2 && location.lat <= 50.6\n        && location.lng >= 10.2 && location.lng <= 13.8) {\n      return 'bayern';\n    }\n\n    // Overlap region - use nearest state center\n    return this.findNearestState(location);\n  },\n\n  // Find nearest state for edge cases\n  findNearestState(location) {\n    const stateCenters = {\n      bayern: { lat: 49.0, lng: 11.5 },\n      badenWuerttemberg: { lat: 48.5, lng: 9.0 },\n      nordrheinWestfalen: { lat: 51.5, lng: 7.5 },\n    };\n\n    let nearestState = 'bayern';\n    let minDistance = Infinity;\n\n    for (const [state, center] of Object.entries(stateCenters)) {\n      const distance = this.calculateDistance(location, center);\n      if (distance < minDistance) {\n        minDistance = distance;\n        nearestState = state;\n      }\n    }\n\n    return nearestState;\n  },\n\n  // Helper function to find nearest hospital\n  findNearest(userLocation, hospitals) {\n    if (!hospitals || hospitals.length === 0) {\n      console.warn('No hospitals available in database');\n      return null;\n    }\n\n    return hospitals\n      .map((hospital) => {\n        // Validate hospital has coordinates\n        if (!hospital.coordinates || typeof hospital.coordinates.lat !== 'number') {\n          console.warn(`Hospital ${hospital.name} missing valid coordinates`);\n          return null;\n        }\n\n        return {\n          ...hospital,\n          distance: this.calculateDistance(userLocation, hospital.coordinates),\n        };\n      })\n      .filter((hospital) => hospital !== null) // Remove invalid hospitals\n      .sort((a, b) => a.distance - b.distance)[0];\n  },\n\n  // Calculate distance between two GPS points\n  calculateDistance(point1, point2) {\n    const R = 6371; // Earth radius in km\n    const dLat = this.toRad(point2.lat - point1.lat);\n    const dLng = this.toRad(point2.lng - point1.lng);\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2)\n      + Math.cos(this.toRad(point1.lat)) * Math.cos(this.toRad(point2.lat))\n      * Math.sin(dLng / 2) * Math.sin(dLng / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  },\n\n  toRad(deg) {\n    return deg * (Math.PI / 180);\n  },\n};\n\nexport { COMPREHENSIVE_HOSPITAL_DATABASE, ROUTING_ALGORITHM };\n","// Stroke centers in Bayern (Bavaria), Germany\n// Data includes comprehensive stroke centers and stroke units with neurosurgical capabilities\n\nexport const strokeCenters = [\n  // Major comprehensive stroke centers in München\n  {\n    id: 'klinikum-grosshadern-muenchen',\n    name: 'LMU Klinikum München - Großhadern',\n    type: 'comprehensive',\n    address: 'Marchioninistraße 15, 81377 München',\n    coordinates: {\n      lat: 48.1106,\n      lng: 11.4684,\n    },\n    phone: '+49 89 4400-0',\n    emergency: '+49 89 4400-73331',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-rechts-der-isar-muenchen',\n    name: 'Klinikum rechts der Isar München (TUM)',\n    type: 'comprehensive',\n    address: 'Ismaninger Str. 22, 81675 München',\n    coordinates: {\n      lat: 48.1497,\n      lng: 11.6052,\n    },\n    phone: '+49 89 4140-0',\n    emergency: '+49 89 4140-2249',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-schwabing-muenchen',\n    name: 'Städtisches Klinikum München Schwabing',\n    type: 'comprehensive',\n    address: 'Kölner Platz 1, 80804 München',\n    coordinates: {\n      lat: 48.1732,\n      lng: 11.5755,\n    },\n    phone: '+49 89 3068-0',\n    emergency: '+49 89 3068-2050',\n    services: ['thrombectomy', 'neurosurgery', 'icu'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-bogenhausen-muenchen',\n    name: 'Städtisches Klinikum München Bogenhausen',\n    type: 'comprehensive',\n    address: 'Englschalkinger Str. 77, 81925 München',\n    coordinates: {\n      lat: 48.1614,\n      lng: 11.6254,\n    },\n    phone: '+49 89 9270-0',\n    emergency: '+49 89 9270-2050',\n    services: ['thrombectomy', 'neurosurgery', 'icu'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n\n  // Major centers in other Bayern cities\n  {\n    id: 'uniklinikum-erlangen',\n    name: 'Universitätsklinikum Erlangen',\n    type: 'comprehensive',\n    address: 'Maximiliansplatz 2, 91054 Erlangen',\n    coordinates: {\n      lat: 49.5982,\n      lng: 11.0037,\n    },\n    phone: '+49 9131 85-0',\n    emergency: '+49 9131 85-39003',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'uniklinikum-regensburg',\n    name: 'Universitätsklinikum Regensburg',\n    type: 'comprehensive',\n    address: 'Franz-Josef-Strauß-Allee 11, 93053 Regensburg',\n    coordinates: {\n      lat: 49.0134,\n      lng: 12.0991,\n    },\n    phone: '+49 941 944-0',\n    emergency: '+49 941 944-7501',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'uniklinikum-wuerzburg',\n    name: 'Universitätsklinikum Würzburg',\n    type: 'comprehensive',\n    address: 'Oberdürrbacher Str. 6, 97080 Würzburg',\n    coordinates: {\n      lat: 49.7840,\n      lng: 9.9721,\n    },\n    phone: '+49 931 201-0',\n    emergency: '+49 931 201-24444',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-nuernberg',\n    name: 'Klinikum Nürnberg Nord',\n    type: 'comprehensive',\n    address: 'Prof.-Ernst-Nathan-Str. 1, 90419 Nürnberg',\n    coordinates: {\n      lat: 49.4521,\n      lng: 11.0767,\n    },\n    phone: '+49 911 398-0',\n    emergency: '+49 911 398-2369',\n    services: ['thrombectomy', 'neurosurgery', 'icu'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-augsburg',\n    name: 'Universitätsklinikum Augsburg',\n    type: 'comprehensive',\n    address: 'Stenglinstr. 2, 86156 Augsburg',\n    coordinates: {\n      lat: 48.3668,\n      lng: 10.9093,\n    },\n    phone: '+49 821 400-01',\n    emergency: '+49 821 400-2356',\n    services: ['thrombectomy', 'neurosurgery', 'icu', 'telemedicine'],\n    certified: true,\n    certification: 'DSG/DGN',\n    lastUpdated: '2024-08-01',\n  },\n\n  // Primary stroke centers\n  {\n    id: 'klinikum-ingolstadt',\n    name: 'Klinikum Ingolstadt',\n    type: 'primary',\n    address: 'Krumenauerstraße 25, 85049 Ingolstadt',\n    coordinates: {\n      lat: 48.7665,\n      lng: 11.4364,\n    },\n    phone: '+49 841 880-0',\n    emergency: '+49 841 880-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-passau',\n    name: 'Klinikum Passau',\n    type: 'primary',\n    address: 'Bischof-Pilgrim-Str. 1, 94032 Passau',\n    coordinates: {\n      lat: 48.5665,\n      lng: 13.4513,\n    },\n    phone: '+49 851 5300-0',\n    emergency: '+49 851 5300-2100',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-bamberg',\n    name: 'Sozialstiftung Bamberg Klinikum',\n    type: 'primary',\n    address: 'Buger Str. 80, 96049 Bamberg',\n    coordinates: {\n      lat: 49.8988,\n      lng: 10.9027,\n    },\n    phone: '+49 951 503-0',\n    emergency: '+49 951 503-11101',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-bayreuth',\n    name: 'Klinikum Bayreuth',\n    type: 'primary',\n    address: 'Preuschwitzer Str. 101, 95445 Bayreuth',\n    coordinates: {\n      lat: 49.9459,\n      lng: 11.5779,\n    },\n    phone: '+49 921 400-0',\n    emergency: '+49 921 400-5401',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-landshut',\n    name: 'Klinikum Landshut',\n    type: 'primary',\n    address: 'Robert-Koch-Str. 1, 84034 Landshut',\n    coordinates: {\n      lat: 48.5436,\n      lng: 12.1619,\n    },\n    phone: '+49 871 698-0',\n    emergency: '+49 871 698-3333',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-rosenheim',\n    name: 'RoMed Klinikum Rosenheim',\n    type: 'primary',\n    address: 'Pettenkoferstr. 10, 83022 Rosenheim',\n    coordinates: {\n      lat: 47.8567,\n      lng: 12.1265,\n    },\n    phone: '+49 8031 365-0',\n    emergency: '+49 8031 365-3711',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-memmingen',\n    name: 'Klinikum Memmingen',\n    type: 'primary',\n    address: 'Bismarckstr. 23, 87700 Memmingen',\n    coordinates: {\n      lat: 47.9833,\n      lng: 10.1833,\n    },\n    phone: '+49 8331 70-0',\n    emergency: '+49 8331 70-2500',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-kempten',\n    name: 'Klinikum Kempten-Oberallgäu',\n    type: 'primary',\n    address: 'Robert-Weixler-Str. 50, 87439 Kempten',\n    coordinates: {\n      lat: 47.7261,\n      lng: 10.3097,\n    },\n    phone: '+49 831 530-0',\n    emergency: '+49 831 530-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-coburg',\n    name: 'Klinikum Coburg',\n    type: 'primary',\n    address: 'Ketschendorfer Str. 33, 96450 Coburg',\n    coordinates: {\n      lat: 50.2596,\n      lng: 10.9685,\n    },\n    phone: '+49 9561 22-0',\n    emergency: '+49 9561 22-6300',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-aschaffenburg',\n    name: 'Klinikum Aschaffenburg-Alzenau',\n    type: 'primary',\n    address: 'Am Hasenkopf 1, 63739 Aschaffenburg',\n    coordinates: {\n      lat: 49.9747,\n      lng: 9.1581,\n    },\n    phone: '+49 6021 32-0',\n    emergency: '+49 6021 32-2700',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n\n  // Additional smaller stroke units in Bayern\n  {\n    id: 'goldberg-klinik-kelheim',\n    name: 'Goldberg-Klinik Kelheim',\n    type: 'primary',\n    address: 'Traubenweg 3, 93309 Kelheim',\n    coordinates: {\n      lat: 48.9166,\n      lng: 11.8742,\n    },\n    phone: '+49 9441 702-0',\n    emergency: '+49 9441 702-6800',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-deggendorf',\n    name: 'DONAUISAR Klinikum Deggendorf',\n    type: 'primary',\n    address: 'Perlasberger Str. 41, 94469 Deggendorf',\n    coordinates: {\n      lat: 48.8372,\n      lng: 12.9619,\n    },\n    phone: '+49 991 380-0',\n    emergency: '+49 991 380-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-straubing',\n    name: 'Klinikum St. Elisabeth Straubing',\n    type: 'primary',\n    address: 'St.-Elisabeth-Str. 23, 94315 Straubing',\n    coordinates: {\n      lat: 48.8742,\n      lng: 12.5733,\n    },\n    phone: '+49 9421 710-0',\n    emergency: '+49 9421 710-2000',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-freising',\n    name: 'Klinikum Freising',\n    type: 'primary',\n    address: 'Mainburger Str. 29, 85356 Freising',\n    coordinates: {\n      lat: 48.4142,\n      lng: 11.7461,\n    },\n    phone: '+49 8161 24-0',\n    emergency: '+49 8161 24-2800',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-erding',\n    name: 'Klinikum Landkreis Erding',\n    type: 'primary',\n    address: 'Bajuwarenstr. 5, 85435 Erding',\n    coordinates: {\n      lat: 48.3061,\n      lng: 11.9067,\n    },\n    phone: '+49 8122 59-0',\n    emergency: '+49 8122 59-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'helios-dachau',\n    name: 'Helios Amper-Klinikum Dachau',\n    type: 'primary',\n    address: 'Krankenhausstr. 15, 85221 Dachau',\n    coordinates: {\n      lat: 48.2599,\n      lng: 11.4342,\n    },\n    phone: '+49 8131 76-0',\n    emergency: '+49 8131 76-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n  {\n    id: 'klinikum-fuerstenfeldbruck',\n    name: 'Klinikum Fürstenfeldbruck',\n    type: 'primary',\n    address: 'Dachauer Str. 33, 82256 Fürstenfeldbruck',\n    coordinates: {\n      lat: 48.1772,\n      lng: 11.2578,\n    },\n    phone: '+49 8141 99-0',\n    emergency: '+49 8141 99-2201',\n    services: ['stroke_unit', 'telemedicine'],\n    certified: true,\n    certification: 'DSG',\n    lastUpdated: '2024-08-01',\n  },\n];\n\n// Helper functions for stroke center data\nexport function getStrokeCentersByType(type) {\n  return strokeCenters.filter((center) => center.type === type);\n}\n\nexport function getComprehensiveStrokeCenters() {\n  return getStrokeCentersByType('comprehensive');\n}\n\nexport function getPrimaryStrokeCenters() {\n  return getStrokeCentersByType('primary');\n}\n\nexport function getStrokeCenterById(id) {\n  return strokeCenters.find((center) => center.id === id);\n}\n\n// Calculate distance between two coordinates using Haversine formula (fallback)\nexport function calculateDistance(lat1, lng1, lat2, lng2) {\n  const R = 6371; // Earth's radius in kilometers\n  const dLat = toRadians(lat2 - lat1);\n  const dLng = toRadians(lng2 - lng1);\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2)\n    + Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2))\n    * Math.sin(dLng / 2) * Math.sin(dLng / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\n\nfunction toRadians(degrees) {\n  return degrees * (Math.PI / 180);\n}\n\n// Calculate travel time using OpenRoute Service API\nexport async function calculateTravelTime(fromLat, fromLng, toLat, toLng, profile = 'driving-car') {\n  try {\n    // Using OpenRoute Service (free tier)\n    const url = `https://api.openrouteservice.org/v2/directions/${profile}`;\n    const body = {\n      coordinates: [[fromLng, fromLat], [toLng, toLat]],\n      radiuses: [1000, 1000], // Allow 1km radius for routing\n      format: 'json',\n    };\n\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8',\n        Authorization: '5b3ce3597851110001cf624868c4c27b63ae476c9c26c8bffbc35688', // Free tier key\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      body: JSON.stringify(body),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Routing API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n\n    if (data.routes && data.routes.length > 0) {\n      const route = data.routes[0];\n      return {\n        duration: Math.round(route.summary.duration / 60), // Convert to minutes\n        distance: Math.round(route.summary.distance / 1000), // Convert to km\n        source: 'routing',\n      };\n    }\n    throw new Error('No route found');\n  } catch (error) {\n    console.warn('Travel time calculation failed, using distance estimate:', error);\n\n    // Fallback to distance-based time estimation\n    const distance = calculateDistance(fromLat, fromLng, toLat, toLng);\n    const estimatedTime = Math.round(distance / 0.8); // Assume 48 km/h average (urban + highway)\n\n    return {\n      duration: estimatedTime,\n      distance: Math.round(distance),\n      source: 'estimated',\n    };\n  }\n}\n\n// Enhanced travel time calculation for emergency vehicles\nexport async function calculateEmergencyTravelTime(fromLat, fromLng, toLat, toLng) {\n  try {\n    // For emergency vehicles, we can use a faster profile and adjust\n    const result = await calculateTravelTime(fromLat, fromLng, toLat, toLng, 'driving-car');\n\n    // Reduce time by 25% for emergency vehicle (sirens, priority routing)\n    const emergencyDuration = Math.round(result.duration * 0.75);\n\n    return {\n      duration: emergencyDuration,\n      distance: result.distance,\n      source: result.source === 'routing' ? 'emergency-routing' : 'emergency-estimated',\n    };\n  } catch (error) {\n    // Fallback calculation\n    const distance = calculateDistance(fromLat, fromLng, toLat, toLng);\n    const emergencyTime = Math.round(distance / 1.2); // Assume 72 km/h for emergency vehicles\n\n    return {\n      duration: emergencyTime,\n      distance: Math.round(distance),\n      source: 'emergency-estimated',\n    };\n  }\n}\n\n// Find nearest stroke centers with travel time calculation\nexport async function findNearestStrokeCentersWithTravelTime(lat, lng, maxResults = 5, maxTime = 120, useEmergencyRouting = true) {\n  console.log('Calculating travel times to stroke centers...');\n\n  const centersWithTravelTime = await Promise.all(\n    strokeCenters.map(async (center) => {\n      try {\n        const travelInfo = useEmergencyRouting\n          ? await calculateEmergencyTravelTime(lat, lng, center.coordinates.lat, center.coordinates.lng)\n          : await calculateTravelTime(lat, lng, center.coordinates.lat, center.coordinates.lng);\n\n        return {\n          ...center,\n          travelTime: travelInfo.duration,\n          distance: travelInfo.distance,\n          travelSource: travelInfo.source,\n        };\n      } catch (error) {\n        console.warn(`Failed to calculate travel time to ${center.name}:`, error);\n        // Fallback to distance calculation\n        const distance = calculateDistance(lat, lng, center.coordinates.lat, center.coordinates.lng);\n        return {\n          ...center,\n          travelTime: Math.round(distance / 0.8), // Estimate: 48 km/h average\n          distance: Math.round(distance),\n          travelSource: 'fallback',\n        };\n      }\n    }),\n  );\n\n  return centersWithTravelTime\n    .filter((center) => center.travelTime <= maxTime)\n    .sort((a, b) => a.travelTime - b.travelTime)\n    .slice(0, maxResults);\n}\n\n// Find nearest stroke centers using distance (fallback/fast method)\nexport function findNearestStrokeCenters(lat, lng, maxResults = 5, maxDistance = 100) {\n  const centersWithDistance = strokeCenters.map((center) => ({\n    ...center,\n    distance: calculateDistance(lat, lng, center.coordinates.lat, center.coordinates.lng),\n  }));\n\n  return centersWithDistance\n    .filter((center) => center.distance <= maxDistance)\n    .sort((a, b) => a.distance - b.distance)\n    .slice(0, maxResults);\n}\n\n// Get stroke center recommendations with travel time (async)\nexport async function getRecommendedStrokeCentersWithTravelTime(lat, lng, conditionType = 'stroke') {\n  const nearestCenters = await findNearestStrokeCentersWithTravelTime(lat, lng, 10, 120, true);\n\n  if (conditionType === 'lvo' || conditionType === 'thrombectomy') {\n    // For LVO cases, prioritize comprehensive stroke centers within 60 minutes\n    const comprehensive = nearestCenters.filter((center) => center.type === 'comprehensive'\n      && center.services.includes('thrombectomy')\n      && center.travelTime <= 60);\n\n    const primary = nearestCenters.filter((center) => center.type === 'primary');\n\n    return {\n      recommended: comprehensive.slice(0, 3),\n      alternative: primary.slice(0, 2),\n    };\n  }\n\n  // For ICH cases, prioritize neurosurgical capabilities\n  if (conditionType === 'ich') {\n    const neurosurgical = nearestCenters.filter((center) => center.services.includes('neurosurgery')\n      && center.travelTime <= 45);\n\n    return {\n      recommended: neurosurgical.slice(0, 3),\n      alternative: nearestCenters.filter((c) => !neurosurgical.includes(c)).slice(0, 2),\n    };\n  }\n\n  // For general stroke cases, return nearest centers regardless of type\n  return {\n    recommended: nearestCenters.slice(0, 5),\n    alternative: [],\n  };\n}\n\n// Get stroke center recommendations based on patient condition (fallback - distance only)\nexport function getRecommendedStrokeCenters(lat, lng, conditionType = 'stroke') {\n  const nearestCenters = findNearestStrokeCenters(lat, lng, 10);\n\n  if (conditionType === 'lvo' || conditionType === 'thrombectomy') {\n    // For LVO cases, prioritize comprehensive stroke centers\n    const comprehensive = nearestCenters.filter((center) => center.type === 'comprehensive'\n      && center.services.includes('thrombectomy'));\n\n    const primary = nearestCenters.filter((center) => center.type === 'primary');\n\n    return {\n      recommended: comprehensive.slice(0, 3),\n      alternative: primary.slice(0, 2),\n    };\n  }\n\n  // For general stroke cases, return nearest centers regardless of type\n  return {\n    recommended: nearestCenters.slice(0, 5),\n    alternative: [],\n  };\n}\n","// GPS-based stroke center map component\nimport { COMPREHENSIVE_HOSPITAL_DATABASE, ROUTING_ALGORITHM } from '../../data/comprehensive-stroke-centers.js';\nimport { calculateDistance, calculateTravelTime, calculateEmergencyTravelTime } from '../../data/stroke-centers.js';\nimport { t } from '../../localization/i18n.js';\n\nexport function renderStrokeCenterMap(results) {\n  return `\n    <div class=\"stroke-center-section\">\n      <h3>🏥 ${t('nearestCentersTitle')}</h3>\n      <div id=\"locationContainer\">\n        <div class=\"location-controls\">\n          <button type=\"button\" id=\"useGpsButton\" class=\"secondary\">\n            📍 ${t('useCurrentLocation')}\n          </button>\n          <div class=\"location-manual\" style=\"display: none;\">\n            <input type=\"text\" id=\"locationInput\" placeholder=\"${t('enterLocationPlaceholder') || 'e.g. München, Köln, Stuttgart, or 48.1351, 11.5820'}\" />\n            <button type=\"button\" id=\"searchLocationButton\" class=\"secondary\">${t('search')}</button>\n          </div>\n          <button type=\"button\" id=\"manualLocationButton\" class=\"secondary\">\n            ✏️ ${t('enterManually')}\n          </button>\n        </div>\n        <div id=\"strokeCenterResults\" class=\"stroke-center-results\"></div>\n      </div>\n    </div>\n  `;\n}\n\nexport function initializeStrokeCenterMap(results) {\n  const useGpsButton = document.getElementById('useGpsButton');\n  const manualLocationButton = document.getElementById('manualLocationButton');\n  const locationManual = document.querySelector('.location-manual');\n  const locationInput = document.getElementById('locationInput');\n  const searchLocationButton = document.getElementById('searchLocationButton');\n  const resultsContainer = document.getElementById('strokeCenterResults');\n\n  if (useGpsButton) {\n    useGpsButton.addEventListener('click', () => {\n      requestUserLocation(results, resultsContainer);\n    });\n  }\n\n  if (manualLocationButton) {\n    manualLocationButton.addEventListener('click', () => {\n      locationManual.style.display = locationManual.style.display === 'none' ? 'block' : 'none';\n    });\n  }\n\n  if (searchLocationButton) {\n    searchLocationButton.addEventListener('click', () => {\n      const location = locationInput.value.trim();\n      if (location) {\n        geocodeLocation(location, results, resultsContainer);\n      }\n    });\n  }\n\n  if (locationInput) {\n    locationInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        const location = locationInput.value.trim();\n        if (location) {\n          geocodeLocation(location, results, resultsContainer);\n        }\n      }\n    });\n  }\n}\n\nfunction requestUserLocation(results, resultsContainer) {\n  if (!navigator.geolocation) {\n    showLocationError(t('geolocationNotSupported'), resultsContainer);\n    return;\n  }\n\n  resultsContainer.innerHTML = `<div class=\"loading\">${t('gettingLocation')}...</div>`;\n\n  navigator.geolocation.getCurrentPosition(\n    (position) => {\n      const { latitude, longitude } = position.coords;\n      showNearestCenters(latitude, longitude, results, resultsContainer);\n    },\n    (error) => {\n      let errorMessage = t('locationError');\n      switch (error.code) {\n        case error.PERMISSION_DENIED:\n          errorMessage = t('locationPermissionDenied');\n          break;\n        case error.POSITION_UNAVAILABLE:\n          errorMessage = t('locationUnavailable');\n          break;\n        case error.TIMEOUT:\n          errorMessage = t('locationTimeout');\n          break;\n      }\n      showLocationError(errorMessage, resultsContainer);\n    },\n    {\n      enableHighAccuracy: true,\n      timeout: 10000,\n      maximumAge: 300000, // 5 minutes\n    },\n  );\n}\n\nasync function geocodeLocation(locationString, results, resultsContainer) {\n  resultsContainer.innerHTML = `<div class=\"loading\">${t('searchingLocation')}...</div>`;\n\n  // Check if user entered coordinates (format: lat, lng or lat,lng)\n  const coordPattern = /^(-?\\d+\\.?\\d*)\\s*,\\s*(-?\\d+\\.?\\d*)$/;\n  const coordMatch = locationString.trim().match(coordPattern);\n\n  if (coordMatch) {\n    // Direct coordinate input\n    const lat = parseFloat(coordMatch[1]);\n    const lng = parseFloat(coordMatch[2]);\n\n    // Validate coordinates are within supported German states (Bayern, BW, NRW)\n    if (lat >= 47.2 && lat <= 52.5 && lng >= 5.9 && lng <= 15.0) {\n      resultsContainer.innerHTML = `\n        <div class=\"location-success\">\n          <p>📍 Coordinates: ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>\n        </div>\n      `;\n      setTimeout(() => {\n        showNearestCenters(lat, lng, results, resultsContainer);\n      }, 500);\n      return;\n    }\n    showLocationError('Coordinates appear to be outside Germany. Please check the values.', resultsContainer);\n    return;\n  }\n\n  try {\n    // Clean up the location string\n    let searchLocation = locationString.trim();\n\n    // If it doesn't already include country info, add it\n    if (!searchLocation.toLowerCase().includes('deutschland')\n        && !searchLocation.toLowerCase().includes('germany')\n        && !searchLocation.toLowerCase().includes('bayern')\n        && !searchLocation.toLowerCase().includes('bavaria')\n        && !searchLocation.toLowerCase().includes('nordrhein')\n        && !searchLocation.toLowerCase().includes('baden')) {\n      searchLocation += ', Deutschland';\n    }\n\n    // Use Nominatim (OpenStreetMap) geocoding service - free and reliable\n    // Note: encodeURIComponent properly handles umlauts (ä, ö, ü, ß)\n    const encodedLocation = encodeURIComponent(searchLocation);\n    const url = `https://nominatim.openstreetmap.org/search?q=${encodedLocation}&countrycodes=de&format=json&limit=3&addressdetails=1`;\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'User-Agent': 'iGFAP-StrokeTriage/2.1.0', // Required by Nominatim\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Geocoding API error: ${response.status}`);\n    }\n\n    const data = await response.json();\n\n    if (data && data.length > 0) {\n      // Prefer results from supported states (Bayern, Baden-Württemberg, NRW)\n      let location = data[0];\n      const supportedStates = ['Bayern', 'Baden-Württemberg', 'Nordrhein-Westfalen'];\n\n      for (const result of data) {\n        if (result.address && supportedStates.includes(result.address.state)) {\n          location = result;\n          break;\n        }\n      }\n\n      const lat = parseFloat(location.lat);\n      const lng = parseFloat(location.lon);\n      const locationName = location.display_name || locationString;\n\n      // Show success message and then proceed with location\n      resultsContainer.innerHTML = `\n        <div class=\"location-success\">\n          <p>📍 Found: ${locationName}</p>\n          <small style=\"color: #666;\">Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}</small>\n        </div>\n      `;\n\n      // Wait a moment to show the found location, then show centers\n      setTimeout(() => {\n        showNearestCenters(lat, lng, results, resultsContainer);\n      }, 1000);\n    } else {\n      showLocationError(`\n        <strong>Location \"${locationString}\" not found.</strong><br>\n        <small>Try:</small>\n        <ul style=\"text-align: left; font-size: 0.9em; margin: 10px 0;\">\n          <li>City name: \"München\", \"Köln\", \"Stuttgart\"</li>\n          <li>Address: \"Marienplatz 1, München\"</li>\n          <li>Coordinates: \"48.1351, 11.5820\"</li>\n        </ul>\n      `, resultsContainer);\n    }\n  } catch (error) {\n    console.warn('Geocoding failed:', error);\n    showLocationError(`\n      <strong>Unable to search location.</strong><br>\n      <small>Please try entering coordinates directly (e.g., \"48.1351, 11.5820\")</small>\n    `, resultsContainer);\n  }\n}\n\nasync function showNearestCenters(lat, lng, results, resultsContainer) {\n  const location = { lat, lng };\n\n  // Use the enhanced routing algorithm\n  const routing = ROUTING_ALGORITHM.routePatient({\n    location,\n    ichProbability: results?.ich?.probability || 0,\n    timeFromOnset: results?.timeFromOnset || null,\n    clinicalFactors: results?.clinicalFactors || {},\n  });\n\n  if (!routing || !routing.destination) {\n    resultsContainer.innerHTML = `\n      <div class=\"location-error\">\n        <p>⚠️ No suitable stroke centers found in this area.</p>\n        <p><small>Please try a different location or contact emergency services directly.</small></p>\n      </div>\n    `;\n    return;\n  }\n\n  // Generate routing explanation\n  const routingExplanation = getEnhancedRoutingExplanation(routing, results);\n\n  // Show loading state\n  resultsContainer.innerHTML = `\n    <div class=\"location-info\">\n      <p><strong>${t('yourLocation')}:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>\n      <p><strong>Detected State:</strong> ${getStateName(routing.state)}</p>\n    </div>\n    <div class=\"loading\">${t('calculatingTravelTimes')}...</div>\n  `;\n\n  try {\n    // Get all relevant hospitals for this routing decision\n    const database = COMPREHENSIVE_HOSPITAL_DATABASE[routing.state];\n    const allHospitals = [\n      ...database.neurosurgicalCenters,\n      ...database.comprehensiveStrokeCenters,\n      ...database.regionalStrokeUnits,\n      ...(database.thrombolysisHospitals || []),\n    ];\n\n    // Add distance and travel time to primary destination\n    const { destination } = routing;\n    destination.distance = calculateDistance(lat, lng, destination.coordinates.lat, destination.coordinates.lng);\n\n    try {\n      const travelInfo = await calculateEmergencyTravelTime(lat, lng, destination.coordinates.lat, destination.coordinates.lng);\n      destination.travelTime = travelInfo.duration;\n      destination.travelSource = travelInfo.source;\n    } catch (error) {\n      destination.travelTime = Math.round(destination.distance / 0.8); // Estimate\n      destination.travelSource = 'estimated';\n    }\n\n    // Find 3-4 alternative hospitals nearby\n    const alternatives = allHospitals\n      .filter((h) => h.id !== destination.id)\n      .map((hospital) => ({\n        ...hospital,\n        distance: calculateDistance(lat, lng, hospital.coordinates.lat, hospital.coordinates.lng),\n      }))\n      .sort((a, b) => a.distance - b.distance)\n      .slice(0, 3);\n\n    // Add travel times to alternatives\n    for (const alt of alternatives) {\n      try {\n        const travelInfo = await calculateEmergencyTravelTime(lat, lng, alt.coordinates.lat, alt.coordinates.lng);\n        alt.travelTime = travelInfo.duration;\n        alt.travelSource = travelInfo.source;\n      } catch (error) {\n        alt.travelTime = Math.round(alt.distance / 0.8);\n        alt.travelSource = 'estimated';\n      }\n    }\n\n    const html = `\n      <div class=\"location-info\">\n        <p><strong>${t('yourLocation')}:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>\n        <p><strong>State:</strong> ${getStateName(routing.state)}</p>\n        ${routingExplanation}\n      </div>\n      \n      <div class=\"recommended-centers\">\n        <h4>🏥 ${routing.urgency === 'IMMEDIATE' ? 'Emergency' : 'Recommended'} Destination</h4>\n        ${renderEnhancedStrokeCenterCard(destination, true, routing)}\n      </div>\n      \n      ${alternatives.length > 0 ? `\n        <div class=\"alternative-centers\">\n          <h4>Alternative Centers</h4>\n          ${alternatives.map((alt) => renderEnhancedStrokeCenterCard(alt, false, routing)).join('')}\n        </div>\n      ` : ''}\n      \n      <div class=\"travel-time-note\">\n        <small>${t('travelTimeNote') || 'Travel times estimated for emergency vehicles'}</small>\n      </div>\n    `;\n\n    resultsContainer.innerHTML = html;\n  } catch (error) {\n    console.warn('Enhanced routing failed, using basic display:', error);\n\n    // Fallback to basic display\n    resultsContainer.innerHTML = `\n      <div class=\"location-info\">\n        <p><strong>${t('yourLocation')}:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>\n        ${routingExplanation}\n      </div>\n      \n      <div class=\"recommended-centers\">\n        <h4>Recommended Center</h4>\n        <div class=\"stroke-center-card recommended\">\n          <div class=\"center-header\">\n            <h5>${routing.destination.name}</h5>\n            <span class=\"distance\">${routing.destination.distance?.toFixed(1) || '?'} km</span>\n          </div>\n          <div class=\"center-details\">\n            <p class=\"address\">📍 ${routing.destination.address}</p>\n            <p class=\"phone\">📞 ${routing.destination.emergency || routing.destination.phone}</p>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"routing-reasoning\">\n        <p><strong>Routing Logic:</strong> ${routing.reasoning}</p>\n      </div>\n    `;\n  }\n}\n\nfunction renderStrokeCenterList(centers, isRecommended = false) {\n  if (!centers || centers.length === 0) {\n    return `<p>${t('noCentersFound')}</p>`;\n  }\n\n  return centers.map((center) => `\n    <div class=\"stroke-center-card ${isRecommended ? 'recommended' : 'alternative'}\">\n      <div class=\"center-header\">\n        <h5>${center.name}</h5>\n        <span class=\"center-type ${center.type}\">${t(`${center.type}Center`)}</span>\n        ${center.travelTime ? `\n          <span class=\"travel-time\">\n            <span class=\"time\">${center.travelTime} ${t('minutes')}</span>\n            <span class=\"distance\">(${center.distance} km)</span>\n          </span>\n        ` : `\n          <span class=\"distance\">${center.distance.toFixed(1)} km</span>\n        `}\n      </div>\n      \n      <div class=\"center-details\">\n        <p class=\"address\">📍 ${center.address}</p>\n        <p class=\"phone\">📞 ${t('emergency')}: ${center.emergency}</p>\n        \n        <div class=\"services\">\n          ${center.services.map((service) => `\n            <span class=\"service-badge\">${t(service)}</span>\n          `).join('')}\n        </div>\n        \n        ${center.certified ? `\n          <div class=\"certification\">\n            ✅ ${t('certified')}: ${center.certification}\n          </div>\n        ` : ''}\n      </div>\n      \n      <div class=\"center-actions\">\n        <button class=\"call-button\" onclick=\"window.open('tel:${center.emergency}')\">\n          📞 ${t('call')}\n        </button>\n        <button class=\"directions-button\" onclick=\"window.open('https://maps.google.com/maps?daddr=${center.coordinates.lat},${center.coordinates.lng}', '_blank')\">\n          🧭 ${t('directions')}\n        </button>\n      </div>\n    </div>\n  `).join('');\n}\n\n// Helper functions for enhanced routing system\nfunction getStateName(stateCode) {\n  const stateNames = {\n    bayern: 'Bayern (Bavaria)',\n    badenWuerttemberg: 'Baden-Württemberg',\n    nordrheinWestfalen: 'Nordrhein-Westfalen (NRW)',\n  };\n  return stateNames[stateCode] || stateCode;\n}\n\nfunction getEnhancedRoutingExplanation(routing, results) {\n  const ichPercent = Math.round((results?.ich?.probability || 0) * 100);\n\n  let urgencyIcon = '🏥';\n  if (routing.urgency === 'IMMEDIATE') {\n    urgencyIcon = '🚨';\n  } else if (routing.urgency === 'TIME_CRITICAL') {\n    urgencyIcon = '⏰';\n  } else if (routing.urgency === 'URGENT') {\n    urgencyIcon = '⚠️';\n  }\n\n  return `\n    <div class=\"routing-explanation ${routing.category.toLowerCase()}\">\n      <div class=\"routing-header\">\n        <strong>${urgencyIcon} ${routing.category.replace('_', ' ')} - ${routing.urgency}</strong>\n      </div>\n      <div class=\"routing-details\">\n        <p><strong>ICH Risk:</strong> ${ichPercent}% ${routing.threshold ? `(${routing.threshold})` : ''}</p>\n        ${routing.timeWindow ? `<p><strong>Time Window:</strong> ${routing.timeWindow}</p>` : ''}\n        <p><strong>Routing Logic:</strong> ${routing.reasoning}</p>\n        <p><strong>Pre-Alert:</strong> ${routing.preAlert}</p>\n        ${routing.bypassLocal ? '<p class=\"bypass-warning\">⚠️ Bypassing local hospitals</p>' : ''}\n      </div>\n    </div>\n  `;\n}\n\nfunction renderEnhancedStrokeCenterCard(center, isRecommended, routing) {\n  const capabilities = [];\n  if (center.neurosurgery) {\n    capabilities.push('🧠 Neurosurgery');\n  }\n  if (center.thrombectomy) {\n    capabilities.push('🩸 Thrombectomy');\n  }\n  if (center.thrombolysis) {\n    capabilities.push('💉 Thrombolysis');\n  }\n\n  const networkBadge = center.network ? `<span class=\"network-badge\">${center.network}</span>` : '';\n\n  return `\n    <div class=\"stroke-center-card ${isRecommended ? 'recommended' : 'alternative'} enhanced\">\n      <div class=\"center-header\">\n        <h5>${center.name}</h5>\n        <div class=\"center-badges\">\n          ${center.neurosurgery ? '<span class=\"capability-badge neurosurgery\">NS</span>' : ''}\n          ${center.thrombectomy ? '<span class=\"capability-badge thrombectomy\">TE</span>' : ''}\n          ${networkBadge}\n        </div>\n      </div>\n      \n      <div class=\"center-metrics\">\n        ${center.travelTime ? `\n          <div class=\"travel-info\">\n            <span class=\"travel-time\">${center.travelTime} min</span>\n            <span class=\"distance\">${center.distance.toFixed(1)} km</span>\n          </div>\n        ` : `\n          <div class=\"distance-only\">\n            <span class=\"distance\">${center.distance.toFixed(1)} km</span>\n          </div>\n        `}\n        <div class=\"bed-info\">\n          <span class=\"beds\">${center.beds} beds</span>\n        </div>\n      </div>\n      \n      <div class=\"center-details\">\n        <p class=\"address\">📍 ${center.address}</p>\n        <p class=\"phone\">📞 ${center.emergency || center.phone}</p>\n        \n        ${capabilities.length > 0 ? `\n          <div class=\"capabilities\">\n            ${capabilities.join(' • ')}\n          </div>\n        ` : ''}\n      </div>\n      \n      <div class=\"center-actions\">\n        <button class=\"call-button\" onclick=\"window.open('tel:${center.emergency || center.phone}')\">\n          📞 Call\n        </button>\n        <button class=\"directions-button\" onclick=\"window.open('https://maps.google.com/maps?daddr=${center.coordinates.lat},${center.coordinates.lng}', '_blank')\">\n          🧭 Directions\n        </button>\n      </div>\n    </div>\n  `;\n}\n\nfunction showLocationError(message, container) {\n  container.innerHTML = `\n    <div class=\"location-error\">\n      <p>⚠️ ${message}</p>\n      <p><small>${t('tryManualEntry')}</small></p>\n    </div>\n  `;\n}\n","import { CRITICAL_THRESHOLDS } from '../config.js';\n\nexport function getRiskLevel(probabilityPercent, type) {\n  const p = Number(probabilityPercent);\n  const thresholds = CRITICAL_THRESHOLDS[type];\n\n  if (p >= thresholds.high) {\n    return '🔴 HIGH RISK';\n  } if (p >= thresholds.medium) {\n    return '🟡 MEDIUM RISK';\n  }\n  return '🟢 LOW RISK';\n}\n\nexport function formatTime(milliseconds) {\n  const seconds = Math.floor(milliseconds / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const remainingSeconds = seconds % 60;\n  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\n}\n","/**\n * ICH Volume Calculation and Clinical Assessment\n * Based on validated log-log regression model (R² = 0.476)\n * Formula: log₁₀(Volume) = 0.0192 + 0.4533 × log₁₀(GFAP)\n */\n\n// Volume-based risk thresholds with clinical significance\nexport const VOLUME_THRESHOLDS = {\n  low: {\n    max: 10, color: '#dc2626', label: 'Small', severity: 'low',\n  },\n  moderate: {\n    min: 10, max: 20, color: '#dc2626', label: 'Moderate', severity: 'moderate',\n  },\n  high: {\n    min: 20, max: 30, color: '#dc2626', label: 'Large', severity: 'high',\n  },\n  critical: {\n    min: 30, color: '#dc2626', label: 'Critical', severity: 'critical',\n  },\n};\n\n// 30-day mortality rates by hemorrhage volume (based on clinical literature)\n// Calibrated to Broderick et al. (1993) landmark study:\n// - 30ml = 19% mortality\n// - 60ml = 91% mortality\n// With correlation strengths from observational data\n// Reference thresholds for documentation purposes:\nexport const MORTALITY_BY_VOLUME = {\n  '<10ml': '5-10%', // Minor hemorrhage\n  '10-30ml': '10-19%', // Small (Broderick: 30ml=19%)\n  '30-50ml': '19-44%', // Moderate (interpolated)\n  '50-60ml': '44-91%', // Large (Broderick: 60ml=91%)\n  '≥60ml': '91-100%', // Massive (Broderick: >60ml=91-100%)\n};\n\n/**\n * Calculate ICH volume from GFAP biomarker value\n * @param {number} gfapValue - GFAP value in pg/ml (0-10,000)\n * @returns {object} Volume calculation results\n */\nexport function calculateICHVolume(gfapValue) {\n  // Handle edge cases\n  if (!gfapValue || gfapValue <= 0) {\n    return {\n      volume: 0,\n      volumeRange: { min: 0, max: 0 },\n      riskLevel: 'low',\n      mortalityRate: '~0%',\n      isValid: true,\n      calculation: 'No hemorrhage detected',\n    };\n  }\n\n  // Cap extremely high GFAP values\n  const cappedGfap = Math.min(gfapValue, 10000);\n  if (gfapValue > 10000) {\n    console.warn(`GFAP value ${gfapValue} exceeds expected range, capped at 10,000 pg/ml`);\n  }\n\n  try {\n    // Apply log-log regression formula\n    const logVolume = 0.0192 + 0.4533 * Math.log10(cappedGfap);\n    const calculatedVolume = 10 ** logVolume;\n\n    // Calculate confidence range (±30%)\n    const volumeRange = {\n      min: calculatedVolume * 0.7,\n      max: calculatedVolume * 1.3,\n    };\n\n    // Determine risk level based on volume\n    const riskLevel = getVolumeRiskLevel(calculatedVolume);\n\n    // Get mortality rate\n    const mortalityRate = getMortalityRate(calculatedVolume);\n\n    // Format volume for display\n    const displayVolume = calculatedVolume < 1 ? '<1' : calculatedVolume.toFixed(1);\n\n    return {\n      volume: calculatedVolume,\n      displayVolume,\n      volumeRange: {\n        min: volumeRange.min.toFixed(1),\n        max: volumeRange.max.toFixed(1),\n      },\n      riskLevel,\n      mortalityRate,\n      isValid: true,\n      calculation: `Based on GFAP ${gfapValue} pg/ml`,\n      threshold: calculatedVolume >= 30 ? 'SURGICAL' : calculatedVolume >= 20 ? 'HIGH_RISK' : 'MANAGEABLE',\n    };\n  } catch (error) {\n    console.error('Volume calculation error:', error);\n    return {\n      volume: 0,\n      volumeRange: { min: 0, max: 0 },\n      riskLevel: 'low',\n      mortalityRate: 'Unknown',\n      isValid: false,\n      calculation: 'Calculation error',\n      error: error.message,\n    };\n  }\n}\n\n/**\n * Determine risk level based on calculated volume\n * @param {number} volume - Calculated volume in ml\n * @returns {string} Risk level key\n */\nfunction getVolumeRiskLevel(volume) {\n  if (volume >= VOLUME_THRESHOLDS.critical.min) {\n    return 'critical';\n  }\n  if (volume >= VOLUME_THRESHOLDS.high.min) {\n    return 'high';\n  }\n  if (volume >= VOLUME_THRESHOLDS.moderate.min) {\n    return 'moderate';\n  }\n  return 'low';\n}\n\n/**\n * Get mortality rate based on volume with improved interpolation\n * Calibrated to match clinical studies (Broderick 1993: 30ml=19%, 60ml=91%)\n * @param {number} volume - Volume in ml\n * @returns {string} Mortality rate string with citation\n */\nfunction getMortalityRate(volume) {\n  // For very small hemorrhages\n  if (volume < 10) {\n    return '5-10%⁴';\n  }\n\n  // For small hemorrhages (10-30ml)\n  // Broderick: 30ml = 19% mortality\n  if (volume < 30) {\n    // Linear interpolation: 10ml=10%, 30ml=19%\n    const rate = Math.round(10 + (volume - 10) * (19 - 10) / (30 - 10));\n    return `${rate}%⁴`;\n  }\n\n  // For moderate hemorrhages (30-50ml)\n  // Interpolating from Broderick 30ml=19% to 50ml≈44%\n  if (volume < 50) {\n    // Linear interpolation: 30ml=19%, 50ml=44%\n    const rate = Math.round(19 + (volume - 30) * (44 - 19) / (50 - 30));\n    return `${rate}%³`;\n  }\n\n  // For large hemorrhages (50-60ml)\n  // Broderick: 60ml = 91% mortality\n  if (volume < 60) {\n    // Steeper increase: 50ml=44%, 60ml=91%\n    const rate = Math.round(44 + (volume - 50) * (91 - 44) / (60 - 50));\n    return `${rate}%²`;\n  }\n\n  // For massive hemorrhages (≥60ml)\n  // Broderick: >60ml = 91-100%\n  if (volume < 80) {\n    // 60ml=91%, 80ml=96%\n    const rate = Math.round(91 + (volume - 60) * (96 - 91) / (80 - 60));\n    return `${rate}%¹`;\n  }\n\n  // For extreme cases (≥80ml)\n  return '96-100%¹';\n}\n\n/**\n * Calculate hemorrhage size percentage for visualization\n * Based on brain area scaling: 30ml = ~40% of brain area, 100ml = ~70%\n * @param {number} volume - Volume in ml\n * @returns {number} Percentage of brain area (0-70)\n */\nexport function calculateHemorrhageSizePercent(volume) {\n  if (volume <= 0) {\n    return 0;\n  }\n  if (volume >= 100) {\n    return 70;\n  } // Maximum 70% of brain area\n\n  // Non-linear scaling for realistic appearance\n  // 30ml = 40%, 100ml = 70%\n  const basePercent = Math.sqrt(volume / 30) * 40;\n  return Math.min(basePercent, 70);\n}\n\n/**\n * Get color for volume visualization\n * @param {number} volume - Volume in ml\n * @returns {string} CSS color value\n */\nexport function getVolumeColor(volume) {\n  const riskLevel = getVolumeRiskLevel(volume);\n  return VOLUME_THRESHOLDS[riskLevel].color;\n}\n\n/**\n * Test function for validation\n * Tests the calculator with known GFAP values\n */\nexport function testVolumeCalculator() {\n  const testCases = [\n    { gfap: 100, expectedVolume: '~5ml' },\n    { gfap: 500, expectedVolume: '~15ml' },\n    { gfap: 1000, expectedVolume: '~21ml' },\n    { gfap: 1500, expectedVolume: '~28ml' },\n    { gfap: 3000, expectedVolume: '~50ml' },\n    { gfap: 5000, expectedVolume: '~72ml' },\n  ];\n\n  console.log('🧪 ICH Volume Calculator Test Results:');\n  testCases.forEach((test) => {\n    const result = calculateICHVolume(test.gfap);\n    console.log(`GFAP ${test.gfap}: ${result.displayVolume}ml (${test.expectedVolume}) - ${result.riskLevel} risk - ${result.mortalityRate}`);\n  });\n}\n\n/**\n * Format volume for display with appropriate precision\n * @param {number} volume - Volume in ml\n * @returns {string} Formatted volume string\n */\nexport function formatVolumeDisplay(volume) {\n  if (volume < 1) {\n    return '<1 ml';\n  }\n  if (volume < 10) {\n    return `${volume.toFixed(1)} ml`;\n  }\n  return `${Math.round(volume)} ml`;\n}\n","/**\n * Brain Visualization Component for ICH Volume Display\n * Creates an SVG-based brain hemorrhage visualization\n */\n\nimport {\n  calculateHemorrhageSizePercent, getVolumeColor, calculateICHVolume, formatVolumeDisplay,\n} from '../../logic/ich-volume-calculator.js';\n\n/**\n * Render brain visualization with hemorrhage overlay\n * @param {number} volume - ICH volume in ml\n * @param {string} size - 'compact' or 'detailed'\n * @returns {string} HTML string with SVG brain visualization\n */\nexport function renderBrainVisualization(volume, size = 'compact') {\n  const dimensions = size === 'compact' ? { width: 120, height: 120 } : { width: 200, height: 200 };\n  const centerX = dimensions.width / 2;\n  const centerY = dimensions.height / 2;\n\n  // Calculate hemorrhage appearance\n  const hemorrhagePercent = calculateHemorrhageSizePercent(volume);\n  const hemorrhageColor = getVolumeColor(volume);\n\n  // Scale hemorrhage radius based on volume (basal ganglia region, slightly off-center)\n  const maxRadius = dimensions.width * 0.25; // Maximum 25% of brain width\n  const hemorrhageRadius = (hemorrhagePercent / 70) * maxRadius; // 70% is max brain area\n\n  // Position hemorrhage in basal ganglia region (slightly right of center)\n  const hemorrhageX = centerX + (dimensions.width * 0.1); // 10% right of center\n  const hemorrhageY = centerY + (dimensions.height * 0.05); // 5% below center\n\n  // 30ml reference circle (for detailed view)\n  const referenceRadius = (40 / 70) * maxRadius; // 40% brain area = 30ml threshold\n\n  // Animation for hemorrhage (subtle pulsing)\n  const animationId = `hemorrhage-pulse-${Math.random().toString(36).substr(2, 9)}`;\n\n  return `\n    <div class=\"brain-visualization ${size}\">\n      <svg \n        width=\"${dimensions.width}\" \n        height=\"${dimensions.height}\" \n        viewBox=\"0 0 ${dimensions.width} ${dimensions.height}\"\n        class=\"brain-svg\"\n        role=\"img\"\n        aria-label=\"Brain hemorrhage visualization showing ${volume.toFixed(1)}ml ICH volume\"\n      >\n        <!-- Brain outline with hemorrhage overlay -->\n        ${renderBrainOutlineWithHemorrhage(dimensions, volume)}\n        \n        <!-- 30ml reference indicator (detailed view only) -->\n        ${size === 'detailed' && volume > 0 ? `\n          <circle \n            cx=\"${hemorrhageX}\" \n            cy=\"${hemorrhageY}\" \n            r=\"${referenceRadius}\"\n            fill=\"none\" \n            stroke=\"#9ca3af\" \n            stroke-width=\"1\" \n            stroke-dasharray=\"3,3\"\n            opacity=\"0.5\"\n          />\n          <text \n            x=\"${hemorrhageX + referenceRadius + 5}\" \n            y=\"${hemorrhageY - referenceRadius}\" \n            font-size=\"10\" \n            fill=\"#6b7280\"\n            font-family=\"system-ui\"\n          >30ml</text>\n        ` : ''}\n        \n        <!-- Hemorrhage visualization -->\n        ${volume > 0 ? `\n          <circle \n            cx=\"${hemorrhageX}\" \n            cy=\"${hemorrhageY}\" \n            r=\"${hemorrhageRadius}\"\n            fill=\"${hemorrhageColor}\"\n            opacity=\"0.8\"\n            class=\"hemorrhage-circle\"\n          >\n            <!-- Subtle pulsing animation -->\n            <animate \n              attributeName=\"opacity\" \n              values=\"0.6;0.9;0.6\" \n              dur=\"2.5s\" \n              repeatCount=\"indefinite\"\n            />\n            ${hemorrhageRadius > 15 ? `\n            <animate \n              attributeName=\"r\" \n              values=\"${hemorrhageRadius * 0.95};${hemorrhageRadius};${hemorrhageRadius * 0.95}\" \n              dur=\"2.5s\" \n              repeatCount=\"indefinite\"\n            />\n            ` : ''}\n          </circle>\n          \n          <!-- Volume label (detailed view only) -->\n          ${size === 'detailed' ? `\n            <text \n              x=\"${centerX}\" \n              y=\"${dimensions.height - 10}\" \n              text-anchor=\"middle\" \n              font-size=\"12\" \n              font-weight=\"bold\"\n              fill=\"#374151\"\n              font-family=\"system-ui\"\n            >${volume < 1 ? '<1' : volume.toFixed(1)} ml</text>\n          ` : ''}\n        ` : ''}\n        \n        <style>\n          .hemorrhage-circle {\n            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));\n          }\n        </style>\n      </svg>\n    </div>\n  `;\n}\n\n/**\n * Load and render the provided brain SVG with hemorrhage overlay\n * @param {object} dimensions - Width and height for the brain\n * @returns {string} Brain SVG with embedded hemorrhage visualization\n */\nfunction renderBrainOutlineWithHemorrhage(dimensions, volume) {\n  // For performance, we'll use the SVG as a background image and overlay the hemorrhage\n  // This avoids loading the 530KB SVG content directly into the DOM\n\n  const centerX = dimensions.width / 2;\n  const centerY = dimensions.height / 2;\n\n  // Calculate hemorrhage position (basal ganglia region - slightly right and posterior)\n  const hemorrhageX = centerX + (dimensions.width * 0.08); // 8% right of center\n  const hemorrhageY = centerY + (dimensions.height * 0.03); // 3% below center\n\n  const hemorrhagePercent = calculateHemorrhageSizePercent(volume);\n  const hemorrhageColor = getVolumeColor(volume);\n  const maxRadius = dimensions.width * 0.25;\n  const hemorrhageRadius = (hemorrhagePercent / 70) * maxRadius;\n\n  return `\n    <!-- 3D Brain image as background -->\n    <image \n      x=\"0\" \n      y=\"0\" \n      width=\"${dimensions.width}\" \n      height=\"${dimensions.height}\"\n      href=\"./src/assets/brain-3d.png\"\n      opacity=\"0.95\"\n      preserveAspectRatio=\"xMidYMid meet\"\n    />\n    \n    <!-- Hemorrhage overlay in basal ganglia region -->\n    ${volume > 0 ? `\n      <circle \n        cx=\"${hemorrhageX}\" \n        cy=\"${hemorrhageY}\" \n        r=\"${hemorrhageRadius}\"\n        fill=\"${hemorrhageColor}\"\n        opacity=\"0.85\"\n        class=\"hemorrhage-circle\"\n      >\n        <!-- Subtle pulsing animation -->\n        <animate \n          attributeName=\"opacity\" \n          values=\"0.7;0.95;0.7\" \n          dur=\"2.5s\" \n          repeatCount=\"indefinite\"\n        />\n        ${hemorrhageRadius > 8 ? `\n        <animate \n          attributeName=\"r\" \n          values=\"${hemorrhageRadius * 0.96};${hemorrhageRadius * 1.02};${hemorrhageRadius * 0.96}\" \n          dur=\"2.5s\" \n          repeatCount=\"indefinite\"\n        />\n        ` : ''}\n      </circle>\n      \n      <!-- Hemorrhage center highlight -->\n      <circle \n        cx=\"${hemorrhageX}\" \n        cy=\"${hemorrhageY}\" \n        r=\"${hemorrhageRadius * 0.3}\"\n        fill=\"${hemorrhageColor}\"\n        opacity=\"0.95\"\n        class=\"hemorrhage-center\"\n      />\n    ` : ''}\n  `;\n}\n\n/**\n * Temporary brain outline (for fallback when SVG file not available)\n */\nfunction renderTemporaryBrainOutline(dimensions) {\n  const centerX = dimensions.width / 2;\n  const centerY = dimensions.height / 2;\n\n  return `\n    <!-- Simplified brain outline -->\n    <ellipse \n      cx=\"${centerX}\" \n      cy=\"${centerY}\" \n      rx=\"${dimensions.width * 0.4}\" \n      ry=\"${dimensions.height * 0.35}\" \n      fill=\"#f1f5f9\" \n      stroke=\"#64748b\" \n      stroke-width=\"2\"\n      opacity=\"0.8\"\n    />\n    \n    <!-- Brain hemisphere division -->\n    <line \n      x1=\"${centerX}\" \n      y1=\"${centerY - dimensions.height * 0.25}\" \n      x2=\"${centerX}\" \n      y2=\"${centerY + dimensions.height * 0.25}\" \n      stroke=\"#9ca3af\" \n      stroke-width=\"1\" \n      opacity=\"0.5\"\n    />\n  `;\n}\n\n/**\n * Create compact brain icon for inline display\n * @param {number} volume - ICH volume in ml\n * @param {number} size - Icon size in pixels\n * @returns {string} Small brain icon with hemorrhage indicator\n */\nexport function renderCompactBrainIcon(volume, size = 24) {\n  const hemorrhageColor = getVolumeColor(volume);\n  const hemorrhageSize = volume > 0 ? Math.max(2, (volume / 50) * size * 0.3) : 0;\n\n  return `\n    <svg \n      width=\"${size}\" \n      height=\"${size}\" \n      viewBox=\"0 0 ${size} ${size}\"\n      class=\"brain-icon\"\n      style=\"display: inline-block; vertical-align: middle;\"\n    >\n      <!-- Simple brain outline -->\n      <ellipse \n        cx=\"${size / 2}\" \n        cy=\"${size / 2}\" \n        rx=\"${size * 0.4}\" \n        ry=\"${size * 0.35}\" \n        fill=\"#f1f5f9\" \n        stroke=\"#64748b\" \n        stroke-width=\"1\"\n      />\n      \n      <!-- Hemorrhage indicator -->\n      ${volume > 0 ? `\n        <circle \n          cx=\"${size / 2 + size * 0.1}\" \n          cy=\"${size / 2}\" \n          r=\"${hemorrhageSize}\"\n          fill=\"${hemorrhageColor}\"\n          opacity=\"0.9\"\n        />\n      ` : ''}\n    </svg>\n  `;\n}\n\n/**\n * Render circular brain display matching ICH risk circle style\n * @param {number} volume - ICH volume in ml\n * @returns {string} HTML for circular brain display\n */\nexport function renderCircularBrainDisplay(volume) {\n  if (!volume || volume <= 0) {\n    return `\n      <div class=\"volume-circle\" data-volume=\"0\">\n        <div class=\"volume-number\">0<span> ml</span></div>\n        <canvas class=\"volume-canvas\" width=\"120\" height=\"120\"></canvas>\n      </div>\n    `;\n  }\n\n  const formattedVolume = formatVolumeDisplay(volume);\n  const canvasId = `volume-canvas-${Math.random().toString(36).substr(2, 9)}`;\n\n  return `\n    <div class=\"volume-circle\" data-volume=\"${volume}\">\n      <div class=\"volume-number\">${formattedVolume}</div>\n      <canvas id=\"${canvasId}\" class=\"volume-canvas\" \n              data-volume=\"${volume}\" data-canvas-id=\"${canvasId}\"></canvas>\n    </div>\n  `;\n}\n\n/**\n * Initialize fluid fill animation for volume canvas\n * Call this after DOM is updated with new volume circles\n */\nexport function initializeVolumeAnimations() {\n  const canvases = document.querySelectorAll('.volume-canvas');\n\n  canvases.forEach((canvas) => {\n    // Set canvas internal size to match CSS size\n    const cssWidth = canvas.offsetWidth || 120;\n    const cssHeight = canvas.offsetHeight || 120;\n    canvas.width = cssWidth;\n    canvas.height = cssHeight;\n\n    const volume = parseFloat(canvas.dataset.volume) || 0;\n    if (volume > 0) {\n      drawVolumeFluid(canvas, volume);\n    }\n  });\n}\n\n/**\n * Draw fluid fill animation on canvas\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @param {number} volume - ICH volume in ml\n */\nfunction drawVolumeFluid(canvas, volume) {\n  const ctx = canvas.getContext('2d');\n  const centerX = canvas.width / 2;\n  const centerY = canvas.height / 2;\n  const radius = canvas.width * 0.45; // 45% of canvas width for the circle\n  let animationFrame = 0;\n  let isAnimating = true;\n\n  // Check dark mode once\n  const isDarkMode = document.body.classList.contains('dark-mode')\n                    || window.matchMedia('(prefers-color-scheme: dark)').matches;\n\n  function draw() {\n    if (!isAnimating) {\n      return;\n    }\n\n    // Clear canvas completely\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Don't draw background - let CSS handle it\n    // Just draw the fluid and border\n    drawFluidLayer();\n  }\n\n  function drawFluidLayer() {\n    // Calculate fill level based on volume\n    const maxVolume = 80; // ml (practical maximum for visualization)\n    const fillPercentage = Math.min(volume / maxVolume, 0.9);\n    const fillHeight = fillPercentage * (radius * 1.8);\n    const baseLevel = centerY + radius - 4 - fillHeight;\n\n    // Draw fluid fill with waves\n    if (volume > 0) {\n      ctx.save();\n\n      // Clip to circle\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, radius - 4, 0, Math.PI * 2);\n      ctx.clip();\n\n      // Draw base fluid rectangle\n      ctx.fillStyle = '#dc2626';\n      ctx.globalAlpha = 0.7;\n      ctx.fillRect(0, baseLevel + 5, canvas.width, canvas.height);\n\n      // Draw animated wave surface\n      ctx.globalAlpha = 0.9;\n      ctx.fillStyle = '#dc2626';\n      ctx.beginPath();\n\n      // Create wave path\n      const startX = centerX - radius + 4;\n      ctx.moveTo(startX, baseLevel);\n\n      for (let x = startX; x <= centerX + radius - 4; x += 2) {\n        const waveOffset1 = Math.sin((x * 0.05) + animationFrame * 0.08) * 3;\n        const waveOffset2 = Math.sin((x * 0.08) + animationFrame * 0.12 + 1) * 2;\n        const y = baseLevel + waveOffset1 + waveOffset2;\n        ctx.lineTo(x, y);\n      }\n\n      // Complete wave fill\n      ctx.lineTo(centerX + radius - 4, canvas.height);\n      ctx.lineTo(startX, canvas.height);\n      ctx.closePath();\n      ctx.fill();\n\n      ctx.restore();\n    }\n\n    // Draw background border circle (like ICH risk ring)\n    const borderColor = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim()\n                       || (isDarkMode ? '#8899a6' : '#6c757d');\n    ctx.strokeStyle = borderColor;\n    ctx.lineWidth = 8;\n    ctx.globalAlpha = 0.4;\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n\n    // Draw volume progress ring (like ICH risk circle)\n    const volumePercent = Math.min(volume / 100, 1); // Max 100ml = 100%\n    const circumference = 2 * Math.PI * radius;\n    const progressOffset = circumference * (1 - volumePercent);\n\n    // Progress ring (dark mode aware)\n    const progressColor = getComputedStyle(document.documentElement).getPropertyValue('--danger-color').trim()\n                         || '#dc2626';\n    ctx.strokeStyle = progressColor;\n    ctx.lineWidth = 8;\n    ctx.setLineDash([]);\n    ctx.lineCap = 'round';\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + (volumePercent * 2 * Math.PI));\n    ctx.stroke();\n\n    // Continue animation\n    animationFrame += 1;\n    if (volume > 0) {\n      requestAnimationFrame(draw);\n    }\n  }\n\n  // Start animation\n  draw();\n\n  // Stop animation when canvas is removed from DOM\n  const observer = new MutationObserver(() => {\n    if (!document.contains(canvas)) {\n      isAnimating = false;\n      observer.disconnect();\n    }\n  });\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\n/**\n * Get brain visualization CSS classes\n * @param {string} size - 'compact' or 'detailed'\n * @returns {string} CSS classes\n */\nexport function getBrainVisualizationClasses(size) {\n  const baseClasses = 'brain-visualization';\n  const sizeClasses = size === 'compact' ? 'compact-brain' : 'detailed-brain';\n  return `${baseClasses} ${sizeClasses}`;\n}\n","import { renderProgressIndicator } from '../components/progress.js';\nimport { renderCriticalAlert } from '../components/alerts.js';\nimport { renderDriversSection } from '../components/drivers.js';\nimport { renderStrokeCenterMap } from '../components/stroke-center-map.js';\nimport { getRiskLevel, formatTime } from '../../logic/formatters.js';\nimport { CRITICAL_THRESHOLDS } from '../../config.js';\nimport { t, i18n } from '../../localization/i18n.js';\nimport { store } from '../../state/store.js';\nimport { formatSummaryLabel, formatDisplayValue, formatDriverName } from '../../utils/label-formatter.js';\nimport { calculateICHVolume, formatVolumeDisplay } from '../../logic/ich-volume-calculator.js';\nimport { renderCircularBrainDisplay, initializeVolumeAnimations } from '../components/brain-visualization.js';\n// Dynamic import for React islands to avoid module resolution issues\n// Using React island tachometer instead of the vanilla premium gauge\nimport { calculateLegacyICH } from '../../research/legacy-ich-model.js';\nimport { safeLogResearchData, isResearchModeEnabled } from '../../research/data-logger.js';\nimport { renderModelComparison, renderResearchToggle } from '../../research/comparison-ui.js';\n// Premium vanilla JS tachometer implementation\n\nfunction getModuleDisplayName(module) {\n  const isDE = i18n.getCurrentLanguage() === 'de';\n  const moduleNames = {\n    Coma: isDE ? 'Koma-Modul' : 'Coma Module',\n    Limited: isDE ? 'Begrenzte Daten' : 'Limited Data',\n    Full: isDE ? 'Vollständige Bewertung' : 'Full Assessment',\n  };\n  return moduleNames[module] || module;\n}\n\nfunction renderInputSummary() {\n  const state = store.getState();\n  const { formData } = state;\n\n  if (!formData || Object.keys(formData).length === 0) {\n    return '';\n  }\n\n  let summaryHtml = '';\n\n  // Iterate through each module's form data\n  Object.entries(formData).forEach(([module, data]) => {\n    if (data && Object.keys(data).length > 0) {\n      const moduleTitle = t(`${module}ModuleTitle`) || module.charAt(0).toUpperCase() + module.slice(1);\n      let itemsHtml = '';\n\n      Object.entries(data).forEach(([key, value]) => {\n        // Skip empty values\n        if (value === '' || value === null || value === undefined) {\n          return;\n        }\n\n        // Use consistent medical terminology from input forms\n        const label = formatSummaryLabel(key);\n\n        // Format value with appropriate units\n        const displayValue = formatDisplayValue(value, key);\n\n        itemsHtml += `\n          <div class=\"summary-item\">\n            <span class=\"summary-label\">${label}:</span>\n            <span class=\"summary-value\">${displayValue}</span>\n          </div>\n        `;\n      });\n\n      if (itemsHtml) {\n        summaryHtml += `\n          <div class=\"summary-module\">\n            <h4>${moduleTitle}</h4>\n            <div class=\"summary-items\">\n              ${itemsHtml}\n            </div>\n          </div>\n        `;\n      }\n    }\n  });\n\n  if (!summaryHtml) {\n    return '';\n  }\n\n  return `\n    <div class=\"input-summary\">\n      <h3>📋 ${t('inputSummaryTitle')}</h3>\n      <p class=\"summary-subtitle\">${t('inputSummarySubtitle')}</p>\n      <div class=\"summary-content\">\n        ${summaryHtml}\n      </div>\n    </div>\n  `;\n}\n\nfunction renderRiskCard(type, data, results) {\n  if (!data) {\n    return '';\n  }\n\n  const percent = Math.round((data.probability || 0) * 100);\n  const riskLevel = getRiskLevel(percent, type);\n  const isCritical = percent > 70; // Very high risk threshold\n  const isHigh = percent > CRITICAL_THRESHOLDS[type].high;\n\n  const icons = { ich: '🩸', lvo: '🧠' };\n  const titles = { ich: t('ichProbability'), lvo: t('lvoProbability') };\n\n  const level = isCritical ? 'critical' : isHigh ? 'high' : 'normal';\n  return `\n    <div class=\"enhanced-risk-card ${type} ${level}\">\n      <div class=\"risk-header\">\n        <div class=\"risk-icon\">${icons[type]}</div>\n        <div class=\"risk-title\">\n          <h3>${titles[type]}</h3>\n        </div>\n      </div>\n      \n      <div class=\"risk-probability\">\n        <div class=\"circles-container\">\n          <div class=\"rings-row\">\n            <div class=\"circle-item\">\n              <div class=\"probability-circle\" data-react-ring data-percent=\"${percent}\" data-level=\"${level}\"></div>\n              <div class=\"circle-label\">${type === 'ich' ? 'ICH Risk' : 'LVO Risk'}</div>\n            </div>\n          </div>\n          <div class=\"risk-level ${level}\">${riskLevel}</div>\n        </div>\n        \n        <div class=\"risk-assessment\"></div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render ICH volume display for integration into risk card\n * @param {object} data - ICH risk data containing GFAP value\n * @returns {string} HTML for volume display\n */\nfunction renderICHVolumeDisplay(data) {\n  // Get GFAP value from the data\n  const gfapValue = data.gfap_value || getCurrentGfapValue();\n\n  if (!gfapValue || gfapValue <= 0) {\n    return '';\n  }\n\n  const volumeResult = calculateICHVolume(gfapValue);\n\n  return `\n    <div class=\"volume-display-container\">\n      ${renderCircularBrainDisplay(volumeResult.volume)}\n    </div>\n  `;\n}\n\n/**\n * Get current GFAP value from form data\n * @returns {number} GFAP value or 0 if not available\n */\nfunction getCurrentGfapValue() {\n  const state = store.getState();\n  const { formData } = state;\n\n  // Check all modules for GFAP value\n  for (const module of ['coma', 'limited', 'full']) {\n    if (formData[module]?.gfap_value) {\n      return parseFloat(formData[module].gfap_value);\n    }\n  }\n\n  return 0;\n}\n\nfunction renderLVONotPossible() {\n  return `\n    <div class=\"enhanced-risk-card lvo not-possible\">\n      <div class=\"risk-header\">\n        <div class=\"risk-icon\">🔍</div>\n        <div class=\"risk-title\">\n          <h3>${t('lvoProbability')}</h3>\n          <span class=\"risk-module\">${t('limitedAssessment')}</span>\n        </div>\n      </div>\n      \n      <div class=\"not-possible-content\">\n        <p>${t('lvoNotPossible')}</p>\n        <p>${t('fullExamRequired')}</p>\n      </div>\n    </div>\n  `;\n}\n\nexport function renderResults(results, startTime) {\n  const { ich, lvo } = results;\n\n  // Determine current module\n  const currentModule = getCurrentModuleName(ich);\n\n  // Calculate legacy model for research comparison (only for stroke modules)\n  const legacyResults = currentModule !== 'coma' ? calculateLegacyFromResults(results) : null;\n\n  // Debug logging for research mode\n\n  // Log research data if research mode is enabled (background, non-breaking)\n  if (legacyResults && isResearchModeEnabled(currentModule)) {\n    safeLogResearchData(ich, legacyResults, getPatientInputs());\n  }\n\n  // Detect which module was used based on the data\n  const isLimitedOrComa = ich?.module === 'Limited' || ich?.module === 'Coma' || lvo?.notPossible === true;\n  const isFullModule = ich?.module === 'Full';\n\n  let resultsHtml;\n\n  // For limited/coma modules - only show ICH\n  if (isLimitedOrComa) {\n    resultsHtml = renderICHFocusedResults(ich, results, startTime, legacyResults, currentModule);\n  } else {\n    // For full module - show ICH prominently with conditional LVO text\n    resultsHtml = renderFullModuleResults(ich, lvo, results, startTime, legacyResults, currentModule);\n  }\n\n  // Initialize animations after DOM update\n  setTimeout(async () => {\n    initializeVolumeAnimations();\n    try {\n      const { mountIslands } = await import('../../react/mountIslands.jsx');\n      mountIslands();\n    } catch (err) {\n      console.warn('React islands not available:', err);\n    }\n  }, 100);\n\n  return resultsHtml;\n}\n\nfunction renderICHFocusedResults(ich, results, startTime, legacyResults, currentModule) {\n  const criticalAlert = ich && ich.probability > 0.6 ? renderCriticalAlert() : '';\n  const ichPercentLocal = Math.round((ich?.probability || 0) * 100);\n  const strokeCenterHtml = renderStrokeCenterMap(results);\n  const inputSummaryHtml = renderInputSummary();\n  const researchToggleHtml = isResearchModeEnabled(currentModule) ? renderResearchToggle() : '';\n  const researchComparisonHtml = (legacyResults && isResearchModeEnabled(currentModule))\n    ? renderModelComparison(ich, legacyResults, getPatientInputs()) : '';\n\n  // Add alternative diagnoses for coma module\n  const alternativeDiagnosesHtml = (ich?.module === 'Coma') ? renderComaAlternativeDiagnoses(ich.probability) : '';\n\n  // Add differential diagnoses for stroke modules (limited and full)\n  const strokeDifferentialHtml = (ich?.module !== 'Coma') ? renderStrokeDifferentialDiagnoses(ich.probability) : '';\n\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(3)}\n      <h2>${t('bleedingRiskAssessment') || 'Blutungsrisiko-Bewertung / Bleeding Risk Assessment'}</h2>\n      ${criticalAlert}\n      \n      <!-- Single ICH Risk Card -->\n      <div class=\"risk-results-single\">\n        ${renderRiskCard('ich', ich, results)}\n      </div>\n\n      ${ich?.module === 'Coma' && ichPercentLocal >= 50 ? `\n      <!-- ICH Volume Card (Coma only) -->\n      <div class=\"risk-results-single\">\n        ${renderVolumeCard(ich)}\n      </div>\n      ` : ''}\n      \n      <!-- Alternative Diagnoses for Coma Module -->\n      ${alternativeDiagnosesHtml}\n      \n      <!-- Differential Diagnoses for Stroke Modules -->\n      ${strokeDifferentialHtml}\n      \n      <!-- Research Model Comparison (hidden unless research mode) -->\n      ${researchComparisonHtml}\n      \n      <!-- ICH Drivers Only (not shown for Coma module) -->\n      ${ich?.module !== 'Coma' ? `\n        <div class=\"enhanced-drivers-section\">\n          <h3>${t('riskFactorsTitle') || 'Hauptrisikofaktoren / Main Risk Factors'}</h3>\n          ${renderICHDriversOnly(ich)}\n        </div>\n      ` : ''}\n      \n      <!-- Collapsible Additional Information -->\n      <div class=\"additional-info-section\">\n        <button class=\"info-toggle\" data-target=\"input-summary\">\n          <span class=\"toggle-icon\">📋</span>\n          <span class=\"toggle-text\">${t('inputSummaryTitle')}</span>\n          <span class=\"toggle-arrow\">▼</span>\n        </button>\n        <div class=\"collapsible-content\" id=\"input-summary\" style=\"display: none;\">\n          ${inputSummaryHtml}\n        </div>\n        \n        <button class=\"info-toggle\" data-target=\"stroke-centers\">\n          <span class=\"toggle-icon\">🏥</span>\n          <span class=\"toggle-text\">${t('nearestCentersTitle')}</span>\n          <span class=\"toggle-arrow\">▼</span>\n        </button>\n        <div class=\"collapsible-content\" id=\"stroke-centers\" style=\"display: none;\">\n          ${strokeCenterHtml}\n        </div>\n      </div>\n      \n      <div class=\"results-actions\">\n        <div class=\"primary-actions\">\n          <button type=\"button\" class=\"primary\" id=\"printResults\"> 📄 ${t('printResults')} </button>\n          <button type=\"button\" class=\"secondary\" data-action=\"reset\"> ${t('newAssessment')} </button>\n        </div>\n        <div class=\"navigation-actions\">\n          <button type=\"button\" class=\"tertiary\" data-action=\"goBack\"> ← ${t('goBack')} </button>\n          <button type=\"button\" class=\"tertiary\" data-action=\"goHome\"> 🏠 ${t('goHome')} </button>\n        </div>\n      </div>\n      \n      <div class=\"disclaimer\">\n        <strong>⚠️ ${t('importantNote')}:</strong> ${t('importantText')} Results generated at ${new Date().toLocaleTimeString()}.\n      </div>\n      \n      ${renderBibliography(ich)}\n      ${researchToggleHtml}\n    </div>\n  `;\n}\n\nfunction renderFullModuleResults(ich, lvo, results, startTime, legacyResults, currentModule) {\n  const ichPercent = Math.round((ich?.probability || 0) * 100);\n  const lvoPercent = Math.round((lvo?.probability || 0) * 100);\n\n  const criticalAlert = ich && ich.probability > 0.6 ? renderCriticalAlert() : '';\n  const strokeCenterHtml = renderStrokeCenterMap(results);\n  const inputSummaryHtml = renderInputSummary();\n  const researchToggleHtml = isResearchModeEnabled(currentModule) ? renderResearchToggle() : '';\n  const researchComparisonHtml = (legacyResults && isResearchModeEnabled(currentModule))\n    ? renderModelComparison(ich, legacyResults, getPatientInputs()) : '';\n\n  // Get FAST-ED score from form data to determine LVO display\n  const state = store.getState();\n  const fastEdScore = parseInt(state.formData?.full?.fast_ed_score) || 0;\n\n  // Ensure we only show LVO in full module and when LVO data is available\n  const isFullModule = currentModule === 'full' || ich?.module === 'Full';\n  const hasValidLVO = lvo && typeof lvo.probability === 'number' && !lvo.notPossible;\n  const showLVORiskCard = isFullModule && fastEdScore > 3 && hasValidLVO;\n\n  console.log('  Conditions: isFullModule:', isFullModule);\n  console.log('  Conditions: fastEdScore > 3:', fastEdScore > 3);\n  console.log('  Conditions: hasValidLVO:', hasValidLVO);\n  console.log('  Show LVO Card:', showLVORiskCard);\n\n  // Determine layout configuration\n  const showVolumeCard = ichPercent >= 50;\n  const maxProbability = Math.max(ichPercent, lvoPercent);\n  // Robust ratio for gating (avoid divide-by-zero)\n  const eps = 0.5;\n  const ratio = lvoPercent / Math.max(ichPercent, eps);\n  const inRatioBand = ratio >= 0.6 && ratio <= 1.7;\n  // Strong-signal gate: both ICH and LVO at least 50%, and ratio in an informative band\n  const showTachometer = isFullModule && ichPercent >= 50 && lvoPercent >= 50 && inRatioBand;\n  const showDominanceBanner = isFullModule && ichPercent >= 50 && lvoPercent >= 50 && !inRatioBand;\n  // DEBUG: Temporary relaxed conditions for testing\n  const debugShowTachometer = isFullModule && ichPercent >= 30 && lvoPercent >= 30;\n\n  // Calculate number of cards and layout class\n  let cardCount = 1; // Always have ICH\n  // No placeholder needed - only show LVO card when FAST-ED > 3\n  if (showLVORiskCard) {\n    cardCount++;\n  }\n  if (showVolumeCard) {\n    cardCount++;\n  }\n\n  const layoutClass = cardCount === 1 ? 'risk-results-single'\n    : cardCount === 2 ? 'risk-results-dual'\n      : 'risk-results-triple';\n\n  // Add differential diagnoses for stroke modules\n  const strokeDifferentialHtml = renderStrokeDifferentialDiagnoses(ich.probability);\n\n  return `\n    <div class=\"container\">\n      ${renderProgressIndicator(3)}\n      <h2>${t('resultsTitle')}</h2>\n      ${criticalAlert}\n      \n      <!-- Risk Assessment Display -->\n      <div class=\"${layoutClass}\">\n        ${renderRiskCard('ich', ich, results)}\n        ${showLVORiskCard ? renderRiskCard('lvo', lvo, results) : ''}\n        ${showVolumeCard ? renderVolumeCard(ich) : ''}\n      </div>\n      \n      <!-- Treatment Decision Gauge (when strong signal) -->\n      ${debugShowTachometer ? renderTachometerGauge(ichPercent, lvoPercent) : ''}\n      ${!debugShowTachometer && showDominanceBanner ? renderDominanceBanner(ichPercent, lvoPercent, ratio) : ''}\n      \n      <!-- Differential Diagnoses for Stroke Modules -->\n      ${strokeDifferentialHtml}\n      \n      <!-- Research Model Comparison (hidden unless research mode) -->\n      ${researchComparisonHtml}\n      \n      <!-- Risk Factor Drivers -->\n      <div class=\"enhanced-drivers-section\">\n        <h3>${t('riskFactorsTitle') || 'Risikofaktoren / Risk Factors'}</h3>\n        ${showLVORiskCard ? renderDriversSection(ich, lvo) : renderICHDriversOnly(ich)}\n      </div>\n      \n      <!-- Collapsible Additional Information -->\n      <div class=\"additional-info-section\">\n        <button class=\"info-toggle\" data-target=\"input-summary\">\n          <span class=\"toggle-icon\">📋</span>\n          <span class=\"toggle-text\">${t('inputSummaryTitle')}</span>\n          <span class=\"toggle-arrow\">▼</span>\n        </button>\n        <div class=\"collapsible-content\" id=\"input-summary\" style=\"display: none;\">\n          ${inputSummaryHtml}\n        </div>\n        \n        <button class=\"info-toggle\" data-target=\"stroke-centers\">\n          <span class=\"toggle-icon\">🏥</span>\n          <span class=\"toggle-text\">${t('nearestCentersTitle')}</span>\n          <span class=\"toggle-arrow\">▼</span>\n        </button>\n        <div class=\"collapsible-content\" id=\"stroke-centers\" style=\"display: none;\">\n          ${strokeCenterHtml}\n        </div>\n      </div>\n      \n      <div class=\"results-actions\">\n        <div class=\"primary-actions\">\n          <button type=\"button\" class=\"primary\" id=\"printResults\"> 📄 ${t('printResults')} </button>\n          <button type=\"button\" class=\"secondary\" data-action=\"reset\"> ${t('newAssessment')} </button>\n        </div>\n        <div class=\"navigation-actions\">\n          <button type=\"button\" class=\"tertiary\" data-action=\"goBack\"> ← ${t('goBack')} </button>\n          <button type=\"button\" class=\"tertiary\" data-action=\"goHome\"> 🏠 ${t('goHome')} </button>\n        </div>\n      </div>\n      \n      <div class=\"disclaimer\">\n        <strong>⚠️ ${t('importantNote')}:</strong> ${t('importantText')} Results generated at ${new Date().toLocaleTimeString()}.\n      </div>\n      \n      ${renderBibliography(ich)}\n      ${researchToggleHtml}\n    </div>\n  `;\n}\n\nfunction renderLVONotification() {\n  return `\n    <div class=\"secondary-notification\">\n      <p class=\"lvo-possible\">\n        ⚡ ${t('lvoMayBePossible') || 'Großgefäßverschluss möglich / Large vessel occlusion possible'}\n      </p>\n    </div>\n  `;\n}\n\nfunction renderDominanceBanner(ichPercent, lvoPercent, ratio) {\n  const dominant = ratio > 1 ? 'LVO' : 'ICH';\n  const icon = dominant === 'LVO' ? '🧠' : '🩸';\n  const dominantText = i18n.getCurrentLanguage() === 'de'\n    ? (dominant === 'LVO' ? 'LVO-dominant' : 'ICH-dominant')\n    : (dominant === 'LVO' ? 'LVO dominant' : 'ICH dominant');\n  const subtitle = i18n.getCurrentLanguage() === 'de'\n    ? `Verhältnis LVO/ICH: ${ratio.toFixed(2)}`\n    : `LVO/ICH ratio: ${ratio.toFixed(2)}`;\n  return `\n    <div class=\"tachometer-section\">\n      <div class=\"tachometer-card\">\n        <div class=\"treatment-recommendation ${dominant === 'LVO' ? 'lvo-dominant' : 'ich-dominant'}\">\n          <div class=\"recommendation-icon\">${icon}</div>\n          <div class=\"recommendation-text\">\n            <h4>${dominantText}</h4>\n            <p>${subtitle}</p>\n          </div>\n          <div class=\"probability-summary\">\n            ICH: ${ichPercent}% | LVO: ${lvoPercent}%\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderICHDriversOnly(ich) {\n  if (!ich || !ich.drivers) {\n    return '<p class=\"no-drivers\">No driver data available</p>';\n  }\n\n  // Drivers are already formatted from API with positive/negative arrays\n  const driversData = ich.drivers;\n\n  // Check if drivers have the correct structure\n  if (!driversData.positive && !driversData.negative) {\n    // Fallback for unexpected format\n    return '<p class=\"no-drivers\">Driver format error</p>';\n  }\n\n  const positiveDrivers = driversData.positive || [];\n  const negativeDrivers = driversData.negative || [];\n\n  return `\n    <div class=\"drivers-split-view\">\n      <div class=\"drivers-column positive-column\">\n        <div class=\"column-header\">\n          <span class=\"column-icon\">⬆</span>\n          <span class=\"column-title\">${t('increasingRisk') || 'Risikoerhöhend / Increasing Risk'}</span>\n        </div>\n        <div class=\"compact-drivers\">\n          ${positiveDrivers.length > 0\n    ? positiveDrivers.slice(0, 5).map((d) => renderCompactDriver(d, 'positive')).join('')\n    : `<p class=\"no-factors\">${t('noFactors') || 'Keine Faktoren / No factors'}</p>`\n}\n        </div>\n      </div>\n      \n      <div class=\"drivers-column negative-column\">\n        <div class=\"column-header\">\n          <span class=\"column-icon\">⬇</span>\n          <span class=\"column-title\">${t('decreasingRisk') || 'Risikomindernd / Decreasing Risk'}</span>\n        </div>\n        <div class=\"compact-drivers\">\n          ${negativeDrivers.length > 0\n    ? negativeDrivers.slice(0, 5).map((d) => renderCompactDriver(d, 'negative')).join('')\n    : `<p class=\"no-factors\">${t('noFactors') || 'Keine Faktoren / No factors'}</p>`\n}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderCompactDriver(driver, type) {\n  // Driver object has 'label' and 'weight' properties\n  const percentage = Math.abs(driver.weight * 100);\n  const width = Math.min(percentage * 2, 100); // Scale for display\n\n  return `\n    <div class=\"compact-driver-item\">\n      <div class=\"compact-driver-label\">${formatDriverName(driver.label)}</div>\n      <div class=\"compact-driver-bar ${type}\" style=\"width: ${width}%;\">\n        <span class=\"compact-driver-value\">${percentage.toFixed(1)}%</span>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render bibliography footer with research citations\n * @param {object} ichData - ICH risk data containing probability\n * @returns {string} HTML for bibliography section\n */\nfunction renderBibliography(ichData) {\n  // Only show bibliography if ICH risk is >= 50%\n  if (!ichData || !ichData.probability) {\n    return '';\n  }\n\n  const ichPercent = Math.round((ichData.probability || 0) * 100);\n  if (ichPercent < 50) {\n    return '';\n  }\n\n  const gfapValue = getCurrentGfapValue();\n  if (!gfapValue || gfapValue <= 0) {\n    return '';\n  }\n\n  return `\n    <div class=\"bibliography-section\">\n      <h4>${t('references')}</h4>\n      <div class=\"citations\">\n        <div class=\"citation\">\n          <span class=\"citation-number\">¹</span>\n          <span class=\"citation-text\">Broderick et al. (1993). Volume of intracerebral hemorrhage. A powerful and easy-to-use predictor of 30-day mortality. Stroke, 24(7), 987-993.</span>\n        </div>\n        <div class=\"citation\">\n          <span class=\"citation-number\">²</span>\n          <span class=\"citation-text\">Krishnan et al. (2013). Hematoma expansion in intracerebral hemorrhage: Predictors and outcomes. Neurology, 81(19), 1660-1666.</span>\n        </div>\n        <div class=\"citation\">\n          <span class=\"citation-number\">³</span>\n          <span class=\"citation-text\">Putra et al. (2020). Functional outcomes and mortality in patients with intracerebral hemorrhage. Critical Care Medicine, 48(3), 347-354.</span>\n        </div>\n        <div class=\"citation\">\n          <span class=\"citation-number\">⁴</span>\n          <span class=\"citation-text\">Tangella et al. (2020). Early prediction of mortality in intracerebral hemorrhage using clinical markers. Journal of Neurocritical Care, 13(2), 89-97.</span>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Calculate legacy model results from current results data (background, non-breaking)\n * @param {object} results - Main model results\n * @returns {object|null} - Legacy model results or null if not possible\n */\nfunction calculateLegacyFromResults(results) {\n  try {\n    const patientInputs = getPatientInputs();\n\n    if (!patientInputs.age || !patientInputs.gfap) {\n      console.warn('🔍 Missing required inputs for legacy model:', {\n        age: patientInputs.age,\n        gfap: patientInputs.gfap,\n      });\n      return null;\n    }\n\n    const legacyResult = calculateLegacyICH(patientInputs);\n\n    return legacyResult;\n  } catch (error) {\n    console.warn('Legacy model calculation failed (non-critical):', error);\n    return null;\n  }\n}\n\n/**\n * Get patient input data from store for research logging\n * @returns {object} - Patient input data\n */\nfunction getPatientInputs() {\n  const state = store.getState();\n  const { formData } = state;\n\n  // Extract age and GFAP from any module\n  let age = null;\n  let gfap = null;\n\n  for (const module of ['coma', 'limited', 'full']) {\n    if (formData[module]) {\n      age = age || formData[module].age_years;\n      gfap = gfap || formData[module].gfap_value;\n    }\n  }\n\n  const result = {\n    age: parseInt(age) || null,\n    gfap: parseFloat(gfap) || null,\n  };\n\n  return result;\n}\n\n/**\n * Render alternative diagnoses for coma module\n * @param {number} probability - ICH probability (0-1)\n * @returns {string} HTML for alternative diagnoses\n */\nfunction renderStrokeDifferentialDiagnoses(probability) {\n  const percent = Math.round(probability * 100);\n\n  if (percent > 25) {\n    return `\n      <div class=\"alternative-diagnosis-card\">\n        <div class=\"diagnosis-header\">\n          <span class=\"lightning-icon\">⚡</span>\n          <h3>${t('differentialDiagnoses')}</h3>\n        </div>\n        <div class=\"diagnosis-content\">\n          <!-- Time Window Confirmation - Clinical Action -->\n          <h4 class=\"clinical-action-heading\">${t('reconfirmTimeWindow')}</h4>\n          \n          <!-- Actual Differential Diagnoses -->\n          <ul class=\"diagnosis-list\">\n            <li>${t('unclearTimeWindow')}</li>\n            <li>${t('rareDiagnoses')}</li>\n          </ul>\n        </div>\n      </div>\n    `;\n  }\n\n  return '';\n}\n\nfunction renderComaAlternativeDiagnoses(probability) {\n  const percent = Math.round(probability * 100);\n  const isDE = i18n.getCurrentLanguage() === 'de';\n\n  if (percent > 25) {\n    // High probability - show SAB, SDH, EDH\n    return `\n      <div class=\"alternative-diagnosis-card\">\n        <div class=\"diagnosis-header\">\n          <span class=\"lightning-icon\">⚡</span>\n          <h3>${isDE ? 'Differentialdiagnosen' : 'Differential Diagnoses'}</h3>\n        </div>\n        <div class=\"diagnosis-content\">\n          <ul class=\"diagnosis-list\">\n            <li>\n              ${isDE\n    ? 'Alternative Diagnosen sind SAB, SDH, EDH (Subarachnoidalblutung, Subduralhämatom, Epiduralhämatom)'\n    : 'Alternative diagnoses include SAH, SDH, EDH (Subarachnoid Hemorrhage, Subdural Hematoma, Epidural Hematoma)'\n}\n            </li>\n            <li>\n              ${isDE\n    ? 'Bei unklarem Zeitfenster seit Symptombeginn oder im erweiterten Zeitfenster kommen auch ein demarkierter Infarkt oder hypoxischer Hirnschaden in Frage'\n    : 'In cases of unclear time window since symptom onset or extended time window, demarcated infarction or hypoxic brain injury should also be considered'\n}\n            </li>\n          </ul>\n        </div>\n      </div>\n    `;\n  }\n  // Low probability - other causes of altered consciousness\n  return `\n      <div class=\"alternative-diagnosis-card\">\n        <div class=\"diagnosis-header\">\n          <span class=\"lightning-icon\">⚡</span>\n          <h3>${isDE ? 'Differentialdiagnosen' : 'Differential Diagnoses'}</h3>\n        </div>\n        <div class=\"diagnosis-content\">\n          <ul class=\"diagnosis-list\">\n            <li>\n              ${isDE\n    ? 'Alternative Diagnose von Vigilanzminderung wahrscheinlich'\n    : 'Alternative diagnosis for reduced consciousness likely'\n}\n            </li>\n            <li>\n              ${isDE\n    ? 'Ein Verschluss der Arteria Basilaris ist nicht ausgeschlossen'\n    : 'Basilar artery occlusion cannot be excluded'\n}\n            </li>\n          </ul>\n        </div>\n      </div>\n    `;\n}\n\n/**\n * Get current module name from results\n * @param {object} ich - ICH results containing module information\n * @returns {string} - Module name ('coma', 'limited', 'full')\n */\nfunction getCurrentModuleName(ich) {\n  if (!ich?.module) {\n    return 'unknown';\n  }\n\n  const module = ich.module.toLowerCase();\n  if (module.includes('coma')) {\n    return 'coma';\n  }\n  if (module.includes('limited')) {\n    return 'limited';\n  }\n  if (module.includes('full')) {\n    return 'full';\n  }\n\n  return 'unknown';\n}\n\n/**\n * Render volume as a standalone risk card (for horizontal layout)\n * @param {object} ichData - ICH data containing volume information\n * @returns {string} HTML for volume risk card\n */\nfunction renderVolumeCard(ichData) {\n  const gfapValue = getCurrentGfapValue();\n  if (!gfapValue || gfapValue <= 0) {\n    return '';\n  }\n\n  const volumeData = calculateICHVolume(gfapValue);\n  const percent = Math.round((ichData?.probability || 0) * 100);\n\n  return `\n    <div class=\"enhanced-risk-card volume-card normal\">\n      <div class=\"risk-header\">\n        <div class=\"risk-icon\">🧮</div>\n        <div class=\"risk-title\">\n          <h3>${t('ichVolumeLabel')}</h3>\n        </div>\n      </div>\n      \n      <div class=\"risk-probability\">\n        <div class=\"circles-container\">\n          <div class=\"rings-row\">\n            <div class=\"circle-item\">\n              ${renderICHVolumeDisplay(ichData)}\n              <div class=\"circle-label\">${t('ichVolumeLabel')}</div>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"risk-assessment\">\n          <div class=\"mortality-assessment\">\n            ${t('predictedMortality')}: ${volumeData.mortalityRate}\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render tachometer gauge for treatment decision when high risk\n * @param {number} ichPercent - ICH probability percentage\n * @param {number} lvoPercent - LVO probability percentage\n * @returns {string} HTML for tachometer gauge\n */\nfunction renderTachometerGauge(ichPercent, lvoPercent) {\n  const ratio = lvoPercent / Math.max(ichPercent, 1);\n\n  return `\n    <div class=\"tachometer-section\">\n      <div class=\"tachometer-card\">\n        <div class=\"tachometer-header\">\n          <h3>🎯 ${i18n.getCurrentLanguage() === 'de' ? 'Entscheidungshilfe – LVO/ICH' : 'Decision Support – LVO/ICH'}</h3>\n          <div class=\"ratio-display\">LVO/ICH Ratio: ${ratio.toFixed(2)}</div>\n        </div>\n        \n        <div class=\"tachometer-gauge\" id=\"tachometer-canvas-container\">\n          <div data-react-tachometer data-ich=\"${ichPercent}\" data-lvo=\"${lvoPercent}\" data-title=\"${i18n.getCurrentLanguage() === 'de' ? 'Entscheidungshilfe – LVO/ICH' : 'Decision Support – LVO/ICH'}\"></div>\n        </div>\n\n        <!-- Legend chips for zones -->\n        <div class=\"tachometer-legend\" aria-hidden=\"true\">\n          <span class=\"legend-chip ich\">ICH</span>\n          <span class=\"legend-chip uncertain\">${i18n.getCurrentLanguage() === 'de' ? 'Unsicher' : 'Uncertain'}</span>\n          <span class=\"legend-chip lvo\">LVO</span>\n        </div>\n\n        <!-- Metrics row: ratio, confidence, absolute difference -->\n        <div class=\"metrics-row\" role=\"group\" aria-label=\"Tachometer metrics\">\n          <div class=\"metric-card\">\n            <div class=\"metric-label\">Ratio</div>\n            <div class=\"metric-value\">${ratio.toFixed(2)}</div>\n            <div class=\"metric-unit\">LVO/ICH</div>\n          </div>\n          <div class=\"metric-card\">\n            <div class=\"metric-label\">Confidence</div>\n            <div class=\"metric-value\">${(() => {\n    const diff = Math.abs(lvoPercent - ichPercent);\n    const maxP = Math.max(lvoPercent, ichPercent);\n    let c = diff < 10 ? Math.round(30 + maxP * 0.3) : diff < 20 ? Math.round(50 + maxP * 0.4) : Math.round(70 + maxP * 0.3);\n    c = Math.max(0, Math.min(100, c));\n    return c;\n  })()}%</div>\n            <div class=\"metric-unit\">percent</div>\n          </div>\n          <div class=\"metric-card\">\n            <div class=\"metric-label\">Difference</div>\n            <div class=\"metric-value\">${Math.abs(lvoPercent - ichPercent).toFixed(0)}%</div>\n            <div class=\"metric-unit\">|LVO − ICH|</div>\n          </div>\n        </div>\n        \n        <div class=\"probability-summary\">\n          ICH: ${ichPercent}% | LVO: ${lvoPercent}%\n        </div>\n        \n        <!-- Hidden probability summary for initialization -->\n        <div class=\"probability-summary\" style=\"display: none;\">\n          ICH: ${ichPercent}% | LVO: ${lvoPercent}%\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n// Premium (vanilla) tachometer disabled in favor of React island gauge\n","/**\n * Login Screen for Research Preview Access\n * iGFAP Stroke Triage Assistant\n */\n\nimport { t } from '../../localization/i18n.js';\nimport { authManager } from '../../auth/authentication.js';\nimport { store } from '../../state/store.js';\n\nexport function renderLoginScreen() {\n  return `\n    <div class=\"login-container\">\n      <div class=\"login-card\">\n        <div class=\"login-header\">\n          <div class=\"app-logo\">\n            <div class=\"logo-icon\">🧠</div>\n            <h1>iGFAP Stroke Triage</h1>\n            <div class=\"version-badge\">Research Preview v2.1</div>\n          </div>\n        </div>\n\n        <div class=\"login-content\">\n          <div class=\"access-notice\">\n            <h2>🔬 Research Access Required</h2>\n            <p>This is a research preview of the iGFAP Stroke Triage Assistant for clinical validation.</p>\n\n            <div class=\"research-disclaimer\">\n              <h3>⚠️ Important Notice</h3>\n              <ul>\n                <li><strong>Research Use Only</strong> - Not for clinical decision making</li>\n                <li><strong>No Patient Data Storage</strong> - All data processed locally</li>\n                <li><strong>Clinical Advisory</strong> - Under supervision of Prof. Christian Förch & Dr. Lovepreet Kalra</li>\n                <li><strong>Contact:</strong> Deepak Bos (bosdeepak@gmail.com)</li>\n              </ul>\n            </div>\n          </div>\n\n          <form id=\"loginForm\" class=\"login-form\">\n            <div class=\"form-group\">\n              <label for=\"researchPassword\">Research Access Code</label>\n              <input\n                type=\"password\"\n                id=\"researchPassword\"\n                name=\"password\"\n                required\n                autocomplete=\"off\"\n                placeholder=\"Enter research access code\"\n                class=\"password-input\"\n              >\n            </div>\n\n            <div id=\"loginError\" class=\"error-message\" style=\"display: none;\"></div>\n\n            <button type=\"submit\" class=\"login-button primary\">\n              <span class=\"button-text\">Access Research System</span>\n              <span class=\"loading-spinner\" style=\"display: none;\">⏳</span>\n            </button>\n          </form>\n\n          <div class=\"login-footer\">\n            <div class=\"regulatory-notice\">\n              <p><strong>Regulatory Status:</strong> Research prototype - CE certification pending</p>\n              <p><strong>Data Protection:</strong> GDPR compliant - local processing only</p>\n              <p><strong>Clinical Oversight:</strong> RKH Klinikum Ludwigsburg, Neurologie</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nexport function initializeLoginScreen() {\n  const loginForm = document.getElementById('loginForm');\n  const passwordInput = document.getElementById('researchPassword');\n  const loginError = document.getElementById('loginError');\n  const loginButton = loginForm.querySelector('.login-button');\n\n  if (!loginForm) {\n    return;\n  }\n\n  // Focus password input on load\n  passwordInput.focus();\n\n  loginForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n\n    const password = passwordInput.value.trim();\n\n    if (!password) {\n      showLoginError('Please enter the research access code');\n      return;\n    }\n\n    // Show loading state\n    setLoginLoading(true);\n    hideLoginError();\n\n    try {\n      const hashedInput = await authManager.hashPassword(password);\n      const isAuthenticated = await authManager.authenticate(hashedInput);\n\n      if (isAuthenticated) {\n        // Log successful authentication\n        store.logEvent('auth_success', {\n          timestamp: new Date().toISOString(),\n          userAgent: navigator.userAgent.substring(0, 100), // Limited info\n        });\n\n        // Navigate to main application\n        store.navigate('triage1');\n      } else {\n        showLoginError('Invalid access code. Please contact Deepak Bos for research access.');\n        passwordInput.value = '';\n        passwordInput.focus();\n\n        // Log failed attempt (no sensitive data)\n        store.logEvent('auth_failed', {\n          timestamp: new Date().toISOString(),\n        });\n      }\n    } catch (error) {\n      showLoginError('Authentication system error. Please try again.');\n      console.error('Authentication error:', error);\n    } finally {\n      setLoginLoading(false);\n    }\n  });\n\n  // Hide error on input\n  passwordInput.addEventListener('input', () => {\n    hideLoginError();\n  });\n\n  function showLoginError(message) {\n    loginError.textContent = message;\n    loginError.style.display = 'block';\n    passwordInput.classList.add('error');\n  }\n\n  function hideLoginError() {\n    loginError.style.display = 'none';\n    passwordInput.classList.remove('error');\n  }\n\n  function setLoginLoading(isLoading) {\n    const buttonText = loginButton.querySelector('.button-text');\n    const loadingSpinner = loginButton.querySelector('.loading-spinner');\n\n    if (isLoading) {\n      buttonText.style.display = 'none';\n      loadingSpinner.style.display = 'inline';\n      loginButton.disabled = true;\n    } else {\n      buttonText.style.display = 'inline';\n      loadingSpinner.style.display = 'none';\n      loginButton.disabled = false;\n    }\n  }\n}\n","/**\n * Accessibility utilities for the Stroke Triage Assistant\n */\n\nexport function announceScreenChange(screen) {\n  const announcement = document.createElement('div');\n  announcement.className = 'sr-only';\n  announcement.setAttribute('role', 'status');\n  announcement.setAttribute('aria-live', 'polite');\n\n  const screenNames = {\n    triage1: 'Coma assessment',\n    triage2: 'Examination capability assessment',\n    coma: 'Coma module',\n    limited: 'Limited data module',\n    full: 'Full stroke assessment',\n    results: 'Assessment results',\n  };\n\n  announcement.textContent = `Navigated to ${screenNames[screen] || screen}`;\n  document.body.appendChild(announcement);\n\n  setTimeout(() => announcement.remove(), 1000);\n}\n\nexport function setPageTitle(screen) {\n  const appName = 'iGFAP';\n  const titles = {\n    triage1: 'Initial Assessment',\n    triage2: 'Examination Capability',\n    coma: 'Coma Module',\n    limited: 'Limited Data Module',\n    full: 'Full Stroke Module',\n    results: 'Assessment Results',\n  };\n\n  const section = titles[screen];\n  // Brand-first to ensure the tab shows iGFAP even when truncated\n  document.title = section ? `${appName} — ${section}` : appName;\n}\n\nexport function focusMainHeading() {\n  // Focus on the main heading for screen readers\n  setTimeout(() => {\n    const heading = document.querySelector('h2');\n    if (heading) {\n      heading.setAttribute('tabindex', '-1');\n      heading.focus();\n      // Remove tabindex after focus for proper tab order\n      setTimeout(() => heading.removeAttribute('tabindex'), 100);\n    }\n  }, 100);\n}\n","import { t } from '../../localization/i18n.js';\n\nexport class FastEdCalculator {\n  constructor() {\n    this.scores = {\n      facial_palsy: 0,\n      arm_weakness: 0,\n      speech_changes: 0,\n      eye_deviation: 0,\n      denial_neglect: 0,\n    };\n    this.onApply = null;\n    this.modal = null;\n  }\n\n  getTotal() {\n    return Object.values(this.scores).reduce((sum, score) => sum + score, 0);\n  }\n\n  getRiskLevel() {\n    const total = this.getTotal();\n    return total >= 4 ? 'high' : 'low';\n  }\n\n  render() {\n    const total = this.getTotal();\n    const riskLevel = this.getRiskLevel();\n\n    return `\n      <div id=\"fastEdModal\" class=\"modal\" role=\"dialog\" aria-labelledby=\"fastEdModalTitle\" aria-hidden=\"true\" style=\"display: none !important;\">\n        <div class=\"modal-content fast-ed-modal\">\n          <div class=\"modal-header\">\n            <h2 id=\"fastEdModalTitle\">${t('fastEdCalculatorTitle')}</h2>\n            <button class=\"modal-close\" aria-label=\"Close\">&times;</button>\n          </div>\n          <div class=\"modal-body\">\n            \n            <!-- Facial Palsy -->\n            <div class=\"fast-ed-component\">\n              <h3>${t('facialPalsyTitle')}</h3>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"facial_palsy\" value=\"0\" ${this.scores.facial_palsy === 0 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('facialPalsyNormal')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"facial_palsy\" value=\"1\" ${this.scores.facial_palsy === 1 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('facialPalsyMild')}</span>\n                </label>\n              </div>\n            </div>\n\n            <!-- Arm Weakness -->\n            <div class=\"fast-ed-component\">\n              <h3>${t('armWeaknessTitle')}</h3>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"arm_weakness\" value=\"0\" ${this.scores.arm_weakness === 0 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('armWeaknessNormal')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"arm_weakness\" value=\"1\" ${this.scores.arm_weakness === 1 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('armWeaknessMild')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"arm_weakness\" value=\"2\" ${this.scores.arm_weakness === 2 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('armWeaknessSevere')}</span>\n                </label>\n              </div>\n            </div>\n\n            <!-- Speech Changes -->\n            <div class=\"fast-ed-component\">\n              <h3>${t('speechChangesTitle')}</h3>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"speech_changes\" value=\"0\" ${this.scores.speech_changes === 0 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('speechChangesNormal')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"speech_changes\" value=\"1\" ${this.scores.speech_changes === 1 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('speechChangesMild')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"speech_changes\" value=\"2\" ${this.scores.speech_changes === 2 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('speechChangesSevere')}</span>\n                </label>\n              </div>\n            </div>\n\n            <!-- Eye Deviation -->\n            <div class=\"fast-ed-component\">\n              <h3>${t('eyeDeviationTitle')}</h3>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"eye_deviation\" value=\"0\" ${this.scores.eye_deviation === 0 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('eyeDeviationNormal')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"eye_deviation\" value=\"1\" ${this.scores.eye_deviation === 1 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('eyeDeviationPartial')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"eye_deviation\" value=\"2\" ${this.scores.eye_deviation === 2 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('eyeDeviationForced')}</span>\n                </label>\n              </div>\n            </div>\n\n            <!-- Denial/Neglect -->\n            <div class=\"fast-ed-component\">\n              <h3>${t('denialNeglectTitle')}</h3>\n              <div class=\"radio-group\">\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"denial_neglect\" value=\"0\" ${this.scores.denial_neglect === 0 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('denialNeglectNormal')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"denial_neglect\" value=\"1\" ${this.scores.denial_neglect === 1 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('denialNeglectPartial')}</span>\n                </label>\n                <label class=\"radio-option\">\n                  <input type=\"radio\" name=\"denial_neglect\" value=\"2\" ${this.scores.denial_neglect === 2 ? 'checked' : ''}>\n                  <span class=\"radio-label\">${t('denialNeglectComplete')}</span>\n                </label>\n              </div>\n            </div>\n\n            <!-- Total Score Display -->\n            <div class=\"fast-ed-total\">\n              <div class=\"score-display\">\n                <h3>${t('totalScoreTitle')}: <span class=\"total-score\">${total}/9</span></h3>\n                <div class=\"risk-indicator ${riskLevel}\">\n                  ${t('riskLevel')}: ${riskLevel === 'high' ? t('riskLevelHigh') : t('riskLevelLow')}\n                </div>\n              </div>\n            </div>\n\n          </div>\n          <div class=\"modal-footer\">\n            <div class=\"button-group\">\n              <button class=\"secondary\" data-action=\"cancel-fast-ed\">${t('cancel')}</button>\n              <button class=\"primary\" data-action=\"apply-fast-ed\">${t('applyScore')}</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  setupEventListeners() {\n    this.modal = document.getElementById('fastEdModal');\n    if (!this.modal) {\n      return;\n    }\n\n    // Radio button changes\n    this.modal.addEventListener('change', (e) => {\n      if (e.target.type === 'radio') {\n        const component = e.target.name;\n        const value = parseInt(e.target.value);\n        this.scores[component] = value;\n        this.updateDisplay();\n      }\n    });\n\n    // Close button\n    const closeBtn = this.modal.querySelector('.modal-close');\n    closeBtn?.addEventListener('click', () => this.close());\n\n    // Cancel button\n    const cancelBtn = this.modal.querySelector('[data-action=\"cancel-fast-ed\"]');\n    cancelBtn?.addEventListener('click', () => this.close());\n\n    // Apply button\n    const applyBtn = this.modal.querySelector('[data-action=\"apply-fast-ed\"]');\n    applyBtn?.addEventListener('click', () => this.apply());\n\n    // Disable backdrop click-to-close to prevent accidental dismissal\n    // Users must explicitly Cancel or Apply\n    this.modal.addEventListener('click', (e) => {\n      if (e.target === this.modal) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    });\n\n    // Keyboard navigation\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && this.modal?.classList.contains('show')) {\n        this.close();\n      }\n    });\n  }\n\n  updateDisplay() {\n    const totalElement = this.modal?.querySelector('.total-score');\n    const riskElement = this.modal?.querySelector('.risk-indicator');\n\n    if (totalElement) {\n      totalElement.textContent = `${this.getTotal()}/9`;\n    }\n\n    if (riskElement) {\n      const riskLevel = this.getRiskLevel();\n      riskElement.className = `risk-indicator ${riskLevel}`;\n      riskElement.textContent = `${t('riskLevel')}: ${riskLevel === 'high' ? t('riskLevelHigh') : t('riskLevelLow')}`;\n    }\n  }\n\n  show(currentScore = 0, onApplyCallback = null) {\n    this.onApply = onApplyCallback;\n\n    // If we have a current score, try to reverse engineer it (basic approximation)\n    if (currentScore > 0 && currentScore <= 9) {\n      this.approximateFromTotal(currentScore);\n    }\n\n    // Inject modal HTML if not already present\n    if (!document.getElementById('fastEdModal')) {\n      document.body.insertAdjacentHTML('beforeend', this.render());\n    } else {\n      // Re-render the modal with current state\n      this.modal.remove();\n      document.body.insertAdjacentHTML('beforeend', this.render());\n      this.modal = document.getElementById('fastEdModal');\n    }\n\n    this.setupEventListeners();\n\n    this.modal.setAttribute('aria-hidden', 'false');\n    this.modal.style.display = 'flex';\n    this.modal.classList.add('show');\n\n    // Focus first radio button\n    const firstRadio = this.modal.querySelector('input[type=\"radio\"]');\n    firstRadio?.focus();\n  }\n\n  close() {\n    if (this.modal) {\n      this.modal.classList.remove('show');\n      this.modal.style.display = 'none';\n      this.modal.setAttribute('aria-hidden', 'true');\n    }\n  }\n\n  apply() {\n    const total = this.getTotal();\n    const armWeaknessBoolean = this.scores.arm_weakness > 0;\n    const eyeDeviationBoolean = this.scores.eye_deviation > 0;\n\n    if (this.onApply) {\n      this.onApply({\n        total,\n        components: { ...this.scores },\n        armWeaknessBoolean,\n        eyeDeviationBoolean,\n      });\n    }\n\n    this.close();\n  }\n\n  approximateFromTotal(total) {\n    // Simple approximation - distribute points across components\n    // This is basic but gives users a starting point\n    this.scores = {\n      facial_palsy: 0,\n      arm_weakness: 0,\n      speech_changes: 0,\n      eye_deviation: 0,\n      denial_neglect: 0,\n    };\n\n    let remaining = total;\n    const components = Object.keys(this.scores);\n\n    for (const component of components) {\n      if (remaining <= 0) {\n        break;\n      }\n\n      const maxForComponent = (component === 'facial_palsy') ? 1 : 2;\n      const assignToThis = Math.min(remaining, maxForComponent);\n      this.scores[component] = assignToThis;\n      remaining -= assignToThis;\n    }\n  }\n}\n\n// Create singleton instance\nexport const fastEdCalculator = new FastEdCalculator();\n","import { store } from '../state/store.js';\nimport {\n  handleTriage1, handleTriage2, handleSubmit, reset, goBack, goHome,\n} from '../logic/handlers.js';\nimport { clearValidationErrors, clearAllValidation } from '../logic/validate.js';\nimport { initializeResearchMode } from '../research/comparison-ui.js';\nimport { authManager } from '../auth/authentication.js';\n\nimport { renderTriage1 } from './screens/triage1.js';\nimport { renderTriage2 } from './screens/triage2.js';\nimport { renderComa } from './screens/coma.js';\nimport { renderLimited } from './screens/limited.js';\nimport { renderFull } from './screens/full.js';\nimport { renderResults } from './screens/results.js';\nimport { renderLoginScreen, initializeLoginScreen } from './screens/login.js';\nimport { announceScreenChange, setPageTitle, focusMainHeading } from './a11y.js';\nimport { initializeStrokeCenterMap } from './components/stroke-center-map.js';\nimport { fastEdCalculator } from './components/fastEdModal.js';\n\nexport function render(container) {\n  const state = store.getState();\n  const {\n    currentScreen, results, startTime, navigationHistory,\n  } = state;\n\n  // Optimize DOM updates to prevent CLS\n  const tempContainer = document.createElement('div');\n\n  // Show/hide back button based on navigation history\n  const backButton = document.getElementById('backButton');\n  if (backButton) {\n    backButton.style.display = navigationHistory && navigationHistory.length > 0 ? 'flex' : 'none';\n  }\n\n  // Render the appropriate screen\n  let html = '';\n  switch (currentScreen) {\n    case 'login':\n      html = renderLoginScreen();\n      break;\n    case 'triage1':\n      // Verify authentication for all clinical screens\n      if (!authManager.isValidSession()) {\n        store.navigate('login');\n        return;\n      }\n      html = renderTriage1();\n      break;\n    case 'triage2':\n      html = renderTriage2();\n      break;\n    case 'coma':\n      html = renderComa();\n      break;\n    case 'limited':\n      html = renderLimited();\n      break;\n    case 'full':\n      html = renderFull();\n      break;\n    case 'results':\n      html = renderResults(results, startTime);\n      break;\n    default:\n      html = renderTriage1();\n  }\n\n  // Use batch DOM update to minimize reflows\n  tempContainer.innerHTML = html;\n\n  // Single DOM replacement to minimize CLS\n  container.innerHTML = '';\n  while (tempContainer.firstChild) {\n    container.appendChild(tempContainer.firstChild);\n  }\n\n  // Restore form data if available\n  const form = container.querySelector('form[data-module]');\n  if (form) {\n    const { module } = form.dataset;\n    restoreFormData(form, module);\n  }\n\n  // Attach event listeners\n  attachEvents(container);\n\n  // Initialize login screen if needed\n  if (currentScreen === 'login') {\n    setTimeout(() => {\n      initializeLoginScreen();\n    }, 100);\n  }\n\n  // Initialize stroke center map if on results screen\n  if (currentScreen === 'results' && results) {\n    setTimeout(() => {\n      initializeStrokeCenterMap(results);\n    }, 100);\n  }\n\n  // Initialize research mode components (non-breaking)\n  setTimeout(() => {\n    initializeResearchMode();\n  }, 150);\n\n  // Accessibility updates\n  announceScreenChange(currentScreen);\n  setPageTitle(currentScreen);\n  focusMainHeading();\n}\n\nfunction restoreFormData(form, module) {\n  const formData = store.getFormData(module);\n  if (!formData || Object.keys(formData).length === 0) {\n    return;\n  }\n\n  Object.entries(formData).forEach(([key, value]) => {\n    const input = form.elements[key];\n    if (input) {\n      if (input.type === 'checkbox') {\n        input.checked = value === true || value === 'on' || value === 'true';\n      } else {\n        input.value = value;\n      }\n    }\n  });\n}\n\nfunction attachEvents(container) {\n  // Clear validation errors when user starts typing in a field\n  container.querySelectorAll('input[type=\"number\"]').forEach((input) => {\n    input.addEventListener('input', () => {\n      // Only clear errors for the specific field being edited\n      const group = input.closest('.input-group');\n      if (group && group.classList.contains('error')) {\n        group.classList.remove('error');\n        group.querySelectorAll('.error-message').forEach((el) => el.remove());\n      }\n    });\n  });\n\n  // Triage button handlers\n  container.querySelectorAll('[data-action]').forEach((button) => {\n    button.addEventListener('click', (e) => {\n      const { action, value } = e.currentTarget.dataset;\n      const boolVal = value === 'true';\n\n      switch (action) {\n        case 'triage1':\n          handleTriage1(boolVal);\n          break;\n        case 'triage2':\n          handleTriage2(boolVal);\n          break;\n        case 'reset':\n          reset();\n          break;\n        case 'goBack':\n          goBack();\n          break;\n        case 'goHome':\n          goHome();\n          break;\n      }\n    });\n  });\n\n  // Form submission handlers\n  container.querySelectorAll('form[data-module]').forEach((form) => {\n    form.addEventListener('submit', (e) => {\n      handleSubmit(e, container);\n    });\n  });\n\n  // Print button handler\n  const printButton = container.querySelector('#printResults');\n  if (printButton) {\n    printButton.addEventListener('click', () => window.print());\n  }\n\n  // FAST-ED calculator handler\n  const fastEdInput = container.querySelector('#fast_ed_score');\n  if (fastEdInput) {\n    fastEdInput.addEventListener('click', (e) => {\n      e.preventDefault();\n      const currentValue = parseInt(fastEdInput.value) || 0;\n\n      fastEdCalculator.show(currentValue, (result) => {\n        // Update FAST-ED score\n        fastEdInput.value = result.total;\n\n        // Update hidden arm weakness field\n        const armPareseField = container.querySelector('#armparese_hidden');\n        if (armPareseField) {\n          armPareseField.value = result.armWeaknessBoolean ? 'true' : 'false';\n        }\n\n        // Update eye deviation hidden field if exists\n        const eyeDeviationField = container.querySelector('#eye_deviation_hidden');\n        if (eyeDeviationField) {\n          eyeDeviationField.value = result.eyeDeviationBoolean ? 'true' : 'false';\n        }\n\n        // Trigger change event to save form data\n        fastEdInput.dispatchEvent(new Event('change', { bubbles: true }));\n      });\n    });\n\n    // Prevent manual typing\n    fastEdInput.addEventListener('keydown', (e) => {\n      e.preventDefault();\n    });\n  }\n\n  // Collapsible info toggles handler\n  const infoToggles = container.querySelectorAll('.info-toggle');\n  infoToggles.forEach((toggle) => {\n    toggle.addEventListener('click', (e) => {\n      const targetId = toggle.dataset.target;\n      const targetContent = container.querySelector(`#${targetId}`);\n      const arrow = toggle.querySelector('.toggle-arrow');\n\n      if (targetContent) {\n        const isVisible = targetContent.style.display !== 'none';\n\n        if (isVisible) {\n          // Hide content\n          targetContent.style.display = 'none';\n          targetContent.classList.remove('show');\n          toggle.classList.remove('active');\n          arrow.style.transform = 'rotate(0deg)';\n        } else {\n          // Show content\n          targetContent.style.display = 'block';\n          targetContent.classList.add('show');\n          toggle.classList.add('active');\n          arrow.style.transform = 'rotate(180deg)';\n        }\n      }\n    });\n  });\n}\n","import { store } from './state/store.js';\nimport { render } from './ui/render.js';\nimport { APP_CONFIG } from './config.js';\nimport { i18n, t } from './localization/i18n.js';\nimport { warmUpFunctions } from './api/client.js';\nimport { setResearchMode, isResearchModeEnabled } from './research/data-logger.js';\nimport { authManager } from './auth/authentication.js';\n\nclass App {\n  constructor() {\n    this.container = null;\n    this.unsubscribe = null;\n  }\n\n  async init() {\n    // Wait for DOM to be ready\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this.init());\n      return;\n    }\n\n    this.container = document.getElementById('appContainer');\n    if (!this.container) {\n      console.error('App container not found');\n      return;\n    }\n\n    // Check authentication before proceeding\n    if (!authManager.isValidSession()) {\n      store.navigate('login');\n    }\n\n    // Subscribe to store changes\n    this.unsubscribe = store.subscribe(() => {\n      render(this.container);\n      // Update research button visibility after each render\n      setTimeout(() => this.initializeResearchMode(), 200);\n    });\n\n    // Subscribe to language changes\n    window.addEventListener('languageChanged', () => {\n      this.updateUILanguage();\n      render(this.container);\n    });\n\n    // Setup global event listeners\n    this.setupGlobalEventListeners();\n\n    // Initialize theme\n    this.initializeTheme();\n\n    // Initialize research mode\n    this.initializeResearchMode();\n\n    // Initialize language\n    this.updateUILanguage();\n\n    // Start auto-save\n    this.startAutoSave();\n\n    // Setup session timeout\n    this.setupSessionTimeout();\n\n    // Set current year in footer\n    this.setCurrentYear();\n\n    // Warm up Cloud Functions in background\n    warmUpFunctions();\n\n    // Initial render\n    render(this.container);\n  }\n\n  setupGlobalEventListeners() {\n    // Navigation buttons\n    const backButton = document.getElementById('backButton');\n    if (backButton) {\n      backButton.addEventListener('click', () => {\n        store.goBack();\n        render(this.container);\n      });\n    }\n\n    const homeButton = document.getElementById('homeButton');\n    if (homeButton) {\n      homeButton.addEventListener('click', () => {\n        store.navigate('welcome');\n        render(this.container);\n      });\n    }\n\n    // Language toggle\n    const languageToggle = document.getElementById('languageToggle');\n    if (languageToggle) {\n      languageToggle.addEventListener('click', (e) => {\n        const currentLang = e.currentTarget.dataset.lang || 'en';\n        const newLang = currentLang === 'en' ? 'de' : 'en';\n        i18n.setLanguage(newLang);\n        e.currentTarget.dataset.lang = newLang;\n        e.currentTarget.textContent = newLang === 'en' ? '🇬🇧' : '🇩🇪';\n      });\n    }\n\n    // Dark mode toggle\n    const darkModeToggle = document.getElementById('darkModeToggle');\n    if (darkModeToggle) {\n      darkModeToggle.addEventListener('click', () => this.toggleDarkMode());\n    }\n\n    // Help modal\n    this.setupHelpModal();\n\n    // Footer links\n    this.setupFooterLinks();\n\n    // Research mode toggle\n    const researchToggle = document.getElementById('researchModeToggle');\n    if (researchToggle) {\n      researchToggle.addEventListener('click', () => {\n        const newState = !isResearchModeEnabled();\n        setResearchMode(newState);\n        researchToggle.classList.toggle('active', newState);\n\n        // Re-render if on results screen\n        const state = store.getState();\n        if (state.currentScreen === 'results') {\n          render(this.container);\n        }\n      });\n    }\n\n    // Prevent double-tap zoom on mobile\n    let lastTouchEnd = 0;\n    document.addEventListener('touchend', (e) => {\n      const now = Date.now();\n      if (now - lastTouchEnd <= 300) {\n        e.preventDefault();\n      }\n      lastTouchEnd = now;\n    }, { passive: false });\n\n    // Handle viewport resize\n    this.handleViewportResize();\n  }\n\n  handleViewportResize() {\n    let resizeTimer;\n    const handleResize = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        // Update CSS variable for viewport height (handles mobile browser UI)\n        const vh = window.innerHeight * 0.01;\n        document.documentElement.style.setProperty('--vh', `${vh}px`);\n      }, 100);\n    };\n\n    window.addEventListener('resize', handleResize);\n    window.addEventListener('orientationchange', handleResize);\n    handleResize(); // Initial call\n  }\n\n  setupHelpModal() {\n    const helpButton = document.getElementById('helpButton');\n    const helpModal = document.getElementById('helpModal');\n    const modalClose = helpModal?.querySelector('.modal-close');\n\n    if (helpButton && helpModal) {\n      helpButton.addEventListener('click', () => {\n        helpModal.style.display = 'flex';\n        helpModal.setAttribute('aria-hidden', 'false');\n      });\n\n      modalClose?.addEventListener('click', () => {\n        helpModal.style.display = 'none';\n        helpModal.setAttribute('aria-hidden', 'true');\n      });\n\n      // Close on outside click\n      helpModal.addEventListener('click', (e) => {\n        if (e.target === helpModal) {\n          helpModal.style.display = 'none';\n          helpModal.setAttribute('aria-hidden', 'true');\n        }\n      });\n\n      // Close on Escape key\n      document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape' && helpModal.style.display === 'flex') {\n          helpModal.style.display = 'none';\n          helpModal.setAttribute('aria-hidden', 'true');\n        }\n      });\n    }\n  }\n\n  setupFooterLinks() {\n    const privacyLink = document.getElementById('privacyLink');\n    const disclaimerLink = document.getElementById('disclaimerLink');\n    const versionLink = document.getElementById('versionLink');\n\n    privacyLink?.addEventListener('click', (e) => {\n      e.preventDefault();\n      alert('Privacy Policy: This application stores data locally on your device. No personal information is transmitted to external servers without explicit consent.');\n    });\n\n    disclaimerLink?.addEventListener('click', (e) => {\n      e.preventDefault();\n      alert('Medical Disclaimer: This tool is for clinical decision support only. Always use clinical judgment and follow local protocols. Not a replacement for physician assessment.');\n    });\n\n    versionLink?.addEventListener('click', (e) => {\n      e.preventDefault();\n      alert(`Version: ${APP_CONFIG.VERSION}\\nBuild: ${APP_CONFIG.BUILD_DATE}\\nEnvironment: ${APP_CONFIG.ENVIRONMENT}`);\n    });\n  }\n\n  initializeTheme() {\n    const savedTheme = localStorage.getItem('theme') || 'light';\n    document.body.dataset.theme = savedTheme;\n\n    const darkModeToggle = document.getElementById('darkModeToggle');\n    if (darkModeToggle) {\n      darkModeToggle.textContent = savedTheme === 'dark' ? '☀️' : '🌙';\n      darkModeToggle.setAttribute(\n        'aria-label',\n        savedTheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode',\n      );\n    }\n  }\n\n  toggleDarkMode() {\n    const currentTheme = document.body.dataset.theme || 'light';\n    const newTheme = currentTheme === 'light' ? 'dark' : 'light';\n\n    document.body.dataset.theme = newTheme;\n    localStorage.setItem('theme', newTheme);\n\n    const darkModeToggle = document.getElementById('darkModeToggle');\n    if (darkModeToggle) {\n      darkModeToggle.textContent = newTheme === 'dark' ? '☀️' : '🌙';\n      darkModeToggle.setAttribute(\n        'aria-label',\n        newTheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode',\n      );\n    }\n  }\n\n  initializeResearchMode() {\n    const researchToggle = document.getElementById('researchModeToggle');\n    if (researchToggle) {\n      const isEnabled = isResearchModeEnabled();\n      researchToggle.classList.toggle('active', isEnabled);\n\n      // Show/hide based on current screen\n      const state = store.getState();\n      if (state.currentScreen === 'results' || state.currentScreen === 'comparison') {\n        researchToggle.style.display = 'block';\n      } else {\n        researchToggle.style.display = 'none';\n      }\n    }\n  }\n\n  updateUILanguage() {\n    // Update help modal content\n    const modalTitle = document.getElementById('modalTitle');\n    if (modalTitle) {\n      modalTitle.textContent = t('help.title');\n    }\n\n    // Update any other static UI elements that need translation\n    const backButton = document.getElementById('backButton');\n    if (backButton) {\n      backButton.setAttribute('aria-label', t('navigation.back'));\n      backButton.setAttribute('title', t('navigation.back'));\n    }\n\n    const homeButton = document.getElementById('homeButton');\n    if (homeButton) {\n      homeButton.setAttribute('aria-label', t('navigation.home'));\n      homeButton.setAttribute('title', t('navigation.home'));\n    }\n  }\n\n  startAutoSave() {\n    // Auto-save state every 30 seconds if there are changes\n    setInterval(() => {\n      const state = store.getState();\n      if (state.isDirty) {\n        store.saveState();\n      }\n    }, 30000);\n  }\n\n  setupSessionTimeout() {\n    let timeoutId;\n    const TIMEOUT_DURATION = 30 * 60 * 1000; // 30 minutes\n\n    const resetTimeout = () => {\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(() => {\n        if (authManager.isValidSession()) {\n          authManager.clearSession();\n          store.navigate('login');\n          alert('Your session has expired. Please log in again.');\n        }\n      }, TIMEOUT_DURATION);\n    };\n\n    // Reset timeout on user activity\n    ['mousedown', 'keypress', 'scroll', 'touchstart'].forEach((event) => {\n      document.addEventListener(event, resetTimeout, { passive: true });\n    });\n\n    resetTimeout(); // Initialize timeout\n  }\n\n  setCurrentYear() {\n    const yearElement = document.getElementById('currentYear');\n    if (yearElement) {\n      yearElement.textContent = new Date().getFullYear();\n    }\n  }\n\n  destroy() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n  }\n}\n\n// Initialize app when DOM is ready\nconst app = new App();\napp.init();\n\n// Cleanup on unload\nwindow.addEventListener('unload', () => {\n  app.destroy();\n});\n\n// Handle errors globally\nwindow.addEventListener('error', (e) => {\n  console.error('Global error:', e.error);\n  // You could send this to a logging service in production\n});\n\nwindow.addEventListener('unhandledrejection', (e) => {\n  console.error('Unhandled promise rejection:', e.reason);\n  // You could send this to a logging service in production\n});\n"],"file":"assets/index-XLcuBX9X.js"}