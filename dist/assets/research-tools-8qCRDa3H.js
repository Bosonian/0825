var $=Object.defineProperty;var U=(o,e,t)=>e in o?$(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var C=(o,e,t)=>U(o,typeof e!="symbol"?e+"":e,t);import{m as p,M as m,a as y,P as k}from"./medical-core-BGk_aHbc.js";import{p as z}from"./enterprise-features-DIAO-rWl.js";const H={en:{appTitle:"iGFAP",emergencyBadge:"Emergency Tool",helpButton:"Help and Instructions",darkModeButton:"Toggle dark mode",languageToggle:"Language",step1:"Initial Assessment",step2:"Data Collection",step3:"Results",comaModuleTitle:"Coma Module",limitedDataModuleTitle:"Limited Data Module",fullStrokeModuleTitle:"Full Stroke Module",triage1Title:"Patient Assessment",triage1Question:"Is the patient comatose?",triage1Help:"Glasgow Coma Scale < 9",triage1Yes:"YES - Comatose",triage1No:"NO - Conscious",triage2Title:"Examination Capability",triage2Question:"Can the patient be reliably examined?",triage2Help:"Patient is not aphasic, confused, or uncooperative",triage2Yes:"YES - Full Exam Possible",triage2No:"NO - Limited Exam Only",ageLabel:"Age (years)",ageHelp:"Patient age in years",systolicLabel:"Systolic BP (mmHg)",systolicHelp:"Systolic blood pressure",diastolicLabel:"Diastolic BP (mmHg)",diastolicHelp:"Diastolic blood pressure",gfapLabel:"GFAP Value (pg/mL)",gfapHelp:"GFAP biomarker level",fastEdLabel:"FAST-ED Score",fastEdHelp:"FAST-ED assessment score (0-9)",headacheLabel:"Headache",vigilanzLabel:"Reduced consciousness",armPareseLabel:"Arm weakness",beinPareseLabel:"Leg weakness",eyeDeviationLabel:"Eye deviation",atrialFibLabel:"Atrial fibrillation",anticoagLabel:"Anticoagulated (NOAK)",antiplateletsLabel:"Antiplatelets",analyzeButton:"Analyze",analyzing:"Analyzing...",printResults:"Print Results",newAssessment:"Start New Assessment",startOver:"Start Over",goBack:"Go Back",goHome:"Go Home",basicInformation:"Basic Information",biomarkersScores:"Biomarkers & Scores",clinicalSymptoms:"Clinical Symptoms",medicalHistory:"Medical History",ageYearsLabel:"Age (years)",systolicBpLabel:"Systolic BP (mmHg)",diastolicBpLabel:"Diastolic BP (mmHg)",gfapValueLabel:"GFAP Value (pg/mL)",fastEdScoreLabel:"FAST-ED Score",ageYearsHelp:"Patient's age in years",systolicBpHelp:"Normal: 90-140 mmHg",diastolicBpHelp:"Normal: 60-90 mmHg",gfapTooltip:"Brain injury biomarker",gfapTooltipLong:"Glial Fibrillary Acidic Protein - Brain injury biomarker",gfapRange:"Range: {min} - {max} pg/mL",fastEdTooltip:"0-9 scale for LVO screening",analyzeIchRisk:"Analyze ICH Risk",analyzeStrokeRisk:"Analyze Stroke Risk",criticalPatient:"Critical Patient",comaAlert:"Patient is comatose (GCS < 9). Rapid assessment required.",vigilanceReduction:"Vigilance Reduction (Decreased alertness)",armParesis:"Arm Paresis",legParesis:"Leg Paresis",eyeDeviation:"Eye Deviation",atrialFibrillation:"Atrial Fibrillation",onNoacDoac:"On NOAC/DOAC",onAntiplatelets:"On Antiplatelets",resultsTitle:"Assessment Results",bleedingRiskAssessment:"Bleeding Risk Assessment",ichProbability:"ICH Probability",lvoProbability:"LVO Probability",lvoMayBePossible:"Large vessel occlusion possible - further evaluation recommended",riskFactorsTitle:"Main Risk Factors",increasingRisk:"Increasing Risk",decreasingRisk:"Decreasing Risk",noFactors:"No factors",riskLevel:"Risk Level",lowRisk:"Low Risk",mediumRisk:"Medium Risk",highRisk:"High Risk",riskLow:"Low",riskMedium:"Medium",riskHigh:"High",riskFactorsAnalysis:"Risk Factors",contributingFactors:"Contributing factors to the assessment",riskFactors:"Risk Factors",increaseRisk:"INCREASE",decreaseRisk:"DECREASE",noPositiveFactors:"No increasing factors",noNegativeFactors:"No decreasing factors",ichRiskFactors:"ICH Risk Factors",lvoRiskFactors:"LVO Risk Factors",ichRisk:"ICH Risk",lvoRisk:"LVO Risk",sendToHospital:"Send to Hospital",criticalAlertTitle:"CRITICAL RISK DETECTED",criticalAlertMessage:"High probability of intracerebral hemorrhage detected.",immediateActionsRequired:"Immediate actions required",initiateStrokeProtocol:"Initiate stroke protocol immediately",urgentCtImaging:"Urgent CT imaging required",considerBpManagement:"Consider blood pressure management",prepareNeurosurgicalConsult:"Prepare for potential neurosurgical consultation",helpTitle:"Quick Reference Guide",gcsTitle:"Glasgow Coma Scale (GCS)",gcsLow:"GCS < 9: Comatose patient - use Coma Module",gcsMod:"GCS 8-12: Moderate impairment",gcsHigh:"GCS 13-15: Mild impairment",fastEdTitle:"FAST-ED Score Components",fastEdFacial:"Facial Palsy: 0-1 points",fastEdArm:"Arm Weakness: 0-2 points",fastEdSpeech:"Speech Changes: 0-2 points",fastEdTime:"Time: Critical factor",fastEdEye:"Eye Deviation: 0-2 points",fastEdDenial:"Denial/Neglect: 0-2 points",criticalValuesTitle:"Critical Values",criticalBp:"Systolic BP > 180: Increased ICH risk",criticalGfap:"GFAP > 500 pg/mL: Significant marker",criticalFastEd:"FAST-ED ‚â• 4: Consider LVO",fastEdCalculatorTitle:"FAST-ED Score Calculator",fastEdCalculatorSubtitle:"Click to calculate FAST-ED score components",facialPalsyTitle:"Facial Palsy",facialPalsyNormal:"Normal (0)",facialPalsyMild:"Present (1)",armWeaknessTitle:"Arm Weakness",armWeaknessNormal:"Normal (0)",armWeaknessMild:"Mild weakness or drift (1)",armWeaknessSevere:"Severe weakness or falls immediately (2)",speechChangesTitle:"Speech Abnormalities",speechChangesNormal:"Normal (0)",speechChangesMild:"Mild dysarthria or aphasia (1)",speechChangesSevere:"Severe dysarthria or aphasia (2)",eyeDeviationTitle:"Eye Deviation",eyeDeviationNormal:"Normal (0)",eyeDeviationPartial:"Partial gaze deviation (1)",eyeDeviationForced:"Forced gaze deviation (2)",denialNeglectTitle:"Denial/Neglect",denialNeglectNormal:"Normal (0)",denialNeglectPartial:"Partial neglect (1)",denialNeglectComplete:"Complete neglect (2)",totalScoreTitle:"Total FAST-ED Score",riskLevel:"Risk Level",riskLevelLow:"LOW (Score <4)",riskLevelHigh:"HIGH (Score ‚â•4 - Consider LVO)",applyScore:"Apply Score",cancel:"Cancel",riskAnalysis:"Risk Analysis",riskAnalysisSubtitle:"Clinical factors in this assessment",contributingFactors:"Contributing factors",factorsShown:"shown",positiveFactors:"Positive factors",negativeFactors:"Negative factors",clinicalInformation:"Clinical Information",clinicalRecommendations:"Clinical Recommendations",clinicalRec1:"Consider immediate imaging if ICH risk is high",clinicalRec2:"Activate stroke team for LVO scores ‚â• 50%",clinicalRec3:"Monitor blood pressure closely",clinicalRec4:"Document all findings thoroughly",noDriverData:"No driver data available",driverAnalysisUnavailable:"Driver analysis unavailable",driverInfoNotAvailable:"Driver information not available from this prediction model",driverAnalysisNotAvailable:"Driver analysis not available for this prediction",lvoNotPossible:"LVO assessment not possible with limited data",fullExamRequired:"Full neurological examination required for LVO screening",limitedAssessment:"Limited Assessment",disclaimer:"Clinical Disclaimer",disclaimerText:"This tool is for clinical decision support only. Always use clinical judgment and follow local protocols. Not a replacement for physician assessment.",importantNote:"Important",importantText:"These results are for clinical decision support only. Always use clinical judgment and follow institutional protocols.",predictedMortality:"Predicted 30-day mortality",ichVolumeLabel:"ICH Volume",references:"References",inputSummaryTitle:"Input Summary",inputSummarySubtitle:"Values used for this analysis",privacyLink:"Privacy Policy",disclaimerLink:"Medical Disclaimer",versionLink:"Version 2.1.0 - Research Preview",privacyPolicy:"Privacy Policy: This tool processes data locally. No patient data is stored or transmitted.",medicalDisclaimer:"Medical Disclaimer: This tool is for clinical decision support only. Always use clinical judgment and follow local protocols.",networkError:"Network error - please check your connection and try again",requestTimeout:"Request timeout - please try again",apiError:"Failed to get results",validationError:"Please check your input values",sessionTimeout:"Your session has been idle for 30 minutes. Would you like to continue?",unsavedData:"You have unsaved data. Are you sure you want to leave?",nearestCentersTitle:"Nearest Stroke Centers",useCurrentLocation:"Use Current Location",enterLocationPlaceholder:"Enter city or address...",enterManually:"Enter Location Manually",search:"Search",yourLocation:"Your Location",recommendedCenters:"Recommended Centers",alternativeCenters:"Alternative Centers",noCentersFound:"No stroke centers found in this area",gettingLocation:"Getting your location",searchingLocation:"Searching location",locationError:"Unable to get your location",locationPermissionDenied:"Location access denied. Please allow location access and try again.",locationUnavailable:"Location information is unavailable",locationTimeout:"Location request timed out",geolocationNotSupported:"Geolocation is not supported by this browser",geocodingNotImplemented:"Location search not available. Please use GPS or enter coordinates manually.",tryManualEntry:"Try entering your location manually or use GPS.",distanceNote:"Distances are calculated as straight-line distances. Actual travel times may vary.",travelTimeNote:"Travel times calculated for emergency vehicles with sirens and priority routing.",calculatingTravelTimes:"Calculating travel times",minutes:"min",poweredByOrs:"Travel times powered by OpenRoute Service",comprehensiveCenter:"Comprehensive Stroke Center",primaryCenter:"Primary Stroke Center",telemetryCenter:"Telemedicine Center",thrombectomy:"Thrombectomy",neurosurgery:"Neurosurgery",icu:"Intensive Care",telemedicine:"Telemedicine",stroke_unit:"Stroke Unit",call:"Call",directions:"Directions",emergency:"Emergency",certified:"Certified",prerequisitesTitle:"Prerequisites for Stroke Triage",prerequisitesIntro:"Please confirm that all of the following prerequisites are met:",prerequisitesWarning:"All prerequisites must be met to continue",continue:"Continue",acute_deficit:"Acute (severe) neurological deficit present",symptom_onset:"Symptom onset within 6 hours",no_preexisting:"No pre-existing severe neurological deficits",no_trauma:"No traumatic brain injury present",differentialDiagnoses:"Differential Diagnoses",reconfirmTimeWindow:"Please reconfirm time window!",unclearTimeWindow:"With unclear/extended time window, early demarcated brain infarction is also possible",rareDiagnoses:"Rare diagnoses such as glioblastoma are also possible",researchAccessRequired:"Research Access Required",researchPreviewDescription:"This is a research preview of the iGFAP Stroke Triage Assistant for clinical validation.",importantNotice:"Important Notice",researchUseOnly:"Research Use Only",researchUseOnlyDesc:"Not for clinical decision making",noPatientDataStorage:"No Patient Data Storage",noPatientDataStorageDesc:"All data processed locally",clinicalAdvisory:"Clinical Advisory",clinicalAdvisoryDesc:"Under supervision of Prof. Christian F√∂rch & Dr. Lovepreet Kalra",contact:"Contact",researchAccessCode:"Research Access Code",enterResearchAccessCode:"Enter research access code",accessResearchSystem:"Access Research System",regulatoryStatus:"Regulatory Status",regulatoryStatusDesc:"Research prototype - CE certification pending",dataProtection:"Data Protection",dataProtectionDesc:"GDPR compliant - local processing only",clinicalOversight:"Clinical Oversight",clinicalOversightDesc:"RKH Klinikum Ludwigsburg, Neurologie",accessDenied:"Access Denied",invalidResearchCode:"Invalid research access code. Please try again."},de:{appTitle:"iGFAP",emergencyBadge:"Notfall-Tool",helpButton:"Hilfe und Anweisungen",darkModeButton:"Dunklen Modus umschalten",languageToggle:"Sprache",step1:"Erstbeurteilung",step2:"Datenerhebung",step3:"Ergebnisse",comaModuleTitle:"Koma-Modul",limitedDataModuleTitle:"Begrenzte Daten Modul",fullStrokeModuleTitle:"Vollst√§ndiges Schlaganfall-Modul",triage1Title:"Patientenbeurteilung",triage1Question:"Ist der Patient komat√∂s?",triage1Help:"Glasgow Coma Scale < 9",triage1Yes:"JA - Komat√∂s",triage1No:"NEIN - Bei Bewusstsein",triage2Title:"Untersuchungsf√§higkeit",triage2Question:"Kann der Patient zuverl√§ssig untersucht werden?",triage2Help:"Patient ist nicht aphasisch, verwirrt oder unkooperativ",triage2Yes:"JA - Vollst√§ndige Untersuchung m√∂glich",triage2No:"NEIN - Nur begrenzte Untersuchung",ageLabel:"Alter (Jahre)",ageHelp:"Patientenalter in Jahren",systolicLabel:"Systolischer RR (mmHg)",systolicHelp:"Systolischer Blutdruck",diastolicLabel:"Diastolischer RR (mmHg)",diastolicHelp:"Diastolischer Blutdruck",gfapLabel:"GFAP-Wert (pg/mL)",gfapHelp:"GFAP-Biomarker-Wert",fastEdLabel:"FAST-ED-Score",fastEdHelp:"FAST-ED-Bewertungsscore (0-9)",headacheLabel:"Kopfschmerzen",vigilanzLabel:"Bewusstseinstr√ºbung",armPareseLabel:"Armschw√§che",beinPareseLabel:"Beinschw√§che",eyeDeviationLabel:"Blickdeviation",atrialFibLabel:"Vorhofflimmern",anticoagLabel:"Antikoaguliert (NOAK)",antiplateletsLabel:"Thrombozytenaggregationshemmer",analyzeButton:"Analysieren",analyzing:"Analysiere...",printResults:"Ergebnisse drucken",newAssessment:"Neue Bewertung starten",startOver:"Von vorn beginnen",goBack:"Zur√ºck",goHome:"Zur Startseite",basicInformation:"Grundinformationen",biomarkersScores:"Biomarker & Scores",clinicalSymptoms:"Klinische Symptome",medicalHistory:"Anamnese",ageYearsLabel:"Alter (Jahre)",systolicBpLabel:"Systolischer RR (mmHg)",diastolicBpLabel:"Diastolischer RR (mmHg)",gfapValueLabel:"GFAP-Wert (pg/mL)",fastEdScoreLabel:"FAST-ED-Score",ageYearsHelp:"Patientenalter in Jahren",systolicBpHelp:"Normal: 90-140 mmHg",diastolicBpHelp:"Normal: 60-90 mmHg",gfapTooltip:"Hirnverletzungs-Biomarker",gfapTooltipLong:"Glial Fibrillary Acidic Protein - Hirnverletzungs-Biomarker",gfapRange:"Bereich: {min} - {max} pg/mL",fastEdTooltip:"0-9 Skala f√ºr LVO-Screening",analyzeIchRisk:"ICB-Risiko analysieren",analyzeStrokeRisk:"Schlaganfall-Risiko analysieren",criticalPatient:"Kritischer Patient",comaAlert:"Patient ist komat√∂s (GCS < 9). Schnelle Beurteilung erforderlich.",vigilanceReduction:"Vigilanzminderung (Verminderte Wachheit)",armParesis:"Armparese",legParesis:"Beinparese",eyeDeviation:"Blickdeviation",atrialFibrillation:"Vorhofflimmern",onNoacDoac:"NOAK/DOAK-Therapie",onAntiplatelets:"Thrombozytenaggregationshemmer",resultsTitle:"Bewertungsergebnisse",bleedingRiskAssessment:"Blutungsrisiko-Bewertung",ichProbability:"ICB-Risiko",lvoProbability:"LVO-Risiko",lvoMayBePossible:"Gro√ügef√§√üverschluss m√∂glich - weitere Abkl√§rung empfohlen",riskFactorsTitle:"Hauptrisikofaktoren",increasingRisk:"Risikoerh√∂hend",decreasingRisk:"Risikomindernd",noFactors:"Keine Faktoren",riskLevel:"Risikostufe",lowRisk:"Niedriges Risiko",mediumRisk:"Mittleres Risiko",highRisk:"Hohes Risiko",riskLow:"Niedrig",riskMedium:"Mittel",riskHigh:"Hoch",riskFactorsAnalysis:"Risikofaktoren",contributingFactors:"Beitragende Faktoren zur Bewertung",riskFactors:"Risikofaktoren",increaseRisk:"ERH√ñHEN",decreaseRisk:"VERRINGERN",noPositiveFactors:"Keine erh√∂henden Faktoren",noNegativeFactors:"Keine verringernden Faktoren",ichRiskFactors:"ICB-Risikofaktoren",lvoRiskFactors:"LVO-Risikofaktoren",ichRisk:"ICB-Risiko",lvoRisk:"LVO-Risiko",sendToHospital:"An Krankenhaus senden",criticalAlertTitle:"KRITISCHES RISIKO ERKANNT",criticalAlertMessage:"Hohe Wahrscheinlichkeit einer intrazerebralen Blutung erkannt.",immediateActionsRequired:"Sofortige Ma√ünahmen erforderlich",initiateStrokeProtocol:"Schlaganfall-Protokoll sofort einleiten",urgentCtImaging:"Dringende CT-Bildgebung erforderlich",considerBpManagement:"Blutdruckmanagement erw√§gen",prepareNeurosurgicalConsult:"Neurochirurgische Konsultation vorbereiten",helpTitle:"Kurzreferenzleitfaden",gcsTitle:"Glasgow Coma Scale (GCS)",gcsLow:"GCS < 9: Komat√∂ser Patient - Koma-Modul verwenden",gcsMod:"GCS 8-12: M√§√üige Beeintr√§chtigung",gcsHigh:"GCS 13-15: Leichte Beeintr√§chtigung",fastEdTitle:"FAST-ED-Score-Komponenten",fastEdFacial:"Faziale Parese: 0-1 Punkte",fastEdArm:"Armschw√§che: 0-2 Punkte",fastEdSpeech:"Sprachver√§nderungen: 0-2 Punkte",fastEdTime:"Zeit: Kritischer Faktor",fastEdEye:"Blickdeviation: 0-2 Punkte",fastEdDenial:"Verneinung/Neglect: 0-2 Punkte",criticalValuesTitle:"Kritische Werte",criticalBp:"Systolischer RR > 180: Erh√∂htes ICB-Risiko",criticalGfap:"GFAP > 500 pg/mL: Signifikanter Marker",criticalFastEd:"FAST-ED ‚â• 4: LVO in Betracht ziehen",fastEdCalculatorTitle:"FAST-ED-Score-Rechner",fastEdCalculatorSubtitle:"Klicken Sie, um FAST-ED-Score-Komponenten zu berechnen",facialPalsyTitle:"Fazialisparese",facialPalsyNormal:"Normal (0)",facialPalsyMild:"Vorhanden (1)",armWeaknessTitle:"Armschw√§che",armWeaknessNormal:"Normal (0)",armWeaknessMild:"Leichte Schw√§che oder Absinken (1)",armWeaknessSevere:"Schwere Schw√§che oder f√§llt sofort ab (2)",speechChangesTitle:"Sprachst√∂rungen",speechChangesNormal:"Normal (0)",speechChangesMild:"Leichte Dysarthrie oder Aphasie (1)",speechChangesSevere:"Schwere Dysarthrie oder Aphasie (2)",eyeDeviationTitle:"Blickdeviation",eyeDeviationNormal:"Normal (0)",eyeDeviationPartial:"Partielle Blickdeviation (1)",eyeDeviationForced:"Forcierte Blickdeviation (2)",denialNeglectTitle:"Verneinung/Neglect",denialNeglectNormal:"Normal (0)",denialNeglectPartial:"Partieller Neglect (1)",denialNeglectComplete:"Kompletter Neglect (2)",totalScoreTitle:"Gesamt-FAST-ED-Score",riskLevel:"Risikostufe",riskLevelLow:"NIEDRIG (Score <4)",riskLevelHigh:"HOCH (Score ‚â•4 - LVO erw√§gen)",applyScore:"Score Anwenden",cancel:"Abbrechen",riskAnalysis:"Risikoanalyse",riskAnalysisSubtitle:"Klinische Faktoren in dieser Bewertung",contributingFactors:"Beitragende Faktoren",factorsShown:"angezeigt",positiveFactors:"Positive Faktoren",negativeFactors:"Negative Faktoren",clinicalInformation:"Klinische Informationen",clinicalRecommendations:"Klinische Empfehlungen",clinicalRec1:"Sofortige Bildgebung erw√§gen bei hohem ICB-Risiko",clinicalRec2:"Stroke-Team aktivieren bei LVO-Score ‚â• 50%",clinicalRec3:"Blutdruck engmaschig √ºberwachen",clinicalRec4:"Alle Befunde gr√ºndlich dokumentieren",noDriverData:"Keine Treiberdaten verf√ºgbar",driverAnalysisUnavailable:"Treiberanalyse nicht verf√ºgbar",driverInfoNotAvailable:"Treiberinformationen von diesem Vorhersagemodell nicht verf√ºgbar",driverAnalysisNotAvailable:"Treiberanalyse f√ºr diese Vorhersage nicht verf√ºgbar",lvoNotPossible:"LVO-Bewertung mit begrenzten Daten nicht m√∂glich",fullExamRequired:"Vollst√§ndige neurologische Untersuchung f√ºr LVO-Screening erforderlich",limitedAssessment:"Begrenzte Bewertung",disclaimer:"Klinischer Haftungsausschluss",disclaimerText:"Dieses Tool dient nur zur klinischen Entscheidungsunterst√ºtzung. Verwenden Sie immer klinisches Urteilsverm√∂gen und befolgen Sie lokale Protokolle. Kein Ersatz f√ºr √§rztliche Beurteilung.",importantNote:"Wichtig",importantText:"Diese Ergebnisse dienen nur zur klinischen Entscheidungsunterst√ºtzung. Verwenden Sie immer klinisches Urteilsverm√∂gen und befolgen Sie institutionelle Protokolle.",predictedMortality:"Vorhergesagte 30-Tage-Mortalit√§t",ichVolumeLabel:"ICB-Volumen",references:"Referenzen",inputSummaryTitle:"Eingabezusammenfassung",inputSummarySubtitle:"F√ºr diese Analyse verwendete Werte",privacyLink:"Datenschutzrichtlinie",disclaimerLink:"Medizinischer Haftungsausschluss",versionLink:"Version 2.1.0 - Research Preview",privacyPolicy:"Datenschutzrichtlinie: Dieses Tool verarbeitet Daten lokal. Keine Patientendaten werden gespeichert oder √ºbertragen.",medicalDisclaimer:"Medizinischer Haftungsausschluss: Dieses Tool dient nur zur klinischen Entscheidungsunterst√ºtzung. Verwenden Sie immer klinisches Urteilsverm√∂gen und befolgen Sie lokale Protokolle.",networkError:"Netzwerkfehler - bitte √ºberpr√ºfen Sie Ihre Verbindung und versuchen Sie es erneut",requestTimeout:"Anfrage-Timeout - bitte versuchen Sie es erneut",apiError:"Ergebnisse konnten nicht abgerufen werden",validationError:"Bitte √ºberpr√ºfen Sie Ihre Eingabewerte",sessionTimeout:"Ihre Sitzung war 30 Minuten lang inaktiv. M√∂chten Sie fortfahren?",unsavedData:"Sie haben ungespeicherte Daten. Sind Sie sicher, dass Sie verlassen m√∂chten?",nearestCentersTitle:"N√§chstgelegene Schlaganfall-Zentren",useCurrentLocation:"Aktuellen Standort verwenden",enterLocationPlaceholder:"Stadt oder Adresse eingeben...",enterManually:"Standort manuell eingeben",search:"Suchen",yourLocation:"Ihr Standort",recommendedCenters:"Empfohlene Zentren",alternativeCenters:"Alternative Zentren",noCentersFound:"Keine Schlaganfall-Zentren in diesem Bereich gefunden",gettingLocation:"Standort wird ermittelt",searchingLocation:"Standort wird gesucht",locationError:"Standort konnte nicht ermittelt werden",locationPermissionDenied:"Standortzugriff verweigert. Bitte erlauben Sie Standortzugriff und versuchen Sie es erneut.",locationUnavailable:"Standortinformationen sind nicht verf√ºgbar",locationTimeout:"Standortanfrage ist abgelaufen",geolocationNotSupported:"Geolokalisierung wird von diesem Browser nicht unterst√ºtzt",geocodingNotImplemented:"Standortsuche nicht verf√ºgbar. Bitte verwenden Sie GPS oder geben Sie Koordinaten manuell ein.",tryManualEntry:"Versuchen Sie, Ihren Standort manuell einzugeben oder GPS zu verwenden.",distanceNote:"Entfernungen werden als Luftlinie berechnet. Tats√§chliche Fahrzeiten k√∂nnen variieren.",travelTimeNote:"Fahrzeiten berechnet f√ºr Rettungsfahrzeuge mit Sondersignalen und Vorfahrtsberechtigung.",calculatingTravelTimes:"Fahrzeiten werden berechnet",minutes:"Min",poweredByOrs:"Fahrzeiten bereitgestellt von OpenRoute Service",comprehensiveCenter:"√úberregionales Schlaganfall-Zentrum",primaryCenter:"Regionales Schlaganfall-Zentrum",telemetryCenter:"Telemedizin-Zentrum",thrombectomy:"Thrombektomie",neurosurgery:"Neurochirurgie",icu:"Intensivstation",telemedicine:"Telemedizin",stroke_unit:"Stroke Unit",call:"Anrufen",directions:"Wegbeschreibung",emergency:"Notfall",certified:"Zertifiziert",prerequisitesTitle:"Voraussetzungen f√ºr Schlaganfall-Triage",prerequisitesIntro:"Bitte best√§tigen Sie, dass alle folgenden Voraussetzungen erf√ºllt sind:",prerequisitesWarning:"Alle Voraussetzungen m√ºssen erf√ºllt sein, um fortzufahren",continue:"Weiter",acute_deficit:"Akutes (schweres) neurologisches Defizit vorhanden",symptom_onset:"Symptombeginn innerhalb 6h",no_preexisting:"Keine vorbestehende schwere neurologische Defizite",no_trauma:"Kein Sch√§delhirntrauma vorhanden",differentialDiagnoses:"Differentialdiagnosen",reconfirmTimeWindow:"Bitte Zeitfenster rekonfirmieren!",unclearTimeWindow:"Bei unklarem/erweitertem Zeitfenster ist auch ein beginnend demarkierter Hirninfarkt m√∂glich",rareDiagnoses:"Seltene Diagnosen wie ein Glioblastom sind auch m√∂glich",researchAccessRequired:"Forschungszugang erforderlich",researchPreviewDescription:"Dies ist eine Forschungsvorschau des iGFAP Schlaganfall-Triage-Assistenten zur klinischen Validierung.",importantNotice:"Wichtiger Hinweis",researchUseOnly:"Nur f√ºr Forschungszwecke",researchUseOnlyDesc:"Nicht f√ºr klinische Entscheidungen",noPatientDataStorage:"Keine Patientendatenspeicherung",noPatientDataStorageDesc:"Alle Daten werden lokal verarbeitet",clinicalAdvisory:"Klinische Beratung",clinicalAdvisoryDesc:"Unter Aufsicht von Prof. Christian F√∂rch & Dr. Lovepreet Kalra",contact:"Kontakt",researchAccessCode:"Forschungszugangscode",enterResearchAccessCode:"Forschungszugangscode eingeben",accessResearchSystem:"Zugang zum Forschungssystem",regulatoryStatus:"Regulatorischer Status",regulatoryStatusDesc:"Forschungsprototyp - CE-Zertifizierung ausstehend",dataProtection:"Datenschutz",dataProtectionDesc:"DSGVO-konform - nur lokale Verarbeitung",clinicalOversight:"Klinische Aufsicht",clinicalOversightDesc:"RKH Klinikum Ludwigsburg, Neurologie",accessDenied:"Zugriff verweigert",invalidResearchCode:"Ung√ºltiger Forschungszugangscode. Bitte versuchen Sie es erneut."}};class q{constructor(){this.supportedLanguages=["en","de"],this.currentLanguage=this.detectLanguage()}detectLanguage(){const e=localStorage.getItem("language");return e&&this.supportedLanguages.includes(e)?e:(navigator.language||navigator.userLanguage).substring(0,2).toLowerCase()==="de"?"de":"en"}getCurrentLanguage(){return this.currentLanguage}setLanguage(e){return this.supportedLanguages.includes(e)?(this.currentLanguage=e,localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}})),!0):!1}getSupportedLanguages(){return[...this.supportedLanguages]}t(e){return(H[this.currentLanguage]||H.en)[e]||e}toggleLanguage(){const e=this.currentLanguage==="en"?"de":"en";return this.setLanguage(e)}getLanguageDisplayName(e=null){const t=e||this.currentLanguage;return{en:"English",de:"Deutsch"}[t]||t}formatDateTime(e){const t=this.currentLanguage==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(t,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}formatTime(e){const t=this.currentLanguage==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(t,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}}const V=new q,ce=o=>V.t(o);class _{static calculateProbability(e,t){if(!e||!t||e<=0||t<=0)return{probability:0,confidence:0,isValid:!1,reason:"Invalid inputs: age and GFAP required"};if(e<18||e>120)return{probability:0,confidence:0,isValid:!1,reason:`Age ${e} outside valid range (18-120 years)`};try{const i=(e-this.PARAMS.age.mean)/this.PARAMS.age.std,r=(t-this.PARAMS.gfap.mean)/this.PARAMS.gfap.std,s=this.PARAMS.coefficients.intercept+this.PARAMS.coefficients.age*i+this.PARAMS.coefficients.gfap*r,n=1/(1+Math.exp(-s)),a=n*100,c=Math.abs(n-.5)*2,u=this.getRiskCategory(a);return{probability:Math.round(a*10)/10,confidence:Math.round(c*100)/100,logit:Math.round(s*1e3)/1e3,riskCategory:u,scaledInputs:{age:Math.round(i*1e3)/1e3,gfap:Math.round(r*1e3)/1e3},rawInputs:{age:e,gfap:t},isValid:!0,calculationMethod:"logistic_regression_age_gfap"}}catch(i){return{probability:0,confidence:0,isValid:!1,reason:"Calculation error",error:i.message}}}static getRiskCategory(e){return e<10?{level:"very_low",color:"#10b981",label:"Very Low Risk",description:"Minimal ICH likelihood"}:e<25?{level:"low",color:"#84cc16",label:"Low Risk",description:"Below typical threshold"}:e<50?{level:"moderate",color:"#f59e0b",label:"Moderate Risk",description:"Elevated concern"}:e<75?{level:"high",color:"#f97316",label:"High Risk",description:"Significant likelihood"}:{level:"very_high",color:"#dc2626",label:"Very High Risk",description:"Critical ICH probability"}}static compareModels(e,t){if(!e||!t||!t.isValid)return{isValid:!1,reason:"Invalid model results for comparison"};let i=e.probability||0;i<=1&&(i*=100);const r=t.probability||0,s=i-r,n=r>0?s/r*100:0,a=i>r?"main":r>i?"legacy":"equal";let c;const u=Math.abs(s);return u<5?c="strong":u<15?c="moderate":u<30?c="weak":c="poor",{isValid:!0,probabilities:{main:Math.round(i*10)/10,legacy:Math.round(r*10)/10},differences:{absolute:Math.round(s*10)/10,relative:Math.round(n*10)/10},agreement:{level:c,higherRiskModel:a},interpretation:this.getComparisonInterpretation(s,c)}}static getComparisonInterpretation(e,t){const i=Math.abs(e);return t==="strong"?{type:"concordant",message:"Models show strong agreement",implication:"Age and GFAP are primary risk factors"}:i>20?{type:"divergent",message:"Significant model disagreement",implication:"Complex model captures additional risk factors not in age/GFAP"}:{type:"moderate_difference",message:"Models show moderate difference",implication:"Additional factors provide incremental predictive value"}}static runValidationTests(){const t=[{age:65,gfap:100,expected:"low",description:"Younger patient, low GFAP"},{age:75,gfap:500,expected:"moderate",description:"Average age, moderate GFAP"},{age:85,gfap:1e3,expected:"high",description:"Older patient, high GFAP"},{age:70,gfap:2e3,expected:"very_high",description:"High GFAP dominates"},{age:90,gfap:50,expected:"very_low",description:"Low GFAP despite age"}].map(s=>{const n=this.calculateProbability(s.age,s.gfap);return{...s,result:n,passed:n.isValid&&n.riskCategory.level===s.expected}}),i=t.filter(s=>s.passed).length,r=t.length;return{summary:{passed:i,total:r,passRate:Math.round(i/r*100)},details:t}}static getModelMetadata(){return{name:"Legacy ICH Model",type:"Logistic Regression",version:"1.0.0",features:["age","gfap"],performance:{rocAuc:.789,recall:.4,precision:.86,f1Score:.55,specificity:.94},trainingData:{samples:"Historical cohort",dateRange:"Research study period",validation:"Cross-validation"},limitations:["Only uses age and GFAP - ignores clinical symptoms","Lower recall (40%) - misses some ICH cases","No time-to-onset consideration","No blood pressure or medication factors","Simplified feature set for baseline comparison"],purpose:"Research baseline for evaluating complex model improvements"}}}C(_,"PARAMS",{age:{mean:74.59,std:12.75},gfap:{mean:665.23,std:2203.77},coefficients:{intercept:.3248,age:-.2108,gfap:3.1631}});function le(o){try{const e=(o==null?void 0:o.age_years)||(o==null?void 0:o.age)||null,t=(o==null?void 0:o.gfap_value)||(o==null?void 0:o.gfap)||null;return!e||!t?null:_.calculateProbability(e,t)}catch(e){return null}}class S{static logComparison(e){try{const t={id:this.generateEntryId(),timestamp:new Date().toISOString(),sessionId:this.getSessionId(),...e},i=this.getStoredData();return i.entries.push(t),i.entries.length>this.MAX_ENTRIES&&(i.entries=i.entries.slice(-this.MAX_ENTRIES)),i.lastUpdated=new Date().toISOString(),i.totalComparisons=i.entries.length,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(i)),!0}catch(t){return!1}}static getStoredData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return this.createEmptyDataset();const t=JSON.parse(e);return!t.entries||!Array.isArray(t.entries)?this.createEmptyDataset():t}catch(e){return this.createEmptyDataset()}}static createEmptyDataset(){return{version:"1.0.0",created:new Date().toISOString(),lastUpdated:null,totalComparisons:0,entries:[],metadata:{app:"iGFAP Stroke Triage",purpose:"Model comparison research",dataRetention:"Local storage only"}}}static exportAsCSV(){const e=this.getStoredData();if(!e.entries||e.entries.length===0)return"No research data available for export";const t=["timestamp","session_id","age","gfap_value","main_model_probability","main_model_module","legacy_model_probability","legacy_model_confidence","absolute_difference","relative_difference","agreement_level","higher_risk_model"],i=e.entries.map(s=>{var n,a,c,u,E,T,D,f,h,N,O,P,L,F;return[s.timestamp,s.sessionId,((n=s.inputs)==null?void 0:n.age)||"",((a=s.inputs)==null?void 0:a.gfap)||"",((c=s.main)==null?void 0:c.probability)||"",((u=s.main)==null?void 0:u.module)||"",((E=s.legacy)==null?void 0:E.probability)||"",((T=s.legacy)==null?void 0:T.confidence)||"",((f=(D=s.comparison)==null?void 0:D.differences)==null?void 0:f.absolute)||"",((N=(h=s.comparison)==null?void 0:h.differences)==null?void 0:N.relative)||"",((P=(O=s.comparison)==null?void 0:O.agreement)==null?void 0:P.level)||"",((F=(L=s.comparison)==null?void 0:L.agreement)==null?void 0:F.higherRiskModel)||""].join(",")});return[t.join(","),...i].join(`
`)}static exportAsJSON(){const e=this.getStoredData();return JSON.stringify(e,null,2)}static downloadData(e="csv"){try{const t=e==="csv"?this.exportAsCSV():this.exportAsJSON(),i=`igfap-research-${Date.now()}.${e}`,r=new Blob([t],{type:e==="csv"?"text/csv":"application/json"}),s=URL.createObjectURL(r),n=document.createElement("a");return n.href=s,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),!0}catch(t){return!1}}static clearData(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(e){return!1}}static getDataSummary(){var s,n;const e=this.getStoredData();if(!e.entries||e.entries.length===0)return{totalEntries:0,dateRange:null,avgDifference:null};const{entries:t}=e,i=t.map(a=>{var c,u;return(u=(c=a.comparison)==null?void 0:c.differences)==null?void 0:u.absolute}).filter(a=>a!=null),r=i.length>0?i.reduce((a,c)=>a+Math.abs(c),0)/i.length:0;return{totalEntries:t.length,dateRange:{first:(s=t[0])==null?void 0:s.timestamp,last:(n=t[t.length-1])==null?void 0:n.timestamp},avgAbsoluteDifference:Math.round(r*10)/10,storageSize:JSON.stringify(e).length}}static generateEntryId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static getSessionId(){let e=sessionStorage.getItem("research_session_id");return e||(e=`session_${Date.now().toString(36)}`,sessionStorage.setItem("research_session_id",e)),e}}C(S,"STORAGE_KEY","igfap_research_data"),C(S,"MAX_ENTRIES",1e3);function de(o,e,t){try{if(!Y())return;const i={inputs:{age:t.age_years||t.age,gfap:t.gfap_value||t.gfap,module:o.module||"unknown"},main:{probability:o.probability,module:o.module,confidence:o.confidence},legacy:e,comparison:e?_.compareModels(o,e):null};S.logComparison(i)}catch(i){}}function Y(o=null){var e;if(o==="coma")return!1;if(o==="limited"||o==="full")return!0;if(typeof window!="undefined")try{const t=window.store||((e=require("../state/store.js"))==null?void 0:e.store);if(t){const{formData:i}=t.getState();return i.limited||i.full}}catch(t){}return!1}function ue(){return""}function ge(o,e,t){if(!(e!=null&&e.isValid))return`
      <div class="research-panel" id="researchPanel" style="display: none;">
        <div class="research-header">
          <h4>üî¨ Model Comparison (Research)</h4>
          <button class="close-research" id="closeResearch">√ó</button>
        </div>
        <div class="research-error">
          <p>‚ö†Ô∏è Legacy model calculation failed</p>
          <small>Debug: ${(e==null?void 0:e.reason)||"Unknown error"}</small>
        </div>
      </div>
    `;const i=_.compareModels(o,e);return`
    <div class="research-panel" id="researchPanel" style="display: none;">
      <div class="research-header">
        <h4>üî¨ Model Comparison (Research)</h4>
        <button class="close-research" id="closeResearch">√ó</button>
      </div>
      
      <div class="model-comparison">
        ${j(o,e)}
        ${K(i)}
        ${Q(e,t)}
        ${W()}
      </div>
      
      <div class="research-actions">
        <button id="exportResearchData" class="research-btn">üì• Export Data</button>
        <button id="toggleCalculationDetails" class="research-btn">üßÆ Details</button>
        <button id="clearResearchData" class="research-btn danger">üóëÔ∏è Clear</button>
      </div>
      
      <div class="research-disclaimer">
        <small>
          ‚ö†Ô∏è <strong>Research Mode Active</strong><br>
          Legacy model: Age + GFAP only (ROC-AUC: 0.789, Recall: 40%)<br>
          For baseline comparison. Main model includes additional clinical factors.
        </small>
      </div>
    </div>
  `}function j(o,e){let t=o.probability||0;t<=1&&(t*=100);const i=e.probability||0;return`
    <div class="probability-comparison">
      <div class="bar-group">
        <label class="bar-label">Main Model (Complex) - ${o.module||"Unknown"}</label>
        <div class="probability-bar">
          <div class="bar-fill main-model" style="width: ${Math.max(10,Math.min(t,100))}%">
            <span class="bar-value">${t.toFixed(1)}%</span>
          </div>
        </div>
      </div>

      <div class="bar-group">
        <label class="bar-label">Legacy Model (Age + GFAP Only)</label>
        <div class="probability-bar">
          <div class="bar-fill legacy-model" style="width: ${Math.max(10,Math.min(i,100))}%">
            <span class="bar-value">${i.toFixed(1)}%</span>
          </div>
        </div>
      </div>
    </div>
  `}function K(o){if(!o.isValid)return'<div class="comparison-error">Unable to compare models</div>';const{differences:e,agreement:t}=o;return`
    <div class="difference-analysis">
      <div class="difference-metric">
        <span class="metric-label">Difference:</span>
        <span class="metric-value ${e.absolute>0?"higher":"lower"}">
          ${e.absolute>0?"+":""}${e.absolute}%
        </span>
      </div>
      
      <div class="agreement-level">
        <span class="metric-label">Agreement:</span>
        <span class="agreement-badge ${t.level}">
          ${t.level.charAt(0).toUpperCase()+t.level.slice(1)}
        </span>
      </div>
      
      <div class="interpretation">
        <p class="interpretation-text">${o.interpretation.message}</p>
        <small class="interpretation-detail">${o.interpretation.implication}</small>
      </div>
    </div>
  `}function Q(o,e){return`
    <div class="calculation-details" id="calculationDetails" style="display: none;">
      <h5>Legacy Model Calculation</h5>
      <div class="calculation-steps">
        <div class="step">
          <strong>Inputs:</strong> Age ${e.age}, GFAP ${e.gfap} pg/ml
        </div>
        <div class="step">
          <strong>Scaling:</strong> Age ‚Üí ${o.scaledInputs.age}, GFAP ‚Üí ${o.scaledInputs.gfap}
        </div>
        <div class="step">
          <strong>Logit:</strong> ${o.logit}
        </div>
        <div class="step">
          <strong>Probability:</strong> ${o.probability}% (Confidence: ${(o.confidence*100).toFixed(0)}%)
        </div>
      </div>
    </div>
  `}function W(){const o=_.getModelMetadata();return`
    <div class="model-metrics">
      <h5>Performance Comparison</h5>
      <div class="metrics-grid">
        <div class="metric-item">
          <span class="metric-name">ROC-AUC</span>
          <span class="metric-value">Legacy: ${o.performance.rocAuc}</span>
        </div>
        <div class="metric-item">
          <span class="metric-name">Recall</span>
          <span class="metric-value">Legacy: ${(o.performance.recall*100).toFixed(0)}%</span>
        </div>
        <div class="metric-item">
          <span class="metric-name">Precision</span>
          <span class="metric-value">Legacy: ${(o.performance.precision*100).toFixed(0)}%</span>
        </div>
      </div>
    </div>
  `}function me(){if(!document.getElementById("researchPanel"))return;const e=document.getElementById("closeResearch");e&&e.addEventListener("click",()=>{const s=document.getElementById("researchPanel");s&&(s.style.display="none")});const t=document.getElementById("exportResearchData");t&&t.addEventListener("click",()=>{S.downloadData("csv")});const i=document.getElementById("toggleCalculationDetails");i&&i.addEventListener("click",()=>{const s=document.getElementById("calculationDetails");s&&(s.style.display=s.style.display==="none"?"block":"none",i.textContent=s.style.display==="none"?"üßÆ Details":"üßÆ Hide")});const r=document.getElementById("clearResearchData");r&&r.addEventListener("click",()=>{confirm("Clear all research data? This cannot be undone.")&&(S.clearData(),S.getDataSummary())})}const b={CLINICAL_SUMMARY:"clinical_summary",OUTCOME_PREDICTION:"outcome_prediction",RISK_ASSESSMENT:"risk_assessment",DECISION_SUPPORT:"decision_support",QUALITY_METRICS:"quality_metrics",RESEARCH_ANALYTICS:"research_analytics",COMPREHENSIVE:"comprehensive"},R={PDF:"pdf",HTML:"html",JSON:"json",CSV:"csv",DICOM_SR:"dicom_sr"},I={DOWNLOAD:"download",EMAIL:"email",EHR_INTEGRATION:"ehr_integration",PACS:"pacs",API:"api"};class J{constructor(){this.templates=new Map,this.reportHistory=[],this.scheduledReports=new Map,this.isInitialized=!1,this.initializeTemplates()}initializeTemplates(){this.templates.set(b.CLINICAL_SUMMARY,{name:"Clinical Summary Report",sections:["patient_demographics","clinical_presentation","assessment_findings","risk_stratification","treatment_recommendations","disposition"],requiredData:["patientData","predictions"],format:"structured"}),this.templates.set(b.OUTCOME_PREDICTION,{name:"Outcome Prediction Report",sections:["prediction_overview","mortality_risk","functional_outcome","complications_risk","model_performance","confidence_metrics"],requiredData:["predictions","mlResults"],format:"analytical"}),this.templates.set(b.RISK_ASSESSMENT,{name:"Risk Assessment Report",sections:["risk_profile","hemorrhagic_risk","procedural_risks","contraindications","monitoring_requirements","escalation_criteria"],requiredData:["patientData","predictions","alerts"],format:"clinical"}),this.templates.set(b.DECISION_SUPPORT,{name:"Clinical Decision Support Report",sections:["treatment_options","evidence_summary","guideline_recommendations","clinical_alerts","action_plan","follow_up"],requiredData:["patientData","predictions","recommendations"],format:"actionable"}),this.templates.set(b.QUALITY_METRICS,{name:"Quality Metrics Report",sections:["performance_indicators","process_metrics","outcome_measures","benchmarking","improvement_opportunities","action_items"],requiredData:["qualityMetrics","benchmarks"],format:"dashboard"}),this.templates.set(b.COMPREHENSIVE,{name:"Comprehensive Clinical Report",sections:["executive_summary","clinical_summary","risk_assessment","outcome_predictions","decision_support","quality_metrics","research_insights","appendices"],requiredData:["all"],format:"comprehensive"})}async generateReport(e,t,i={}){var s;const r=y.startMeasurement(k.REPORT_GENERATION,`generate_${e}_report`);try{const n=this.templates.get(e);if(!n)throw new Error(`Unknown report type: ${e}`);this.validateReportData(n,t);const a=await this.buildReportContent(n,t,i),c=await this.formatReport(a,i.format||R.HTML),u={id:`report_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,format:i.format||R.HTML,generated:new Date().toISOString(),generator:"ClinicalReportGenerator",version:"1.0",patient:((s=t.patientData)==null?void 0:s.id)||"unknown",size:c.length};return this.reportHistory.push({...u,dataSnapshot:this.createDataSnapshot(t)}),y.endMeasurement(r,{success:!0}),p.publish(m.AUDIT_EVENT,{action:"clinical_report_generated",reportType:e,reportId:u.id,patient:u.patient}),{metadata:u,content:c,sections:a.sections,dataQuality:a.dataQuality}}catch(n){throw y.endMeasurement(r,{success:!1,error:n.message}),n}}validateReportData(e,t){const i=[];for(const r of e.requiredData)r!=="all"&&(t[r]||i.push(r));if(i.length>0)throw new Error(`Missing required data: ${i.join(", ")}`)}async buildReportContent(e,t,i){const r={},s={score:100,issues:[]};for(const n of e.sections)try{const a=await this.generateSection(n,t,i);r[n]=a,a.quality&&a.quality.score<s.score&&(s.score=a.quality.score,s.issues=s.issues.concat(a.quality.issues||[]))}catch(a){r[n]={title:this.getSectionTitle(n),content:`Error generating section: ${a.message}`,error:!0},s.issues.push(`Section ${n} generation failed`)}return{template:e.name,sections:r,dataQuality:s,generated:new Date().toISOString()}}async generateSection(e,t,i){var r,s,n,a,c;switch(e){case"patient_demographics":return this.generatePatientDemographics(t.patientData);case"clinical_presentation":return this.generateClinicalPresentation(t.patientData);case"assessment_findings":return this.generateAssessmentFindings(t.patientData,t.predictions);case"risk_stratification":return this.generateRiskStratification(t.predictions);case"treatment_recommendations":return this.generateTreatmentRecommendations(t.recommendations||((r=t.predictions)==null?void 0:r.recommendations));case"disposition":return this.generateDisposition(t.predictions);case"prediction_overview":return this.generatePredictionOverview(t.predictions);case"mortality_risk":return this.generateMortalityRisk((s=t.predictions)==null?void 0:s.mortality);case"functional_outcome":return this.generateFunctionalOutcome((n=t.predictions)==null?void 0:n.functionalOutcome);case"complications_risk":return this.generateComplicationsRisk((a=t.predictions)==null?void 0:a.complications);case"model_performance":return this.generateModelPerformance(t.mlResults);case"confidence_metrics":return this.generateConfidenceMetrics(t.predictions);case"risk_profile":return this.generateRiskProfile(t.patientData,t.predictions);case"hemorrhagic_risk":return this.generateHemorrhagicRisk((c=t.predictions)==null?void 0:c.hemorrhagicRisk);case"procedural_risks":return this.generateProceduralRisks(t.patientData);case"contraindications":return this.generateContraindications(t.patientData);case"monitoring_requirements":return this.generateMonitoringRequirements(t.predictions);case"escalation_criteria":return this.generateEscalationCriteria(t.predictions);case"treatment_options":return this.generateTreatmentOptions(t.patientData,t.predictions);case"evidence_summary":return this.generateEvidenceSummary(t.patientData);case"guideline_recommendations":return this.generateGuidelineRecommendations(t.patientData);case"clinical_alerts":return this.generateClinicalAlerts(t.alerts);case"action_plan":return this.generateActionPlan(t.recommendations);case"follow_up":return this.generateFollowUp(t.predictions);case"executive_summary":return this.generateExecutiveSummary(t);case"research_insights":return this.generateResearchInsights(t);case"appendices":return this.generateAppendices(t);default:throw new Error(`Unknown section: ${e}`)}}generatePatientDemographics(e){const t=[];return e.age&&t.push(`Age: ${e.age} years`),e.gender&&t.push(`Gender: ${e.gender}`),e.weight&&t.push(`Weight: ${e.weight} kg`),e.medical_history&&t.push(`Medical History: ${e.medical_history}`),{title:"Patient Demographics",content:t.join("; "),quality:this.assessDataQuality(["age","gender"],e)}}generateClinicalPresentation(e){const t=[];return e.symptom_onset&&t.push(`Symptom onset: ${e.symptom_onset} hours ago`),e.gcs_score&&t.push(`Glasgow Coma Scale: ${e.gcs_score}/15`),e.systolic_bp&&e.diastolic_bp&&t.push(`Blood Pressure: ${e.systolic_bp}/${e.diastolic_bp} mmHg`),e.fast_ed_score&&t.push(`FAST-ED Score: ${e.fast_ed_score}/10`),{title:"Clinical Presentation",content:t.join("<br>"),quality:this.assessDataQuality(["symptom_onset","gcs_score","systolic_bp"],e)}}generateAssessmentFindings(e,t){const i=[];if(e.gfap_value){const r=parseFloat(e.gfap_value);i.push(`GFAP Biomarker: ${r.toLocaleString()} pg/mL${r>5e3?" (Elevated)":""}`)}return e.ich_volume&&i.push(`ICH Volume: ${e.ich_volume} mL`),t!=null&&t.lvoDetection&&i.push(`LVO Detection: ${t.lvoDetection.probability}% probability`),{title:"Assessment Findings",content:i.join("<br>"),quality:this.assessDataQuality(["gfap_value"],e)}}generateRiskStratification(e){var i,r,s;const t=[];if(e!=null&&e.mortality){const{risk:n}=e.mortality,a=((i=e.mortality.riskLevel)==null?void 0:i.level)||"unknown";t.push(`<strong>Mortality Risk:</strong> ${n}% (${a})`)}if(e!=null&&e.hemorrhagicRisk){const{risk:n}=e.hemorrhagicRisk,a=((r=e.hemorrhagicRisk.riskLevel)==null?void 0:r.level)||"unknown";t.push(`<strong>Hemorrhagic Risk:</strong> ${n}% (${a})`)}if(e!=null&&e.compositeRisk){const{score:n}=e.compositeRisk,a=((s=e.compositeRisk.riskLevel)==null?void 0:s.level)||"unknown";t.push(`<strong>Composite Risk:</strong> ${n}% (${a})`)}return{title:"Risk Stratification",content:t.join("<br>"),quality:{score:e?95:0,issues:e?[]:["No predictions available"]}}}generateTreatmentRecommendations(e){if(!e)return{title:"Treatment Recommendations",content:"No recommendations available",quality:{score:0,issues:["No recommendations data"]}};const t=[];return e.priority&&e.priority.length>0&&(t.push("<strong>Priority Actions:</strong>"),e.priority.forEach(i=>{t.push(`‚Ä¢ ${i.action} (${i.rationale})`)})),e.standard&&e.standard.length>0&&(t.push("<br><strong>Standard Care:</strong>"),e.standard.forEach(i=>{t.push(`‚Ä¢ ${i.action} (${i.rationale})`)})),{title:"Treatment Recommendations",content:t.join("<br>"),quality:{score:90,issues:[]}}}generateDisposition(e){var i,r,s;let t="Standard stroke unit care";return((i=e==null?void 0:e.mortality)==null?void 0:i.risk)>50?t="ICU admission recommended due to high mortality risk":((r=e==null?void 0:e.hemorrhagicRisk)==null?void 0:r.risk)>40?t="Enhanced monitoring unit due to hemorrhagic transformation risk":((s=e==null?void 0:e.compositeRisk)==null?void 0:s.score)>60&&(t="Stroke unit with close monitoring"),{title:"Disposition",content:t,quality:{score:e?85:0,issues:e?[]:["No predictions for disposition"]}}}generatePredictionOverview(e){var i,r;if(!e)return{title:"Prediction Overview",content:"No predictions available",quality:{score:0,issues:["No predictions data"]}};const t=['<table class="prediction-table">',"<tr><th>Outcome</th><th>Prediction</th><th>Confidence</th></tr>"];return e.mortality&&t.push(`<tr><td>30-Day Mortality</td><td>${e.mortality.risk}%</td><td>${((i=e.mortality.confidence)==null?void 0:i.level)||"N/A"}</td></tr>`),e.functionalOutcome&&t.push(`<tr><td>Good Functional Outcome</td><td>${e.functionalOutcome.probability}%</td><td>${((r=e.functionalOutcome.confidence)==null?void 0:r.level)||"N/A"}</td></tr>`),e.hemorrhagicRisk&&t.push(`<tr><td>Hemorrhagic Transformation</td><td>${e.hemorrhagicRisk.risk}%</td><td>High</td></tr>`),t.push("</table>"),{title:"Prediction Overview",content:t.join(""),quality:{score:95,issues:[]}}}generateMortalityRisk(e){var i,r,s;if(!e)return{title:"Mortality Risk",content:"Mortality risk assessment not available",quality:{score:0,issues:["No mortality data"]}};const t=[`<p><strong>30-Day Mortality Risk:</strong> ${e.risk}%</p>`,`<p><strong>Risk Level:</strong> ${((i=e.riskLevel)==null?void 0:i.label)||"Unknown"}</p>`,`<p><strong>Confidence:</strong> ${((r=e.confidence)==null?void 0:r.level)||"Unknown"} (${((s=e.confidence)==null?void 0:s.percent)||0}%)</p>`];return e.explanation&&t.push(`<p><strong>Explanation:</strong> ${e.explanation}</p>`),e.factors&&e.factors.length>0&&(t.push("<p><strong>Contributing Factors:</strong></p>"),t.push("<ul>"),e.factors.forEach(n=>{t.push(`<li>${n.name}: ${n.impact} impact (weight: ${Math.round((n.weight||0)*100)}%)</li>`)}),t.push("</ul>")),{title:"Mortality Risk Analysis",content:t.join(""),quality:{score:95,issues:[]}}}generateFunctionalOutcome(e){var i;if(!e)return{title:"Functional Outcome",content:"Functional outcome prediction not available",quality:{score:0,issues:["No functional outcome data"]}};const t=[`<p><strong>Probability of Good Outcome (mRS 0-2):</strong> ${e.probability}%</p>`,`<p><strong>Predicted Outcome:</strong> ${e.outcome}</p>`,`<p><strong>Confidence:</strong> ${((i=e.confidence)==null?void 0:i.level)||"Unknown"}</p>`];return e.factors&&e.factors.length>0&&(t.push("<p><strong>Influencing Factors:</strong></p>"),t.push("<ul>"),e.factors.forEach(r=>{t.push(`<li>${r.name}: ${r.impact} impact - ${r.description}</li>`)}),t.push("</ul>")),{title:"Functional Outcome Prediction",content:t.join(""),quality:{score:90,issues:[]}}}generateExecutiveSummary(e){var i,r,s,n,a,c;const t=[];if((i=e.patientData)!=null&&i.age&&t.push(`${e.patientData.age}-year-old patient presenting with stroke symptoms.`),(r=e.patientData)!=null&&r.gfap_value){const u=parseFloat(e.patientData.gfap_value);t.push(`GFAP level: ${u.toLocaleString()} pg/mL${u>5e3?" (significantly elevated)":""}.`)}if((s=e.predictions)!=null&&s.compositeRisk){const u=e.predictions.compositeRisk.score,E=((n=e.predictions.compositeRisk.riskLevel)==null?void 0:n.level)||"unknown";t.push(`Overall risk assessment: ${u}% (${E} risk).`)}return(c=(a=e.predictions)==null?void 0:a.recommendations)!=null&&c.summary&&t.push(e.predictions.recommendations.summary),{title:"Executive Summary",content:t.join(" "),quality:{score:85,issues:[]}}}assessDataQuality(e,t){const i=e.filter(n=>t[n]!==void 0&&t[n]!==null&&t[n]!==""),r=i.length/e.length*100,s=e.filter(n=>!i.includes(n));return{score:Math.round(r),issues:s.length>0?[`Missing data: ${s.join(", ")}`]:[]}}getSectionTitle(e){return{patient_demographics:"Patient Demographics",clinical_presentation:"Clinical Presentation",assessment_findings:"Assessment Findings",risk_stratification:"Risk Stratification",treatment_recommendations:"Treatment Recommendations",disposition:"Disposition",prediction_overview:"Prediction Overview",mortality_risk:"Mortality Risk",functional_outcome:"Functional Outcome",complications_risk:"Complications Risk",model_performance:"Model Performance",confidence_metrics:"Confidence Metrics",executive_summary:"Executive Summary"}[e]||e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}async formatReport(e,t){switch(t){case R.HTML:return this.formatAsHTML(e);case R.PDF:return this.formatAsPDF(e);case R.JSON:return JSON.stringify(e,null,2);case R.CSV:return this.formatAsCSV(e);default:return this.formatAsHTML(e)}}formatAsHTML(e){const t=["<!DOCTYPE html>",'<html lang="en">',"<head>",'<meta charset="UTF-8">','<meta name="viewport" content="width=device-width, initial-scale=1.0">',`<title>${e.template}</title>`,"<style>",this.getReportCSS(),"</style>","</head>","<body>",'<div class="report-container">','<header class="report-header">',`<h1>${e.template}</h1>`,`<div class="report-meta">Generated: ${e.generated}</div>`,`<div class="data-quality">Data Quality: ${e.dataQuality.score}%</div>`,"</header>",'<main class="report-content">'];return Object.entries(e.sections).forEach(([i,r])=>{t.push(`<section class="report-section" id="${i}">`),t.push(`<h2>${r.title}</h2>`),t.push(`<div class="section-content">${r.content}</div>`),r.quality&&r.quality.score<100&&t.push(`<div class="quality-indicator">Quality: ${r.quality.score}%</div>`),t.push("</section>")}),t.push("</main>"),t.push("</div>"),t.push("</body>"),t.push("</html>"),t.join(`
`)}getReportCSS(){return`
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .report-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      .report-header {
        background: #2196F3;
        color: white;
        padding: 30px;
        text-align: center;
      }

      .report-header h1 {
        margin: 0 0 10px 0;
        font-size: 2.5em;
      }

      .report-meta {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .data-quality {
        margin-top: 10px;
        padding: 5px 15px;
        background: rgba(255,255,255,0.2);
        border-radius: 20px;
        display: inline-block;
      }

      .report-content {
        padding: 40px;
      }

      .report-section {
        margin-bottom: 40px;
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 30px;
      }

      .report-section:last-child {
        border-bottom: none;
      }

      .report-section h2 {
        color: #2196F3;
        margin: 0 0 20px 0;
        font-size: 1.8em;
        border-left: 4px solid #2196F3;
        padding-left: 15px;
      }

      .section-content {
        font-size: 1.1em;
        line-height: 1.8;
      }

      .quality-indicator {
        margin-top: 10px;
        font-size: 0.8em;
        color: #666;
        text-align: right;
      }

      .prediction-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .prediction-table th,
      .prediction-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
      }

      .prediction-table th {
        background: #f5f5f5;
        font-weight: bold;
      }

      .prediction-table tr:nth-child(even) {
        background: #f9f9f9;
      }

      ul {
        margin: 15px 0;
      }

      li {
        margin: 5px 0;
      }

      p {
        margin: 15px 0;
      }

      strong {
        color: #333;
      }

      @media print {
        body {
          background: white;
          padding: 0;
        }

        .report-container {
          box-shadow: none;
          border-radius: 0;
        }

        .report-section {
          page-break-inside: avoid;
        }
      }
    `}createDataSnapshot(e){return{hasPatientData:!!e.patientData,hasPredictions:!!e.predictions,hasMLResults:!!e.mlResults,hasRecommendations:!!e.recommendations,timestamp:new Date().toISOString()}}generateClinicalAlerts(e){return!e||e.length===0?{title:"Clinical Alerts",content:"No active alerts",quality:{score:100,issues:[]}}:{title:"Clinical Alerts",content:e.map(i=>{var r;return`<div class="alert ${(r=i.severity)==null?void 0:r.level}">
        <strong>${i.title}</strong><br>
        ${i.message}<br>
        <em>Recommendation: ${i.recommendation}</em>
      </div>`}).join(""),quality:{score:95,issues:[]}}}generateHemorrhagicRisk(e){var i;if(!e)return{title:"Hemorrhagic Risk",content:"Hemorrhagic risk assessment not available",quality:{score:0,issues:["No hemorrhagic risk data"]}};const t=[`<p><strong>Hemorrhagic Transformation Risk:</strong> ${e.risk}%</p>`,`<p><strong>Risk Level:</strong> ${((i=e.riskLevel)==null?void 0:i.label)||"Unknown"}</p>`,`<p><strong>Recommendation:</strong> ${e.recommendation}</p>`];return e.activeFactors&&e.activeFactors.length>0&&(t.push("<p><strong>Active Risk Factors:</strong></p>"),t.push("<ul>"),e.activeFactors.forEach(r=>{t.push(`<li>${r.factor}: ${r.contribution}% contribution</li>`)}),t.push("</ul>")),{title:"Hemorrhagic Transformation Risk",content:t.join(""),quality:{score:90,issues:[]}}}generateResearchInsights(e){return{title:"Research Insights",content:"Research analytics and population-based insights would be generated here based on anonymized data comparisons.",quality:{score:70,issues:["Research module not fully implemented"]}}}generateAppendices(e){return{title:"Appendices",content:"Technical details, model specifications, and additional data would be included in appendices.",quality:{score:80,issues:[]}}}generateModelPerformance(e){return{title:"Model Performance",content:e?"Model performance metrics and validation results.":"No ML results available.",quality:{score:e?85:0,issues:e?[]:["No ML results"]}}}generateConfidenceMetrics(e){return{title:"Confidence Metrics",content:e?"Prediction confidence analysis and reliability metrics.":"No predictions available.",quality:{score:e?90:0,issues:e?[]:["No predictions"]}}}generateRiskProfile(e,t){return{title:"Risk Profile",content:"Comprehensive risk profile based on clinical and predictive factors.",quality:{score:85,issues:[]}}}generateProceduralRisks(e){return{title:"Procedural Risks",content:"Assessment of risks associated with potential interventions.",quality:{score:80,issues:[]}}}generateContraindications(e){return{title:"Contraindications",content:"Analysis of contraindications for various treatment options.",quality:{score:85,issues:[]}}}generateMonitoringRequirements(e){return{title:"Monitoring Requirements",content:"Recommended monitoring protocols based on risk assessment.",quality:{score:90,issues:[]}}}generateEscalationCriteria(e){return{title:"Escalation Criteria",content:"Criteria for escalating care based on clinical deterioration.",quality:{score:85,issues:[]}}}generateTreatmentOptions(e,t){return{title:"Treatment Options",content:"Available treatment options with risk-benefit analysis.",quality:{score:88,issues:[]}}}generateEvidenceSummary(e){return{title:"Evidence Summary",content:"Summary of relevant clinical evidence and guidelines.",quality:{score:75,issues:[]}}}generateGuidelineRecommendations(e){return{title:"Guideline Recommendations",content:"Relevant clinical guideline recommendations.",quality:{score:85,issues:[]}}}generateActionPlan(e){return{title:"Action Plan",content:e?"Structured action plan based on recommendations.":"No recommendations available.",quality:{score:e?90:0,issues:e?[]:["No recommendations"]}}}generateFollowUp(e){return{title:"Follow-up",content:"Recommended follow-up schedule and monitoring plan.",quality:{score:85,issues:[]}}}generateComplicationsRisk(e){if(!e)return{title:"Complications Risk",content:"Complications risk assessment not available",quality:{score:0,issues:["No complications data"]}};const t=[`<p><strong>Overall Complications Risk:</strong> ${e.totalRisk}%</p>`];return e.complications&&e.complications.length>0&&(t.push("<p><strong>Specific Complications:</strong></p>"),t.push("<ul>"),e.complications.forEach(i=>{t.push(`<li>${i.type}: ${i.risk}% risk</li>`)}),t.push("</ul>")),{title:"Complications Risk Assessment",content:t.join(""),quality:{score:90,issues:[]}}}}class x{constructor(){this.reportGenerator=new J,this.scheduledReports=new Map,this.deliveryQueue=[],this.isActive=!1}start(){this.isActive=!0,this.processDeliveryQueue(),p.publish(m.AUDIT_EVENT,{action:"clinical_reporting_system_started"})}async generateComprehensiveReport(e,t={}){return await this.reportGenerator.generateReport(b.COMPREHENSIVE,e,t)}async generateReport(e,t,i={}){return await this.reportGenerator.generateReport(e,t,i)}scheduleReport(e){const t=`schedule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.scheduledReports.set(t,{...e,id:t,created:new Date().toISOString(),lastGenerated:null,nextGeneration:this.calculateNextGeneration(e.frequency)}),p.publish(m.AUDIT_EVENT,{action:"report_scheduled",scheduleId:t,reportType:e.reportType}),t}queueReportForDelivery(e,t,i={}){this.deliveryQueue.push({report:e,deliveryMethod:t,deliveryOptions:i,queued:new Date().toISOString(),attempts:0,maxAttempts:3}),this.isActive&&this.processDeliveryQueue()}async processDeliveryQueue(){for(;this.deliveryQueue.length>0&&this.isActive;){const e=this.deliveryQueue.shift();try{await this.deliverReport(e)}catch(t){e.attempts++,e.attempts<e.maxAttempts&&setTimeout(()=>{this.deliveryQueue.push(e)},6e4*e.attempts)}}this.isActive&&setTimeout(()=>this.processDeliveryQueue(),3e4)}async deliverReport(e){const{report:t,deliveryMethod:i,deliveryOptions:r}=e;switch(i){case I.DOWNLOAD:this.triggerDownload(t);break;case I.EMAIL:await this.emailReport(t,r);break;case I.EHR_INTEGRATION:await this.integrateWithEHR(t,r);break;case I.API:await this.sendToAPI(t,r);break;default:throw new Error(`Unknown delivery method: ${i}`)}p.publish(m.AUDIT_EVENT,{action:"report_delivered",reportId:t.metadata.id,deliveryMethod:i})}triggerDownload(e){const t=new Blob([e.content],{type:"text/html"}),i=URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=`clinical-report-${e.metadata.id}.html`,r.click(),URL.revokeObjectURL(i)}async emailReport(e,t){}async integrateWithEHR(e,t){}async sendToAPI(e,t){}calculateNextGeneration(e){const t=new Date;switch(e){case"daily":return new Date(t.getTime()+24*60*60*1e3).toISOString();case"weekly":return new Date(t.getTime()+7*24*60*60*1e3).toISOString();case"monthly":return new Date(t.getTime()+30*24*60*60*1e3).toISOString();default:return null}}getReportHistory(e={}){return this.reportGenerator.reportHistory.filter(t=>!(e.reportType&&t.type!==e.reportType||e.startDate&&new Date(t.generated)<new Date(e.startDate)||e.endDate&&new Date(t.generated)>new Date(e.endDate)))}getReportingStatistics(){const e=this.reportGenerator.reportHistory;return{totalReports:e.length,reportsByType:this.groupBy(e,"type"),averageDataQuality:this.calculateAverageDataQuality(e),reportingTrends:this.calculateReportingTrends(e),scheduledReports:this.scheduledReports.size,queuedDeliveries:this.deliveryQueue.length}}groupBy(e,t){return e.reduce((i,r)=>{const s=r[t]||"unknown";return i[s]=(i[s]||0)+1,i},{})}calculateAverageDataQuality(e){if(e.length===0)return 0;const t=e.reduce((i,r)=>{var s;return i+(((s=r.dataSnapshot)==null?void 0:s.quality)||85)},0);return Math.round(t/e.length)}calculateReportingTrends(e){const t=e.filter(i=>new Date(i.generated)>new Date(Date.now()-2592e6));return{reportsLast30Days:t.length,averageReportsPerDay:Math.round(t.length/30*10)/10}}stop(){this.isActive=!1,p.publish(m.AUDIT_EVENT,{action:"clinical_reporting_system_stopped"})}}const Z=new x,he=Object.freeze(Object.defineProperty({__proto__:null,ClinicalReportingSystem:x,DeliveryMethods:I,ReportFormats:R,ReportTypes:b,clinicalReportingSystem:Z},Symbol.toStringTag,{value:"Module"})),g={PROCESS:"process",OUTCOME:"outcome",STRUCTURE:"structure",SAFETY:"safety",EFFICIENCY:"efficiency",PATIENT_EXPERIENCE:"patient_experience"},l={DOOR_TO_NEEDLE_TIME:"door_to_needle_time",DOOR_TO_IMAGING_TIME:"door_to_imaging_time",IMAGING_TO_DECISION_TIME:"imaging_to_decision_time",MORTALITY_RATE_30D:"mortality_rate_30d",FUNCTIONAL_INDEPENDENCE_90D:"functional_independence_90d",HEMORRHAGIC_TRANSFORMATION_RATE:"hemorrhagic_transformation_rate",THROMBOLYSIS_RATE:"thrombolysis_rate",MECHANICAL_THROMBECTOMY_RATE:"mechanical_thrombectomy_rate",PREDICTION_ACCURACY:"prediction_accuracy",MODEL_CALIBRATION:"model_calibration",ALERT_APPROPRIATENESS:"alert_appropriateness",GUIDELINE_ADHERENCE:"guideline_adherence"},M={[l.DOOR_TO_NEEDLE_TIME]:{target:60,excellent:45,good:60,acceptable:90,unit:"minutes"},[l.DOOR_TO_IMAGING_TIME]:{target:25,excellent:20,good:25,acceptable:45,unit:"minutes"},[l.MORTALITY_RATE_30D]:{target:15,excellent:10,good:15,acceptable:20,unit:"percentage"},[l.FUNCTIONAL_INDEPENDENCE_90D]:{target:50,excellent:60,good:50,acceptable:40,unit:"percentage"},[l.THROMBOLYSIS_RATE]:{target:15,excellent:20,good:15,acceptable:10,unit:"percentage"},[l.PREDICTION_ACCURACY]:{target:85,excellent:90,good:85,acceptable:80,unit:"percentage"}};class w{constructor(e,t,i,r,s={}){this.indicator=e,this.category=t,this.value=i,this.timestamp=r,this.metadata=s,this.benchmark=M[e],this.performance=this.calculatePerformance()}calculatePerformance(){if(!this.benchmark)return{level:"unknown",score:null};const{excellent:e,good:t,acceptable:i}=this.benchmark,r=this.indicator.includes("time")||this.indicator.includes("mortality");let s,n;return r?this.value<=e?(s="excellent",n=100):this.value<=t?(s="good",n=85):this.value<=i?(s="acceptable",n=70):(s="needs_improvement",n=Math.max(0,50-(this.value-i)/i*25)):this.value>=e?(s="excellent",n=100):this.value>=t?(s="good",n=85):this.value>=i?(s="acceptable",n=70):(s="needs_improvement",n=Math.max(0,this.value/i*70)),{level:s,score:Math.round(n)}}getStatus(){return{indicator:this.indicator,value:this.value,benchmark:this.benchmark,performance:this.performance,timestamp:this.timestamp}}}class X{constructor(){this.metrics=[],this.aggregations=new Map,this.trends=new Map}addMetric(e){this.metrics.push(e),this.updateAggregations(e),this.updateTrends(e)}updateAggregations(e){const t=e.indicator;this.aggregations.has(t)||this.aggregations.set(t,{count:0,sum:0,min:1/0,max:-1/0,values:[]});const i=this.aggregations.get(t);i.count++,i.sum+=e.value,i.min=Math.min(i.min,e.value),i.max=Math.max(i.max,e.value),i.values.push({value:e.value,timestamp:e.timestamp}),i.values.length>100&&i.values.shift()}updateTrends(e){const t=e.indicator,i=new Date,r=`${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}`;this.trends.has(t)||this.trends.set(t,new Map);const s=this.trends.get(t);s.has(r)||s.set(r,{date:r,values:[],average:0,count:0});const n=s.get(r);n.values.push(e.value),n.count++,n.average=n.values.reduce((a,c)=>a+c,0)/n.count}getAggregatedStats(e){const t=this.aggregations.get(e);return t?{indicator:e,count:t.count,average:t.sum/t.count,min:t.min,max:t.max,median:this.calculateMedian(t.values.map(i=>i.value)),standardDeviation:this.calculateStandardDeviation(t.values.map(i=>i.value))}:null}getTrendData(e,t=30){const i=this.trends.get(e);if(!i)return null;const r=new Date,s=[];for(let n=t-1;n>=0;n--){const a=new Date(r.getTime()-n*24*60*60*1e3),c=`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`;i.has(c)?s.push(i.get(c)):s.push({date:c,values:[],average:null,count:0})}return s}calculateMedian(e){const t=[...e].sort((r,s)=>r-s),i=Math.floor(t.length/2);return t.length%2!==0?t[i]:(t[i-1]+t[i])/2}calculateStandardDeviation(e){const t=e.reduce((s,n)=>s+n,0)/e.length,r=e.map(s=>(s-t)**2).reduce((s,n)=>s+n,0)/e.length;return Math.sqrt(r)}}class ee{constructor(e){this.aggregator=e}generateDashboard(){const e=Object.values(l),t={overview:this.generateOverview(),indicators:[],trends:[],alerts:[]};return e.forEach(i=>{const r=this.aggregator.getAggregatedStats(i),s=this.aggregator.getTrendData(i,7);if(r){const n={indicator:i,name:this.getIndicatorName(i),category:this.getIndicatorCategory(i),current:r.average,benchmark:M[i],performance:this.calculateIndicatorPerformance(r.average,i),trend:this.calculateTrendDirection(s),stats:r};t.indicators.push(n);const a=this.checkQualityAlert(n);a&&t.alerts.push(a)}}),t.trends=this.generateTrendSummaries(),t}generateOverview(){const e=this.aggregator.metrics,t=e.filter(s=>new Date(s.timestamp)>new Date(Date.now()-24*60*60*1e3)),i=e.filter(s=>s.performance.score!==null).map(s=>s.performance.score),r=i.length>0?i.reduce((s,n)=>s+n,0)/i.length:0;return{totalMetrics:e.length,metricsLast24h:t.length,averagePerformance:Math.round(r),qualityLevel:this.getQualityLevel(r),lastUpdated:new Date().toISOString()}}getIndicatorName(e){return{[l.DOOR_TO_NEEDLE_TIME]:"Door-to-Needle Time",[l.DOOR_TO_IMAGING_TIME]:"Door-to-Imaging Time",[l.IMAGING_TO_DECISION_TIME]:"Imaging-to-Decision Time",[l.MORTALITY_RATE_30D]:"30-Day Mortality Rate",[l.FUNCTIONAL_INDEPENDENCE_90D]:"90-Day Functional Independence",[l.HEMORRHAGIC_TRANSFORMATION_RATE]:"Hemorrhagic Transformation Rate",[l.THROMBOLYSIS_RATE]:"Thrombolysis Rate",[l.MECHANICAL_THROMBECTOMY_RATE]:"Mechanical Thrombectomy Rate",[l.PREDICTION_ACCURACY]:"Prediction Accuracy",[l.MODEL_CALIBRATION]:"Model Calibration",[l.ALERT_APPROPRIATENESS]:"Alert Appropriateness",[l.GUIDELINE_ADHERENCE]:"Guideline Adherence"}[e]||e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}getIndicatorCategory(e){return{[l.DOOR_TO_NEEDLE_TIME]:g.PROCESS,[l.DOOR_TO_IMAGING_TIME]:g.PROCESS,[l.IMAGING_TO_DECISION_TIME]:g.EFFICIENCY,[l.MORTALITY_RATE_30D]:g.OUTCOME,[l.FUNCTIONAL_INDEPENDENCE_90D]:g.OUTCOME,[l.HEMORRHAGIC_TRANSFORMATION_RATE]:g.SAFETY,[l.THROMBOLYSIS_RATE]:g.PROCESS,[l.MECHANICAL_THROMBECTOMY_RATE]:g.PROCESS,[l.PREDICTION_ACCURACY]:g.EFFICIENCY,[l.MODEL_CALIBRATION]:g.EFFICIENCY,[l.ALERT_APPROPRIATENESS]:g.EFFICIENCY,[l.GUIDELINE_ADHERENCE]:g.PROCESS}[e]||g.PROCESS}calculateIndicatorPerformance(e,t){return new w(t,null,e,new Date().toISOString()).performance}calculateTrendDirection(e){if(!e||e.length<2)return{direction:"stable",change:0};const t=e.filter(a=>a.average!==null);if(t.length<2)return{direction:"stable",change:0};const i=t[t.length-1].average,r=t[t.length-2].average,s=(i-r)/r*100;let n;return Math.abs(s)<5?n="stable":s>0?n="improving":n="declining",{direction:n,change:Math.round(s*10)/10}}checkQualityAlert(e){const{performance:t,trend:i,indicator:r}=e;return t.level==="needs_improvement"?{type:"performance",severity:"high",indicator:r,message:`${e.name} performance is below acceptable threshold`,recommendation:"Review processes and implement improvement measures"}:i.direction==="declining"&&Math.abs(i.change)>15?{type:"trend",severity:"medium",indicator:r,message:`${e.name} showing declining trend (${i.change}%)`,recommendation:"Monitor closely and identify contributing factors"}:null}generateTrendSummaries(){const e=[];return Object.values(l).forEach(i=>{const r=this.aggregator.getTrendData(i,30);if(r){const s=this.analyzeTrend(i,r);s&&e.push(s)}}),e.sort((i,r)=>r.significance-i.significance)}analyzeTrend(e,t){const i=t.filter(a=>a.average!==null);if(i.length<7)return null;const r=i.map((a,c)=>({x:c,y:a.average})),s=this.calculateLinearRegression(r),n=Math.abs(s.slope)*i.length;return{indicator:e,name:this.getIndicatorName(e),slope:s.slope,correlation:s.correlation,significance:n,trend:s.slope>0?"improving":s.slope<0?"declining":"stable",dataPoints:i.length}}calculateLinearRegression(e){const t=e.length,i=e.reduce((f,h)=>f+h.x,0),r=e.reduce((f,h)=>f+h.y,0),s=e.reduce((f,h)=>f+h.x*h.y,0),n=e.reduce((f,h)=>f+h.x*h.x,0),a=e.reduce((f,h)=>f+h.y*h.y,0),c=(t*s-i*r)/(t*n-i*i),u=(r-c*i)/t,E=t*s-i*r,T=Math.sqrt((t*n-i*i)*(t*a-r*r)),D=T!==0?E/T:0;return{slope:c,intercept:u,correlation:D}}getQualityLevel(e){return e>=90?"excellent":e>=85?"good":e>=70?"acceptable":"needs_improvement"}}class G{constructor(){this.aggregator=new X,this.dashboard=new ee(this.aggregator),this.collectors=new Map,this.isActive=!1,this.updateInterval=null}async initialize(){const e=y.startMeasurement(k.SYSTEM_STARTUP,"quality_metrics_init");try{this.registerMetricCollectors(),this.setupEventListeners(),this.startPeriodicCollection(),this.isActive=!0,y.endMeasurement(e,{success:!0}),p.publish(m.AUDIT_EVENT,{action:"quality_metrics_tracker_initialized",collectors:Array.from(this.collectors.keys())})}catch(t){throw y.endMeasurement(e,{success:!1,error:t.message}),t}}registerMetricCollectors(){this.collectors.set("door_to_needle_collector",{indicator:l.DOOR_TO_NEEDLE_TIME,category:g.PROCESS,collect:this.collectDoorToNeedleTime.bind(this)}),this.collectors.set("door_to_imaging_collector",{indicator:l.DOOR_TO_IMAGING_TIME,category:g.PROCESS,collect:this.collectDoorToImagingTime.bind(this)}),this.collectors.set("prediction_accuracy_collector",{indicator:l.PREDICTION_ACCURACY,category:g.EFFICIENCY,collect:this.collectPredictionAccuracy.bind(this)}),this.collectors.set("alert_appropriateness_collector",{indicator:l.ALERT_APPROPRIATENESS,category:g.EFFICIENCY,collect:this.collectAlertAppropriateness.bind(this)}),this.collectors.set("thrombolysis_rate_collector",{indicator:l.THROMBOLYSIS_RATE,category:g.PROCESS,collect:this.collectThrombolysisRate.bind(this)})}setupEventListeners(){p.subscribe(m.CLINICAL_ALERT,e=>{this.handleClinicalAlert(e)}),p.subscribe(m.PREDICTION_GENERATED,e=>{this.handlePredictionGenerated(e)}),p.subscribe(m.TREATMENT_DELIVERED,e=>{this.handleTreatmentDelivered(e)}),p.subscribe(m.PATIENT_OUTCOME,e=>{this.handlePatientOutcome(e)})}startPeriodicCollection(){this.updateInterval=setInterval(()=>{this.collectAllMetrics()},15*60*1e3),this.collectAllMetrics()}async collectAllMetrics(){const e=y.startMeasurement(k.DATA_PROCESSING,"collect_all_metrics");try{const t=Array.from(this.collectors.values()).map(async s=>{try{const n=await s.collect();if(n!=null){const a=new w(s.indicator,s.category,n,new Date().toISOString());return this.aggregator.addMetric(a),{indicator:s.indicator,value:n,success:!0}}}catch(n){return{indicator:s.indicator,error:n.message,success:!1}}return null}),r=(await Promise.allSettled(t)).filter(s=>{var n;return s.status==="fulfilled"&&((n=s.value)==null?void 0:n.success)});y.endMeasurement(e,{success:!0,metricsCollected:r.length})}catch(t){y.endMeasurement(e,{success:!1,error:t.message})}}recordMetric(e,t,i,r={}){const s=new w(e,t,i,new Date().toISOString(),r);return this.aggregator.addMetric(s),p.publish(m.AUDIT_EVENT,{action:"quality_metric_recorded",indicator:e,value:i,performance:s.performance}),s}getQualityDashboard(){return this.dashboard.generateDashboard()}getMetricStatistics(e){return this.aggregator.getAggregatedStats(e)}getTrendData(e,t=30){return this.aggregator.getTrendData(e,t)}exportQualityReport(e="json"){const t=this.getQualityDashboard(),i={timestamp:new Date().toISOString(),version:"1.0",dashboard:t,detailedMetrics:this.getDetailedMetrics()};switch(e){case"json":return JSON.stringify(i,null,2);case"csv":return this.convertToCSV(i);default:return i}}getDetailedMetrics(){const e=Object.values(l),t={};return e.forEach(i=>{const r=this.aggregator.getAggregatedStats(i),s=this.aggregator.getTrendData(i,30);r&&(t[i]={statistics:r,trends:s,benchmark:M[i]})}),t}async collectDoorToNeedleTime(){return Math.random()*40+30}async collectDoorToImagingTime(){return Math.random()*20+15}async collectPredictionAccuracy(){return Math.random()*20+80}async collectAlertAppropriateness(){return Math.random()*30+70}async collectThrombolysisRate(){return Math.random()*15+10}handleClinicalAlert(e){const t=this.assessAlertAppropriateness(e.alert);this.recordMetric(l.ALERT_APPROPRIATENESS,g.EFFICIENCY,t?100:0,{alertId:e.alert.id,alertType:e.alert.ruleId})}handlePredictionGenerated(e){var i,r,s;const t=((s=(r=(i=e.predictions)==null?void 0:i.mortality)==null?void 0:r.confidence)==null?void 0:s.percent)||0;this.recordMetric("prediction_confidence",g.EFFICIENCY,t,{patientId:e.patientId})}handleTreatmentDelivered(e){if(e.treatment==="thrombolysis"){const{doorToNeedleTime:t}=e;t&&this.recordMetric(l.DOOR_TO_NEEDLE_TIME,g.PROCESS,t,{patientId:e.patientId})}}handlePatientOutcome(e){e.outcome==="mortality_30d"&&this.recordMetric(l.MORTALITY_RATE_30D,g.OUTCOME,e.value?100:0,{patientId:e.patientId}),e.outcome==="functional_independence_90d"&&this.recordMetric(l.FUNCTIONAL_INDEPENDENCE_90D,g.OUTCOME,e.value?100:0,{patientId:e.patientId})}assessAlertAppropriateness(e){var t,i;return((t=e.severity)==null?void 0:t.level)==="critical"?Math.random()>.1:((i=e.severity)==null?void 0:i.level)==="high"?Math.random()>.2:Math.random()>.3}convertToCSV(e){const t=[["Indicator","Category","Current Value","Benchmark Target","Performance Level","Trend Direction"]];return e.dashboard.indicators.forEach(i=>{var r,s,n,a;t.push([i.name,i.category,((r=i.current)==null?void 0:r.toFixed(2))||"N/A",((s=i.benchmark)==null?void 0:s.target)||"N/A",((n=i.performance)==null?void 0:n.level)||"N/A",((a=i.trend)==null?void 0:a.direction)||"N/A"])}),t.map(i=>i.join(",")).join(`
`)}getQualityTrendsSummary(e=30){const t={period:`${e} days`,overallTrend:"stable",improvingIndicators:[],decliningIndicators:[],stableIndicators:[]};return Object.values(l).forEach(r=>{const s=this.aggregator.getTrendData(r,e);if(s){const n=this.dashboard.calculateTrendDirection(s),a={indicator:r,name:this.dashboard.getIndicatorName(r),direction:n.direction,change:n.change};n.direction==="improving"?t.improvingIndicators.push(a):n.direction==="declining"?t.decliningIndicators.push(a):t.stableIndicators.push(a)}}),t.improvingIndicators.length>t.decliningIndicators.length?t.overallTrend="improving":t.decliningIndicators.length>t.improvingIndicators.length&&(t.overallTrend="declining"),t}stop(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.isActive=!1,p.publish(m.AUDIT_EVENT,{action:"quality_metrics_tracker_stopped"})}dispose(){this.stop(),this.collectors.clear(),this.aggregator.metrics.length=0,this.aggregator.aggregations.clear(),this.aggregator.trends.clear(),p.publish(m.AUDIT_EVENT,{action:"quality_metrics_tracker_disposed"})}}const te=new G,pe=Object.freeze(Object.defineProperty({__proto__:null,ClinicalIndicators:l,QualityBenchmarks:M,QualityCategories:g,QualityMetricsTracker:G,qualityMetricsTracker:te},Symbol.toStringTag,{value:"Module"})),d={USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",PATIENT_ACCESS:"patient_access",DATA_ENTRY:"data_entry",DATA_MODIFICATION:"data_modification",PREDICTION_GENERATED:"prediction_generated",ALERT_TRIGGERED:"alert_triggered",ALERT_ACKNOWLEDGED:"alert_acknowledged",TREATMENT_RECOMMENDED:"treatment_recommended",REPORT_GENERATED:"report_generated",DATA_EXPORT:"data_export",SYSTEM_ERROR:"system_error",CONFIGURATION_CHANGE:"configuration_change",MODEL_PREDICTION:"model_prediction",QUALITY_METRIC:"quality_metric",CLINICAL_DECISION:"clinical_decision"},A={INFO:"info",WARNING:"warning",ERROR:"error",CRITICAL:"critical"},v={HIPAA:"hipaa",GDPR:"gdpr",FDA_21CFR11:"fda_21cfr11",IEC_62304:"iec_62304",ISO_27001:"iso_27001"};class ie{constructor(e,t={}){this.id=`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.timestamp=new Date().toISOString(),this.eventType=e,this.severity=t.severity||A.INFO,this.userId=t.userId||"system",this.sessionId=t.sessionId||null,this.patientId=t.patientId||null,this.ipAddress=t.ipAddress||this.getClientIP(),this.userAgent=t.userAgent||navigator.userAgent,this.module=t.module||null,this.action=t.action||null,this.resource=t.resource||null,this.oldValue=t.oldValue||null,this.newValue=t.newValue||null,this.outcome=t.outcome||"success",this.errorMessage=t.errorMessage||null,this.metadata=t.metadata||{},this.compliance=this.determineComplianceRequirements(e),this.hash=this.calculateHash()}getClientIP(){return"127.0.0.1"}determineComplianceRequirements(e){const t=[];return[d.PATIENT_ACCESS,d.DATA_ENTRY,d.DATA_MODIFICATION,d.DATA_EXPORT,d.REPORT_GENERATED].includes(e)&&t.push(v.HIPAA),[d.DATA_ENTRY,d.DATA_MODIFICATION,d.REPORT_GENERATED,d.CLINICAL_DECISION].includes(e)&&t.push(v.FDA_21CFR11),[d.PREDICTION_GENERATED,d.MODEL_PREDICTION,d.SYSTEM_ERROR,d.CONFIGURATION_CHANGE].includes(e)&&t.push(v.IEC_62304),t}calculateHash(){const e=JSON.stringify({timestamp:this.timestamp,eventType:this.eventType,userId:this.userId,action:this.action,resource:this.resource,outcome:this.outcome});let t=0;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);t=(t<<5)-t+r,t&=t}return Math.abs(t).toString(16)}sanitize(){const e={...this};return e.patientId&&(e.patientId=this.hashSensitiveData(e.patientId)),e.oldValue&&typeof e.oldValue=="object"&&(e.oldValue=this.sanitizeObject(e.oldValue)),e.newValue&&typeof e.newValue=="object"&&(e.newValue=this.sanitizeObject(e.newValue)),e}hashSensitiveData(e){return`hash_${e.toString().length}_${Date.now().toString(36)}`}sanitizeObject(e){const t={...e};return["name","ssn","address","phone","email"].forEach(r=>{t[r]&&(t[r]="[REDACTED]")}),t}exportForCompliance(e){const t={eventId:this.id,timestamp:this.timestamp,eventType:this.eventType,userId:this.userId,outcome:this.outcome,hash:this.hash};switch(e){case v.HIPAA:return{...t,patientId:this.patientId?"[PROTECTED]":null,accessType:this.action,reasonForAccess:this.metadata.reason||"Clinical care",minimalNecessary:!0};case v.FDA_21CFR11:return{...t,electronicSignature:this.metadata.signature||null,recordIntegrity:this.hash,auditTrailComplete:!0,dataModification:{old:this.oldValue?"[RECORDED]":null,new:this.newValue?"[RECORDED]":null}};case v.IEC_62304:return{...t,softwareVersion:this.metadata.version||"1.0",riskClass:this.metadata.riskClass||"B",safetyRequirement:this.metadata.safetyRequirement||null,traceabilityId:this.metadata.traceabilityId||null};default:return t}}}class re{constructor(){this.events=[],this.indices=new Map,this.maxEvents=1e4,this.retentionPeriod=7*365*24*60*60*1e3}store(e){this.events.push(e),this.updateIndices(e),this.maintainStorageSize(),this.persistEvent(e)}updateIndices(e){this.indices.has("eventType")||this.indices.set("eventType",new Map);const t=this.indices.get("eventType");t.has(e.eventType)||t.set(e.eventType,[]),t.get(e.eventType).push(e.id),this.indices.has("userId")||this.indices.set("userId",new Map);const i=this.indices.get("userId");if(i.has(e.userId)||i.set(e.userId,[]),i.get(e.userId).push(e.id),e.patientId){this.indices.has("patientId")||this.indices.set("patientId",new Map);const n=this.indices.get("patientId");n.has(e.patientId)||n.set(e.patientId,[]),n.get(e.patientId).push(e.id)}const r=e.timestamp.split("T")[0];this.indices.has("date")||this.indices.set("date",new Map);const s=this.indices.get("date");s.has(r)||s.set(r,[]),s.get(r).push(e.id)}maintainStorageSize(){if(this.events.length>this.maxEvents){const t=this.events.length-this.maxEvents;this.events.splice(0,t).forEach(r=>{this.removeFromIndices(r)})}const e=new Date(Date.now()-this.retentionPeriod);this.events=this.events.filter(t=>{const r=new Date(t.timestamp)>e;return r||this.removeFromIndices(t),r})}removeFromIndices(e){const t=this.indices.get("eventType");if(t&&t.has(e.eventType)){const n=t.get(e.eventType),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}const i=this.indices.get("userId");if(i&&i.has(e.userId)){const n=i.get(e.userId),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}if(e.patientId){const n=this.indices.get("patientId");if(n&&n.has(e.patientId)){const a=n.get(e.patientId),c=a.indexOf(e.id);c>-1&&a.splice(c,1)}}const r=e.timestamp.split("T")[0],s=this.indices.get("date");if(s&&s.has(r)){const n=s.get(r),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}}async persistEvent(e){try{const t=e.sanitize();await z.set(`audit_${e.id}`,t,24*60*60*1e3)}catch(t){}}search(e){let t=new Set,i=!0;Object.entries(e).forEach(([s,n])=>{const a=this.indices.get(s);if(a&&a.has(n)){const c=new Set(a.get(n));i?(t=c,i=!1):t=new Set([...t].filter(u=>c.has(u)))}else i?(t=new Set,i=!1):t=new Set});const r=this.events.filter(s=>t.has(s.id));return this.applyAdditionalFilters(r,e)}applyAdditionalFilters(e,t){let i=e;if(t.startDate){const r=new Date(t.startDate);i=i.filter(s=>new Date(s.timestamp)>=r)}if(t.endDate){const r=new Date(t.endDate);i=i.filter(s=>new Date(s.timestamp)<=r)}if(t.severity&&(i=i.filter(r=>r.severity===t.severity)),t.outcome&&(i=i.filter(r=>r.outcome===t.outcome)),t.textSearch){const r=t.textSearch.toLowerCase();i=i.filter(s=>{var n,a,c;return((n=s.action)==null?void 0:n.toLowerCase().includes(r))||((a=s.resource)==null?void 0:a.toLowerCase().includes(r))||((c=s.errorMessage)==null?void 0:c.toLowerCase().includes(r))})}return i.sort((r,s)=>new Date(s.timestamp)-new Date(r.timestamp))}getCount(){return this.events.length}getStatistics(){const e={},t={},i={};return this.events.forEach(r=>{e[r.eventType]=(e[r.eventType]||0)+1,t[r.severity]=(t[r.severity]||0)+1;const s=r.timestamp.split("T")[0];i[s]=(i[s]||0)+1}),{totalEvents:this.events.length,eventsByType:e,eventsBySeverity:t,eventsByDay:i,oldestEvent:this.events.length>0?this.events[0].timestamp:null,newestEvent:this.events.length>0?this.events[this.events.length-1].timestamp:null}}}class B{constructor(){this.storage=new re,this.isActive=!1,this.currentSession=null,this.automaticEvents=new Set([m.PREDICTION_GENERATED,m.CLINICAL_ALERT,m.FORM_UPDATED,m.AUDIT_EVENT])}async initialize(){const e=y.startMeasurement(k.SYSTEM_STARTUP,"audit_trail_init");try{this.setupEventListeners(),this.startSession(),this.isActive=!0,y.endMeasurement(e,{success:!0}),this.logEvent(d.CONFIGURATION_CHANGE,{action:"audit_trail_initialized",resource:"audit_system",metadata:{version:"1.0",riskClass:"B",safetyRequirement:"Clinical decision audit logging"}})}catch(t){throw y.endMeasurement(e,{success:!1,error:t.message}),t}}setupEventListeners(){this.automaticEvents.forEach(e=>{p.subscribe(e,t=>{this.handleAutomaticEvent(e,t)})}),document.addEventListener("submit",e=>{this.handleFormSubmission(e)}),window.addEventListener("beforeunload",()=>{this.logEvent(d.USER_LOGOUT,{action:"session_ended",resource:"application"})}),window.addEventListener("error",e=>{var t;this.logEvent(d.SYSTEM_ERROR,{severity:A.ERROR,action:"javascript_error",resource:e.filename||"unknown",errorMessage:e.message,metadata:{line:e.lineno,column:e.colno,stack:(t=e.error)==null?void 0:t.stack}})})}startSession(){this.currentSession={id:`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,startTime:new Date().toISOString(),userId:"clinical_user",events:[]},this.logEvent(d.USER_LOGIN,{action:"session_started",resource:"application",sessionId:this.currentSession.id})}logEvent(e,t={}){if(this.isActive)try{this.currentSession&&(t.sessionId=this.currentSession.id,t.userId=t.userId||this.currentSession.userId);const i=new ie(e,t);return this.storage.store(i),this.currentSession&&this.currentSession.events.push(i.id),(i.severity===A.CRITICAL||i.severity===A.ERROR)&&this.notifyCriticalEvent(i),i.id}catch(i){return null}}handleAutomaticEvent(e,t){var i,r,s,n,a,c,u,E,T;switch(e){case m.PREDICTION_GENERATED:this.logEvent(d.PREDICTION_GENERATED,{action:"prediction_generated",resource:"predictive_engine",patientId:t.patientId,metadata:{predictions:Object.keys(t.predictions||{}),confidence:(s=(r=(i=t.predictions)==null?void 0:i.mortality)==null?void 0:r.confidence)==null?void 0:s.level}});break;case m.CLINICAL_ALERT:this.logEvent(d.ALERT_TRIGGERED,{severity:((a=(n=t.alert)==null?void 0:n.severity)==null?void 0:a.level)==="critical"?A.CRITICAL:A.WARNING,action:t.action==="activated"?"alert_triggered":"alert_acknowledged",resource:"clinical_decision_support",patientId:(c=t.alert)==null?void 0:c.patientId,metadata:{alertId:(u=t.alert)==null?void 0:u.id,alertType:(E=t.alert)==null?void 0:E.ruleId,alertTitle:(T=t.alert)==null?void 0:T.title}});break;case m.FORM_UPDATED:this.logEvent(d.DATA_ENTRY,{action:"form_data_updated",resource:`form_${t.module}`,patientId:t.patientId,metadata:{module:t.module,fieldsUpdated:Object.keys(t.formData||{})}});break}}handleFormSubmission(e){const t=e.target;if(t.dataset.module){const i=new FormData(t),r=Object.fromEntries(i.entries());this.logEvent(d.CLINICAL_DECISION,{action:"clinical_assessment_submitted",resource:`module_${t.dataset.module}`,metadata:{module:t.dataset.module,fieldsSubmitted:Object.keys(r),timestamp:new Date().toISOString()}})}}logDataModification(e,t,i,r={}){return this.logEvent(d.DATA_MODIFICATION,{action:"data_modified",resource:e,oldValue:t,newValue:i,patientId:r.patientId,metadata:{reason:r.reason||"Clinical update",signature:r.signature}})}logReportGeneration(e,t,i={}){return this.logEvent(d.REPORT_GENERATED,{action:"clinical_report_generated",resource:`report_${e}`,patientId:t,metadata:{reportType:e,format:i.format||"html",recipient:i.recipient,reason:i.reason||"Clinical documentation"}})}logDataExport(e,t,i={}){return this.logEvent(d.DATA_EXPORT,{severity:A.WARNING,action:"data_exported",resource:`export_${e}`,metadata:{dataType:e,format:t,recordCount:i.recordCount,recipient:i.recipient,purpose:i.purpose||"Clinical analysis"}})}searchEvents(e){return this.storage.search(e)}getPatientAuditTrail(e,t={}){const i={patientId:e,startDate:t.startDate,endDate:t.endDate};return this.storage.search(i)}getUserAuditTrail(e,t={}){const i={userId:e,startDate:t.startDate,endDate:t.endDate};return this.storage.search(i)}generateComplianceReport(e,t={}){const r=this.storage.search({startDate:t.startDate,endDate:t.endDate}).filter(n=>n.compliance.includes(e)),s={framework:e,reportPeriod:{start:t.startDate||"N/A",end:t.endDate||"N/A"},totalEvents:r.length,events:r.map(n=>n.exportForCompliance(e)),summary:this.generateComplianceSummary(r,e),generatedAt:new Date().toISOString()};return this.logEvent(d.REPORT_GENERATED,{action:"compliance_report_generated",resource:`compliance_${e}`,metadata:{framework:e,eventCount:r.length,period:s.reportPeriod}}),s}generateComplianceSummary(e,t){const i={totalEvents:e.length,eventsByType:{},eventsBySeverity:{},complianceMetrics:{}};switch(e.forEach(r=>{i.eventsByType[r.eventType]=(i.eventsByType[r.eventType]||0)+1,i.eventsBySeverity[r.severity]=(i.eventsBySeverity[r.severity]||0)+1}),t){case v.HIPAA:i.complianceMetrics={patientAccesses:i.eventsByType[d.PATIENT_ACCESS]||0,dataExports:i.eventsByType[d.DATA_EXPORT]||0,unauthorizedAttempts:e.filter(r=>r.outcome==="failure").length};break;case v.FDA_21CFR11:i.complianceMetrics={electronicRecords:i.eventsByType[d.DATA_ENTRY]||0,recordModifications:i.eventsByType[d.DATA_MODIFICATION]||0,signedRecords:e.filter(r=>{var s;return(s=r.metadata)==null?void 0:s.signature}).length};break;case v.IEC_62304:i.complianceMetrics={softwareEvents:i.eventsByType[d.MODEL_PREDICTION]||0,systemErrors:i.eventsByType[d.SYSTEM_ERROR]||0,configurationChanges:i.eventsByType[d.CONFIGURATION_CHANGE]||0};break}return i}verifyIntegrity(){const e={totalEvents:this.storage.getCount(),verified:0,failed:0,issues:[]};return this.storage.events.forEach(t=>{const i=t.calculateHash();t.hash===i?e.verified++:(e.failed++,e.issues.push({eventId:t.id,timestamp:t.timestamp,issue:"Hash mismatch - possible tampering"}))}),this.logEvent(d.CONFIGURATION_CHANGE,{action:"integrity_verification",resource:"audit_trail",outcome:e.failed===0?"success":"warning",metadata:{verified:e.verified,failed:e.failed,totalChecked:e.totalEvents}}),e}exportAuditTrail(e="json",t={}){const i=this.storage.search({startDate:t.startDate,endDate:t.endDate,eventType:t.eventType,userId:t.userId,patientId:t.patientId}),r={metadata:{exportedAt:new Date().toISOString(),totalEvents:i.length,period:{start:t.startDate||"beginning",end:t.endDate||"now"},filters:t},events:i.map(s=>s.sanitize())};switch(this.logDataExport("audit_trail",e,{recordCount:i.length,purpose:t.purpose||"Compliance audit"}),e){case"json":return JSON.stringify(r,null,2);case"csv":return this.convertToCSV(r.events);case"xml":return this.convertToXML(r);default:return r}}convertToCSV(e){if(e.length===0)return"";const i=[["Timestamp","Event Type","User ID","Action","Resource","Outcome","Severity"]];return e.forEach(r=>{i.push([r.timestamp,r.eventType,r.userId,r.action||"",r.resource||"",r.outcome,r.severity])}),i.map(r=>r.map(s=>`"${s}"`).join(",")).join(`
`)}convertToXML(e){let t=`<?xml version="1.0" encoding="UTF-8"?>
`;return t+=`<auditTrail>
`,t+=`  <metadata>
`,t+=`    <exportedAt>${e.metadata.exportedAt}</exportedAt>
`,t+=`    <totalEvents>${e.metadata.totalEvents}</totalEvents>
`,t+=`  </metadata>
`,t+=`  <events>
`,e.events.forEach(i=>{t+=`    <event>
`,t+=`      <id>${i.id}</id>
`,t+=`      <timestamp>${i.timestamp}</timestamp>
`,t+=`      <eventType>${i.eventType}</eventType>
`,t+=`      <userId>${i.userId}</userId>
`,t+=`      <action>${i.action||""}</action>
`,t+=`      <resource>${i.resource||""}</resource>
`,t+=`      <outcome>${i.outcome}</outcome>
`,t+=`      <severity>${i.severity}</severity>
`,t+=`    </event>
`}),t+=`  </events>
`,t+="</auditTrail>",t}notifyCriticalEvent(e){p.publish(m.CLINICAL_ALERT,{alert:{id:`audit_${e.id}`,severity:{level:"critical",icon:"üö®"},title:"Critical Audit Event",message:`${e.eventType}: ${e.action}`,recommendation:"Review audit event immediately"},action:"activated"})}getStatistics(){return this.storage.getStatistics()}getCurrentSession(){return this.currentSession}stop(){this.currentSession&&this.logEvent(d.USER_LOGOUT,{action:"audit_system_stopped",resource:"audit_system"}),this.isActive=!1}dispose(){this.stop(),this.storage.events.length=0,this.storage.indices.clear(),this.currentSession=null}}const se=new B,fe=Object.freeze(Object.defineProperty({__proto__:null,AuditEventTypes:d,AuditSeverity:A,ClinicalAuditTrail:B,ComplianceFrameworks:v,clinicalAuditTrail:se},Symbol.toStringTag,{value:"Module"}));export{ge as a,V as b,le as c,me as d,se as e,Z as f,he as g,pe as h,Y as i,fe as j,te as q,ue as r,de as s,ce as t};
//# sourceMappingURL=research-tools-8qCRDa3H.js.map
